var CABLES=function(t){var e={};function i(s){if(e[s])return e[s].exports;var r=e[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(s,r,function(e){return t[e]}.bind(null,r));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){t.exports=i(2)},function(t){t.exports=JSON.parse("{}")},function(t,e,i){"use strict";i.r(e);var s={};i.r(s),i.d(s,"getShortOpName",(function(){return p})),i.d(s,"shuffleArray",(function(){return _})),i.d(s,"shortId",(function(){return m})),i.d(s,"uuid",(function(){return T})),i.d(s,"generateUUID",(function(){return A})),i.d(s,"simpleId",(function(){return y})),i.d(s,"smoothStep",(function(){return v})),i.d(s,"smootherStep",(function(){return x})),i.d(s,"clamp",(function(){return I})),i.d(s,"map",(function(){return O})),i.d(s,"cacheBust",(function(){return R})),i.d(s,"copyArray",(function(){return S})),i.d(s,"basename",(function(){return P})),i.d(s,"jsonp",(function(){return F})),i.d(s,"ajaxSync",(function(){return C})),i.d(s,"ajax",(function(){return w})),i.d(s,"request",(function(){return M})),i.d(s,"keyCodeToName",(function(){return U})),i.d(s,"UTILS",(function(){return g}));var r={};i.r(r),i.d(r,"base64Chars",(function(){return k})),i.d(r,"base64lookup",(function(){return V})),i.d(r,"b64encTypesArray",(function(){return G})),i.d(r,"b64decTypedArray",(function(){return H}));var n={};i.r(n),i.d(n,"easeExpoIn",(function(){return K})),i.d(n,"easeExpoOut",(function(){return j})),i.d(n,"easeExpoInOut",(function(){return Q})),i.d(n,"easeCubicIn",(function(){return q})),i.d(n,"easeCubicOut",(function(){return J})),i.d(n,"easeCubicInOut",(function(){return Z})),i.d(n,"ANIM",(function(){return X})),i.d(n,"Anim",(function(){return $})),i.d(n,"TL",(function(){return tt}));var o={};i.r(o),i.d(o,"PatchConnectionReceiver",(function(){return kt})),i.d(o,"PatchConnectionSender",(function(){return Dt})),i.d(o,"PatchConnectorBroadcastChannel",(function(){return Vt}));class h{constructor(t){this._logs=[],this.initiator=t}stack(t){console.error("["+this.initiator+"] ",t),console.log((new Error).stack),window.gui&&window.gui.emitEvent("coreLogEvent",this.initiator,"error",t)}groupCollapsed(t){console.groupCollapsed("["+this.initiator+"] "+t)}table(t){console.table(t)}groupEnd(){console.groupEnd()}error(t){console.error("["+this.initiator+"]",...arguments),window.gui&&window.gui.emitEvent("coreLogEvent",this.initiator,"error",arguments)}info(t){console.error("["+this.initiator+"]",...arguments),window.gui&&window.gui.emitEvent("coreLogEvent",this.initiator,"info",arguments)}warn(t){console.warn("["+this.initiator+"]",...arguments),window.gui&&window.gui.emitEvent("coreLogEvent",this.initiator,"warn",arguments)}verbose(){(CABLES.UI&&CABLES.UI.logFilter.shouldPrint(this.initiator,...arguments)||!CABLES.logSilent)&&console.log("["+this.initiator+"]",...arguments),window.gui&&window.gui.emitEvent("coreLogEvent",this.initiator,"verbose",arguments)}log(t){(CABLES.UI&&CABLES.UI.logFilter.shouldPrint(this.initiator,...arguments)||!CABLES.logSilent)&&console.log("["+this.initiator+"]",...arguments),window.gui&&window.gui.emitEvent("coreLogEvent",this.initiator,"log",arguments)}userInteraction(t){}}const a={EASINGS:["linear","absolute","smoothstep","smootherstep","Cubic In","Cubic Out","Cubic In Out","Expo In","Expo Out","Expo In Out","Sin In","Sin Out","Sin In Out","Quart In","Quart Out","Quart In Out","Quint In","Quint Out","Quint In Out","Back In","Back Out","Back In Out","Elastic In","Elastic Out","Bounce In","Bounce Out"],EASING_LINEAR:0,EASING_ABSOLUTE:1,EASING_SMOOTHSTEP:2,EASING_SMOOTHERSTEP:3,EASING_CUBICSPLINE:4,EASING_CUBIC_IN:5,EASING_CUBIC_OUT:6,EASING_CUBIC_INOUT:7,EASING_EXPO_IN:8,EASING_EXPO_OUT:9,EASING_EXPO_INOUT:10,EASING_SIN_IN:11,EASING_SIN_OUT:12,EASING_SIN_INOUT:13,EASING_BACK_IN:14,EASING_BACK_OUT:15,EASING_BACK_INOUT:16,EASING_ELASTIC_IN:17,EASING_ELASTIC_OUT:18,EASING_BOUNCE_IN:19,EASING_BOUNCE_OUT:21,EASING_QUART_IN:22,EASING_QUART_OUT:23,EASING_QUART_INOUT:24,EASING_QUINT_IN:25,EASING_QUINT_OUT:26,EASING_QUINT_INOUT:27},l={OP_PORT_TYPE_VALUE:0,OP_PORT_TYPE_FUNCTION:1,OP_PORT_TYPE_OBJECT:2,OP_PORT_TYPE_TEXTURE:2,OP_PORT_TYPE_ARRAY:3,OP_PORT_TYPE_DYNAMIC:4,OP_PORT_TYPE_STRING:5,OP_VERSION_PREFIX:"_v"},c={PORT_DIR_IN:0,PORT_DIR_OUT:1},u={PACO_CLEAR:0,PACO_VALUECHANGE:1,PACO_OP_DELETE:2,PACO_UNLINK:3,PACO_LINK:4,PACO_LOAD:5,PACO_OP_CREATE:6,PACO_OP_ENABLE:7,PACO_OP_DISABLE:8,PACO_UIATTRIBS:9,PACO_VARIABLES:10,PACO_TRIGGERS:11,PACO_PORT_SETVARIABLE:12,PACO_PORT_SETANIMATED:13,PACO_PORT_ANIM_UPDATED:14,PACO_DESERIALIZE:15},g={float32Concat:function(t,e){t instanceof Float32Array||(t=new Float32Array(t)),e instanceof Float32Array||(e=new Float32Array(e));const i=new Float32Array(t.length+e.length);return i.set(t),i.set(e,t.length),i}},p=function(t){let e=t.split(".")[t.split(".").length-1];if(e.indexOf(l.OP_VERSION_PREFIX)>0){const t=e.split(l.OP_VERSION_PREFIX)[1];e=e.substring(0,e.length-(l.OP_VERSION_PREFIX+t).length)}return e},_=function(t){for(let e=t.length-1;e>0;e--){const i=Math.floor(Math.seededRandom()*(e+1)),s=t[e];t[e]=t[i],t[i]=s}return t},d={},f=function(){let t=Math.random().toString(36).substr(2,9);return d.hasOwnProperty(t)&&(t=f()),d[t]=!0,t},m=f,E=function(){let t=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const i=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?i:3&i|8).toString(16)})},T=E,A=E;let b=0;const y=function(){return b++,b},v=function(t){const e=Math.max(0,Math.min(1,(t-0)/1));return t=e*e*(3-2*e)},x=function(t){const e=Math.max(0,Math.min(1,(t-0)/1));return t=e*e*e*(e*(6*e-15)+10)},I=function(t,e,i){return Math.min(Math.max(t,e),i)},O=function(t,e,i,s,r,n){if(t>=i)return r;if(t<=e)return s;let o=!1;const h=Math.min(e,i),a=Math.max(e,i);h!=e&&(o=!0);let l=!1;const c=Math.min(s,r),u=Math.max(s,r);c!=s&&(l=!0);let g=0,p=0;return g=o?(a-t)*(u-c)/(a-h):(t-h)*(u-c)/(a-h),p=l?u-g:g+c,n?1==n?s+(t=Math.max(0,Math.min(1,(p-s)/(r-s))))*t*(3-2*t)*(r-s):2==n?s+(t=Math.max(0,Math.min(1,(p-s)/(r-s))))*t*t*(t*(6*t-15)+10)*(r-s):p:p};Math.randomSeed=1,Math.seededRandom=function(t,e){0===Math.randomSeed&&(Math.randomSeed=999*Math.random()),t=t||1,e=e||0,Math.randomSeed=(9301*Math.randomSeed+49297)%233280;return e+Math.randomSeed/233280*(t-e)},g.arrayWriteToEnd=function(t,e){for(let e=1;e<t.length;e++)t[e-1]=t[e];t[t.length-1]=e},g.isNumeric=function(t){return!isNaN(parseFloat(t))&&isFinite(t)},g.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},String.prototype.endl=function(){return this+"\n"},String.prototype.startsWith=function(t){return 0===this.indexOf(t)},String.prototype.endsWith=function(t){return this.match(t+"$")==t};const R=function(t){return t.indexOf("?")>-1?t+="&":t+="?",t+"cb="+CABLES.uuid()},S=function(t,e){if(!t)return null;(e=e||[]).length=t.length;for(let i=0;i<t.length;i++)e[i]=t[i];return e},P=function(t){let e="";if(!t)return"";const i=(t+"").split("/");if(i.length>0){let t=i[i.length-1].split("?");e=t[0],t=e.split("."),e=t[0]}return e};let N=null;const F=function(t,e){N=N||0,N++;const i=N;CABLES["jsonpFunc"+i]=function(t){e(!1,t)};let s="?";t.indexOf(s)>-1&&(s="&");const r=document.createElement("script");r.setAttribute("src",t+s+"callback=CABLES.jsonpFunc"+i),document.body.appendChild(r)},C=function(t,e,i,s,r){M({url:t,cb:e,method:i,data:s,contenttype:r,sync:!0})},w=function(t,e,i,s,r,n,o={}){M({url:t,cb:e,method:i,data:s,contenttype:r,sync:!1,jsonP:n,headers:o})},M=function(t){let e;t.hasOwnProperty("asynch")||(t.asynch=!0);try{e=new XMLHttpRequest}catch(t){}if(e.onreadystatechange=function(){4==e.readyState&&t.cb&&(200==e.status||0==e.status?t.cb(!1,e.responseText,e):t.cb(!0,e.responseText,e))},e.addEventListener("progress",t=>{}),e.open(t.method?t.method.toUpperCase():"GET",t.url,!t.sync),"object"==typeof t.headers){const i=Object.keys(t.headers);for(let s=0;s<i.length;s++){const r=i[s],n=t.headers[r];e.setRequestHeader(r,n)}}t.post||t.data?(e.setRequestHeader("Content-type",t.contenttype?t.contenttype:"application/x-www-form-urlencoded"),e.send(t.data||t.post)):e.send()},U=function(t){if(!t&&0!==t)return"Unidentified";const e={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"};return e[t]?e[t]:String.fromCharCode(t)};window.performance=window.performance||{offset:Date.now(),now:function(){return Date.now()-this.offset}};const L=function(t,e){if(!t)throw new Error("no cgl");this._log=new h("cgl_texture"),this._cgl=t,this.tex=this._cgl.gl.createTexture(),this.id=T(),this.width=0,this.height=0,this.loading=!1,this.flip=!0,this.flipped=!1,this.shadowMap=!1,this.deleted=!1,this.image=null,this.anisotropic=0,this.filter=L.FILTER_NEAREST,this.wrap=L.WRAP_CLAMP_TO_EDGE,this.texTarget=this._cgl.gl.TEXTURE_2D,e&&e.type&&(this.texTarget=e.type),this.textureType=L.TYPE_DEFAULT,this.unpackAlpha=!0,this._fromData=!0,this.name="unknown",e?(this.name=e.name||this.name,e.isDepthTexture&&(this.textureType=L.TYPE_DEPTH),e.isFloatingPointTexture&&(this.textureType=L.TYPE_FLOAT),"textureType"in e&&(this.textureType=e.textureType),"filter"in e&&(this.filter=e.filter),"wrap"in e&&(this.wrap=e.wrap),"unpackAlpha"in e&&(this.unpackAlpha=e.unpackAlpha),"flip"in e&&(this.flip=e.flip),"shadowMap"in e&&(this.shadowMap=e.shadowMap),"anisotropic"in e&&(this.anisotropic=e.anisotropic)):e={},e.width||(e.width=8),e.height||(e.height=8),this._cgl.profileData.profileTextureNew++,this._cgl.profileData.addHeavyEvent("texture created",this.name,e.width+"x"+e.height),this.setSize(e.width,e.height),this.getInfoOneLine()};L.prototype.isFloatingPoint=function(){return this.textureType==L.TYPE_FLOAT},L.prototype.compareSettings=function(t){return!!t&&(t.width==this.width&&t.height==this.height&&t.filter==this.filter&&t.wrap==this.wrap&&t.textureType==this.textureType&&t.unpackAlpha==this.unpackAlpha&&t.anisotropic==this.anisotropic&&t.shadowMap==this.shadowMap&&t.texTarget==this.texTarget&&t.flip==this.flip)},L.prototype.clone=function(){const t=new L(this._cgl,{name:this.name,filter:this.filter,wrap:this.wrap,textureType:this.textureType,unpackAlpha:this.unpackAlpha,flip:this.flip,width:this.width,height:this.height});return this._cgl.profileData.addHeavyEvent("texture created",this.name,this.width+"x"+this.height),this.compareSettings(t)||(this._log.error("Cloned texture settings do not compare!"),this._log.error(this),this._log.error(t)),t},L.prototype.setSize=function(t,e){if((t!=t||t<=0||!t)&&(t=8),(e!=e||e<=0||!e)&&(e=8),(t>this._cgl.maxTexSize||e>this._cgl.maxTexSize)&&this._log.error("texture size too big! "+t+"x"+e+" / max: "+this._cgl.maxTexSize),t=Math.min(t,this._cgl.maxTexSize),e=Math.min(e,this._cgl.maxTexSize),t=Math.floor(t),e=Math.floor(e),this.width==t&&this.height==e)return;this.width=t,this.height=e,this.deleted=!1,this.shortInfoString=this.getInfoOneLine(),this._cgl.gl.bindTexture(this.texTarget,this.tex),this._cgl.profileData.profileTextureResize++;if(this._cgl.patch.config.canvas.forceTextureNearest&&(this.filter=L.FILTER_NEAREST),1!=this._cgl.glVersion||this.textureType!=L.TYPE_FLOAT||this.filter!=L.FILTER_LINEAR||this._cgl.gl.getExtension("OES_texture_float_linear")||(console.warn("this graphics card does not support floating point texture linear interpolation! using NEAREST"),this.filter=L.FILTER_NEAREST),this.textureType==L.TYPE_FLOAT)if(1==this._cgl.glVersion)if(this._cgl.glUseHalfFloatTex){const i=this._cgl.gl.getExtension("OES_texture_half_float");this._cgl.gl.getExtension("EXT_color_buffer_half_float");if(!i)throw new Error("no half float texture extension");this._cgl.gl.texImage2D(this.texTarget,0,this._cgl.gl.RGBA,t,e,0,this._cgl.gl.RGBA,i.HALF_FLOAT_OES,null)}else this._cgl.gl.getExtension("OES_texture_float"),this._cgl.gl.texImage2D(this.texTarget,0,this._cgl.gl.RGBA,t,e,0,this._cgl.gl.RGBA,this._cgl.gl.FLOAT,null);else if(this._cgl.glUseHalfFloatTex){if(!this._cgl.gl.getExtension("EXT_color_buffer_half_float"))throw new Error("no half float texture extension");console.log("half float",this._cgl.gl.RGBA16F,this._cgl.gl.HALF_FLOAT),console.log("half float",this._cgl.gl.HALF_FLOAT),console.log("half float",this._cgl.gl.RGBA16F),this._cgl.gl.texImage2D(this.texTarget,0,this._cgl.gl.RGBA,t,e,0,this._cgl.gl.RGBA,this._cgl.gl.HALF_FLOAT,null)}else this._cgl.gl.getExtension("EXT_color_buffer_float"),this._cgl.gl.getExtension("EXT_color_buffer_float_linear"),this._cgl.gl.getExtension("OES_texture_float_linear"),this._cgl.gl.texImage2D(this.texTarget,0,this._cgl.gl.RGBA32F,t,e,0,this._cgl.gl.RGBA,this._cgl.gl.FLOAT,null);else if(this.textureType==L.TYPE_DEPTH)if(1==this._cgl.glVersion){const i=this._cgl.gl.DEPTH_COMPONENT;this._cgl.gl.texImage2D(this.texTarget,0,i,t,e,0,this._cgl.gl.DEPTH_COMPONENT,this._cgl.gl.UNSIGNED_SHORT,null)}else{const i=this._cgl.gl.DEPTH_COMPONENT32F;this._cgl.gl.texImage2D(this.texTarget,0,i,t,e,0,this._cgl.gl.DEPTH_COMPONENT,this._cgl.gl.FLOAT,null)}else this._cgl.gl.texImage2D(this.texTarget,0,this._cgl.gl.RGBA,t,e,0,this._cgl.gl.RGBA,this._cgl.gl.UNSIGNED_BYTE,null);this._setFilter(),this.updateMipMap(),this._cgl.gl.bindTexture(this.texTarget,null)},L.prototype.initFromData=function(t,e,i,s,r){if(this.filter=s,this.wrap=r,null==s&&(this.filter=L.FILTER_LINEAR),null==r&&(this.wrap=L.WRAP_CLAMP_TO_EDGE),this.width=e,this.height=i,this._fromData=!0,this.deleted=!1,this.height>this._cgl.maxTexSize||this.width>this._cgl.maxTexSize){const t=CGL.Texture.getTempTexture(this._cgl);return this.width=t.width,this.height=t.height,this.tex=t.tex,void this._log.error("[cgl_texture] texture size to big!!!",this.width,this.height,this._cgl.maxTexSize)}this.flip&&this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_FLIP_Y_WEBGL,this.flip),this._cgl.gl.bindTexture(this.texTarget,this.tex),this.textureType==L.TYPE_FLOAT?this._cgl.gl.texImage2D(this.texTarget,0,this._cgl.gl.RGBA32F,e,i,0,this._cgl.gl.RGBA,this._cgl.gl.FLOAT,t):this._cgl.gl.texImage2D(this.texTarget,0,this._cgl.gl.RGBA,e,i,0,this._cgl.gl.RGBA,this._cgl.gl.UNSIGNED_BYTE,t),this._setFilter(),this.updateMipMap(),this.flip&&this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_FLIP_Y_WEBGL,!1),this._cgl.gl.bindTexture(this.texTarget,null)},L.prototype.updateMipMap=function(){2!=this._cgl.glVersion&&!this.isPowerOfTwo()||this.filter!=L.FILTER_MIPMAP||(this._cgl.gl.generateMipmap(this.texTarget),this._cgl.profileData.profileGenMipMap++)},L.prototype.initTexture=function(t,e){if(this._cgl.printError("before initTexture"),this._cgl.checkFrameStarted("texture inittexture"),this._fromData=!1,this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.unpackAlpha),t.width&&(this.width=t.width),t.height&&(this.height=t.height),e&&(this.filter=e),t.height>this._cgl.maxTexSize||t.width>this._cgl.maxTexSize){const e=CGL.Texture.getTempTexture(this._cgl);return this.width=e.width,this.height=e.height,this.tex=e.tex,void this._log.error("[cgl_texture] texture size to big!!!",t.width,t.height,this._cgl.maxTexSize)}this._cgl.gl.bindTexture(this.texTarget,this.tex),this.deleted=!1,this.flipped=!this.flip,this.flipped&&this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_FLIP_Y_WEBGL,this.flipped),this._cgl.gl.texImage2D(this.texTarget,0,this._cgl.gl.RGBA,this._cgl.gl.RGBA,this._cgl.gl.UNSIGNED_BYTE,t),this._setFilter(),this.updateMipMap(),this._cgl.gl.bindTexture(this.texTarget,null),this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),this.flipped&&this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_FLIP_Y_WEBGL,!1),this.getInfoOneLine(),this._cgl.printError("initTexture")},L.prototype.delete=function(){this.loading||(this.deleted=!0,this.width=0,this.height=0,this._cgl.profileData.profileTextureDelete++,this._cgl.gl.deleteTexture(this.tex),this.image=null,this.tex=null)},L.prototype.isPowerOfTwo=function(){return L.isPowerOfTwo(this.width)&&L.isPowerOfTwo(this.height)},L.prototype.printInfo=function(){console.log(this.getInfo())},L.prototype.getInfoReadable=function(){const t=this.getInfo();let e="";t.name=t.name.substr(0,t.name.indexOf("?rnd="));for(const i in t)e+="* "+i+":  **"+t[i]+"**\n";return e},L.prototype.getInfoOneLine=function(){let t=this.width+" x "+this.height;return this.textureType===CGL.Texture.TYPE_FLOAT?t+=" 32bit":t+=" 8bit",this.filter===CGL.Texture.FILTER_NEAREST&&(t+=" nearest"),this.filter===CGL.Texture.FILTER_LINEAR&&(t+=" linear"),this.filter===CGL.Texture.FILTER_MIPMAP&&(t+=" mipmap"),this.wrap===CGL.Texture.WRAP_CLAMP_TO_EDGE&&(t+=" clamp"),this.wrap===CGL.Texture.WRAP_REPEAT&&(t+=" repeat"),this.wrap===CGL.Texture.WRAP_MIRRORED_REPEAT&&(t+=" repeatmir"),this.shortInfoString=t,t},L.prototype.getInfo=function(){const t={};t.name=this.name,t["power of two"]=this.isPowerOfTwo(),t.size=this.width+" x "+this.height;let e=this.texTarget;return this.texTarget==this._cgl.gl.TEXTURE_2D&&(e="TEXTURE_2D"),t.target=e,t.unpackAlpha=this.unpackAlpha,this.textureType==L.TYPE_FLOAT?t.textureType="TYPE_FLOAT":this.textureType==L.TYPE_DEPTH?t.textureType="TYPE_DEPTH":this.textureType==L.TYPE_DEFAULT?t.textureType="TYPE_DEFAULT":t.textureType="UNKNOWN",this.wrap==L.WRAP_CLAMP_TO_EDGE?t.wrap="CLAMP_TO_EDGE":this.wrap==L.WRAP_REPEAT?t.wrap="WRAP_REPEAT":this.wrap==L.WRAP_MIRRORED_REPEAT?t.wrap="WRAP_MIRRORED_REPEAT":t.wrap="UNKNOWN",this.filter==L.FILTER_NEAREST?t.filter="FILTER_NEAREST":this.filter==L.FILTER_LINEAR?t.filter="FILTER_LINEAR":this.filter==L.FILTER_MIPMAP?t.filter="FILTER_MIPMAP":t.filter="UNKNOWN",t},L.prototype._setFilter=function(){if(this._cgl.printError("before _setFilter"),this._fromData||this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.unpackAlpha),this.shadowMap&&(this._cgl.gl.texParameteri(this._cgl.gl.TEXTURE_2D,this._cgl.gl.TEXTURE_COMPARE_MODE,this._cgl.gl.COMPARE_REF_TO_TEXTURE),this._cgl.gl.texParameteri(this._cgl.gl.TEXTURE_2D,this._cgl.gl.TEXTURE_COMPARE_FUNC,this._cgl.gl.LEQUAL)),this.textureType==L.TYPE_FLOAT&&this.filter==L.FILTER_MIPMAP&&(this.filter=L.FILTER_LINEAR,this._log.stack("texture: HDR and mipmap filtering at the same time is not possible")),1!=this._cgl.glVersion||this.isPowerOfTwo()){if(this.wrap==L.WRAP_CLAMP_TO_EDGE?(this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_S,this._cgl.gl.CLAMP_TO_EDGE),this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_T,this._cgl.gl.CLAMP_TO_EDGE)):this.wrap==L.WRAP_REPEAT?(this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_S,this._cgl.gl.REPEAT),this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_T,this._cgl.gl.REPEAT)):this.wrap==L.WRAP_MIRRORED_REPEAT&&(this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_S,this._cgl.gl.MIRRORED_REPEAT),this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_T,this._cgl.gl.MIRRORED_REPEAT)),this.filter==L.FILTER_NEAREST)this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MAG_FILTER,this._cgl.gl.NEAREST),this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MIN_FILTER,this._cgl.gl.NEAREST);else if(this.filter==L.FILTER_LINEAR)this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MIN_FILTER,this._cgl.gl.LINEAR),this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MAG_FILTER,this._cgl.gl.LINEAR);else{if(this.filter!=L.FILTER_MIPMAP)throw this._log.log("unknown texture filter!",this.filter),new Error("unknown texture filter!"+this.filter);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MAG_FILTER,this._cgl.gl.LINEAR),this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MIN_FILTER,this._cgl.gl.LINEAR_MIPMAP_LINEAR)}if(this.anisotropic){const t=this._cgl.gl.getExtension("EXT_texture_filter_anisotropic");if(t){const e=this._cgl.gl.getParameter(t.MAX_TEXTURE_MAX_ANISOTROPY_EXT);this._cgl.gl.texParameterf(this._cgl.gl.TEXTURE_2D,t.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(e,this.anisotropic))}}}else this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MAG_FILTER,this._cgl.gl.NEAREST),this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MIN_FILTER,this._cgl.gl.NEAREST),this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_S,this._cgl.gl.CLAMP_TO_EDGE),this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_T,this._cgl.gl.CLAMP_TO_EDGE),this.filter=L.FILTER_NEAREST,this.wrap=L.WRAP_CLAMP_TO_EDGE;this.getInfoOneLine(),this._cgl.printError("_setFilter")},L.load=function(t,e,i,s){if(!e)return i({error:!0});let r=null;t.patch.loading.existByName(e)||(r=t.patch.loading.start("texture",e));const n=new L(t);return n.name=e,t.patch.isEditorMode()&&gui.jobs().start({id:"loadtexture"+r,title:"loading texture "+CABLES.basename(e)}),n.image=new Image,n.image.crossOrigin="anonymous",n.loading=!0,s&&s.hasOwnProperty("filter")&&(n.filter=s.filter),s&&s.hasOwnProperty("flip")&&(n.flip=s.flip),s&&s.hasOwnProperty("wrap")&&(n.wrap=s.wrap),s&&s.hasOwnProperty("anisotropic")&&(n.anisotropic=s.anisotropic),s&&s.hasOwnProperty("unpackAlpha")&&(n.unpackAlpha=s.unpackAlpha),n.image.onabort=n.image.onerror=s=>{console.warn("[cgl.texture.load] error loading texture",e,s),n.loading=!1,r&&t.patch.loading.finished(r);i&&i({error:!0},n),t.patch.isEditorMode()&&gui.jobs().finish("loadtexture"+r)},n.image.onload=function(e){t.addNextFrameOnceCallback(()=>{n.initTexture(n.image),r&&t.patch.loading.finished(r),n.loading=!1,t.patch.isEditorMode()&&gui.jobs().finish("loadtexture"+r),i&&i(null,n)})},n.image.src=e,n},L.getTempTexture=function(t){return t||console.error("[getTempTexture] no cgl!"),t.tempTexture||(t.tempTexture=L.getTemporaryTexture(t,256,L.FILTER_LINEAR,L.REPEAT)),t.tempTexture},L.getEmptyTexture=function(t,e){if(e)return L.getEmptyTextureFloat(t);if(t||console.error("[getEmptyTexture] no cgl!"),t.tempTextureEmpty)return t.tempTextureEmpty;t.tempTextureEmpty=new L(t,{name:"emptyTexture"});const i=new Uint8Array(256).fill(0);for(let t=0;t<256;t+=4)i[t+3]=0;return t.tempTextureEmpty.initFromData(i,8,8,L.FILTER_NEAREST,L.WRAP_REPEAT),t.tempTextureEmpty},L.getEmptyTextureFloat=function(t){if(t||console.error("[getEmptyTextureFloat] no cgl!"),t.tempTextureEmptyFloat)return t.tempTextureEmptyFloat;t.tempTextureEmptyFloat=new L(t,{name:"emptyTexture",isFloatingPointTexture:!0});const e=new Float32Array(256).fill(1);for(let t=0;t<256;t+=4)e[t+3]=0;return t.tempTextureEmptyFloat.initFromData(e,8,8,L.FILTER_NEAREST,L.WRAP_REPEAT),t.tempTextureEmptyFloat},L.getRandomTexture=function(t){if(t||console.error("[getRandomTexture] no cgl!"),t.randomTexture)return t.randomTexture;const e=new Uint8Array(262144);for(let t=0;t<65536;t++)e[4*t+0]=255*Math.random(),e[4*t+1]=255*Math.random(),e[4*t+2]=255*Math.random(),e[4*t+3]=255;return t.randomTexture=new L(t),t.randomTexture.initFromData(e,256,256,L.FILTER_NEAREST,L.WRAP_REPEAT),t.randomTexture},L.getBlackTexture=function(t){if(t||this._log.error("[getBlackTexture] no cgl!"),t.blackTexture)return t.blackTexture;const e=new Uint8Array(256);for(let t=0;t<64;t++)e[4*t+0]=e[4*t+1]=e[4*t+2]=0,e[4*t+3]=255;return t.blackTexture=new L(t),t.blackTexture.initFromData(e,8,8,L.FILTER_NEAREST,L.WRAP_REPEAT),t.blackTexture},L.getEmptyCubemapTexture=function(t){const e=[t.gl.TEXTURE_CUBE_MAP_POSITIVE_X,t.gl.TEXTURE_CUBE_MAP_NEGATIVE_X,t.gl.TEXTURE_CUBE_MAP_POSITIVE_Y,t.gl.TEXTURE_CUBE_MAP_NEGATIVE_Y,t.gl.TEXTURE_CUBE_MAP_POSITIVE_Z,t.gl.TEXTURE_CUBE_MAP_NEGATIVE_Z],i=t.gl.createTexture(),s=t.gl.TEXTURE_CUBE_MAP,r=L.FILTER_NEAREST,n=L.WRAP_CLAMP_TO_EDGE;t.profileData.profileTextureNew++,t.gl.bindTexture(s,i),t.profileData.profileTextureResize++;for(let i=0;i<6;i+=1){const r=new Uint8Array(256);t.gl.texImage2D(e[i],0,t.gl.RGBA,8,8,0,t.gl.RGBA,t.gl.UNSIGNED_BYTE,r),t.gl.texParameteri(s,t.gl.TEXTURE_MAG_FILTER,t.gl.NEAREST),t.gl.texParameteri(s,t.gl.TEXTURE_MIN_FILTER,t.gl.NEAREST),t.gl.texParameteri(s,t.gl.TEXTURE_WRAP_S,t.gl.CLAMP_TO_EDGE),t.gl.texParameteri(s,t.gl.TEXTURE_WRAP_T,t.gl.CLAMP_TO_EDGE)}return t.gl.bindTexture(s,null),{id:CABLES.uuid(),tex:i,cubemap:i,width:8,height:8,filter:r,wrap:n,unpackAlpha:!0,flip:!0,_fromData:!0,name:"emptyCubemapTexture",anisotropic:0}},L.getTempGradientTexture=function(t){if(t||console.error("[getTempGradientTexture] no cgl!"),t.tempTextureGradient)return t.tempTextureGradient;const e=new L(t),i=new Uint8Array(262144);for(let t=0;t<256;t++)for(let e=0;e<256;e++)i[4*(e+256*t)+0]=i[4*(e+256*t)+1]=i[4*(e+256*t)+2]=255-t,i[4*(e+256*t)+3]=255;return e.initFromData(i,256,256,L.FILTER_NEAREST,L.WRAP_REPEAT),t.tempTextureGradient=e,e},L.getTemporaryTexture=function(t,e,i,s){const r=new L(t),n=[];for(let t=0;t<e;t++)for(let i=0;i<e;i++)(i+t)%64<32?(n.push(200+t/e*25+i/e*25),n.push(200+t/e*25+i/e*25),n.push(200+t/e*25+i/e*25)):(n.push(40+t/e*25+i/e*25),n.push(40+t/e*25+i/e*25),n.push(40+t/e*25+i/e*25)),n.push(255);const o=new Uint8Array(n);return r.initFromData(o,e,e,i,s),r},L.createFromImage=function(t,e,i){const s=new L(t,i=i||{});return s.flip=!1,s.image=e,s.width=e.width,s.height=e.height,s.initTexture(e,i.filter),s},L.fromImage=function(t,e,i,s){console.error("deprecated texture from image...");const r=new L(t);return r.flip=!1,i&&(r.filter=i),s&&(r.wrap=s),r.image=e,r.initTexture(e),r},L.isPowerOfTwo=function(t){return 1==t||2==t||4==t||8==t||16==t||32==t||64==t||128==t||256==t||512==t||1024==t||2048==t||4096==t||8192==t||16384==t},L.FILTER_NEAREST=0,L.FILTER_LINEAR=1,L.FILTER_MIPMAP=2,L.WRAP_REPEAT=0,L.WRAP_MIRRORED_REPEAT=1,L.WRAP_CLAMP_TO_EDGE=2,L.TYPE_DEFAULT=0,L.TYPE_DEPTH=1,L.TYPE_FLOAT=2,L.PFORMATSTR_RGBA32F="RGBA 32bit float",L.PFORMATSTR_RGBA8UB="RGBA 8bit ubyte",L.PIXELFORMATS=[L.PFORMATSTR_RGBA8UB,L.PFORMATSTR_RGBA32F];const B=function(t,e,i,s){this._log=new h("cgl_framebuffer2"),this.Framebuffer2DrawTargetsDefault=null,this.Framebuffer2BlittingFramebuffer=null,this.Framebuffer2FinalFramebuffer=null,this._cgl=t,this._cgl.printError("before framebuffer2 constructor"),this._width=0,this._height=0,this._depthRenderbuffer=null,this._frameBuffer=null,this._textureFrameBuffer=null,this._colorRenderbuffers=[],this._drawTargetArray=[],this.Framebuffer2BlittingFramebuffer||(this.Framebuffer2BlittingFramebuffer=t.gl.createFramebuffer()),this.Framebuffer2FinalFramebuffer||(this.Framebuffer2FinalFramebuffer=t.gl.createFramebuffer()),this.Framebuffer2DrawTargetsDefault||(this.Framebuffer2DrawTargetsDefault=[t.gl.COLOR_ATTACHMENT0]),this._options=s||{isFloatingPointTexture:!1},this.name=this._options.name||"unknown",this._cgl.profileData.addHeavyEvent("framebuffer create",this.name),this._options.hasOwnProperty("numRenderBuffers")||(this._options.numRenderBuffers=1),this._options.hasOwnProperty("depth")||(this._options.depth=!0),this._options.hasOwnProperty("clear")||(this._options.clear=!0),this._options.hasOwnProperty("multisampling")||(this._options.multisampling=!1,this._options.multisamplingSamples=0),this._options.multisamplingSamples&&(this._cgl.glSlowRenderer&&(this._options.multisamplingSamples=0),this._cgl.gl.MAX_SAMPLES?this._options.multisamplingSamples=Math.min(this._cgl.maxSamples,this._options.multisamplingSamples):this._options.multisamplingSamples=0),this._options.hasOwnProperty("filter")||(this._options.filter=L.FILTER_LINEAR),this._options.hasOwnProperty("wrap")||(this._options.wrap=L.WRAP_REPEAT),this._numRenderBuffers=this._options.numRenderBuffers,this._colorTextures=[];for(let e=0;e<this._numRenderBuffers;e++)this._colorTextures[e]=new L(t,{name:"fb2 "+this.name+" "+e,isFloatingPointTexture:this._options.isFloatingPointTexture,filter:this._options.filter,wrap:this._options.wrap});let r=L.FILTER_NEAREST;this._options.shadowMap&&(r=L.FILTER_LINEAR);this._options.depth&&(this._textureDepth=new L(t,{name:"fb2 depth "+this.name,isDepthTexture:!0,filter:r,shadowMap:this._options.shadowMap||!1,width:e||512,height:i||512})),t.aborted||(this.setSize(e||512,i||512),this._cgl.printError("framebuffer2 constructor"))};B.prototype.getWidth=function(){return this._width},B.prototype.getHeight=function(){return this._height},B.prototype.getGlFrameBuffer=function(){return this._frameBuffer},B.prototype.getDepthRenderBuffer=function(){return this._depthRenderbuffer},B.prototype.getTextureColor=function(){return this._colorTextures[0]},B.prototype.getTextureColorNum=function(t){return this._colorTextures[t]},B.prototype.getTextureDepth=function(){return this._textureDepth},B.prototype.setFilter=function(t){for(let e=0;e<this._numRenderBuffers;e++)this._colorTextures[e].filter=t,this._colorTextures[e].setSize(this._width,this._height)},B.prototype.delete=B.prototype.dispose=function(){let t=0;for(t=0;t<this._numRenderBuffers;t++)this._colorTextures[t].delete();for(this._textureDepth&&this._textureDepth.delete(),t=0;t<this._numRenderBuffers;t++)this._cgl.gl.deleteRenderbuffer(this._colorRenderbuffers[t]);this._cgl.gl.deleteRenderbuffer(this._depthRenderbuffer),this._cgl.gl.deleteFramebuffer(this._frameBuffer),this._cgl.gl.deleteFramebuffer(this._textureFrameBuffer)},B.prototype.setSize=function(t,e){this._cgl.profileData.addHeavyEvent("framebuffer resize",this.name);let i=0;if(this._width=Math.floor(t),this._height=Math.floor(e),this._width=Math.min(this._width,this._cgl.maxTexSize),this._height=Math.min(this._height,this._cgl.maxTexSize),this._cgl.profileData.profileFrameBuffercreate++,this._frameBuffer){for(i=0;i<this._numRenderBuffers;i++)this._cgl.gl.deleteRenderbuffer(this._colorRenderbuffers[i]);this._cgl.gl.deleteRenderbuffer(this._depthRenderbuffer),this._cgl.gl.deleteFramebuffer(this._frameBuffer),this._cgl.gl.deleteFramebuffer(this._textureFrameBuffer)}this._frameBuffer=this._cgl.gl.createFramebuffer(),this._textureFrameBuffer=this._cgl.gl.createFramebuffer();const s=this._options.depth;for(i=0;i<this._numRenderBuffers;i++)this._colorTextures[i].setSize(this._width,this._height);for(i=0;i<this._numRenderBuffers;i++){const t=this._cgl.gl.createRenderbuffer();this._cgl.gl.getExtension("EXT_color_buffer_float");if(this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuffer),this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,t),this._options.isFloatingPointTexture){this._cgl.gl.getExtension("EXT_color_buffer_float"),this._cgl.gl.getExtension("EXT_color_buffer_float_linear"),this._cgl.gl.getExtension("OES_texture_float_linear");if(this._options.multisampling&&this._options.multisamplingSamples)this._cgl.gl.renderbufferStorageMultisample(this._cgl.gl.RENDERBUFFER,this._options.multisamplingSamples,this._cgl.gl.RGBA32F,this._width,this._height);else{let t=this._cgl.gl.RGBA32F;this._cgl._isSafariCrap&&(t=this._cgl.gl.RGBA16F),this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER,t,this._width,this._height)}}else this._options.multisampling&&this._options.multisamplingSamples?this._cgl.gl.renderbufferStorageMultisample(this._cgl.gl.RENDERBUFFER,this._options.multisamplingSamples,this._cgl.gl.RGBA8,this._width,this._height):this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER,this._cgl.gl.RGBA8,this._width,this._height);this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0+i,this._cgl.gl.RENDERBUFFER,t),this._colorRenderbuffers[i]=t}for(this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._textureFrameBuffer),i=0;i<this._numRenderBuffers;i++)this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0+i,this._cgl.gl.TEXTURE_2D,this._colorTextures[i].tex,0);this._options.depth&&this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.TEXTURE_2D,this._textureDepth.tex,0),this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuffer);let r=this._cgl.gl.DEPTH_COMPONENT32F;for(this._cgl.glSlowRenderer&&(r=this._cgl.gl.DEPTH_COMPONENT16),s&&(this._textureDepth.setSize(this._width,this._height),this._depthRenderbuffer=this._cgl.gl.createRenderbuffer(),this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,this._depthRenderbuffer),this._options.isFloatingPointTexture,this._options.multisampling?this._cgl.gl.renderbufferStorageMultisample(this._cgl.gl.RENDERBUFFER,this._options.multisamplingSamples,r,this._width,this._height):this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER,r,this._width,this._height),this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.RENDERBUFFER,this._depthRenderbuffer)),this._drawTargetArray.length=0,i=0;i<this._numRenderBuffers;i++)this._drawTargetArray.push(this._cgl.gl.COLOR_ATTACHMENT0+i);this._cgl.gl.isFramebuffer(this._textureFrameBuffer)||this._this._log.warn("invalid framebuffer");const n=this._cgl.gl.checkFramebufferStatus(this._cgl.gl.FRAMEBUFFER);if(n!=this._cgl.gl.FRAMEBUFFER_COMPLETE)switch(this._log.error("framebuffer incomplete: "+this.name,this),n){case this._cgl.gl.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:throw this._log.warn("FRAMEBUFFER_INCOMPLETE_ATTACHMENT...",this),new Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");case this._cgl.gl.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:throw this._log.warn("FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT"),new Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");case this._cgl.gl.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:throw this._log.warn("FRAMEBUFFER_INCOMPLETE_DIMENSIONS"),new Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");case this._cgl.gl.FRAMEBUFFER_UNSUPPORTED:throw this._log.warn("FRAMEBUFFER_UNSUPPORTED"),new Error("Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED");default:throw this._log.warn("incomplete framebuffer",n),new Error("Incomplete framebuffer: "+n)}this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,null),this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,null)},B.prototype.renderStart=function(){this._cgl.checkFrameStarted("fb2 renderstart"),this._cgl.pushModelMatrix(),this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuffer),this._cgl.pushGlFrameBuffer(this._frameBuffer),this._cgl.pushFrameBuffer(this),this._cgl.pushPMatrix(),this._cgl.gl.viewport(0,0,this._width,this._height),this._cgl.gl.drawBuffers(this._drawTargetArray),this._options.clear&&(this._cgl.gl.clearColor(0,0,0,0),this._cgl.gl.clear(this._cgl.gl.COLOR_BUFFER_BIT|this._cgl.gl.DEPTH_BUFFER_BIT))},B.prototype.renderEnd=function(){if(this._cgl.popPMatrix(),this._cgl.profileData.profileFramebuffer++,this._numRenderBuffers<=1)this._cgl.gl.bindFramebuffer(this._cgl.gl.READ_FRAMEBUFFER,this._frameBuffer),this._cgl.gl.bindFramebuffer(this._cgl.gl.DRAW_FRAMEBUFFER,this._textureFrameBuffer),this._cgl.gl.clearBufferfv(this._cgl.gl.COLOR,0,[0,0,0,1]),this._cgl.gl.blitFramebuffer(0,0,this._width,this._height,0,0,this._width,this._height,this._cgl.gl.COLOR_BUFFER_BIT|this._cgl.gl.DEPTH_BUFFER_BIT,this._cgl.gl.NEAREST);else{this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this.Framebuffer2BlittingFramebuffer),this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.RENDERBUFFER,this._depthRenderbuffer),this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this.Framebuffer2FinalFramebuffer),this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.TEXTURE_2D,this._textureDepth.tex,0);for(let t=0;t<this._numRenderBuffers;t++){this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this.Framebuffer2BlittingFramebuffer),this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0,this._cgl.gl.RENDERBUFFER,this._colorRenderbuffers[t]),this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this.Framebuffer2FinalFramebuffer),this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0,this._cgl.gl.TEXTURE_2D,this._colorTextures[t].tex,0),this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,null),this._cgl.gl.bindFramebuffer(this._cgl.gl.READ_FRAMEBUFFER,this.Framebuffer2BlittingFramebuffer),this._cgl.gl.bindFramebuffer(this._cgl.gl.DRAW_FRAMEBUFFER,this.Framebuffer2FinalFramebuffer),this._cgl.gl.clearBufferfv(this._cgl.gl.COLOR,0,[0,0,0,1]);let e=this._cgl.gl.COLOR_BUFFER_BIT;0==t&&(e|=this._cgl.gl.DEPTH_BUFFER_BIT),this._cgl.gl.blitFramebuffer(0,0,this._width,this._height,0,0,this._width,this._height,e,this._cgl.gl.NEAREST)}}if(this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.popGlFrameBuffer()),this._cgl.popFrameBuffer(),this._cgl.popModelMatrix(),this._cgl.resetViewPort(),this._colorTextures[0].filter==L.FILTER_MIPMAP)for(let t=0;t<this._numRenderBuffers;t++)this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,this._colorTextures[t].tex),this._colorTextures[t].updateMipMap(),this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,null)};const k="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",D=new Uint8Array(256);for(let t=0;t<k.length;t++)D[k.charCodeAt(t)]=t;const V=D,G=function(t){t.buffer&&(t=t.buffer);let e,i=new Uint8Array(t),s=i.length,r="";for(e=0;e<s;e+=3)r+=k[i[e]>>2],r+=k[(3&i[e])<<4|i[e+1]>>4],r+=k[(15&i[e+1])<<2|i[e+2]>>6],r+=k[63&i[e+2]];return s%3==2?r=r.substring(0,r.length-1)+"=":s%3==1&&(r=r.substring(0,r.length-2)+"=="),r},H=function(t){let e,i,s,r,n,o=.75*t.length,h=t.length,a=0;"="===t[t.length-1]&&(o--,"="===t[t.length-2]&&o--);let l=new ArrayBuffer(o),c=new Uint8Array(l);for(e=0;e<h;e+=4)i=V[t.charCodeAt(e)],s=V[t.charCodeAt(e+1)],r=V[t.charCodeAt(e+2)],n=V[t.charCodeAt(e+3)],c[a++]=i<<2|s>>4,c[a++]=(15&s)<<4|r>>2,c[a++]=(3&r)<<6|63&n;return l};class z{constructor(t){this._init(),this._first=!0,this._wireMesh=null,t&&this.apply(t)}_init(){this._max=[-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE],this._min=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this._center=[0,0,0],this._size=[0,0,0],this._maxAxis=0,this._first=!0}get maxAxis(){return this._maxAxis||1}get size(){return this._size}get center(){return this._center}get x(){return this._center[0]}get y(){return this._center[1]}get z(){return this._center[2]}get minX(){return this._min[0]}get minY(){return this._min[1]}get minZ(){return this._min[2]}get maxX(){return this._max[0]}get maxY(){return this._max[1]}get maxZ(){return this._max[2]}apply(t,e){if(t){if(t instanceof z){const e=t;this.applyPos(e.maxX,e.maxY,e.maxZ),this.applyPos(e.minX,e.minY,e.minZ)}else for(let e=0;e<t.vertices.length;e+=3)this.applyPos(t.vertices[e],t.vertices[e+1],t.vertices[e+2]);this.calcCenterSize()}}copy(){return new z(this)}get changed(){return!(this._max[0]==-Number.MAX_VALUE&&this._max[1]==-Number.MAX_VALUE&&this._max[2]==-Number.MAX_VALUE)}applyPos(t,e,i){if(t!=Number.MAX_VALUE&&t!=-Number.MAX_VALUE&&e!=Number.MAX_VALUE&&e!=-Number.MAX_VALUE&&i!=Number.MAX_VALUE&&i!=-Number.MAX_VALUE&&CABLES.UTILS.isNumeric(t)&&CABLES.UTILS.isNumeric(e)&&CABLES.UTILS.isNumeric(i)){if(this._first)return this._max[0]=t,this._max[1]=e,this._max[2]=i,this._min[0]=t,this._min[1]=e,this._min[2]=i,void(this._first=!1);this._max[0]=Math.max(this._max[0],t),this._max[1]=Math.max(this._max[1],e),this._max[2]=Math.max(this._max[2],i),this._min[0]=Math.min(this._min[0],t),this._min[1]=Math.min(this._min[1],e),this._min[2]=Math.min(this._min[2],i)}}calcCenterSize(){this._first||(this._size[0]=this._max[0]-this._min[0],this._size[1]=this._max[1]-this._min[1],this._size[2]=this._max[2]-this._min[2],this._center[0]=(this._min[0]+this._max[0])/2,this._center[1]=(this._min[1]+this._max[1])/2,this._center[2]=(this._min[2]+this._max[2])/2,this._maxAxis=Math.max(this._size[2],Math.max(this._size[0],this._size[1])))}mulMat4(t){this._first&&(this._max[0]=0,this._max[1]=0,this._max[2]=0,this._min[0]=0,this._min[1]=0,this._min[2]=0,this._first=!1),vec3.transformMat4(this._max,this._max,t),vec3.transformMat4(this._min,this._min,t),this.calcCenterSize()}render(t,e){this._wireMesh||(this._wireMesh=new CGL.WireCube(t)),t.pushModelMatrix(),mat4.translate(t.mMatrix,t.mMatrix,this._center),this._wireMesh.render(t,this._size[0]/2,this._size[1]/2,this._size[2]/2),t.popModelMatrix()}}const Y=function(t){this.name=t||"unknown",this._log=new h("cgl_geometry"),this.faceVertCount=3,this._vertices=[],this.verticesIndices=[],this.texCoords=new Float32Array,this.texCoordsIndices=[],this.vertexNormals=[],this.tangents=[],this.biTangents=[],this.morphTargets=[],this.vertexColors=[],this._attributes={},this.glPrimitive=null,Object.defineProperty(this,"vertices",{get(){return this._vertices},set(t){this.setVertices(t)}})};Y.prototype.clear=function(){this.vertices=new Float32Array([]),this.verticesIndices.length=0,this.texCoords=new Float32Array([]),this.texCoordsIndices.length=0,this.vertexNormals=new Float32Array([])},Y.prototype.getAttributes=function(){return this._attributes},Y.prototype.getAttribute=function(t){for(const e in this._attributes)if(this._attributes[e].name==t)return this._attributes[e];return null},Y.prototype.setAttribute=function(t,e,i){let s="";1==i?s="float":2==i?s="vec2":3==i?s="vec3":4==i&&(s="vec4");const r={name:t,data:e,itemSize:i,type:s};this._attributes[t]=r},Y.prototype.setVertices=function(t){t instanceof Float32Array?this._vertices=t:this._vertices=new Float32Array(t)},Y.prototype.setTexCoords=function(t){t instanceof Float32Array?this.texCoords=t:this.texCoords=new Float32Array(t)},Y.prototype.calcNormals=function(t){t||this.unIndex(),this.calculateNormals({})},Y.prototype.flipNormals=function(t,e,i){let s=vec3.create();null==t&&(t=1),null==e&&(e=1),null==i&&(i=1);for(let r=0;r<this.vertexNormals.length;r+=3)vec3.set(s,this.vertexNormals[r+0],this.vertexNormals[r+1],this.vertexNormals[r+2]),s[0]*=-t,s[1]*=-e,s[2]*=-i,vec3.normalize(s,s),this.vertexNormals[r+0]=s[0],this.vertexNormals[r+1]=s[1],this.vertexNormals[r+2]=s[2]},Y.prototype.getNumTriangles=function(){return this.verticesIndices&&this.verticesIndices.length?this.verticesIndices.length/3:this.vertices.length/3},Y.prototype.flipVertDir=function(){const t=[];t.length=this.verticesIndices.length;for(let e=0;e<this.verticesIndices.length;e+=3)t[e]=this.verticesIndices[e+2],t[e+1]=this.verticesIndices[e+1],t[e+2]=this.verticesIndices[e];this.verticesIndices=t},Y.prototype.setPointVertices=function(t){if(t.length%3==0){t instanceof Float32Array?this.vertices=t:this.vertices=new Float32Array(t),this.texCoords instanceof Float32Array||(this.texCoords=new Float32Array(t.length/3*2)),this.verticesIndices.length=t.length/3;for(let e=0;e<t.length/3;e++)this.verticesIndices[e]=e,this.texCoords[2*e]=0,this.texCoords[2*e+1]=0}else this._log.error("SetPointVertices: Array must be multiple of three.")},Y.prototype.merge=function(t){if(!t)return;const e=this.verticesIndices.length,i=this.vertices.length/3;this.verticesIndices.length=this.verticesIndices.length+t.verticesIndices.length;for(let s=0;s<t.verticesIndices.length;s++)this.verticesIndices[e+s]=t.verticesIndices[s]+i;this.vertices=g.float32Concat(this.vertices,t.vertices),this.texCoords=g.float32Concat(this.texCoords,t.texCoords),this.vertexNormals=g.float32Concat(this.vertexNormals,t.vertexNormals),this.tangents=g.float32Concat(this.tangents,t.tangents),this.biTangents=g.float32Concat(this.biTangents,t.biTangents)},Y.prototype.copy=function(){let t=0;const e=new Y(this.name+" copy");if(e.faceVertCount=this.faceVertCount,e.glPrimitive=this.glPrimitive,e.setVertices(this._vertices.slice(0)),this.verticesIndices)for(e.verticesIndices.length=this.verticesIndices.length,t=0;t<this.verticesIndices.length;t++)e.verticesIndices[t]=this.verticesIndices[t];if(this.texCoords)for(e.texCoords=new Float32Array(this.texCoords.length),t=0;t<this.texCoords.length;t++)e.texCoords[t]=this.texCoords[t];if(this.texCoordsIndices)for(e.texCoordsIndices.length=this.texCoordsIndices.length,t=0;t<this.texCoordsIndices.length;t++)e.texCoordsIndices[t]=this.texCoordsIndices[t];if(this.vertexNormals)for(e.vertexNormals=new Float32Array(this.vertexNormals.length),t=0;t<this.vertexNormals.length;t++)e.vertexNormals[t]=this.vertexNormals[t];if(this.tangents)for(e.tangents=[],e.tangents.length=this.tangents.length,t=0;t<this.tangents.length;t++)e.tangents[t]=this.tangents[t];if(this.biTangents)for(e.biTangents=[],e.biTangents.length=this.biTangents.length,t=0;t<this.biTangents.length;t++)e.biTangents[t]=this.biTangents[t];for(e.morphTargets.length=this.morphTargets.length,t=0;t<this.morphTargets.length;t++)e.morphTargets[t]=this.morphTargets[t];for(e.vertexColors.length=this.vertexColors.length,t=0;t<this.vertexColors.length;t++)e.vertexColors[t]=this.vertexColors[t];return e},Y.prototype.calculateNormals=function(t){const e=vec3.create(),i=vec3.create(),s=vec3.create();function r(r){return vec3.subtract(e,r[0],r[1]),vec3.subtract(i,r[0],r[2]),vec3.cross(s,e,i),vec3.normalize(s,s),t&&t.forceZUp&&s[2]<0&&(s[0]*=-1,s[1]*=-1,s[2]*=-1),s}this.getVertexVec=function(t){const e=[0,0,0];return e[0]=this.vertices[3*t+0],e[1]=this.vertices[3*t+1],e[2]=this.vertices[3*t+2],e},this.vertexNormals instanceof Float32Array&&this.vertexNormals.length==this.vertices.length||(this.vertexNormals=new Float32Array(this.vertices.length));for(let t=0;t<this.vertices.length;t++)this.vertexNormals[t]=0;if(this.isIndexed()){const t=[];t.length=Math.floor(this.verticesIndices.length/3);for(let e=0;e<this.verticesIndices.length;e+=3){const i=[this.getVertexVec(this.verticesIndices[e+0]),this.getVertexVec(this.verticesIndices[e+1]),this.getVertexVec(this.verticesIndices[e+2])];t[e/3]=r(i),this.vertexNormals[3*this.verticesIndices[e+0]+0]+=t[e/3][0],this.vertexNormals[3*this.verticesIndices[e+0]+1]+=t[e/3][1],this.vertexNormals[3*this.verticesIndices[e+0]+2]+=t[e/3][2],this.vertexNormals[3*this.verticesIndices[e+1]+0]+=t[e/3][0],this.vertexNormals[3*this.verticesIndices[e+1]+1]+=t[e/3][1],this.vertexNormals[3*this.verticesIndices[e+1]+2]+=t[e/3][2],this.vertexNormals[3*this.verticesIndices[e+2]+0]+=t[e/3][0],this.vertexNormals[3*this.verticesIndices[e+2]+1]+=t[e/3][1],this.vertexNormals[3*this.verticesIndices[e+2]+2]+=t[e/3][2]}for(let t=0;t<this.verticesIndices.length;t+=3)for(let e=0;e<3;e++){const i=[this.vertexNormals[3*this.verticesIndices[t+e]+0],this.vertexNormals[3*this.verticesIndices[t+e]+1],this.vertexNormals[3*this.verticesIndices[t+e]+2]];vec3.normalize(i,i),this.vertexNormals[3*this.verticesIndices[t+e]+0]=i[0],this.vertexNormals[3*this.verticesIndices[t+e]+1]=i[1],this.vertexNormals[3*this.verticesIndices[t+e]+2]=i[2]}}else{const t=[];for(let e=0;e<this.vertices.length;e+=9){const i=r([[this.vertices[e+0],this.vertices[e+1],this.vertices[e+2]],[this.vertices[e+3],this.vertices[e+4],this.vertices[e+5]],[this.vertices[e+6],this.vertices[e+7],this.vertices[e+8]]]);t.push(i[0],i[1],i[2],i[0],i[1],i[2],i[0],i[1],i[2])}this.vertexNormals=t}},Y.prototype.calcTangentsBitangents=function(){if(!this.vertices.length)return void this._log.error("Cannot calculate tangents/bitangents without vertices.");if(!this.vertexNormals.length)return void this._log.error("Cannot calculate tangents/bitangents without normals.");if(!this.texCoords.length){const t=this.vertices.length/3*2;this.texCoords=new Float32Array(t);for(let e=0;e<t;e+=1)this.texCoords[e]=0}if(!this.verticesIndices||!this.verticesIndices.length)return void this._log.error("Cannot calculate tangents/bitangents without vertex indices.");if(this.verticesIndices.length%3!=0)return void this._log.error("Vertex indices mismatch!");const t=this.verticesIndices.length/3,e=this.vertices.length/3;this.tangents=new Float32Array(this.vertexNormals.length),this.biTangents=new Float32Array(this.vertexNormals.length);const i=[];i.length=2*e;const s=vec3.create(),r=vec3.create(),n=vec3.create(),o=vec2.create(),h=vec2.create(),a=vec2.create(),l=vec3.create(),c=vec3.create();for(let u=0;u<t;u+=1){const t=this.verticesIndices[3*u],g=this.verticesIndices[3*u+1],p=this.verticesIndices[3*u+2];vec3.set(s,this.vertices[3*t],this.vertices[3*t+1],this.vertices[3*t+2]),vec3.set(r,this.vertices[3*g],this.vertices[3*g+1],this.vertices[3*g+2]),vec3.set(n,this.vertices[3*p],this.vertices[3*p+1],this.vertices[3*p+2]),vec2.set(o,this.texCoords[2*t],this.texCoords[2*t+1]),vec2.set(h,this.texCoords[2*g],this.texCoords[2*g+1]),vec2.set(a,this.texCoords[2*p],this.texCoords[2*p+1]);const _=r[0]-s[0],d=n[0]-s[0],f=r[1]-s[1],m=n[1]-s[1],E=r[2]-s[2],T=n[2]-s[2],A=h[0]-o[0],b=a[0]-o[0],y=h[1]-o[1],v=a[1]-o[1],x=1/(A*v-b*y);vec3.set(l,(v*_-y*d)*x,(v*f-y*m)*x,(v*E-y*T)*x),vec3.set(c,(A*d-b*_)*x,(A*m-b*f)*x,(A*T-b*E)*x),i[t]=l,i[g]=l,i[p]=l,i[t+e]=c,i[g+e]=c,i[p+e]=c}const u=vec3.create(),g=vec3.create(),p=vec3.create(),_=vec3.create(),d=vec3.create(),f=vec3.create(),m=vec3.create(),E=vec3.create();for(let t=0;t<e;t+=1){if(!i[t])continue;vec3.set(u,this.vertexNormals[3*t],this.vertexNormals[3*t+1],this.vertexNormals[3*t+2]),vec3.set(g,i[t][0],i[t][1],i[t][2]);const s=vec3.dot(u,g);vec3.scale(d,u,s),vec3.subtract(f,g,d),vec3.normalize(E,f),vec3.cross(m,u,g);vec3.dot(m,i[t+e]);const r=1;vec3.scale(p,E,1/r),vec3.cross(_,u,p),this.tangents[3*t+0]=p[0],this.tangents[3*t+1]=p[1],this.tangents[3*t+2]=p[2],this.biTangents[3*t+0]=_[0],this.biTangents[3*t+1]=_[1],this.biTangents[3*t+2]=_[2]}},Y.prototype.isIndexed=function(){return 0!=this.verticesIndices.length},Y.prototype.unIndex=function(t,e){const i=[],s=[],r=[],n=[],o=[],h=[];let a=0,l=0;for(l=0;l<this.verticesIndices.length;l+=3)i.push(this.vertices[3*this.verticesIndices[l+0]+0],this.vertices[3*this.verticesIndices[l+0]+1],this.vertices[3*this.verticesIndices[l+0]+2]),n.push(this.vertexNormals[3*this.verticesIndices[l+0]+0],this.vertexNormals[3*this.verticesIndices[l+0]+1],this.vertexNormals[3*this.verticesIndices[l+0]+2]),this.tangents.length>0&&o.push(this.tangents[3*this.verticesIndices[l+0]+0],this.tangents[3*this.verticesIndices[l+0]+1],this.tangents[3*this.verticesIndices[l+0]+2]),this.biTangents.length>0&&h.push(this.biTangents[3*this.verticesIndices[l+0]+0],this.biTangents[3*this.verticesIndices[l+0]+1],this.biTangents[3*this.verticesIndices[l+0]+2]),this.texCoords?r.push(this.texCoords[2*this.verticesIndices[l+0]+0],this.texCoords[2*this.verticesIndices[l+0]+1]):r.push(0,0),s.push(a),a++,i.push(this.vertices[3*this.verticesIndices[l+1]+0],this.vertices[3*this.verticesIndices[l+1]+1],this.vertices[3*this.verticesIndices[l+1]+2]),n.push(this.vertexNormals[3*this.verticesIndices[l+1]+0],this.vertexNormals[3*this.verticesIndices[l+1]+1],this.vertexNormals[3*this.verticesIndices[l+1]+2]),this.tangents.length>0&&o.push(this.tangents[3*this.verticesIndices[l+1]+0],this.tangents[3*this.verticesIndices[l+1]+1],this.tangents[3*this.verticesIndices[l+1]+2]),this.biTangents.length>0&&h.push(this.biTangents[3*this.verticesIndices[l+1]+0],this.biTangents[3*this.verticesIndices[l+1]+1],this.biTangents[3*this.verticesIndices[l+1]+2]),this.texCoords?r.push(this.texCoords[2*this.verticesIndices[l+1]+0],this.texCoords[2*this.verticesIndices[l+1]+1]):r.push(0,0),s.push(a),a++,i.push(this.vertices[3*this.verticesIndices[l+2]+0],this.vertices[3*this.verticesIndices[l+2]+1],this.vertices[3*this.verticesIndices[l+2]+2]),n.push(this.vertexNormals[3*this.verticesIndices[l+2]+0],this.vertexNormals[3*this.verticesIndices[l+2]+1],this.vertexNormals[3*this.verticesIndices[l+2]+2]),this.tangents.length>0&&o.push(this.tangents[3*this.verticesIndices[l+2]+0],this.tangents[3*this.verticesIndices[l+2]+1],this.tangents[3*this.verticesIndices[l+2]+2]),this.biTangents.length>0&&h.push(this.biTangents[3*this.verticesIndices[l+2]+0],this.biTangents[3*this.verticesIndices[l+2]+1],this.biTangents[3*this.verticesIndices[l+2]+2]),this.texCoords?r.push(this.texCoords[2*this.verticesIndices[l+2]+0],this.texCoords[2*this.verticesIndices[l+2]+1]):r.push(0,0),s.push(a),a++;this.vertices=i,this.texCoords=r,this.vertexNormals=n,o.length>0&&(this.tangents=o),h.length>0&&(this.biTangents=h),this.verticesIndices.length=0,t&&(this.verticesIndices=s),e||this.calculateNormals()},Y.prototype.calcBarycentric=function(){let t=[];t.length=this.vertices.length;for(let e=0;e<this.vertices.length;e++)t[e]=0;let e=0;for(let i=0;i<this.vertices.length;i+=3)t[i+e]=1,e++,3==e&&(e=0);this.setAttribute("attrBarycentric",t,3)},Y.prototype.getBounds=function(){return new z(this)},Y.prototype.center=function(t,e,i){void 0===t&&(t=!0,e=!0,i=!0);let s=0;const r=this.getBounds(),n=[r.minX+(r.maxX-r.minX)/2,r.minY+(r.maxY-r.minY)/2,r.minZ+(r.maxZ-r.minZ)/2];for(s=0;s<this.vertices.length;s+=3)this.vertices[s+0]==this.vertices[s+0]&&(t&&(this.vertices[s+0]-=n[0]),e&&(this.vertices[s+1]-=n[1]),i&&(this.vertices[s+2]-=n[2]));return n},Y.prototype.mapTexCoords2d=function(){const t=this.getBounds(),e=this.vertices.length/3;this.texCoords=new Float32Array(2*e);for(let i=0;i<e;i++){const e=this.vertices[3*i+0],s=this.vertices[3*i+1];this.texCoords[2*i+0]=e/(t.maxX-t.minX)+.5,this.texCoords[2*i+1]=1-s/(t.maxY-t.minY)+.5}},Y.prototype.getInfo=function(){const t={};return this.verticesIndices?t.numFaces=this.verticesIndices.length/3:t.numFaces=0,this.vertices?t.numVerts=this.vertices.length/3:t.numVerts=0,this.vertexNormals?t.numNormals=this.vertexNormals.length/3:t.numNormals=0,this.texCoords?t.numTexCoords=this.texCoords.length/2:t.numTexCoords=0,this.tangents?t.numTangents=this.tangents.length/3:t.numTangents=0,this.biTangents?t.numBiTangents=this.biTangents.length/3:t.numBiTangents=0,this.biTangents?t.numBiTangents=this.biTangents.length/3:t.numBiTangents=0,this.vertexColors?t.numVertexColors=this.vertexColors.length/4:t.numVertexColors=0,this.getAttributes()?t.numAttribs=Object.keys(this.getAttributes()).length:t.numAttribs=0,t.isIndexed=this.isIndexed(),t},Y.buildFromFaces=function(t,e,i){const s=[],r=[];for(let e=0;e<t.length;e+=3){const n=t[e+0],o=t[e+1],h=t[e+2],a=[-1,-1,-1];if(i)for(let t=0;t<s.length;t+=3)s[t+0]==n[0]&&s[t+1]==n[1]&&s[t+2]==n[2]&&(a[0]=t/3),s[t+0]==o[0]&&s[t+1]==o[1]&&s[t+2]==o[2]&&(a[1]=t/3),s[t+0]==h[0]&&s[t+1]==h[1]&&s[t+2]==h[2]&&(a[2]=t/3);-1==a[0]&&(s.push(n[0],n[1],n[2]),a[0]=(s.length-1)/3),-1==a[1]&&(s.push(o[0],o[1],o[2]),a[1]=(s.length-1)/3),-1==a[2]&&(s.push(h[0],h[1],h[2]),a[2]=(s.length-1)/3),r.push(parseInt(a[0],10)),r.push(parseInt(a[1],10)),r.push(parseInt(a[2],10))}const n=new Y(e);return n.name=e,n.vertices=s,n.verticesIndices=r,n},Y.json2geom=function(t){const e=new Y("jsonMeshGeom");if(e.verticesIndices=[],e.vertices=t.vertices||[],e.vertexNormals=t.normals||[],e.vertexColors=t.colors||[],e.tangents=t.tangents||[],e.biTangents=t.bitangents||[],t.texturecoords&&e.setTexCoords(t.texturecoords[0]),t.vertices_b64&&(e.vertices=new Float32Array(H(t.vertices_b64))),t.normals_b64&&(e.vertexNormals=new Float32Array(H(t.normals_b64))),t.tangents_b64&&(e.tangents=new Float32Array(H(t.tangents_b64))),t.bitangents_b64&&(e.biTangents=new Float32Array(H(t.bitangents_b64))),t.texturecoords_b64&&e.setTexCoords(new Float32Array(H(t.texturecoords_b64[0]))),t.faces_b64)e.verticesIndices=new Uint32Array(H(t.faces_b64));else{e.verticesIndices.length=3*t.faces.length;for(let i=0;i<t.faces.length;i++)e.verticesIndices[3*i]=t.faces[i][0],e.verticesIndices[3*i+1]=t.faces[i][1],e.verticesIndices[3*i+2]=t.faces[i][2]}return e};const W=function(){this._log=new h("eventtaget"),this._eventCallbacks={},this._logName="",this._logEvents=!1,this._listeners={},this.addEventListener=this.on=function(t,e,i){const s={id:(i||"")+CABLES.uuid(),name:t,cb:e};return this._eventCallbacks[t]?this._eventCallbacks[t].push(s):this._eventCallbacks[t]=[s],this._listeners[s.id]=s,s.id},this.hasEventListener=function(t,e){if(t&&!e)return!!this._listeners[t];if(this._log.warn("old eventtarget function haseventlistener!"),t&&e&&this._eventCallbacks[t]){return-1!=this._eventCallbacks[t].indexOf(e)}},this.removeEventListener=this.off=function(t,e){if(null==t)return;if(!e){const e=this._listeners[t];if(!e)return;let i=!0;for(;i;){i=!1;let s=-1;for(let r=0;r<this._eventCallbacks[e.name].length;r++)0===this._eventCallbacks[e.name][r].id.indexOf(t)&&(i=!0,s=r);-1!==s&&(this._eventCallbacks[e.name].splice(s,1),delete this._listeners[t])}return}this._log.stack(" old function signature: removeEventListener! use listener id");let i=null;for(let s=0;s<this._eventCallbacks[t].length;s++)this._eventCallbacks[t][s].cb==e&&(i=s);null!==i?delete this._eventCallbacks[i]:this._log.warn("removeEventListener not found "+t)},this.logEvents=function(t,e){this._logEvents=t,this._logName=e},this.emitEvent=function(t,e,i,s,r,n,o){if(this._logEvents&&console.log("[event] ",this._logName,t,this._eventCallbacks),this._eventCallbacks[t])for(let h=0;h<this._eventCallbacks[t].length;h++)this._eventCallbacks[t][h]&&this._eventCallbacks[t][h].cb(e,i,s,r,n,o);else this._logEvents&&console.log("[event] has no event callback",t,this._eventCallbacks)}},X={Key:function(t){this.time=0,this.value=0,this.ui=null,this.onChange=null,this._easing=0,this.bezTangIn=0,this.bezTangOut=0,this.cb=null,this.cbTriggered=!1;this.setEasing(a.EASING_LINEAR),this.set(t)}};X.Key.cubicSpline=function(t,e,i){let s=t*t,r=s*t;return(2*r-3*s+1)*e.value+(r-2*s+t)*e.bezTangOut+(-2*r+3*s)*i.value+(r-s)*i.bezTangIn},X.Key.easeCubicSpline=function(t,e){return X.Key.cubicSpline(t,this,e)},X.Key.linear=function(t,e,i){return parseFloat(e.value)+parseFloat(i.value-e.value)*t},X.Key.easeLinear=function(t,e){return X.Key.linear(t,this,e)},X.Key.easeAbsolute=function(t,e){return this.value};const K=function(t){return Math.pow(2,10*(t-1))};X.Key.easeExpoIn=function(t,e){return t=K(t),X.Key.linear(t,this,e)};const j=function(t){return t=1-Math.pow(2,-10*t)};X.Key.easeExpoOut=function(t,e){return t=j(t),X.Key.linear(t,this,e)};const Q=function(t){return(t*=2)<1?t=.5*Math.pow(2,10*(t-1)):(t--,t=.5*(2-Math.pow(2,-10*t))),t};X.Key.easeExpoInOut=function(t,e){return t=Q(t),X.Key.linear(t,this,e)},X.Key.easeSinIn=function(t,e){return t=-1*Math.cos(t*Math.PI/2)+1,X.Key.linear(t,this,e)},X.Key.easeSinOut=function(t,e){return t=Math.sin(t*Math.PI/2),X.Key.linear(t,this,e)},X.Key.easeSinInOut=function(t,e){return t=-.5*(Math.cos(Math.PI*t)-1),X.Key.linear(t,this,e)};const q=function(t){return t*=t*t};X.Key.easeCubicIn=function(t,e){return t=q(t),X.Key.linear(t,this,e)},X.Key.easeInQuint=function(t,e){return t*=t*t*t*t,X.Key.linear(t,this,e)},X.Key.easeOutQuint=function(t,e){return t=(t-=1)*t*t*t*t+1,X.Key.linear(t,this,e)},X.Key.easeInOutQuint=function(t,e){return(t/=.5)<1?t*=.5*t*t*t*t:t=.5*((t-=2)*t*t*t*t+2),X.Key.linear(t,this,e)},X.Key.easeInQuart=function(t,e){return t*=t*t*t,X.Key.linear(t,this,e)},X.Key.easeOutQuart=function(t,e){return t=-1*((t-=1)*t*t*t-1),X.Key.linear(t,this,e)},X.Key.easeInOutQuart=function(t,e){return(t/=.5)<1?t*=.5*t*t*t:t=-.5*((t-=2)*t*t*t-2),X.Key.linear(t,this,e)},X.Key.bounce=function(t){return(t/=1)<1/2.75?t*=7.5625*t:t=t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375,t},X.Key.easeInBounce=function(t,e){return X.Key.linear(X.Key.bounce(t),this,e)},X.Key.easeOutBounce=function(t,e){return X.Key.linear(X.Key.bounce(t),this,e)},X.Key.easeInElastic=function(t,e){let i=1.70158,s=0,r=1;return 0===t?t=0:1==(t/=1)?t=1:(s||(s=.3),r<Math.abs(1)?(r=1,i=s/4):i=s/(2*Math.PI)*Math.asin(1/r),t=-r*Math.pow(2,10*(t-=1))*Math.sin((1*t-i)*(2*Math.PI)/s)+0),X.Key.linear(t,this,e)},X.Key.easeOutElastic=function(t,e){let i=1.70158,s=0,r=1;return 0===t?t=0:1==(t/=1)?t=1:(s||(s=.3),r<Math.abs(1)?(r=1,i=s/4):i=s/(2*Math.PI)*Math.asin(1/r),t=r*Math.pow(2,-10*t)*Math.sin((1*t-i)*(2*Math.PI)/s)+1+0),X.Key.linear(t,this,e)},X.Key.easeInBack=function(t,e){const i=1.70158;return t=t*t*((i+1)*t-i),X.Key.linear(t,this,e)},X.Key.easeOutBack=function(t,e){const i=1.70158;return t=(t=t/1-1)*t*((i+1)*t+i)+1,X.Key.linear(t,this,e)},X.Key.easeInOutBack=function(t,e){let i=1.70158;return t=(t/=.5)<1?t*t*((1+(i*=1.525))*t-i)*.5:.5*((t-=2)*t*((1+(i*=1.525))*t+i)+2),X.Key.linear(t,this,e)};const J=function(t){return t=--t*t*t+1};X.Key.easeCubicOut=function(t,e){return t=J(t),X.Key.linear(t,this,e)};const Z=function(t){return(t*=2)<1?t*=.5*t*t:t=.5*((t-=2)*t*t+2),t};X.Key.easeCubicInOut=function(t,e){return t=Z(t),X.Key.linear(t,this,e)},X.Key.easeSmoothStep=function(t,e){const i=Math.max(0,Math.min(1,t));return t=i*i*(3-2*i),X.Key.linear(t,this,e)},X.Key.easeSmootherStep=function(t,e){const i=Math.max(0,Math.min(1,(t-0)/1));return t=i*i*i*(i*(6*i-15)+10),X.Key.linear(t,this,e)},X.Key.prototype.setEasing=function(t){this._easing=t,this._easing==a.EASING_LINEAR?this.ease=X.Key.easeLinear:this._easing==a.EASING_ABSOLUTE?this.ease=X.Key.easeAbsolute:this._easing==a.EASING_SMOOTHSTEP?this.ease=X.Key.easeSmoothStep:this._easing==a.EASING_SMOOTHERSTEP?this.ease=X.Key.easeSmootherStep:this._easing==a.EASING_CUBIC_IN?this.ease=X.Key.easeCubicIn:this._easing==a.EASING_CUBIC_OUT?this.ease=X.Key.easeCubicOut:this._easing==a.EASING_CUBIC_INOUT?this.ease=X.Key.easeCubicInOut:this._easing==a.EASING_EXPO_IN?this.ease=X.Key.easeExpoIn:this._easing==a.EASING_EXPO_OUT?this.ease=X.Key.easeExpoOut:this._easing==a.EASING_EXPO_INOUT?this.ease=X.Key.easeExpoInOut:this._easing==a.EASING_SIN_IN?this.ease=X.Key.easeSinIn:this._easing==a.EASING_SIN_OUT?this.ease=X.Key.easeSinOut:this._easing==a.EASING_SIN_INOUT?this.ease=X.Key.easeSinInOut:this._easing==a.EASING_BACK_OUT?this.ease=X.Key.easeOutBack:this._easing==a.EASING_BACK_IN?this.ease=X.Key.easeInBack:this._easing==a.EASING_BACK_INOUT?this.ease=X.Key.easeInOutBack:this._easing==a.EASING_ELASTIC_IN?this.ease=X.Key.easeInElastic:this._easing==a.EASING_ELASTIC_OUT?this.ease=X.Key.easeOutElastic:this._easing==a.EASING_ELASTIC_INOUT?this.ease=X.Key.easeElasticInOut:this._easing==a.EASING_BOUNCE_IN?this.ease=X.Key.easeInBounce:this._easing==a.EASING_BOUNCE_OUT?this.ease=X.Key.easeOutBounce:this._easing==a.EASING_QUART_OUT?this.ease=X.Key.easeOutQuart:this._easing==a.EASING_QUART_IN?this.ease=X.Key.easeInQuart:this._easing==a.EASING_QUART_INOUT?this.ease=X.Key.easeInOutQuart:this._easing==a.EASING_QUINT_OUT?this.ease=X.Key.easeOutQuint:this._easing==a.EASING_QUINT_IN?this.ease=X.Key.easeInQuint:this._easing==a.EASING_QUINT_INOUT?this.ease=X.Key.easeInOutQuint:this._easing==a.EASING_CUBICSPLINE?this.ease=X.Key.easeCubicSpline:(this._easing=a.EASING_LINEAR,this.ease=X.Key.easeLinear)},X.Key.prototype.trigger=function(){this.cb(),this.cbTriggered=!0},X.Key.prototype.setValue=function(t){this.value=t,null!==this.onChange&&this.onChange()},X.Key.prototype.set=function(t){t&&(t.e&&this.setEasing(t.e),t.cb&&(this.cb=t.cb,this.cbTriggered=!1),t.b,t.hasOwnProperty("t")&&(this.time=t.t),t.hasOwnProperty("time")&&(this.time=t.time),t.hasOwnProperty("v")?this.value=t.v:t.hasOwnProperty("value")&&(this.value=t.value)),null!==this.onChange&&this.onChange()},X.Key.prototype.getSerialized=function(){const t={};return t.t=this.time,t.v=this.value,t.e=this._easing,t},X.Key.prototype.getEasing=function(){return this._easing};const $=function(t){W.apply(this),t=t||{},this.keys=[],this.onChange=null,this.stayInTimeline=!1,this.loop=!1,this._log=new h("Anim"),this.defaultEasing=t.defaultEasing||a.EASING_LINEAR,this.onLooped=null,this._timesLooped=0,this._needsSort=!1};$.prototype.forceChangeCallback=function(){null!==this.onChange&&this.onChange(),this.emitEvent("onChange",this)},$.prototype.getLoop=function(){return this.loop},$.prototype.setLoop=function(t){this.loop=t,this.emitEvent("onChange",this)},$.prototype.hasEnded=function(t){return 0===this.keys.length||this.keys[this.keys.length-1].time<=t},$.prototype.isRising=function(t){if(this.hasEnded(t))return!1;const e=this.getKeyIndex(t);return this.keys[e].value<this.keys[e+1].value},$.prototype.clearBefore=function(t){const e=this.getValue(t),i=this.getKeyIndex(t);this.setValue(t,e),i>1&&this.keys.splice(0,i)},$.prototype.clear=function(t){let e=0;t&&(e=this.getValue(t)),this.keys.length=0,t&&this.setValue(t,e),null!==this.onChange&&this.onChange(),this.emitEvent("onChange",this)},$.prototype.sortKeys=function(){this.keys.sort((t,e)=>parseFloat(t.time)-parseFloat(e.time)),this._needsSort=!1},$.prototype.getLength=function(){return 0===this.keys.length?0:this.keys[this.keys.length-1].time},$.prototype.getKeyIndex=function(t){let e=0;for(let i=0;i<this.keys.length;i++)if(t>=this.keys[i].time&&(e=i),this.keys[i].time>t)return e;return e},$.prototype.setValue=function(t,e,i){let s=null;for(const r in this.keys)if(this.keys[r].time==t){s=this.keys[r],this.keys[r].setValue(e),this.keys[r].cb=i;break}return s||(s=new X.Key({time:t,value:e,e:this.defaultEasing,cb:i}),this.keys.push(s)),this.onChange&&this.onChange(),this.emitEvent("onChange",this),this._needsSort=!0,s},$.prototype.setKeyEasing=function(t,e){this.keys[t]&&(this.keys[t].setEasing(e),this.emitEvent("onChange",this))},$.prototype.getSerialized=function(){const t={keys:[]};t.loop=this.loop;for(const e in this.keys)t.keys.push(this.keys[e].getSerialized());return t},$.prototype.getKey=function(t){const e=this.getKeyIndex(t);return this.keys[e]},$.prototype.getNextKey=function(t){let e=this.getKeyIndex(t)+1;return e>=this.keys.length&&(e=this.keys.length-1),this.keys[e]},$.prototype.isFinished=function(t){return this.keys.length<=0||t>this.keys[this.keys.length-1].time},$.prototype.isStarted=function(t){return!(this.keys.length<=0)&&t>=this.keys[0].time},$.prototype.getValue=function(t){if(0===this.keys.length)return 0;if(this._needsSort&&this.sortKeys(),t<this.keys[0].time)return this.keys[0].value;const e=this.keys.length-1;if(this.loop&&t>this.keys[e].time){t/this.keys[e].time>this._timesLooped&&(this._timesLooped++,this.onLooped&&this.onLooped()),t=(t-this.keys[0].time)%(this.keys[e].time-this.keys[0].time),t+=this.keys[0].time}const i=this.getKeyIndex(t);if(i>=e)return this.keys[e].cb&&!this.keys[e].cbTriggered&&this.keys[e].trigger(),this.keys[e].value;const s=parseInt(i,10)+1,r=this.keys[i],n=this.keys[s];if(r.cb&&!r.cbTriggered&&r.trigger(),!n)return-1;const o=(t-r.time)/(n.time-r.time);return r.ease||this.log._warn("has no ease",r,n),r.ease(o,n)},$.prototype.addKey=function(t){void 0===t.time?this.log.warn("key time undefined, ignoring!"):(this.keys.push(t),null!==this.onChange&&this.onChange(),this.emitEvent("onChange",this))},$.prototype.easingFromString=function(t){return"linear"==t?a.EASING_LINEAR:"absolute"==t?a.EASING_ABSOLUTE:"smoothstep"==t?a.EASING_SMOOTHSTEP:"smootherstep"==t?a.EASING_SMOOTHERSTEP:"Cubic In"==t?a.EASING_CUBIC_IN:"Cubic Out"==t?a.EASING_CUBIC_OUT:"Cubic In Out"==t?a.EASING_CUBIC_INOUT:"Expo In"==t?a.EASING_EXPO_IN:"Expo Out"==t?a.EASING_EXPO_OUT:"Expo In Out"==t?a.EASING_EXPO_INOUT:"Sin In"==t?a.EASING_SIN_IN:"Sin Out"==t?a.EASING_SIN_OUT:"Sin In Out"==t?a.EASING_SIN_INOUT:"Back In"==t?a.EASING_BACK_IN:"Back Out"==t?a.EASING_BACK_OUT:"Back In Out"==t?a.EASING_BACK_INOUT:"Elastic In"==t?a.EASING_ELASTIC_IN:"Elastic Out"==t?a.EASING_ELASTIC_OUT:"Bounce In"==t?a.EASING_BOUNCE_IN:"Bounce Out"==t?a.EASING_BOUNCE_OUT:"Quart Out"==t?a.EASING_QUART_OUT:"Quart In"==t?a.EASING_QUART_IN:"Quart In Out"==t?a.EASING_QUART_INOUT:"Quint Out"==t?a.EASING_QUINT_OUT:"Quint In"==t?a.EASING_QUINT_IN:"Quint In Out"==t?a.EASING_QUINT_INOUT:void 0},$.prototype.createPort=function(t,e,i){const s=t.inDropDown(e,a.EASINGS);return s.set("linear"),s.defaultValue="linear",s.onChange=function(){this.defaultEasing=this.easingFromString(s.get()),i&&i()}.bind(this),s},$.slerpQuaternion=function(t,e,i,s,r,n){$.slerpQuaternion.q1||($.slerpQuaternion.q1=quat.create(),$.slerpQuaternion.q2=quat.create());const o=i.getKeyIndex(t);let h=o+1;if(h>=i.keys.length&&(h=i.keys.length-1),o==h)quat.set(e,i.keys[o].value,s.keys[o].value,r.keys[o].value,n.keys[o].value);else{const a=i.keys[o].time,l=(t-a)/(i.keys[h].time-a);quat.set($.slerpQuaternion.q1,i.keys[o].value,s.keys[o].value,r.keys[o].value,n.keys[o].value),quat.set($.slerpQuaternion.q2,i.keys[h].value,s.keys[h].value,r.keys[h].value,n.keys[h].value),quat.slerp(e,$.slerpQuaternion.q1,$.slerpQuaternion.q2,l)}return e};const tt=X;tt.Anim=$;const et=function(t,e,i,s){W.apply(this),this.data={},this._log=new h("core_port"),this.direction=c.PORT_DIR_IN,this.id=A(),this.parent=t,this.links=[],this.value=0,this.name=e,this.type=i||l.OP_PORT_TYPE_VALUE,this.uiAttribs=s||{},this.anim=null,this._oldAnimVal=-5711,this.defaultValue=null,this._uiActiveState=!0,this.ignoreValueSerialize=!1,this.onLinkChanged=null,this.crashed=!1,this._valueBeforeLink=null,this._lastAnimFrame=-1,this._animated=!1,this.onValueChanged=null,this.onTriggered=null,this.onUiActiveStateChange=null,this.changeAlways=!1,this._warnedDeprecated=!1,this._useVariableName=null,this.activityCounter=0,this._tempLastUiValue=null,Object.defineProperty(this,"val",{get(){return this._log.warn("val getter deprecated!",this),this._log.stack("val getter deprecated"),this._warnedDeprecated=!0,this.get()},set(t){this._log.warn("val setter deprecated!",this),this._log.stack("val setter deprecated"),this.setValue(t),this._warnedDeprecated=!0}})};et.prototype.getValueForDisplay=function(){let t=String(this.value);return this.uiAttribs&&"boolnum"==this.uiAttribs.display&&(t+=" - ",this.value?t+="true":t+="false"),t=t.replace(/(<([^>]+)>)/gi,""),t.length>100&&(t=t.substring(0,100)),t},et.prototype.onAnimToggle=function(){},et.prototype._onAnimToggle=function(){this.onAnimToggle()},et.prototype.remove=function(){this.removeLinks(),this.parent.removePort(this)},et.prototype.setUiAttribs=function(t){let e=!1;this.uiAttribs||(this.uiAttribs={});for(const i in t)this.uiAttribs[i]!=t[i]&&(e=!0),this.uiAttribs[i]=t[i],"group"==i&&this.indexPort&&this.indexPort.setUiAttribs({group:t[i]});e&&this.emitEvent("onUiAttrChange",t)},et.prototype.getUiAttribs=function(){return this.uiAttribs},et.prototype.getUiAttrib=function(t){return this.uiAttribs&&this.uiAttribs.hasOwnProperty(t)?this.uiAttribs[t]:null},et.prototype.get=function(){return this._animated&&this._lastAnimFrame!=this.parent.patch.getFrameNum()&&(this._lastAnimFrame=this.parent.patch.getFrameNum(),this.value=this.anim.getValue(this.parent.patch.timer.getTime()),this._oldAnimVal=this.value,this.forceChange()),this.value},et.prototype.set=et.prototype.setValue=function(t){if(void 0!==t&&this.parent.enabled&&!this.crashed&&(t!==this.value||this.changeAlways||this.type==l.OP_PORT_TYPE_TEXTURE||this.type==l.OP_PORT_TYPE_ARRAY)){if(this._animated)this.anim.setValue(this.parent.patch.timer.getTime(),t);else{try{this.value=t,this.forceChange()}catch(t){this.crashed=!0,this.setValue=function(t){},this.onTriggered=function(){},this._log.error("onvaluechanged exception cought",t),this._log.error(t.stack),this._log.warn("exception in: "+this.parent.name),this.parent.patch.isEditorMode()&&gui.showOpCrash(this.parent),this.parent.patch.emitEvent("exception",t,this.parent),this.parent.onError&&this.parent.onError(t)}this.parent&&this.parent.patch&&this.parent.patch.isEditorMode()&&this.type==l.OP_PORT_TYPE_TEXTURE&&gui.texturePreview().updateTexturePort(this)}if(this.direction==c.PORT_DIR_OUT)for(let t=0;t<this.links.length;++t)this.links[t].setValue()}},et.prototype.updateAnim=function(){this._animated&&(this.value=this.get(),(this._oldAnimVal!=this.value||this.changeAlways)&&(this._oldAnimVal=this.value,this.forceChange()),this._oldAnimVal=this.value)},et.args=function(t){return(t+"").replace(/[/][/].*$/gm,"").replace(/\s+/g,"").replace(/[/][*][^/*]*[*][/]/g,"").split("){",1)[0].replace(/^[^(]*[(]/,"").replace(/=[^,]+/g,"").split(",").filter(Boolean)},et.prototype.forceChange=function(){this.onValueChanged||this.onChange,this._activity(),this.emitEvent("change",this.value,this),this.onChange?this.onChange(this,this.value):this.onValueChanged&&this.onValueChanged(this,this.value)},et.prototype.getTypeString=function(){return this.type==l.OP_PORT_TYPE_VALUE?"Number":this.type==l.OP_PORT_TYPE_FUNCTION?"Trigger":this.type==l.OP_PORT_TYPE_OBJECT?"Object":this.type==l.OP_PORT_TYPE_DYNAMIC?"Dynamic":this.type==l.OP_PORT_TYPE_ARRAY?"Array":this.type==l.OP_PORT_TYPE_STRING?"String":"Unknown"},et.prototype.deSerializeSettings=function(t){if(t&&(t.animated&&this.setAnimated(t.animated),t.useVariable&&this.setVariableName(t.useVariable),t.anim)){this.anim||(this.anim=new $),this.anim.addEventListener("onChange",()=>{this.parent.patch.emitEvent("portAnimUpdated",this.parent,this,this.anim)}),t.anim.loop&&(this.anim.loop=t.anim.loop);for(const e in t.anim.keys)this.anim.keys.push(new X.Key(t.anim.keys[e]))}},et.prototype.getSerialized=function(){const t={};if(t.name=this.getName(),this.ignoreValueSerialize||0!==this.links.length||this.type==l.OP_PORT_TYPE_OBJECT&&this.value&&this.value.tex||(t.value=this.value),this._useVariableName&&(t.useVariable=this._useVariableName),this._animated&&(t.animated=!0),this.anim&&(t.anim=this.anim.getSerialized()),"file"==this.uiAttribs.display&&(t.display=this.uiAttribs.display),this.direction==c.PORT_DIR_OUT&&this.links.length>0){t.links=[];for(const e in this.links)!this.links[e].ignoreInSerialize&&this.links[e].portIn&&this.links[e].portOut&&t.links.push(this.links[e].getSerialized())}return t},et.prototype.shouldLink=function(){return!0},et.prototype.removeLinks=function(){let t=0;for(;this.links.length>0;){if(t++,t>5e3){this._log.warn("could not delete links... / infinite loop"),this.links.length=0;break}this.links[0].remove()}},et.prototype.removeLink=function(t){for(const e in this.links)this.links[e]==t&&this.links.splice(e,1);this.direction==c.PORT_DIR_IN&&(this.type==l.OP_PORT_TYPE_VALUE?this.setValue(this._valueBeforeLink||0):this.setValue(this._valueBeforeLink||null)),this.onLinkChanged&&this.onLinkChanged(),this.emitEvent("onLinkChanged")},et.prototype.getName=function(){return this.name},et.prototype.addLink=function(t){this._valueBeforeLink=this.value,this.links.push(t),this.onLinkChanged&&this.onLinkChanged(),this.emitEvent("onLinkChanged")},et.prototype.getLinkTo=function(t){for(const e in this.links)if(this.links[e].portIn==t||this.links[e].portOut==t)return this.links[e]},et.prototype.removeLinkTo=function(t){for(const e in this.links)if(this.links[e].portIn==t||this.links[e].portOut==t)return this.links[e].remove(),this.onLinkChanged&&this.onLinkChanged(),void this.emitEvent("onLinkChanged")},et.prototype.isLinkedTo=function(t){for(const e in this.links)if(this.links[e].portIn==t||this.links[e].portOut==t)return!0;return!1},et.prototype._activity=function(){this.activityCounter++},et.prototype.trigger=function(){if(this._activity(),0===this.links.length)return;if(!this.parent.enabled)return;let t=null;try{for(let e=0;e<this.links.length;++e)this.links[e].portIn&&(t=this.links[e].portIn,t.parent.patch.pushTriggerStack(t),t._onTriggered(),t.parent.patch.popTriggerStack()),this.links[e]&&this.links[e].activity()}catch(e){this.parent.enabled=!1,this.parent.patch.isEditorMode()&&(this.parent.patch.emitEvent("exception",e,t.parent),this.parent.patch.emitEvent("opcrash",t),t.parent.onError&&t.parent.onError(e)),this._log.warn("exception!"),this._log.error("ontriggered exception cought",e),this._log.error(e.stack),this._log.warn("exception in: "+t.parent.name)}},et.prototype.call=function(){this._log.warn("call deprecated - use trigger() "),this.trigger()},et.prototype.execute=function(){this._log.warn("### execute port: "+this.getName(),this.goals.length)},et.prototype.setVariableName=function(t){this._useVariableName=t},et.prototype.getVariableName=function(){return this._useVariableName},et.prototype.setVariable=function(t){this.setAnimated(!1);const e={useVariable:!1};this._variableIn&&(this._variableIn.removeListener(this.set.bind(this)),this._variableIn=null),t?(this._variableIn=this.parent.patch.getVar(t),this._variableIn?(this.type==l.OP_PORT_TYPE_OBJECT?this._variableIn.addListener(()=>{this.set(null),this.set(this._variableIn.getValue())}):this._variableIn.addListener(this.set.bind(this)),this.set(this._variableIn.getValue())):this._log.warn("PORT VAR NOT FOUND!!!",t),this._useVariableName=t,e.useVariable=!0,e.variableName=this._useVariableName):(e.variableName=this._useVariableName=null,e.useVariable=!1),this.setUiAttribs(e),this.parent.patch.emitEvent("portSetVariable",this.parent,this,t)},et.prototype._handleNoTriggerOpAnimUpdates=function(t){let e=!1;for(let t=0;t<this.parent.portsIn.length;t++)if(this.parent.portsIn.type==l.OP_PORT_TYPE_FUNCTION){e=!0;break}e||(t?this._notriggerAnimUpdate=this.parent.patch.on("onRenderFrame",()=>{this.updateAnim()}):this.parent.patch.removeEventListener(this._notriggerAnimUpdate))},et.prototype.setAnimated=function(t){this._animated!=t&&(this._animated=t,this._animated&&!this.anim&&(this.anim=new $,this.anim.addEventListener("onChange",()=>{this.parent.patch.emitEvent("portAnimUpdated",this.parent,this,this.anim)})),this._onAnimToggle()),this._handleNoTriggerOpAnimUpdates(t),this.setUiAttribs({isAnimated:this._animated})},et.prototype.toggleAnim=function(t){this._animated=!this._animated,this._animated&&!this.anim&&(this.anim=new $,this.anim.addEventListener("onChange",()=>{this.parent.patch.emitEvent("portAnimUpdated",this.parent,this,this.anim)})),this.setAnimated(this._animated),this._onAnimToggle(),this.setUiAttribs({isAnimated:this._animated})},et.prototype.getType=function(){return this.type},et.prototype.isLinked=function(){return this.links.length>0},et.prototype.isBoundToVar=function(){return null!=this._useVariableName},et.prototype.isAnimated=function(){return this._animated},et.prototype.isHidden=function(){return this.uiAttribs.hidePort},et.prototype._onTriggered=function(t){this._activity(),this.parent.updateAnims(),this.parent.enabled&&this.onTriggered&&this.onTriggered(t)},et.prototype._onSetProfiling=function(t){this.parent.patch.profiler.add("port",this),this.setValue(t),this.parent.patch.profiler.add("port",null)},et.prototype._onTriggeredProfiling=function(){this.parent.enabled&&this.onTriggered&&(this.parent.patch.profiler.add("port",this),this.onTriggered(),this.parent.patch.profiler.add("port",null))},et.prototype.onValueChange=function(t){this.onChange=t},et.prototype.getUiActiveState=function(){return this._uiActiveState},et.prototype.setUiActiveState=function(t){this._uiActiveState=t,this.onUiActiveStateChange&&this.onUiActiveStateChange()},et.prototype.hidePort=function(){this._log.warn("op.hideport() is deprecated, do not use it!")},et.portTypeNumberToString=function(t){return t==l.OP_PORT_TYPE_VALUE?"value":t==l.OP_PORT_TYPE_FUNCTION?"function":t==l.OP_PORT_TYPE_OBJECT?"object":t==l.OP_PORT_TYPE_ARRAY?"array":t==l.OP_PORT_TYPE_STRING?"string":t==l.OP_PORT_TYPE_DYNAMIC?"dynamic":"unknown"};class it extends et{constructor(t,e,i,s,r){super(t,e,i,s),this.indexPort=r,this.indexPort.set=t=>{const e=s.values;if(!e)return;let i=Math.floor(t);i=Math.min(i,e.length-1),i=Math.max(i,0),this.indexPort.setValue(i),this.set(e[i]),this.parent.patch.isEditorMode()&&window.gui&&gui.patchView.isCurrentOp(this.parent)&&gui.opParams.show(this.parent)}}setUiAttribs(t){const e=t.hidePort;t.hidePort=!0,super.setUiAttribs(t),void 0!==e&&this.indexPort.setUiAttribs({hidePort:e})}}class st extends it{setUiAttribs(t){if(this.indexPort.isLinked())for(const e in t)"greyout"!=e||t[e]||(t[e]="true");super.setUiAttribs(t)}}const rt=function(t,e,i,s,r,n,o,a,l,c){if(this._loc=-1,this._log=new h("cgl_uniform"),this._type=e,this._cgl=t._cgl,this._name=i,this._shader=t,this._value=1e-5,this._oldValue=null,this._port=null,this._structName=l,this._structUniformName=a,this._propertyName=c,this._shader._addUniform(this),this.needsUpdate=!0,this.shaderType=null,this.comment=null,"f"==e)this.set=this.setValue=this.setValueF.bind(this),this.updateValue=this.updateValueF.bind(this);else if("f[]"==e)this.set=this.setValue=this.setValueArrayF.bind(this),this.updateValue=this.updateValueArrayF.bind(this);else if("2f[]"==e)this.set=this.setValue=this.setValueArray2F.bind(this),this.updateValue=this.updateValueArray2F.bind(this);else if("3f[]"==e)this.set=this.setValue=this.setValueArray3F.bind(this),this.updateValue=this.updateValueArray3F.bind(this);else if("4f[]"==e)this.set=this.setValue=this.setValueArray4F.bind(this),this.updateValue=this.updateValueArray4F.bind(this);else if("i"==e)this.set=this.setValue=this.setValueI.bind(this),this.updateValue=this.updateValueI.bind(this);else if("2i"==e)this.set=this.setValue=this.setValue2I.bind(this),this.updateValue=this.updateValue2I.bind(this);else if("3i"==e)this.set=this.setValue=this.setValue3I.bind(this),this.updateValue=this.updateValue3I.bind(this);else if("4i"==e)this.set=this.setValue=this.setValue4I.bind(this),this.updateValue=this.updateValue4I.bind(this);else if("b"==e)this.set=this.setValue=this.setValueBool.bind(this),this.updateValue=this.updateValueBool.bind(this);else if("4f"==e)this.set=this.setValue=this.setValue4F.bind(this),this.updateValue=this.updateValue4F.bind(this);else if("3f"==e)this.set=this.setValue=this.setValue3F.bind(this),this.updateValue=this.updateValue3F.bind(this);else if("2f"==e)this.set=this.setValue=this.setValue2F.bind(this),this.updateValue=this.updateValue2F.bind(this);else if("t"==e)this.set=this.setValue=this.setValueT.bind(this),this.updateValue=this.updateValueT.bind(this);else if("tc"==e)this.set=this.setValue=this.setValueT.bind(this),this.updateValue=this.updateValueT.bind(this);else if("t[]"==e)this.set=this.setValue=this.setValueArrayT.bind(this),this.updateValue=this.updateValueArrayT.bind(this);else{if("m4"!=e&&"m4[]"!=e)throw new Error("Unknown uniform type");this.set=this.setValue=this.setValueM4.bind(this),this.updateValue=this.updateValueM4.bind(this)}"object"==typeof s&&s instanceof et?(this._port=s,this._value=this._port.get(),r&&n&&o?(r instanceof et&&n instanceof et&&o instanceof et||this._log.error("[cgl_uniform] mixed port/value parameter for vec4 ",this._name),this._value=[0,0,0,0],this._port2=r,this._port3=n,this._port4=o,this._port.on("change",this.updateFromPort4f.bind(this)),this._port2.on("change",this.updateFromPort4f.bind(this)),this._port3.on("change",this.updateFromPort4f.bind(this)),this._port4.on("change",this.updateFromPort4f.bind(this)),this.updateFromPort4f()):r&&n?(r instanceof et&&n instanceof et||this._log.error("[cgl_uniform] mixed port/value parameter for vec4 ",this._name),this._value=[0,0,0],this._port2=r,this._port3=n,this._port.on("change",this.updateFromPort3f.bind(this)),this._port2.on("change",this.updateFromPort3f.bind(this)),this._port3.on("change",this.updateFromPort3f.bind(this)),this.updateFromPort3f()):r?(r instanceof et||this._log.error("[cgl_uniform] mixed port/value parameter for vec4 ",this._name),this._value=[0,0],this._port2=r,this._port.on("change",this.updateFromPort2f.bind(this)),this._port2.on("change",this.updateFromPort2f.bind(this)),this.updateFromPort2f()):this._port.on("change",this.updateFromPort.bind(this))):this._value=s,this.setValue(this._value),this.needsUpdate=!0};rt.prototype.copy=function(t){const e=new rt(t,this._type,this._name,this._value,this._port2,this._port3,this._port4,this._structUniformName,this._structName,this._propertyName);return e.shaderType=this.shaderType,e},rt.prototype.getGlslTypeString=function(){return"f"==this._type?"float":"b"==this._type?"bool":"i"==this._type?"int":"2i"==this._type?"ivec2":"2f"==this._type?"vec2":"3f"==this._type?"vec3":"4f"==this._type?"vec4":"m4"==this._type?"mat4":"t"==this._type?"sampler2D":"tc"==this._type?"samplerCube":"3f[]"==this._type||"m4[]"==this._type?null:void this._log.warn("[CGL UNIFORM] unknown glsl type string ",this._type)},rt.prototype._isValidLoc=function(){return-1!=this._loc},rt.prototype.getType=function(){return this._type},rt.prototype.getName=function(){return this._name},rt.prototype.getValue=function(){return this._value},rt.prototype.getShaderType=function(){return this.shaderType},rt.prototype.isStructMember=function(){return!!this._structName},rt.prototype.resetLoc=function(){this._loc=-1,this.needsUpdate=!0},rt.prototype.bindTextures=function(){return this._value},rt.prototype.resetLoc=function(){this._loc=-1,this.needsUpdate=!0},rt.prototype.bindTextures=function(){},rt.prototype.getLoc=function(){return this._loc},rt.prototype.updateFromPort4f=function(){this._value[0]=this._port.get(),this._value[1]=this._port2.get(),this._value[2]=this._port3.get(),this._value[3]=this._port4.get(),this.setValue(this._value)},rt.prototype.updateFromPort3f=function(){this._value[0]=this._port.get(),this._value[1]=this._port2.get(),this._value[2]=this._port3.get(),this.setValue(this._value)},rt.prototype.updateFromPort2f=function(){this._value[0]=this._port.get(),this._value[1]=this._port2.get(),this.setValue(this._value)},rt.prototype.updateFromPort=function(){this.setValue(this._port.get())},rt.prototype.updateValueF=function(){this._isValidLoc()?this.needsUpdate=!1:this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._shader.getCgl().gl.uniform1f(this._loc,this._value),this._cgl.profileData.profileUniformCount++},rt.prototype.setValueF=function(t){t!=this._value&&(this.needsUpdate=!0,this._value=t)},rt.prototype.updateValueI=function(){this._isValidLoc()?this.needsUpdate=!1:this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._shader.getCgl().gl.uniform1i(this._loc,this._value),this._cgl.profileData.profileUniformCount++},rt.prototype.updateValue2I=function(){this._value&&(this._isValidLoc()||(this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._cgl.profileData.profileShaderGetUniform++,this._cgl.profileData.profileShaderGetUniformName=this._name),this._shader.getCgl().gl.uniform2i(this._loc,this._value[0],this._value[1]),this.needsUpdate=!1,this._cgl.profileData.profileUniformCount++)},rt.prototype.updateValue3I=function(){this._value&&(this._isValidLoc()||(this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._cgl.profileData.profileShaderGetUniform++,this._cgl.profileData.profileShaderGetUniformName=this._name),this._shader.getCgl().gl.uniform3i(this._loc,this._value[0],this._value[1],this._value[2]),this.needsUpdate=!1,this._cgl.profileData.profileUniformCount++)},rt.prototype.updateValue4I=function(){this._isValidLoc()||(this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._cgl.profileData.profileShaderGetUniform++,this._cgl.profileData.profileShaderGetUniformName=this._name),this._shader.getCgl().gl.uniform4i(this._loc,this._value[0],this._value[1],this._value[2],this._value[3]),this._cgl.profileData.profileUniformCount++},rt.prototype.setValueI=function(t){t!=this._value&&(this.needsUpdate=!0,this._value=t)},rt.prototype.setValue2I=function(t){t&&(this._oldValue?t[0]==this._oldValue[0]&&t[1]==this._oldValue[1]||(this._oldValue[0]=t[0],this._oldValue[1]=t[1],this.needsUpdate=!0):(this._oldValue=[t[0]-1,1],this.needsUpdate=!0),this._value=t)},rt.prototype.setValue3I=function(t){t&&(this._oldValue?t[0]==this._oldValue[0]&&t[1]==this._oldValue[1]&&t[2]==this._oldValue[2]||(this._oldValue[0]=t[0],this._oldValue[1]=t[1],this._oldValue[2]=t[2],this.needsUpdate=!0):(this._oldValue=[t[0]-1,1,2],this.needsUpdate=!0),this._value=t)},rt.prototype.setValue4I=function(t){this.needsUpdate=!0,this._value=t||vec4.create()},rt.prototype.updateValueBool=function(){this._isValidLoc()?this.needsUpdate=!1:this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._shader.getCgl().gl.uniform1i(this._loc,this._value?1:0),this._cgl.profileData.profileUniformCount++},rt.prototype.setValueBool=function(t){t!=this._value&&(this.needsUpdate=!0,this._value=t)},rt.prototype.setValueArray4F=function(t){this.needsUpdate=!0,this._value=t},rt.prototype.updateValueArray4F=function(){this._isValidLoc()?this.needsUpdate=!1:this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._value&&(this._shader.getCgl().gl.uniform4fv(this._loc,this._value),this._cgl.profileData.profileUniformCount++)},rt.prototype.setValueArray3F=function(t){this.needsUpdate=!0,this._value=t},rt.prototype.updateValueArray3F=function(){this._isValidLoc()?this.needsUpdate=!1:this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._value&&(this._shader.getCgl().gl.uniform3fv(this._loc,this._value),this._cgl.profileData.profileUniformCount++)},rt.prototype.setValueArray2F=function(t){this.needsUpdate=!0,this._value=t},rt.prototype.updateValueArray2F=function(){this._isValidLoc()?this.needsUpdate=!1:this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._value&&(this._shader.getCgl().gl.uniform2fv(this._loc,this._value),this._cgl.profileData.profileUniformCount++)},rt.prototype.setValueArrayF=function(t){this.needsUpdate=!0,this._value=t},rt.prototype.updateValueArrayF=function(){this._isValidLoc()?this.needsUpdate=!1:this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._value&&(this._shader.getCgl().gl.uniform1fv(this._loc,this._value),this._cgl.profileData.profileUniformCount++)},rt.prototype.setValueArrayT=function(t){this.needsUpdate=!0,this._value=t},rt.prototype.updateValue3F=function(){this._value&&(this._isValidLoc()||(this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._cgl.profileData.profileShaderGetUniform++,this._cgl.profileData.profileShaderGetUniformName=this._name),this._shader.getCgl().gl.uniform3f(this._loc,this._value[0],this._value[1],this._value[2]),this.needsUpdate=!1,this._cgl.profileData.profileUniformCount++)},rt.prototype.setValue3F=function(t){t&&(this._oldValue?t[0]==this._oldValue[0]&&t[1]==this._oldValue[1]&&t[2]==this._oldValue[2]||(this._oldValue[0]=t[0],this._oldValue[1]=t[1],this._oldValue[2]=t[2],this.needsUpdate=!0):(this._oldValue=[t[0]-1,1,2],this.needsUpdate=!0),this._value=t)},rt.prototype.updateValue2F=function(){this._value&&(this._isValidLoc()||(this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._cgl.profileData.profileShaderGetUniform++,this._cgl.profileData.profileShaderGetUniformName=this._name),this._shader.getCgl().gl.uniform2f(this._loc,this._value[0],this._value[1]),this.needsUpdate=!1,this._cgl.profileData.profileUniformCount++)},rt.prototype.setValue2F=function(t){t&&(this._oldValue?t[0]==this._oldValue[0]&&t[1]==this._oldValue[1]||(this._oldValue[0]=t[0],this._oldValue[1]=t[1],this.needsUpdate=!0):(this._oldValue=[t[0]-1,1],this.needsUpdate=!0),this._value=t)},rt.prototype.updateValue4F=function(){this._isValidLoc()||(this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._cgl.profileData.profileShaderGetUniform++,this._cgl.profileData.profileShaderGetUniformName=this._name),this._value||(this._log.warn("no value for uniform",this._name,this),this._value=[0,0,0,0]),this.needsUpdate=!1,this._shader.getCgl().gl.uniform4f(this._loc,this._value[0],this._value[1],this._value[2],this._value[3]),this._cgl.profileData.profileUniformCount++},rt.prototype.setValue4F=function(t){"number"==typeof this.value&&(this.value=vec4.create()),t&&(this._oldValue?t[0]==this._oldValue[0]&&t[1]==this._oldValue[1]&&t[2]==this._oldValue[2]&&t[3]==this._oldValue[3]||(this._oldValue[0]=t[0],this._oldValue[1]=t[1],this._oldValue[2]=t[2],this.needsUpdate=!0):(this._oldValue=[t[0]-1,1,2,3],this.needsUpdate=!0),this._value=t)},rt.prototype.updateValueM4=function(){if(this._isValidLoc()||(this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._cgl.profileData.profileShaderGetUniform++,this._cgl.profileData.profileShaderGetUniformName=this._name),!this._value||this._value.length%16!=0)return console.log("this.name",this._name,this._value);this._shader.getCgl().gl.uniformMatrix4fv(this._loc,!1,this._value),this._cgl.profileData.profileUniformCount++},rt.prototype.setValueM4=function(t){this.needsUpdate=!0,this._value=t||mat4.create()},rt.prototype.updateValueArrayT=function(){this._isValidLoc()?this.needsUpdate=!1:this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._value&&(this._shader.getCgl().gl.uniform1iv(this._loc,this._value),this._cgl.profileData.profileUniformCount++)},rt.prototype.updateValueT=function(){this._isValidLoc()||(this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name),this._cgl.profileData.profileShaderGetUniform++,this._cgl.profileData.profileShaderGetUniformName=this._name),this._cgl.profileData.profileUniformCount++,this._shader.getCgl().gl.uniform1i(this._loc,this._value),this.needsUpdate=!1},rt.prototype.setValueT=function(t){this.needsUpdate=!0,this._value=t};const nt=180/Math.PI,ot={MATH:{DEG2RAD:Math.PI/180,RAD2DEG:nt},SHADER:{SHADERVAR_VERTEX_POSITION:"vPosition",SHADERVAR_VERTEX_NUMBER:"attrVertIndex",SHADERVAR_VERTEX_NORMAL:"attrVertNormal",SHADERVAR_VERTEX_TEXCOORD:"attrTexCoord",SHADERVAR_INSTANCE_MMATRIX:"instMat",SHADERVAR_VERTEX_COLOR:"attrVertColor",SHADERVAR_UNI_PROJMAT:"projMatrix",SHADERVAR_UNI_VIEWMAT:"viewMatrix",SHADERVAR_UNI_MODELMAT:"modelMatrix",SHADERVAR_UNI_NORMALMAT:"normalMatrix",SHADERVAR_UNI_INVVIEWMAT:"inverseViewMatrix",SHADERVAR_UNI_VIEWPOS:"camPos"},BLEND_MODES:{BLEND_NONE:0,BLEND_NORMAL:1,BLEND_ADD:2,BLEND_SUB:3,BLEND_MUL:4}};i(1);const ht={lastMesh:null},at=function(t,e,i){this._cgl=t,this._log=new h("cgl_mesh"),this._bufVertexAttrib=null,this._bufVerticesIndizes=this._cgl.gl.createBuffer(),this._indexType=this._cgl.gl.UNSIGNED_SHORT,this._attributes=[],this._attribLocs={},this._geom=null,this._lastShader=null,this._numInstances=0,this._glPrimitive=i,this._preWireframeGeom=null,this.addVertexNumbers=!1,this.feedBackAttributes=[],this.setGeom(e),this._feedBacks=[],this._feedBacksChanged=!1,this._transformFeedBackLoc=-1,this._lastAttrUpdate=0,this._name="unknown",this._cgl.profileData.addHeavyEvent("mesh constructed",this._name),this._queryExt=null,Object.defineProperty(this,"numInstances",{get(){return this._numInstances},set(t){this.setNumInstances(t)}})};at.prototype.updateVertices=function(t){this.setAttribute(ot.SHADER.SHADERVAR_VERTEX_POSITION,t.vertices,3),this._numVerts=t.vertices.length/3},at.prototype.setAttributePointer=function(t,e,i,s){for(let r=0;r<this._attributes.length;r++)this._attributes[r].name==t&&(this._attributes[r].pointer||(this._attributes[r].pointer=[]),this._attributes[r].pointer.push({loc:-1,name:e,stride:i,offset:s,instanced:t==ot.SHADER.SHADERVAR_INSTANCE_MMATRIX}))},at.prototype.getAttribute=function(t){for(let e=0;e<this._attributes.length;e++)if(this._attributes[e].name==t)return this._attributes[e]},at.prototype.setAttributeRange=function(t,e,i,s){t&&(i||s)&&(t.name||(console.log(t),this._log.stack("no attrname?!")),this._cgl.gl.bindBuffer(this._cgl.gl.ARRAY_BUFFER,t.buffer),this._cgl.profileData.profileMeshAttributes+=s-i||0,this._cgl.profileData.profileSingleMeshAttribute[this._name]=this._cgl.profileData.profileSingleMeshAttribute[this._name]||0,this._cgl.profileData.profileSingleMeshAttribute[this._name]+=s-i||0,t.numItems<e.length/t.itemSize&&this._resizeAttr(e,t),s>=e.length-1&&this._log.log(this._cgl.canvas.id+" "+t.name+" buffersubdata out of bounds ?",e.length,s,i,t),1==this._cgl.glVersion?this._cgl.gl.bufferSubData(this._cgl.gl.ARRAY_BUFFER,0,e):this._cgl.gl.bufferSubData(this._cgl.gl.ARRAY_BUFFER,4*i,e,i,s-i))},at.prototype._resizeAttr=function(t,e){e.buffer&&this._cgl.gl.deleteBuffer(e.buffer),e.buffer=this._cgl.gl.createBuffer(),this._cgl.gl.bindBuffer(this._cgl.gl.ARRAY_BUFFER,e.buffer),this._bufferArray(t,e),e.numItems=t.length/e.itemSize},at.prototype._bufferArray=function(t,e){let i=null;t&&(this._cgl.debugOneFrame&&console.log("_bufferArray",t.length,e.name),t instanceof Float32Array?i=t:e&&i&&i.length==t.length?i.set(t):(i=new Float32Array(t),this._cgl.debugOneFrame&&console.log("_bufferArray create new float32array",t.length,e.name),this._cgl.profileData.profileNonTypedAttrib++,this._cgl.profileData.profileNonTypedAttribNames="("+this._name+":"+e.name+")"),e.arrayLength=i.length,this._cgl.gl.bufferData(this._cgl.gl.ARRAY_BUFFER,i,this._cgl.gl.DYNAMIC_DRAW))},at.prototype.addAttribute=at.prototype.updateAttribute=at.prototype.setAttribute=function(t,e,i,s){if(!e)throw this._log.error("mesh addAttribute - no array given! "+t),new Error;let r=null,n=!1,o=0;const h=e.length/i;for(this._cgl.profileData.profileMeshAttributes+=h||0,"function"==typeof s&&(r=s),"object"==typeof s&&(s.cb&&(r=s.cb),s.instanced&&(n=s.instanced)),t==ot.SHADER.SHADERVAR_INSTANCE_MMATRIX&&(n=!0),o=0;o<this._attributes.length;o++){const i=this._attributes[o];if(i.name==t)return i.numItems===h||this._resizeAttr(e,i),this._cgl.gl.bindBuffer(this._cgl.gl.ARRAY_BUFFER,i.buffer),this._bufferArray(e,i),i}const a=this._cgl.gl.createBuffer();this._cgl.gl.bindBuffer(this._cgl.gl.ARRAY_BUFFER,a);let l=this._cgl.gl.FLOAT;s&&s.type&&(l=s.type);const c={buffer:a,name:t,cb:r,itemSize:i,numItems:h,startItem:0,instanced:n,type:l};return this._bufferArray(e,c),t==ot.SHADER.SHADERVAR_VERTEX_POSITION&&(this._bufVertexAttrib=c),this._attributes.push(c),this._attribLocs={},c},at.prototype.getAttributes=function(){return this._attributes},at.prototype.updateTexCoords=function(t){if(t.texCoords&&t.texCoords.length>0)this.setAttribute(ot.SHADER.SHADERVAR_VERTEX_TEXCOORD,t.texCoords,2);else{const e=new Float32Array(Math.round(t.vertices.length/3*2));this.setAttribute(ot.SHADER.SHADERVAR_VERTEX_TEXCOORD,e,2)}},at.prototype.updateNormals=function(t){if(t.vertexNormals&&t.vertexNormals.length>0)this.setAttribute("attrVertNormal",t.vertexNormals,3);else{const e=new Float32Array(Math.round(t.vertices.length));this.setAttribute("attrVertNormal",e,3)}},at.prototype._setVertexNumbers=function(t){if(!this._verticesNumbers||this._verticesNumbers.length!=this._numVerts||t){if(t)this._verticesNumbers=t;else{this._verticesNumbers=new Float32Array(this._numVerts);for(let t=0;t<this._numVerts;t++)this._verticesNumbers[t]=t}this.setAttribute(ot.SHADER.SHADERVAR_VERTEX_NUMBER,this._verticesNumbers,1,(t,e,i)=>{i.uniformNumVertices||(i.uniformNumVertices=new rt(i,"f","numVertices",this._numVerts)),i.uniformNumVertices.setValue(this._numVerts)})}},at.prototype.setVertexIndices=function(t){if(this._bufVerticesIndizes)if(t.length>0){for(let e=0;e<t.length;e++)if(t[e]>=this._numVerts)return void this._log.warn("invalid index in "+this._name);this._cgl.gl.bindBuffer(this._cgl.gl.ELEMENT_ARRAY_BUFFER,this._bufVerticesIndizes),t instanceof Float32Array&&this._log.warn("vertIndices float32Array: "+this._name),t instanceof Uint32Array?(this.vertIndicesTyped=t,this._indexType=this._cgl.gl.UNSIGNED_INT):t instanceof Uint16Array?this.vertIndicesTyped=t:this.vertIndicesTyped=new Uint16Array(t),this._cgl.gl.bufferData(this._cgl.gl.ELEMENT_ARRAY_BUFFER,this.vertIndicesTyped,this._cgl.gl.DYNAMIC_DRAW),this._bufVerticesIndizes.itemSize=1,this._bufVerticesIndizes.numItems=t.length}else this._bufVerticesIndizes.numItems=0;else this._log.warn("no bufVerticesIndizes: "+this._name)},at.prototype.setGeom=function(t,e){this._geom=t,null!=t.glPrimitive&&(this._glPrimitive=t.glPrimitive),this._geom&&this._geom.name&&(this._name="mesh "+this._geom.name),ht.lastMesh=null,this._cgl.profileData.profileMeshSetGeom++,this._disposeAttributes(),this.updateVertices(this._geom),this.setVertexIndices(this._geom.verticesIndices),this.updateTexCoords(this._geom),this.updateNormals(this._geom),this._geom.hasOwnProperty("tangents")&&this._geom.tangents&&this._geom.tangents.length>0&&this.setAttribute("attrTangent",this._geom.tangents,3),this._geom.hasOwnProperty("biTangents")&&this._geom.biTangents&&this._geom.biTangents.length>0&&this.setAttribute("attrBiTangent",this._geom.biTangents,3),this._geom.vertexColors.length>0&&(this._geom.vertexColors.flat&&this._geom.vertexColors.flat(100),this.setAttribute("attrVertColor",this._geom.vertexColors,4)),this.addVertexNumbers&&this._setVertexNumbers();const i=this._geom.getAttributes();for(const t in i)this.setAttribute(t,i[t].data,i[t].itemSize);e&&(this._geom=null)},at.prototype._preBind=function(t){for(let e=0;e<this._attributes.length;e++)this._attributes[e].cb&&this._attributes[e].cb(this._attributes[e],this._geom,t)},at.prototype._checkAttrLengths=function(){for(let t=0;t<this._attributes.length;t++)if(this._attributes[t].arrayLength/this._attributes[t].itemSize<this._attributes[0].arrayLength/this._attributes[0].itemSize){let t="unknown";this._geom&&(t=this._geom.name)}},at.prototype._bind=function(t){if(!t.isValid())return;let e=[];if(this._attribLocs[t.id]?e=this._attribLocs[t.id]:this._attribLocs[t.id]=e,this._lastShader=t,t.lastCompile>this._lastAttrUpdate||e.length!=this._attributes.length){this._lastAttrUpdate=t.lastCompile;for(let t=0;t<this._attributes.length;t++)e[t]=-1}for(let i=0;i<this._attributes.length;i++){const s=this._attributes[i];if(-1==e[i]&&s._attrLocationLastShaderTime!=t.lastCompile&&(s._attrLocationLastShaderTime=t.lastCompile,e[i]=this._cgl.glGetAttribLocation(t.getProgram(),s.name),this._cgl.profileData.profileAttrLoc++),-1!=e[i])if(this._cgl.gl.enableVertexAttribArray(e[i]),this._cgl.gl.bindBuffer(this._cgl.gl.ARRAY_BUFFER,s.buffer),s.instanced)if(s.itemSize<=4)s.itemSize&&0!=s.itemSize||this._log.warn("instanced attrib itemsize error",this._geom.name,s),this._cgl.gl.vertexAttribPointer(e[i],s.itemSize,s.type,!1,4*s.itemSize,0),this._cgl.gl.vertexAttribDivisor(e[i],1);else if(16==s.itemSize){const t=64;this._cgl.gl.vertexAttribPointer(e[i],4,s.type,!1,t,0),this._cgl.gl.enableVertexAttribArray(e[i]+1),this._cgl.gl.vertexAttribPointer(e[i]+1,4,s.type,!1,t,16),this._cgl.gl.enableVertexAttribArray(e[i]+2),this._cgl.gl.vertexAttribPointer(e[i]+2,4,s.type,!1,t,32),this._cgl.gl.enableVertexAttribArray(e[i]+3),this._cgl.gl.vertexAttribPointer(e[i]+3,4,s.type,!1,t,48),this._cgl.gl.vertexAttribDivisor(e[i],1),this._cgl.gl.vertexAttribDivisor(e[i]+1,1),this._cgl.gl.vertexAttribDivisor(e[i]+2,1),this._cgl.gl.vertexAttribDivisor(e[i]+3,1)}else this._log.warn("unknown instance attrib size",s.name);else{if(s.itemSize&&0!=s.itemSize||this._log.warn("attrib itemsize error",this._name,s),this._cgl.gl.vertexAttribPointer(e[i],s.itemSize,s.type,!1,4*s.itemSize,0),s.pointer)for(let e=0;e<s.pointer.length;e++){const i=s.pointer[e];-1==i.loc&&(i.loc=this._cgl.glGetAttribLocation(t.getProgram(),i.name)),this._cgl.profileData.profileAttrLoc++,this._cgl.gl.enableVertexAttribArray(i.loc),this._cgl.gl.vertexAttribPointer(i.loc,s.itemSize,s.type,!1,i.stride,i.offset)}this.bindFeedback(s)}}0!==this._bufVerticesIndizes.numItems&&this._cgl.gl.bindBuffer(this._cgl.gl.ELEMENT_ARRAY_BUFFER,this._bufVerticesIndizes)},at.prototype.unBind=function(){const t=this._lastShader;if(this._lastShader=null,!t)return;let e=[];this._attribLocs[t.id]?e=this._attribLocs[t.id]:this._attribLocs[t.id]=e,ht.lastMesh=null;for(let t=0;t<this._attributes.length;t++)this._attributes[t].instanced&&(this._attributes[t].itemSize<=4?(-1!=e[t]&&this._cgl.gl.vertexAttribDivisor(e[t],0),e[t]>=0&&this._cgl.gl.disableVertexAttribArray(e[t])):(this._cgl.gl.vertexAttribDivisor(e[t],0),this._cgl.gl.vertexAttribDivisor(e[t]+1,0),this._cgl.gl.vertexAttribDivisor(e[t]+2,0),this._cgl.gl.vertexAttribDivisor(e[t]+3,0),this._cgl.gl.disableVertexAttribArray(e[t]+1),this._cgl.gl.disableVertexAttribArray(e[t]+2),this._cgl.gl.disableVertexAttribArray(e[t]+3))),-1!=e[t]&&this._cgl.gl.disableVertexAttribArray(e[t])},at.prototype.meshChanged=function(){return this._cgl.lastMesh&&this._cgl.lastMesh!=this},at.prototype.printDebug=function(t){console.log("--attributes");for(let t=0;t<this._attributes.length;t++)console.log("attribute "+t+" "+this._attributes[t].name)},at.prototype.setNumVertices=function(t){this._bufVertexAttrib.numItems=t},at.prototype.getNumVertices=function(){return this._bufVertexAttrib.numItems},at.prototype.render=function(t){if(!t||!t.isValid())return;if(this._checkAttrLengths(),this._geom&&(!this._preWireframeGeom||t.wireframe||this._geom.isIndexed()||(this.setGeom(this._preWireframeGeom),this._preWireframeGeom=null),t.wireframe)){let t=!1;this._geom.isIndexed()&&(this._preWireframeGeom||(this._preWireframeGeom=this._geom,this._geom=this._geom.copy()),this._geom.unIndex(),t=!0),this._geom.getAttribute("attrBarycentric")||(this._preWireframeGeom||(this._preWireframeGeom=this._geom,this._geom=this._geom.copy()),t=!0,this._geom.calcBarycentric()),t&&this.setGeom(this._geom)}let e=!1;ht.lastMesh!=this&&(ht.lastMesh&&ht.lastMesh.unBind(),e=!0),e&&this._preBind(t),t.bind(),t.bindTextures&&t.bindTextures(),this._bind(t),this.addVertexNumbers&&this._setVertexNumbers(),ht.lastMesh=this;let i=this._cgl.gl.TRIANGLES;void 0!==this._glPrimitive&&(i=this._glPrimitive),null!==t.glPrimitive&&(i=t.glPrimitive);let s=1,r=this._cgl.profileData.doProfileGlQuery,n=!1;if(r){let e=this._name+" "+t.getName()+" #"+t.id;this._numInstances&&(e+=" instanced "+this._numInstances+"x");let i=this._cgl.profileData.glQueryData[e];if(i||(i={id:e,num:0},this._cgl.profileData.glQueryData[e]=i),this._queryExt||!1===this._queryExt||(this._queryExt=this._cgl.gl.getExtension("EXT_disjoint_timer_query_webgl2")||!1),this._queryExt){if(i._drawQuery){if(this._cgl.gl.getQueryParameter(i._drawQuery,this._cgl.gl.QUERY_RESULT_AVAILABLE)){const t=this._cgl.gl.getQueryParameter(i._drawQuery,this._cgl.gl.QUERY_RESULT)/1e6;i._times+=t,i._numcount++,i.when=performance.now(),i._drawQuery=null,i.queryStarted=!1}}i.queryStarted||(i._drawQuery=this._cgl.gl.createQuery(),this._cgl.gl.beginQuery(this._queryExt.TIME_ELAPSED_EXT,i._drawQuery),n=i.queryStarted=!0)}}if(this.hasFeedbacks()?this.drawFeedbacks(t,i):0===this._bufVerticesIndizes.numItems?(i==this._cgl.gl.TRIANGLES&&(s=3),0===this._numInstances?this._cgl.gl.drawArrays(i,this._bufVertexAttrib.startItem,this._bufVertexAttrib.numItems-this._bufVertexAttrib.startItem):this._cgl.gl.drawArraysInstanced(i,this._bufVertexAttrib.startItem,this._bufVertexAttrib.numItems,this._numInstances)):0===this._numInstances?this._cgl.gl.drawElements(i,this._bufVerticesIndizes.numItems,this._indexType,0):this._cgl.gl.drawElementsInstanced(i,this._bufVerticesIndizes.numItems,this._indexType,0,this._numInstances),this._cgl.debugOneFrame&&this._cgl.gl.getError()!=this._cgl.gl.NO_ERROR){this._log.error("mesh draw gl error"),this._log.error("mesh",this),this._log.error("shader",t);for(let e=0;e<this._cgl.gl.getProgramParameter(t.getProgram(),this._cgl.gl.ACTIVE_ATTRIBUTES);e++){const i=this._cgl.gl.getActiveAttrib(t.getProgram(),e).name;this._log.error("attrib ",i)}}this._cgl.profileData.profileMeshNumElements+=this._bufVertexAttrib.numItems/s*(this._numInstances||1),this._cgl.profileData.profileMeshDraw++,r&&n&&this._cgl.gl.endQuery(this._queryExt.TIME_ELAPSED_EXT),this.unBind()},at.prototype.setNumInstances=function(t){if(t=Math.max(0,t),this._numInstances!=t){this._numInstances=t;const e=new Float32Array(t);for(let i=0;i<t;i++)e[i]=i;this.setAttribute("instanceIndex",e,1,{instanced:!0})}},at.prototype._disposeAttributes=function(){if(this._attributes){for(let t=0;t<this._attributes.length;t++)this._attributes[t].buffer&&(this._cgl.gl.deleteBuffer(this._attributes[t].buffer),this._attributes[t].buffer=null);this._attributes.length=0}},at.prototype.dispose=function(){this._bufVertexAttrib&&this._bufVertexAttrib.buffer&&this._cgl.gl.deleteBuffer(this._bufVertexAttrib.buffer),this._bufVerticesIndizes&&this._cgl.gl.deleteBuffer(this._bufVerticesIndizes),this._bufVerticesIndizes=null,this._disposeAttributes()},function(t){t.prototype.hasFeedbacks=function(){return this._feedBacks.length>0},t.prototype.removeFeedbacks=function(t){this._feedbacks&&(this._feedbacks.length=0,this._feedBacksChanged=!0)},t.prototype.setAttributeFeedback=function(){},t.prototype.setFeedback=function(t,e,i){let s={nameOut:e},r=!1;this.unBindFeedbacks();for(let t=0;t<this._feedBacks.length;t++)this._feedBacks[t].nameOut==e&&(s=this._feedBacks[t],r=!0);return r||(this._feedBacksChanged=!0),s.initialArr=i,s.attrib=t,s.outBuffer&&this._cgl.gl.deleteBuffer(s.outBuffer),s.outBuffer=this._cgl.gl.createBuffer(),this._cgl.gl.bindBuffer(this._cgl.gl.ARRAY_BUFFER,s.outBuffer),this._cgl.gl.bufferData(this._cgl.gl.ARRAY_BUFFER,s.initialArr,this._cgl.gl.STATIC_DRAW),this._cgl.gl.bindBuffer(this._cgl.gl.ARRAY_BUFFER,s.attrib.buffer),this._cgl.gl.bufferData(this._cgl.gl.ARRAY_BUFFER,s.initialArr,this._cgl.gl.STATIC_DRAW),r||this._feedBacks.push(s),s},t.prototype.bindFeedback=function(t){if(!this._feedBacks||0===this._feedBacks.length)return;-1==this._transformFeedBackLoc&&(this._transformFeedBackLoc=this._cgl.gl.createTransformFeedback()),this._cgl.gl.bindTransformFeedback(this._cgl.gl.TRANSFORM_FEEDBACK,this._transformFeedBackLoc);let e=!1;for(let i=0;i<this._feedBacks.length;i++){const s=this._feedBacks[i];s.attrib==t&&(e=!0,this._cgl.gl.bindBufferBase(this._cgl.gl.TRANSFORM_FEEDBACK_BUFFER,i,s.outBuffer))}},t.prototype.drawFeedbacks=function(t,e){let i=0;if(this._feedBacksChanged){const e=[];for(this._cgl.gl.bindTransformFeedback(this._cgl.gl.TRANSFORM_FEEDBACK,this._transformFeedBackLoc),i=0;i<this._feedBacks.length;i++)e.push(this._feedBacks[i].nameOut);return t.setFeedbackNames(e),console.log("feedbacknames",e),t.compile(),this._feedBacksChanged=!1,this._cgl.gl.bindTransformFeedback(this._cgl.gl.TRANSFORM_FEEDBACK,null),void console.log("changed finished")}this._cgl.gl.beginTransformFeedback(this.glPrimitive),this._cgl.gl.drawArrays(e,0,this._feedBacks[0].attrib.numItems),this._cgl.gl.endTransformFeedback(),this.unBindFeedbacks(),this.feedBacksSwapBuffers()},t.prototype.unBindFeedbacks=function(){for(let t=0;t<this._feedBacks.length;t++)this._cgl.gl.bindBufferBase(this._cgl.gl.TRANSFORM_FEEDBACK_BUFFER,t,null);this._cgl.gl.bindTransformFeedback(this._cgl.gl.TRANSFORM_FEEDBACK,null)},t.prototype.feedBacksSwapBuffers=function(){for(let t=0;t<this._feedBacks.length;t++){const e=this._feedBacks[t].attrib.buffer;this._feedBacks[t].attrib.buffer=this._feedBacks[t].outBuffer,this._feedBacks[t].outBuffer=e}}}(at);const lt={getSimpleRect:function(t,e){const i=new Y(e);return i.vertices=[1,1,0,-1,1,0,1,-1,0,-1,-1,0],i.texCoords=[1,1,0,1,1,0,0,0],i.verticesIndices=[0,1,2,2,1,3],i.vertexNormals=[0,0,0,0,0,0,0,0,0,0,0,0],new at(t,i)}},ct=function(t,e){this._cgl=t,this._log=new h("cgl_TextureEffect"),t.TextureEffectMesh||this.createMesh(),this._textureSource=null,this._options=e,this.imgCompVer=0,this.aspectRatio=1,this._textureTarget=null,this._frameBuf=this._cgl.gl.createFramebuffer(),this._frameBuf2=this._cgl.gl.createFramebuffer(),this._renderbuffer=this._cgl.gl.createRenderbuffer(),this._renderbuffer2=this._cgl.gl.createRenderbuffer(),this.switched=!1,this.depth=!1};ct.prototype.getWidth=function(){return this._textureSource.width},ct.prototype.getHeight=function(){return this._textureSource.height},ct.prototype.setSourceTexture=function(t){t.textureType==L.TYPE_FLOAT&&this._cgl.gl.getExtension("EXT_color_buffer_float"),null===t?(this._textureSource=new L(this._cgl),this._textureSource.setSize(16,16)):this._textureSource=t,this._textureSource.compareSettings(this._textureTarget)||(this._textureTarget&&this._textureTarget.delete(),this._textureTarget=this._textureSource.clone(),this._cgl.profileData.profileEffectBuffercreate++,this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuf),this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,this._renderbuffer),this.depth&&this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER,this._cgl.gl.DEPTH_COMPONENT16,this._textureSource.width,this._textureSource.height),this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0,this._cgl.gl.TEXTURE_2D,this._textureTarget.tex,0),this.depth&&this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.RENDERBUFFER,this._renderbuffer),this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,null),this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,null),this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,null),this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuf2),this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,this._renderbuffer2),this.depth&&this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER,this._cgl.gl.DEPTH_COMPONENT16,this._textureSource.width,this._textureSource.height),this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0,this._cgl.gl.TEXTURE_2D,this._textureSource.tex,0),this.depth&&this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.RENDERBUFFER,this._renderbuffer2),this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,null),this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,null),this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,null)),this.aspectRatio=this._textureSource.width/this._textureSource.height},ct.prototype.continueEffect=function(){this._cgl.pushDepthTest(!1),this._cgl.pushModelMatrix(),this._cgl.pushPMatrix(),this._cgl.gl.viewport(0,0,this.getCurrentTargetTexture().width,this.getCurrentTargetTexture().height),mat4.perspective(this._cgl.pMatrix,45,this.getCurrentTargetTexture().width/this.getCurrentTargetTexture().height,.1,1100),this._cgl.pushPMatrix(),mat4.identity(this._cgl.pMatrix),this._cgl.pushViewMatrix(),mat4.identity(this._cgl.vMatrix),this._cgl.pushModelMatrix(),mat4.identity(this._cgl.mvMatrix)},ct.prototype.startEffect=function(t){this._textureTarget?(this.switched=!1,this.continueEffect(),t&&(this._bgTex=t),this._countEffects=0):this._log.warn("effect has no target")},ct.prototype.endEffect=function(){this._cgl.popDepthTest(),this._cgl.popModelMatrix(),this._cgl.popPMatrix(),this._cgl.popModelMatrix(),this._cgl.popViewMatrix(),this._cgl.popPMatrix(),this._cgl.resetViewPort()},ct.prototype.bind=function(){null!==this._textureSource?this.switched?(this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuf2),this._cgl.pushGlFrameBuffer(this._frameBuf2)):(this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuf),this._cgl.pushGlFrameBuffer(this._frameBuf)):this._log.warn("no base texture set!")},ct.prototype.finish=function(){null!==this._textureSource?(this._cgl.TextureEffectMesh.render(this._cgl.getShader()),this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.popGlFrameBuffer()),this._cgl.profileData.profileTextureEffect++,this._textureTarget.filter==L.FILTER_MIPMAP&&(this.switched?(this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,this._textureSource.tex),this._textureSource.updateMipMap()):(this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,this._textureTarget.tex),this._textureTarget.updateMipMap()),this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,null)),this.switched=!this.switched,this._countEffects++):this._log.warn("no base texture set!")},ct.prototype.getCurrentTargetTexture=function(){return this.switched?this._textureSource:this._textureTarget},ct.prototype.getCurrentSourceTexture=function(){return 0==this._countEffects&&this._bgTex?this._bgTex:this.switched?this._textureTarget:this._textureSource},ct.prototype.delete=function(){this._textureTarget&&this._textureTarget.delete(),this._textureSource&&this._textureSource.delete(),this._cgl.gl.deleteRenderbuffer(this._renderbuffer),this._cgl.gl.deleteFramebuffer(this._frameBuf)},ct.prototype.createMesh=function(){this._cgl.TextureEffectMesh=lt.getSimpleRect(this._cgl,"texEffectRect")},ct.checkOpNotInTextureEffect=function(t){return t.uiAttribs.error&&!t.patch.cgl.currentTextureEffect?(t.setUiError("textureeffect",null),!0):!t.patch.cgl.currentTextureEffect||(t.patch.cgl.currentTextureEffect&&!t.uiAttribs.error?(t.setUiError("textureeffect","This op can not be a child of a ImageCompose/texture effect! imagecompose should only have textureeffect childs.",0),!1):!t.patch.cgl.currentTextureEffect)},ct.checkOpInEffect=function(t,e){if(e=e||0,t.patch.cgl.currentTextureEffect){if(t.uiAttribs.uierrors&&t.patch.cgl.currentTextureEffect.imgCompVer>=e)return t.setUiError("texeffect",null),!0;e&&t.patch.cgl.currentTextureEffect.imgCompVer<e&&t.setUiError("texeffect","This op must be a child of an ImageCompose op with version >="+e+' <span class="button-small" onclick="gui.patchView.downGradeOp(\''+t.id+"','"+t.name+"')\">Downgrade</span> to previous version",1)}return!!t.patch.cgl.currentTextureEffect||(t.patch.cgl.currentTextureEffect||t.uiAttribs.uierrors&&0!=t.uiAttribs.uierrors.length?!!t.patch.cgl.currentTextureEffect:(t.setUiError("texeffect",'This op must be a child of an ImageCompose op! More infos <a href="https://docs.cables.gl/image_composition/image_composition.html" target="_blank">here</a>. ',1),!1))},ct.getBlendCode=function(t){let e="".endl()+"vec3 _blend(vec3 base,vec3 blend)".endl()+"{".endl()+"   vec3 colNew=blend;".endl()+"   #ifdef BM_MULTIPLY".endl()+"       colNew=base*blend;".endl()+"   #endif".endl()+"   #ifdef BM_MULTIPLY_INV".endl()+"       colNew=base* vec3(1.0)-blend;".endl()+"   #endif".endl()+"   #ifdef BM_AVERAGE".endl()+"       colNew=((base + blend) / 2.0);".endl()+"   #endif".endl()+"   #ifdef BM_ADD".endl()+"       colNew=min(base + blend, vec3(1.0));".endl()+"   #endif".endl()+"   #ifdef BM_SUBTRACT_ONE".endl()+"       colNew=max(base + blend - vec3(1.0), vec3(0.0));".endl()+"   #endif".endl()+"   #ifdef BM_SUBTRACT".endl()+"       colNew=base - blend;".endl()+"   #endif".endl()+"   #ifdef BM_DIFFERENCE".endl()+"       colNew=abs(base - blend);".endl()+"   #endif".endl()+"   #ifdef BM_NEGATION".endl()+"       colNew=(vec3(1.0) - abs(vec3(1.0) - base - blend));".endl()+"   #endif".endl()+"   #ifdef BM_EXCLUSION".endl()+"       colNew=(base + blend - 2.0 * base * blend);".endl()+"   #endif".endl()+"   #ifdef BM_LIGHTEN".endl()+"       colNew=max(blend, base);".endl()+"   #endif".endl()+"   #ifdef BM_DARKEN".endl()+"       colNew=min(blend, base);".endl()+"   #endif".endl()+"   #ifdef BM_OVERLAY".endl()+"      #define BlendOverlayf(base, blend)  (base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend)))".endl()+"      colNew=vec3(BlendOverlayf(base.r, blend.r),BlendOverlayf(base.g, blend.g),BlendOverlayf(base.b, blend.b));".endl()+"   #endif".endl()+"   #ifdef BM_SCREEN".endl()+"      #define BlendScreenf(base, blend)       (1.0 - ((1.0 - base) * (1.0 - blend)))".endl()+"      colNew=vec3(BlendScreenf(base.r, blend.r),BlendScreenf(base.g, blend.g),BlendScreenf(base.b, blend.b));".endl()+"   #endif".endl()+"   #ifdef BM_SOFTLIGHT".endl()+"      #define BlendSoftLightf(base, blend)    ((blend < 0.5) ? (2.0 * base * blend + base * base * (1.0 - 2.0 * blend)) : (sqrt(base) * (2.0 * blend - 1.0) + 2.0 * base * (1.0 - blend)))".endl()+"      colNew=vec3(BlendSoftLightf(base.r, blend.r),BlendSoftLightf(base.g, blend.g),BlendSoftLightf(base.b, blend.b));".endl()+"   #endif".endl()+"   #ifdef BM_HARDLIGHT".endl()+"      #define BlendOverlayf(base, blend)  (base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend)))".endl()+"      colNew=vec3(BlendOverlayf(base.r, blend.r),BlendOverlayf(base.g, blend.g),BlendOverlayf(base.b, blend.b));".endl()+"   #endif".endl()+"   #ifdef BM_COLORDODGE".endl()+"      #define BlendColorDodgef(base, blend)   ((blend == 1.0) ? blend : min(base / (1.0 - blend), 1.0))".endl()+"      colNew=vec3(BlendColorDodgef(base.r, blend.r),BlendColorDodgef(base.g, blend.g),BlendColorDodgef(base.b, blend.b));".endl()+"   #endif".endl()+"   #ifdef BM_COLORBURN".endl()+"      #define BlendColorBurnf(base, blend)    ((blend == 0.0) ? blend : max((1.0 - ((1.0 - base) / blend)), 0.0))".endl()+"      colNew=vec3(BlendColorBurnf(base.r, blend.r),BlendColorBurnf(base.g, blend.g),BlendColorBurnf(base.b, blend.b));".endl()+"   #endif".endl()+"   return colNew;".endl()+"}".endl();return t||(e+="vec4 cgl_blend(vec4 oldColor,vec4 newColor,float amount)".endl()+"{".endl()+"vec4 col=vec4( _blend(oldColor.rgb,newColor.rgb) ,1.0);".endl()+"col=vec4( mix( col.rgb, oldColor.rgb ,1.0-oldColor.a*amount),1.0);".endl()+"return col;".endl()+"}".endl()),t>=3&&(e+="vec4 cgl_blendPixel(vec4 base,vec4 col,float amount)".endl()+"{".endl()+"vec3 colNew=_blend(base.rgb,col.rgb);".endl()+"float newA=clamp(base.a+(col.a*amount),0.,1.);".endl()+"#ifdef BM_ALPHAMASKED".endl()+"newA=base.a;".endl()+"#endif".endl()+"return vec4(".endl()+"mix(colNew,base.rgb,1.0-(amount*col.a)),".endl()+"newA);".endl()+"}".endl()),e},ct.onChangeBlendSelect=function(t,e,i){t.toggleDefine("BM_NORMAL","normal"==e),t.toggleDefine("BM_MULTIPLY","multiply"==e),t.toggleDefine("BM_MULTIPLY_INV","multiply invert"==e),t.toggleDefine("BM_AVERAGE","average"==e),t.toggleDefine("BM_ADD","add"==e),t.toggleDefine("BM_SUBTRACT_ONE","subtract one"==e),t.toggleDefine("BM_SUBTRACT","subtract"==e),t.toggleDefine("BM_DIFFERENCE","difference"==e),t.toggleDefine("BM_NEGATION","negation"==e),t.toggleDefine("BM_EXCLUSION","exclusion"==e),t.toggleDefine("BM_LIGHTEN","lighten"==e),t.toggleDefine("BM_DARKEN","darken"==e),t.toggleDefine("BM_OVERLAY","overlay"==e),t.toggleDefine("BM_SCREEN","screen"==e),t.toggleDefine("BM_SOFTLIGHT","softlight"==e),t.toggleDefine("BM_HARDLIGHT","hardlight"==e),t.toggleDefine("BM_COLORDODGE","color dodge"==e),t.toggleDefine("BM_COLORBURN","color burn"==e),t.toggleDefine("BM_ALPHAMASKED",i)},ct.AddBlendSelect=function(t,e,i){return t.inValueSelect(e||"Blend Mode",["normal","lighten","darken","multiply","multiply invert","average","add","subtract","difference","negation","exclusion","overlay","screen","color dodge","color burn","softlight","hardlight","subtract one"],i||"normal")},ct.AddBlendAlphaMask=function(t,e,i){return t.inSwitch(e||"Alpha Mask",["Off","On"],i||"Off")},ct.setupBlending=function(t,e,i,s,r){const n=()=>{let s=!1;r&&(s="On"==r.get()),ct.onChangeBlendSelect(e,i.get(),s);let n=i.get();"normal"==n?n=null:"multiply"==n?n="mul":"multiply invert"==n?n="mulinv":"lighten"==n?n="light":"darken"==n?n="darken":"average"==n?n="avg":"subtract one"==n?n="sub one":"subtract"==n?n="sub":"difference"==n?n="diff":"negation"==n||"negation"==n||"negation"==n?n="neg":"exclusion"==n?n="exc":"overlay"==n?n="ovl":"color dodge"==n?n="dodge":"color burn"==n?n="burn":"softlight"==n?n="soft":"hardlight"==n&&(n="hard"),t.setUiAttrib({extendTitle:n})};t.setPortGroup("Blending",[i,s,r]);let o=!1;i.onChange=n,r&&(r.onChange=n,o="On"==r.get()),ct.onChangeBlendSelect(e,i.get(),o)};const ut={"CGL.BLENDMODES":function(){this.name="blendmodes",this.srcHeadFrag=ct.getBlendCode()},"CGL.BLENDMODES3":function(){this.name="blendmodes3",this.srcHeadFrag=ct.getBlendCode(3)},"CGL.LUMINANCE":function(){this.name="luminance",this.srcHeadFrag="".endl()+"float cgl_luminance(vec3 c)".endl()+"{".endl()+"    return dot(vec3(0.2126,0.7152,0.0722),c);".endl()+"}".endl()},"CGL.RANDOM_OLD":function(){this.name="randomNumber",this.srcHeadFrag="".endl()+"float cgl_random(vec2 co)".endl()+"{".endl()+"    return fract(sin(dot(co.xy ,vec2(12.9898,4.1414))) * 432758.5453);".endl()+"}".endl()+"vec3 cgl_random3(vec2 co)".endl()+"{".endl()+"    return vec3( cgl_random(co),cgl_random(co+0.5711),cgl_random(co+1.5711));".endl()+"}"},"CGL.RANDOM_LOW":function(){this.name="randomNumber",this.srcHeadFrag="".endl()+"float cgl_random(vec2 co)".endl()+"{".endl()+"    return fract(sin(dot(co.xy ,vec2(12.9898,4.1414))) * 358.5453);".endl()+"}".endl()+"vec3 cgl_random3(vec2 co)".endl()+"{".endl()+"    return vec3( cgl_random(co),cgl_random(co+0.5711),cgl_random(co+1.5711));".endl()+"}"},"CGL.RANDOM_TEX":function(){this.name="randomNumbertex",this.srcHeadFrag="".endl()+"UNI sampler2D CGLRNDTEX;".endl()+"float cgl_random(vec2 co)".endl()+"{".endl()+"    return texture(CGLRNDTEX,co*5711.0).r;".endl()+"}".endl()+"vec3 cgl_random3(vec2 co)".endl()+"{".endl()+"    return texture(CGLRNDTEX,co*5711.0).rgb;".endl()+"}",this.initUniforms=function(t){return[new rt(t,"t","CGLRNDTEX",7)]},this.onBind=function(t,e){L.getRandomTexture(t),t.setTexture(7,L.getRandomTexture(t).tex)}}},gt=function(){return window.performance.now()},pt=function(){return gt()},_t=function(){CABLES.EventTarget.apply(this),this._timeStart=gt(),this._timeOffset=0,this._currentTime=0,this._lastTime=0,this._paused=!0,this._delay=0,this._eventsPaused=!1,this.overwriteTime=-1,this.cbPlayPause=[],this.cbTimeChange=[]};_t.prototype._getTime=function(){return this._lastTime=(gt()-this._timeStart)/1e3,this._lastTime+this._timeOffset},_t.prototype._eventPlayPause=function(){if(this.emitEvent("playPause"),!this._eventsPaused)for(const t in this.cbPlayPause)this.cbPlayPause[t]()},_t.prototype._eventTimeChange=function(){if(!this._eventsPaused)for(const t in this.cbTimeChange)this.cbTimeChange[t]()},_t.prototype.setDelay=function(t){this._delay=t,this._eventTimeChange()},_t.prototype.isPlaying=function(){return!this._paused},_t.prototype.update=function(){if(!this._paused)return this._currentTime=this._getTime(),this._currentTime},_t.prototype.getMillis=function(){return 1e3*this.get()},_t.prototype.get=_t.prototype.getTime=function(){return this.overwriteTime>=0?this.overwriteTime-this._delay:this._currentTime-this._delay},_t.prototype.togglePlay=function(){this._paused?this.play():this.pause()},_t.prototype.setTime=function(t){t<0&&(t=0),this._timeStart=gt(),this._timeOffset=t,this._currentTime=t,this._eventTimeChange()},_t.prototype.setOffset=function(t){this._currentTime+t<0?(this._timeStart=gt(),this._timeOffset=0,this._currentTime=0):(this._timeOffset+=t,this._currentTime=this._lastTime+this._timeOffset),this._eventTimeChange()},_t.prototype.play=function(){this._timeStart=gt(),this._paused=!1,this._eventPlayPause()},_t.prototype.pause=function(){this._timeOffset=this._currentTime,this._paused=!0,this._eventPlayPause()},_t.prototype.pauseEvents=function(t){this._eventsPaused=t},_t.prototype.onPlayPause=function(t){t&&"function"==typeof t&&this.cbPlayPause.push(t)},_t.prototype.onTimeChange=function(t){t&&"function"==typeof t&&this.cbTimeChange.push(t)};const dt=Math.PI/180,ft=(Math.PI,-1!=window.navigator.userAgent.indexOf("Windows")),mt=function(t){let e;if(t.wheelDelta)e=t.wheelDelta%120-0==-0?t.wheelDelta/120:t.wheelDelta/30,e*=-1.5,ft&&(e*=2);else{let i=t.deltaY;t.shiftKey&&(i=t.deltaX);const s=i||t.detail;e=-(s%3?10*s:s/3),e*=-3}return e>20&&(e=20),e<-20&&(e=-20),e},Et=mt,Tt=mt,At={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},bt=/[&<>"']/g,yt=RegExp(bt.source);const vt=function(t,e){if(!t)throw new Error("shader constructed without cgl "+e);this._log=new h("cgl_shader"),this._cgl=t,e||this._log.stack("no shader name given"),this._name=e||"unknown",this.glslVersion=0,t.glVersion>1&&(this.glslVersion=300),this.id=y(),this._isValid=!0,this._program=null,this._uniforms=[],this._drawBuffers=[!0],this._defines=[],this._needsRecompile=!0,this._compileReason="initial",this._projMatrixUniform=null,this._mvMatrixUniform=null,this._mMatrixUniform=null,this._vMatrixUniform=null,this._camPosUniform=null,this._normalMatrixUniform=null,this._inverseViewMatrixUniform=null,this._attrVertexPos=-1,this.precision=t.patch.config.glslPrecision||"highp",this._pMatrixState=-1,this._vMatrixState=-1,this._modGroupCount=0,this._feedBackNames=[],this._attributes=[],this.glPrimitive=null,this.offScreenPass=!1,this._extensions=[],this.srcVert=this.getDefaultVertexShader(),this.srcFrag=this.getDefaultFragmentShader(),this.lastCompile=0,this._moduleNames=[],this._modules=[],this._moduleNumId=0,this._libs=[],this._structNames=[],this._structUniformNames=[],this._textureStackUni=[],this._textureStackTex=[],this._textureStackType=[],this._textureStackTexCgl=[],this._tempNormalMatrix=mat4.create(),this._tempCamPosMatrix=mat4.create(),this._tempInverseViewMatrix=mat4.create(),this.setModules(["MODULE_VERTEX_POSITION","MODULE_COLOR","MODULE_BEGIN_FRAG"])};vt.prototype.isValid=function(){return this._isValid},vt.prototype.getCgl=function(){return this._cgl},vt.prototype.getName=function(){return this._name},vt.prototype.enableExtension=function(t){this.setWhyCompile("enable extension "+t),this._needsRecompile=!0,this._extensions.push(t)},vt.prototype.getAttrVertexPos=function(){return this._attrVertexPos},vt.prototype.hasTextureUniforms=function(){for(let t=0;t<this._uniforms.length;t++)if("t"==this._uniforms[t].getType())return!0;return!1},vt.prototype.setWhyCompile=function(t){this._compileReason=t},vt.prototype.copyUniformValues=function(t){for(let e=0;e<t._uniforms.length;e++)this._uniforms[e]?(-1!=t._uniforms[e].getName().indexOf("pathPoints")&&console.log("copyUniformValues",t._uniforms[e].getName(),t._uniforms[e].getValue()),this.getUniform(t._uniforms[e].getName()).set(t._uniforms[e].getValue())):this._log.log("unknown uniform?!");this.popTextures();for(let e=0;e<t._textureStackUni.length;e++)this._textureStackUni[e]=t._textureStackUni[e],this._textureStackTex[e]=t._textureStackTex[e],this._textureStackType[e]=t._textureStackType[e],this._textureStackTexCgl[e]=t._textureStackTexCgl[e]},vt.prototype.copy=function(){const t=new vt(this._cgl,this._name+" copy");t.setSource(this.srcVert,this.srcFrag),t._modules=JSON.parse(JSON.stringify(this._modules)),t._defines=JSON.parse(JSON.stringify(this._defines)),t._modGroupCount=this._modGroupCount,t._moduleNames=this._moduleNames,t.glPrimitive=this.glPrimitive,t.offScreenPass=this.offScreenPass,t._extensions=this._extensions,t.wireframe=this.wireframe;for(let e=0;e<this._uniforms.length;e++){this._uniforms[e].copy(t).resetLoc()}return this.setWhyCompile("copy"),t._needsRecompile=!0,t},vt.prototype.setSource=function(t,e){this.srcVert=t,this.srcFrag=e,this.setWhyCompile("Source changed"),this._needsRecompile=!0},vt.prototype._addLibs=function(t){for(const e in ut)if(t.indexOf(e)>-1){const i=new ut[e];t=t.replace("{{"+e+"}}",i.srcHeadFrag),this._libs.push(i),i.initUniforms&&i.initUniforms(this)}return t},vt.prototype.createStructUniforms=function(){let t="",e="";this._structNames=[],this._injectedStringsFrag={},this._injectedStringsVert={},this._structUniformNamesIndicesFrag=[],this._structUniformNamesIndicesVert=[];for(let i=0;i<this._uniforms.length;i++)if(this._uniforms[i].isStructMember()){const s="{{INJECTION_POINT_STRUCT_"+this._uniforms[i]._structName+"}}";if(-1===this._structNames.indexOf(this._uniforms[i]._structName)){const r="struct "+this._uniforms[i]._structName+" {".endl()+s+"};".endl().endl();"both"!==this._uniforms[i].getShaderType()&&"frag"!==this._uniforms[i].getShaderType()||(t=t.concat(r)),"both"!==this._uniforms[i].getShaderType()&&"vert"!==this._uniforms[i].getShaderType()||(e=e.concat(r)),this._structNames.push(this._uniforms[i]._structName),this._injectedStringsFrag[this._uniforms[i]._structName]=[],this._injectedStringsVert[this._uniforms[i]._structName]=[]}let r="";this._uniforms[i].comment&&(r=" // "+this._uniforms[i].comment);let n="";if(null==this._uniforms[i].getGlslTypeString()&&(n+="//"),n+="  "+this._uniforms[i].getGlslTypeString()+" "+this._uniforms[i]._propertyName+";"+r,"both"===this._uniforms[i].getShaderType()){if(-1===this._injectedStringsFrag[this._uniforms[i]._structName].indexOf(n)&&-1===this._injectedStringsVert[this._uniforms[i]._structName].indexOf(n)){const r=t.lastIndexOf(s),o=e.lastIndexOf(s);t=t.slice(0,r)+n+t.slice(r-1),e=e.slice(0,o)+n+e.slice(o-1),this._injectedStringsFrag[this._uniforms[i]._structName].push(n),this._injectedStringsVert[this._uniforms[i]._structName].push(n)}-1===this._structUniformNamesIndicesFrag.indexOf(i)&&this._structUniformNamesIndicesFrag.push(i),-1===this._structUniformNamesIndicesVert.indexOf(i)&&this._structUniformNamesIndicesVert.push(i)}else if("frag"===this._uniforms[i].getShaderType()){if(-1===this._injectedStringsFrag[this._uniforms[i]._structName].indexOf(n)){const e=t.lastIndexOf(s);t=t.slice(0,e)+n+t.slice(e-1),this._injectedStringsFrag[this._uniforms[i]._structName].push(n)}-1===this._structUniformNamesIndicesFrag.indexOf(i)&&this._structUniformNamesIndicesFrag.push(i)}else if("vert"===this._uniforms[i].getShaderType()){if(-1===this._injectedStringsVert[this._uniforms[i]._structName].indexOf(n)){const t=e.lastIndexOf(s);e=e.slice(0,t)+n+e.slice(t-1),this._injectedStringsVert[this._uniforms[i]._structName].push(n)}-1===this._structUniformNamesIndicesVert.indexOf(i)&&this._structUniformNamesIndicesVert.push(i)}}this._uniDeclarationsFrag=[],this._uniDeclarationsVert=[];for(let e=0;e<this._structUniformNamesIndicesFrag.length;e+=1){const i=this._structUniformNamesIndicesFrag[e],s="UNI "+this._uniforms[i]._structName+" "+this._uniforms[i]._structUniformName+";".endl();if(-1===this._uniDeclarationsFrag.indexOf(s)){const e="{{INJECTION_POINT_STRUCT_"+this._uniforms[i]._structName+"}}";t=t.replace(e,""),t+=s,this._uniDeclarationsFrag.push(s)}}for(let t=0;t<this._structUniformNamesIndicesVert.length;t+=1){const i=this._structUniformNamesIndicesVert[t],s="UNI "+this._uniforms[i]._structName+" "+this._uniforms[i]._structUniformName+";".endl();if(-1===this._uniDeclarationsVert.indexOf(s)){const t="{{INJECTION_POINT_STRUCT_"+this._uniforms[i]._structName+"}}";e=e.replace(t,""),e+=s,this._uniDeclarationsVert.push(s)}}return[e,t]},vt.prototype.compile=function(){const t=performance.now();this._cgl.profileData.profileShaderCompiles++,this._cgl.profileData.profileShaderCompileName=this._name+" ["+this._compileReason+"]";let e="";if(this._extensions)for(let t=0;t<this._extensions.length;t++)e+="#extension "+this._extensions[t]+" : enable".endl();let i="";this._defines.length&&(i="\n// cgl generated".endl());for(let t=0;t<this._defines.length;t++)i+="#define "+this._defines[t][0]+" "+this._defines[t][1]+"".endl();const s=this.createStructUniforms();if(this._cgl.profileData.addHeavyEvent("shader compile",this._name+" ["+this._compileReason+"]"),this._compileReason="",this._uniforms){const t=this._uniforms.map(t=>t._name),e=[];for(let i=0;i<this._uniforms.length;i++){const s=this._uniforms[i];t.indexOf(s._name,i+1)>-1&&e.push(i)}for(let t=this._uniforms.length-1;t>=0;t-=1)e.indexOf(t)>-1?this._uniforms.splice(t,1):this._uniforms[t].resetLoc()}this._cgl.printError("uniform resets"),this.hasTextureUniforms()&&(i+="#define HAS_TEXTURES".endl());let r="",n="";if(this.srcFrag||(this._log.error("[cgl shader] has no fragment source!"),this.srcVert=this.getDefaultVertexShader(),this.srcFrag=this.getDefaultFragmentShader()),300==this.glslVersion){let t="";if(this.srcFrag.indexOf("outColor0")>-1&&(this._drawBuffers[0]=!0),this.srcFrag.indexOf("outColor1")>-1&&(this._drawBuffers[1]=!0),this.srcFrag.indexOf("outColor2")>-1&&(this._drawBuffers[2]=!0),this.srcFrag.indexOf("outColor3")>-1&&(this._drawBuffers[3]=!0),1==this._drawBuffers.length)t="out vec4 outColor;".endl(),t+="#define gl_FragColor outColor".endl();else{let e=0;t+="#define MULTI_COLORTARGETS".endl(),t+="vec4 outColor;".endl();for(let i=0;i<this._drawBuffers.length;i++)0==e&&(t+="#define gl_FragColor outColor"+i+"".endl()),t+="layout(location = "+i+") out vec4 outColor"+i+";".endl(),e++}r="#version 300 es".endl()+"// ".endl()+"// vertex shader "+this._name.endl()+"// ".endl()+"precision "+this.precision+" float;".endl()+"precision "+this.precision+" sampler2D;".endl()+"".endl()+"#define WEBGL2".endl()+"#define texture2D texture".endl()+"#define UNI uniform".endl()+"#define IN in".endl()+"#define OUT out".endl(),n="#version 300 es".endl()+"// ".endl()+"// fragment shader "+this._name.endl()+"// ".endl()+"precision "+this.precision+" float;".endl()+"precision "+this.precision+" sampler2D;".endl()+"".endl()+"#define WEBGL2".endl()+"#define texture2D texture".endl()+"#define IN in".endl()+"#define UNI uniform".endl()+t.endl()}else n="".endl()+"// ".endl()+"// fragment shader "+this._name.endl()+"// ".endl()+"#define WEBGL1".endl()+"#define texture texture2D".endl()+"#define outColor gl_FragColor".endl()+"#define IN varying".endl()+"#define UNI uniform".endl(),r="".endl()+"// ".endl()+"// vertex shader "+this._name.endl()+"// ".endl()+"#define WEBGL1".endl()+"#define texture texture2D".endl()+"#define OUT varying".endl()+"#define IN attribute".endl()+"#define UNI uniform".endl();let o="\n// cgl generated".endl(),h="\n// cgl generated".endl();n+="\n// active mods: --------------- ",r+="\n// active mods: --------------- ";let a=!1,l=!1;for(let t=0;t<this._moduleNames.length;t++)for(let e=0;e<this._modules.length;e++)this._modules[e].name==this._moduleNames[t]&&((this._modules[e].srcBodyFrag||this._modules[e].srcHeadFrag)&&(a=!0,n+="\n// "+t+"."+e+". "+this._modules[e].title+" ("+this._modules[e].name+")"),(this._modules[e].srcBodyVert||this._modules[e].srcHeadVert)&&(r+="\n// "+t+"."+e+". "+this._modules[e].title+" ("+this._modules[e].name+")",l=!0));l||(n+="\n// no mods used..."),a||(n+="\n// no mods used..."),n+="\n",r+="\n";for(let t=0;t<this._uniforms.length;t++)if(this._uniforms[t].shaderType&&!this._uniforms[t].isStructMember()){let e="";this._uniforms[t].getGlslTypeString()||(e+="// "),e+="UNI "+this._uniforms[t].getGlslTypeString()+" "+this._uniforms[t].getName();let i="";this._uniforms[t].comment&&(i=" // "+this._uniforms[t].comment),"vert"!=this._uniforms[t].shaderType&&"both"!=this._uniforms[t].shaderType||-1==this.srcVert.indexOf(e)&&-1==this.srcVert.indexOf("uniform "+this._uniforms[t].getGlslTypeString()+" "+this._uniforms[t].getName())&&(o+=e+";"+i.endl()),"frag"!=this._uniforms[t].shaderType&&"both"!=this._uniforms[t].shaderType||-1==this.srcFrag.indexOf(e)&&-1==this.srcFrag.indexOf("uniform "+this._uniforms[t].getGlslTypeString()+" "+this._uniforms[t].getName())&&(h+=e+";"+i.endl())}let c=0,u=0;for(let t=0;t<this._uniforms.length;t++)this._uniforms[t].shaderType&&!this._uniforms[t].isStructMember()&&("vert"!=this._uniforms[t].shaderType&&"both"!=this._uniforms[t].shaderType||u++,"frag"!=this._uniforms[t].shaderType&&"both"!=this._uniforms[t].shaderType||c++);c>=this._cgl.maxUniformsFrag&&this._log.warn("[cgl_shader] num uniforms frag: "+c+" / "+this._cgl.maxUniformsFrag),u>=this._cgl.maxUniformsVert&&this._log.warn("[cgl_shader] num uniforms vert: "+u+" / "+this._cgl.maxUniformsVert),-1==n.indexOf("precision")&&(n="precision "+this.precision+" float;".endl()+n),-1==r.indexOf("precision")&&(r="precision "+this.precision+" float;".endl()+r),/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(n+="#define MOBILE".endl(),r+="#define MOBILE".endl()),r=e+r+i+s[0]+o+"\n// -- \n"+this.srcVert,n=e+n+i+s[1]+h+"\n// -- \n"+this.srcFrag;let g="",p="";this._modules.sort((function(t,e){return t.group-e.group})),this._modules.sort((function(t,e){return t.priority||0-e.priority||0}));let _=!1;for(let t=0;t<this._moduleNames.length;t++){let e="",i="";for(let s=0;s<this._modules.length;s++)if(this._modules[s].name==this._moduleNames[t]){if(g+="\n//---- MOD: group:"+this._modules[s].group+": idx:"+s+" - prfx:"+this._modules[s].prefix+" - "+this._modules[s].title+" ------\n",p+="\n//---- MOD: group:"+this._modules[s].group+": idx:"+s+" - prfx:"+this._modules[s].prefix+" - "+this._modules[s].title+" ------\n",e+="\n\n//---- MOD: "+this._modules[s].title+" / "+this._modules[s].priority+" ------\n",i+="\n\n//---- MOD: "+this._modules[s].title+" / "+this._modules[s].priority+" ------\n",!_){_=!0;for(let t=0;t<this._attributes.length;t++)this._attributes[t].name&&this._attributes[t].type&&(g+="".endl()+"#ifndef ATTRIB_"+this._attributes[t].name.endl()+"  #define ATTRIB_"+this._attributes[t].name.endl()+"  IN "+this._attributes[t].type+" "+this._attributes[t].name+";".endl()+"#endif",this._attributes[t].nameFrag&&(g+="".endl()+"#ifndef ATTRIB_"+this._attributes[t].nameFrag.endl()+"  #define ATTRIB_"+this._attributes[t].nameFrag.endl()+"  OUT "+this._attributes[t].type+" "+this._attributes[t].nameFrag+";".endl()+"#endif",e+="".endl()+this._attributes[t].nameFrag+"="+this._attributes[t].name+";"),p+="".endl()+"#ifndef ATTRIB_"+this._attributes[t].nameFrag.endl()+"  #define ATTRIB_"+this._attributes[t].nameFrag.endl()+"  IN "+this._attributes[t].type+" "+this._attributes[t].nameFrag+";".endl()+"#endif")}g+=this._modules[s].srcHeadVert||"",p+=this._modules[s].srcHeadFrag||"",e+=this._modules[s].srcBodyVert||"",i+=this._modules[s].srcBodyFrag||"",g+="\n//---- end mod ------\n",p+="\n//---- end mod ------\n",e+="\n//---- end mod ------\n",i+="\n//---- end mod ------\n",e=e.replace(/{{mod}}/g,this._modules[s].prefix),i=i.replace(/{{mod}}/g,this._modules[s].prefix),g=g.replace(/{{mod}}/g,this._modules[s].prefix),p=p.replace(/{{mod}}/g,this._modules[s].prefix),e=e.replace(/MOD_/g,this._modules[s].prefix),i=i.replace(/MOD_/g,this._modules[s].prefix),g=g.replace(/MOD_/g,this._modules[s].prefix),p=p.replace(/MOD_/g,this._modules[s].prefix)}r=r.replace("{{"+this._moduleNames[t]+"}}",e),n=n.replace("{{"+this._moduleNames[t]+"}}",i)}if(r=r.replace("{{MODULES_HEAD}}",g),n=n.replace("{{MODULES_HEAD}}",p),r=this._addLibs(r),n=this._addLibs(n),this._program){this._program=this._createProgram(r,n),this._projMatrixUniform=null;for(let t=0;t<this._uniforms.length;t++)this._uniforms[t].resetLoc()}else this._program=this._createProgram(r,n);this.finalShaderFrag=n,this.finalShaderVert=r,ht.lastMesh=null,ht.lastShader=null,this._needsRecompile=!1,this.lastCompile=pt(),this._cgl.profileData.shaderCompileTime+=performance.now()-t},vt.hasChanged=function(){return this._needsRecompile},vt.prototype.bind=function(){if(this._isValid&&(ht.lastShader=this,this._program&&!this._needsRecompile||this.compile(),this._isValid)){if(!this._projMatrixUniform){this._attrVertexPos=this._cgl.glGetAttribLocation(this._program,ot.SHADER.SHADERVAR_VERTEX_POSITION),this._projMatrixUniform=this._cgl.gl.getUniformLocation(this._program,ot.SHADER.SHADERVAR_UNI_PROJMAT),this._mvMatrixUniform=this._cgl.gl.getUniformLocation(this._program,"mvMatrix"),this._vMatrixUniform=this._cgl.gl.getUniformLocation(this._program,ot.SHADER.SHADERVAR_UNI_VIEWMAT),this._mMatrixUniform=this._cgl.gl.getUniformLocation(this._program,ot.SHADER.SHADERVAR_UNI_MODELMAT),this._camPosUniform=this._cgl.gl.getUniformLocation(this._program,ot.SHADER.SHADERVAR_UNI_VIEWPOS),this._normalMatrixUniform=this._cgl.gl.getUniformLocation(this._program,ot.SHADER.SHADERVAR_UNI_NORMALMAT),this._inverseViewMatrixUniform=this._cgl.gl.getUniformLocation(this._program,ot.SHADER.SHADERVAR_UNI_INVVIEWMAT);for(let t=0;t<this._uniforms.length;t++)this._uniforms[t].needsUpdate=!0}this._cgl.currentProgram!=this._program&&(this._cgl.profileData.profileShaderBinds++,this._cgl.gl.useProgram(this._program),this._cgl.currentProgram=this._program);for(let t=0;t<this._uniforms.length;t++)this._uniforms[t].needsUpdate&&this._uniforms[t].updateValue();if(this._pMatrixState!=this._cgl.getProjectionMatrixStateCount()&&(this._pMatrixState=this._cgl.getProjectionMatrixStateCount(),this._cgl.gl.uniformMatrix4fv(this._projMatrixUniform,!1,this._cgl.pMatrix),this._cgl.profileData.profileMVPMatrixCount++),this._vMatrixUniform)this._vMatrixState!=this._cgl.getViewMatrixStateCount()&&(this._cgl.gl.uniformMatrix4fv(this._vMatrixUniform,!1,this._cgl.vMatrix),this._cgl.profileData.profileMVPMatrixCount++,this._vMatrixState=this._cgl.getViewMatrixStateCount(),this._inverseViewMatrixUniform&&(mat4.invert(this._tempInverseViewMatrix,this._cgl.vMatrix),this._cgl.gl.uniformMatrix4fv(this._inverseViewMatrixUniform,!1,this._tempInverseViewMatrix),this._cgl.profileData.profileMVPMatrixCount++)),this._cgl.gl.uniformMatrix4fv(this._mMatrixUniform,!1,this._cgl.mMatrix),this._cgl.profileData.profileMVPMatrixCount++,this._camPosUniform&&(mat4.invert(this._tempCamPosMatrix,this._cgl.vMatrix),this._cgl.gl.uniform3f(this._camPosUniform,this._tempCamPosMatrix[12],this._tempCamPosMatrix[13],this._tempCamPosMatrix[14]),this._cgl.profileData.profileMVPMatrixCount++);else{const t=mat4.create();mat4.mul(t,this._cgl.vMatrix,this._cgl.mMatrix),this._cgl.gl.uniformMatrix4fv(this._mvMatrixUniform,!1,t),this._cgl.profileData.profileMVPMatrixCount++}this._normalMatrixUniform&&(mat4.invert(this._tempNormalMatrix,this._cgl.mMatrix),mat4.transpose(this._tempNormalMatrix,this._tempNormalMatrix),this._cgl.gl.uniformMatrix4fv(this._normalMatrixUniform,!1,this._tempNormalMatrix),this._cgl.profileData.profileMVPMatrixCount++);for(let t=0;t<this._libs.length;t++)this._libs[t].onBind&&this._libs[t].onBind.bind(this._libs[t])(this._cgl,this);this._bindTextures()}},vt.prototype.toggleDefine=function(t,e){e&&"object"==typeof e&&e.addEventListener&&(e.changeListener&&e.removeEventListener(e.changeListener),e.onToggleDefine=e=>{this.toggleDefine(t,e)},e.changeListener=e.on("change",e.onToggleDefine),e=e.get()),e?this.define(t):this.removeDefine(t)},vt.prototype.define=function(t,e){null==e&&(e=""),"object"==typeof e&&(e.removeEventListener("change",e.onDefineChange),e.onDefineChange=e=>{this.define(t,e)},e.on("change",e.onDefineChange),e=e.get());for(let i=0;i<this._defines.length;i++){if(this._defines[i][0]==t&&this._defines[i][1]==e)return;if(this._defines[i][0]==t)return this._defines[i][1]=e,this.setWhyCompile("define "+t+" "+e),void(this._needsRecompile=!0)}this.setWhyCompile("define "+t+" "+e),this._needsRecompile=!0,this._defines.push([t,e])},vt.prototype.getDefines=function(){return this._defines},vt.prototype.getDefine=function(t){for(let e=0;e<this._defines.length;e++)if(this._defines[e][0]==t)return this._defines[e][1];return null},vt.prototype.hasDefine=function(t){for(let e=0;e<this._defines.length;e++)if(this._defines[e][0]==t)return!0},vt.prototype.removeDefine=function(t){for(let e=0;e<this._defines.length;e++)if(this._defines[e][0]==t)return this._defines.splice(e,1),this._needsRecompile=!0,void this.setWhyCompile("define removed:"+t)},vt.prototype.removeModule=function(t){for(let e=0;e<this._modules.length;e++)if(t&&t.id&&(this._modules[e].id==t.id||!this._modules[e])){let i=!0;for(;i;){i=!1;for(let e=0;e<this._uniforms.length;e++)0!=this._uniforms[e].getName().indexOf(t.prefix)||(this._uniforms.splice(e,1),i=!0)}this._needsRecompile=!0,this.setWhyCompile("remove module "+t.title),this._modules.splice(e,1);break}},vt.prototype.getNumModules=function(){return this._modules.length},vt.prototype.getCurrentModules=function(){return this._modules},vt.prototype.addModule=function(t,e){return t.id||(t.id=A()),t.numId||(t.numId=this._moduleNumId),t.num||(t.num=this._modules.length),e&&!e.group&&(e.group=y()),t.group||(t.group=e?e.group:y()),t.prefix="mod"+t.group+"_",this._modules.push(t),this._needsRecompile=!0,this.setWhyCompile("add module "+t.title),this._moduleNumId++,t},vt.prototype.hasModule=function(t){for(let e=0;e<this._modules.length;e++)if(this._modules[e].id==t)return!0;return!1},vt.prototype.setModules=function(t){this._moduleNames=t},vt.prototype.dispose=function(){this._cgl.gl.deleteProgram(this._program)},vt.prototype.needsRecompile=function(){return this._needsRecompile},vt.prototype.setDrawBuffers=function(t){if(this._drawBuffers.length!==t.length)return this._drawBuffers=t,this._needsRecompile=!0,void this.setWhyCompile("setDrawBuffers");for(let e=0;e<t;e++)if(t[e]!==this._drawBuffers[e])return this._drawBuffers=t,this._needsRecompile=!0,void this.setWhyCompile("setDrawBuffers")},vt.prototype.getUniforms=function(){return this._uniforms},vt.prototype.getUniform=function(t){for(let e=0;e<this._uniforms.length;e++)if(this._uniforms[e].getName()==t)return this._uniforms[e];return null},vt.prototype.removeUniform=function(t){for(let e=0;e<this._uniforms.length;e++)this._uniforms[e].getName()==t&&this._uniforms.splice(e,1);this._needsRecompile=!0,this.setWhyCompile("remove uniform "+t)},vt.prototype._addUniform=function(t){this._uniforms.push(t),this.setWhyCompile("add uniform "+name),this._needsRecompile=!0},vt.prototype.addUniformFrag=function(t,e,i,s,r,n){const o=new CGL.Uniform(this,t,e,i,s,r,n);return o.shaderType="frag",o},vt.prototype.addUniformVert=function(t,e,i,s,r,n){const o=new CGL.Uniform(this,t,e,i,s,r,n);return o.shaderType="vert",o},vt.prototype.addUniformBoth=function(t,e,i,s,r,n){const o=new CGL.Uniform(this,t,e,i,s,r,n);return o.shaderType="both",o},vt.prototype.addUniformStructFrag=function(t,e,i){const s={};if(!i)return s;for(let r=0;r<i.length;r+=1){const n=i[r];if(!this.hasUniform(e+"."+n.name)){const i=new CGL.Uniform(this,n.type,e+"."+n.name,n.v1,n.v2,n.v3,n.v4,e,t,n.name);i.shaderType="frag",s[e+"."+n.name]=i}}return s},vt.prototype.addUniformStructVert=function(t,e,i){const s={};if(!i)return s;for(let r=0;r<i.length;r+=1){const n=i[r];if(!this.hasUniform(e+"."+n.name)){const i=new CGL.Uniform(this,n.type,e+"."+n.name,n.v1,n.v2,n.v3,n.v4,e,t,n.name);i.shaderType="vert",s[e+"."+n.name]=i}}return s},vt.prototype.addUniformStructBoth=function(t,e,i){const s={};if(!i)return s;for(let r=0;r<i.length;r+=1){const n=i[r];if("2i"!==n.type&&"i"!==n.type&&"3i"!==n.type||this._log.error("Adding an integer struct member to both shaders can potentially error. Please use different structs for each shader. Error occured in struct:",t," with member:",n.name," of type:",n.type,"."),!this.hasUniform(e+"."+n.name)){const i=new CGL.Uniform(this,n.type,e+"."+n.name,n.v1,n.v2,n.v3,n.v4,e,t,n.name);i.shaderType="both",s[e+"."+n.name]=i}}return s},vt.prototype.hasUniform=function(t){for(let e=0;e<this._uniforms.length;e++)if(this._uniforms[e].getName()==t)return!0;return!1},vt.prototype._createProgram=function(t,e){this._cgl.printError("before _createprogram");const i=this._cgl.gl.createProgram();return this.vshader=vt.createShader(this._cgl,t,this._cgl.gl.VERTEX_SHADER,this),this.fshader=vt.createShader(this._cgl,e,this._cgl.gl.FRAGMENT_SHADER,this),this._cgl.gl.attachShader(i,this.vshader),this._cgl.gl.attachShader(i,this.fshader),this._linkProgram(i,t,e),this._cgl.printError("shader _createProgram"),i},vt.prototype.hasErrors=function(){return this._hasErrors},vt.prototype._linkProgram=function(t,e,i){this._cgl.printError("before _linkprogram"),this._feedBackNames.length>0&&this._cgl.gl.transformFeedbackVaryings(t,this._feedBackNames,this._cgl.gl.SEPARATE_ATTRIBS),this._cgl.gl.linkProgram(t),this._cgl.printError("gl.linkprogram"),this._isValid=!0,this._hasErrors=!1,!1!==this._cgl.patch.config.glValidateShader&&(this._cgl.gl.validateProgram(t),this._cgl.gl.getProgramParameter(t,this._cgl.gl.VALIDATE_STATUS)||(console.log("shaderprogram validation failed..."),console.log(this._name+" programinfo: ",this._cgl.gl.getProgramInfoLog(t))),this._cgl.gl.getProgramParameter(t,this._cgl.gl.LINK_STATUS)||(this._hasErrors=!0,this._log.warn(this._cgl.gl.getShaderInfoLog(this.fshader)||"empty shader infolog"),this._log.warn(this._cgl.gl.getShaderInfoLog(this.vshader)||"empty shader infolog"),this._log.error(this._name+" shader linking fail..."),console.log(this._name+" programinfo: ",this._cgl.gl.getProgramInfoLog(t)),console.log("--------------------------------------"),console.log(this),console.log("--------------------------------------"),this._isValid=!1,this._name="errorshader",this.setSource(vt.getDefaultVertexShader(),vt.getErrorFragmentShader()),this._cgl.printError("shader link err")))},vt.prototype.getProgram=function(){return this._program},vt.prototype.setFeedbackNames=function(t){this.setWhyCompile("setFeedbackNames"),this._needsRecompile=!0,this._feedBackNames=t},vt.prototype.getDefaultVertexShader=vt.getDefaultVertexShader=function(){return"{{MODULES_HEAD}}\nIN vec3 vPosition;\nIN vec2 attrTexCoord;\nIN vec3 attrVertNormal;\nIN vec3 attrTangent,attrBiTangent;\n\nIN float attrVertIndex;\n\nOUT vec2 texCoord;\nOUT vec3 norm;\nUNI mat4 projMatrix;\nUNI mat4 viewMatrix;\nUNI mat4 modelMatrix;\n\nvoid main()\n{\n    texCoord=attrTexCoord;\n    norm=attrVertNormal;\n    vec4 pos=vec4(vPosition,  1.0);\n    vec3 tangent=attrTangent;\n    vec3 bitangent=attrBiTangent;\n    mat4 mMatrix=modelMatrix;\n    {{MODULE_VERTEX_POSITION}}\n    gl_Position = projMatrix * (viewMatrix*mMatrix) * pos;\n}\n"},vt.prototype.getDefaultFragmentShader=vt.getDefaultFragmentShader=function(t,e,i){return null==t&&(t=.5,e=.5,i=.5),"".endl()+"IN vec2 texCoord;".endl()+"{{MODULES_HEAD}}".endl()+"void main()".endl()+"{".endl()+"    vec4 col=vec4("+t+","+e+","+i+",1.0);".endl()+"    {{MODULE_COLOR}}".endl()+"    outColor = col;".endl()+"}"},vt.prototype.addAttribute=function(t){for(let e=0;e<this._attributes.length;e++)if(this._attributes[e].name==t.name&&this._attributes[e].nameFrag==t.nameFrag)return;this._attributes.push(t),this._needsRecompile=!0,this.setWhyCompile("addAttribute")},vt.prototype.bindTextures=vt.prototype._bindTextures=function(){this._textureStackTex.length>this._cgl.maxTextureUnits&&this._log.warn("[shader._bindTextures] too many textures bound",this._textureStackTex.length+"/"+this._cgl.maxTextureUnits);for(let t=0;t<this._textureStackTex.length;t++)if(this._textureStackTex[t]||this._textureStackTexCgl[t]){let e=this._textureStackTex[t];this._textureStackTexCgl[t]&&(e=this._textureStackTexCgl[t].tex||CGL.Texture.getEmptyTexture(this._cgl).tex);let i=!0;this._textureStackUni[t]?(this._textureStackUni[t].setValue(t),i=this._cgl.setTexture(t,e,this._textureStackType[t])):(this._log.warn("no uniform for pushtexture",this._name),i=this._cgl.setTexture(t,e,this._textureStackType[t])),i||this._log.warn("tex bind failed",this.getName(),this._textureStackUni[t])}else this._log.warn("no texture for pushtexture",this._name)},vt.prototype.setUniformTexture=function(t,e){for(let i=0;i<this._textureStackTex.length;i++)if(this._textureStackUni[i]==t){const t=this._textureStackTex[i];return this._textureStackTex[i]=e,t}return null},vt.prototype.pushTexture=function(t,e,i){if(!t)throw new Error("no uniform given to texturestack");if(e){if(!(e.hasOwnProperty("tex")||e instanceof WebGLTexture))return this._log.warn(new Error("invalid texture").stack),void this._log.warn("[cgl_shader] invalid texture...",e);this._textureStackUni.push(t),e.hasOwnProperty("tex")?(this._textureStackTexCgl.push(e),this._textureStackTex.push(null)):(this._textureStackTexCgl.push(null),this._textureStackTex.push(e)),this._textureStackType.push(i)}},vt.prototype.popTexture=function(){this._textureStackUni.pop(),this._textureStackTex.pop(),this._textureStackType.pop()},vt.prototype.popTextures=function(){this._textureStackTex.length=this._textureStackTexCgl.length=this._textureStackType.length=this._textureStackUni.length=0},vt.prototype.getInfo=function(){const t={};return t.name=this._name,t.defines=this.getDefines(),t.hasErrors=this.hasErrors(),t},vt.getErrorFragmentShader=function(){return"".endl()+"void main()".endl()+"{".endl()+"   float g=mod((gl_FragCoord.y+gl_FragCoord.x),50.0)/50.0;".endl()+"   g= step(0.1,g);".endl()+"   outColor = vec4( g+0.5, 0.0, 0.0, 1.0);".endl()+"}"},vt.createShader=function(t,e,i,s){if(t.aborted)return;const r=t.gl.createShader(i);if(t.gl.shaderSource(r,e),t.gl.compileShader(r),!t.gl.getShaderParameter(r,t.gl.COMPILE_STATUS)){console.log("compile status: "),i==t.gl.VERTEX_SHADER&&console.log("VERTEX_SHADER"),i==t.gl.FRAGMENT_SHADER&&console.log("FRAGMENT_SHADER");let o=t.gl.getShaderInfoLog(r)||"empty shader info log";const h=function(t){const e=[],i=t.split("\n");for(const t in i){const s=i[t].split(":");parseInt(s[2],10)&&e.push(parseInt(s[2],10))}return e}(o);let a='<div class="shaderErrorCode">';const l=e.match(/^.*((\r\n|\n|\r)|$)/gm);for(const t in l){const e=parseInt(t,10)+1,i=e+": "+l[t];console.log(i);let s=!1;for(const t in h)h[t]==e&&(s=!0);s&&(a+='<span class="error">'),a+=(n=i)&&yt.test(n)?n.replace(bt,(function(t){return At[t]})):n||"",s&&(a+="</span>")}console.warn(o),o=o.replace(/\n/g,"<br/>"),a=o+"<br/>"+a+"<br/><br/>",a+="</div>",t.patch.emitEvent("criticalError","Shader error "+this._name,a),t.patch.isEditorMode()&&console.log("Shader error "+this._name,a),this._name="errorshader",s.setSource(vt.getDefaultVertexShader(),vt.getErrorFragmentShader())}var n;return r};const xt=function(){this._arr=[mat4.create()],this._index=0,this.stateCounter=0};xt.prototype.push=function(t){if(this._index++,this.stateCounter++,this._index==this._arr.length){const t=mat4.create();this._arr.push(t)}return mat4.copy(this._arr[this._index],t||this._arr[this._index-1]),this._arr[this._index]},xt.prototype.pop=function(){return this.stateCounter++,this._index--,this._index<0&&(this._index=0),this._arr[this._index]},xt.prototype.length=function(){return this._index};class It{constructor(t){this._cgl=t,this._lastTime=0,this.pause=!1,this.profileUniformCount=0,this.profileShaderBinds=0,this.profileUniformCount=0,this.profileShaderCompiles=0,this.profileVideosPlaying=0,this.profileMVPMatrixCount=0,this.profileEffectBuffercreate=0,this.profileShaderGetUniform=0,this.profileFrameBuffercreate=0,this.profileMeshSetGeom=0,this.profileTextureNew=0,this.profileGenMipMap=0,this.profileOnAnimFrameOps=0,this.profileMainloopMs=0,this.profileMeshDraw=0,this.profileTextureEffect=0,this.profileTexPreviews=0,this.shaderCompileTime=0,this.profileMeshNumElements=0,this.profileMeshAttributes=0,this.profileSingleMeshAttribute=[],this.heavyEvents=[],this.doProfileGlQuery=!1,this.glQueryData={}}clear(){this.profileSingleMeshAttribute={},this.profileMeshAttributes=0,this.profileUniformCount=0,this.profileShaderGetUniform=0,this.profileShaderCompiles=0,this.profileShaderBinds=0,this.profileTextureResize=0,this.profileFrameBuffercreate=0,this.profileEffectBuffercreate=0,this.profileTextureDelete=0,this.profileMeshSetGeom=0,this.profileVideosPlaying=0,this.profileMVPMatrixCount=0,this.profileNonTypedAttrib=0,this.profileNonTypedAttribNames="",this.profileTextureNew=0,this.profileGenMipMap=0,this.profileFramebuffer=0,this.profileMeshDraw=0,this.profileTextureEffect=0,this.profileTexPreviews=0,this.profileMeshNumElements=0}clearGlQuery(){for(let t in this.glQueryData)(!this.glQueryData[t].lastClear||performance.now()-this.glQueryData[t].lastClear>1e3)&&(this.glQueryData[t].time=this.glQueryData[t]._times/this.glQueryData[t]._numcount,this.glQueryData[t].num=this.glQueryData[t]._numcount,this.glQueryData[t]._times=0,this.glQueryData[t]._numcount=0,this.glQueryData[t].lastClear=performance.now())}addHeavyEvent(t,e,i){const s={event:t,name:e,info:i,date:performance.now()};this.heavyEvents.push(s),this._cgl.emitEvent("heavyEvent",s)}}const Ot=function(t){W.apply(this),this.profileData=new It(this),this._log=new h("cgl_context");const e=[0,0,0,0];this.glVersion=0,this.glUseHalfFloatTex=!1,this.clearCanvasTransparent=!0,this.clearCanvasDepth=!0,this.patch=t,this.debugOneFrame=!1,this.checkGlErrors=!0,this.maxTextureUnits=0,this.maxVaryingVectors=0,this.currentProgram=null,this._hadStackError=!1,this.glSlowRenderer=!1,this._isSafariCrap=!1,this.temporaryTexture=null,this.frameStore={},this._onetimeCallbacks=[],this.gl=null,this._cursor="auto",this._currentCursor="",this.pMatrix=mat4.create(),this.mMatrix=mat4.create(),this.vMatrix=mat4.create(),this._textureslots=[],this._pMatrixStack=new xt,this._mMatrixStack=new xt,this._vMatrixStack=new xt,this._glFrameBufferStack=[],this._frameBufferStack=[],this._shaderStack=[],this._stackDepthTest=[],Object.defineProperty(this,"mvMatrix",{get(){return this.mMatrix},set(t){this.mMatrix=t}}),this.canvas=null,this.pixelDensity=1,mat4.identity(this.mMatrix),mat4.identity(this.vMatrix);const i=new vt(this,"simpleshader");i.setModules(["MODULE_VERTEX_POSITION","MODULE_COLOR","MODULE_BEGIN_FRAG"]),i.setSource(vt.getDefaultVertexShader(),vt.getDefaultFragmentShader());let s=i;this.aborted=!1;const r=[];this.exitError=function(t,e){this.patch.exitError(t,e),this.aborted=!0},this.setCanvas=function(t){if(this.canvas="string"==typeof t?document.getElementById(t):t,this.patch.config.canvas||(this.patch.config.canvas={}),this.patch.config.canvas.hasOwnProperty("preserveDrawingBuffer")||(this.patch.config.canvas.preserveDrawingBuffer=!1),this.patch.config.canvas.hasOwnProperty("premultipliedAlpha")||(this.patch.config.canvas.premultipliedAlpha=!1),this.patch.config.canvas.hasOwnProperty("alpha")||(this.patch.config.canvas.alpha=!1),this.patch.config.hasOwnProperty("clearCanvasColor")&&(this.clearCanvasTransparent=this.patch.config.clearCanvasColor),this.patch.config.hasOwnProperty("clearCanvasDepth")&&(this.clearCanvasDepth=this.patch.config.clearCanvasDepth),/^((?!chrome|android).)*safari/i.test(navigator.userAgent)&&(this._isSafariCrap=!0),this.patch.config.canvas.forceWebGl1||(this.gl=this.canvas.getContext("webgl2",this.patch.config.canvas)),this.gl&&"WebGL 1.0"!=this.gl.getParameter(this.gl.VERSION)?this.glVersion=2:(this.gl=this.canvas.getContext("webgl",this.patch.config.canvas)||this.canvas.getContext("experimental-webgl",this.patch.config.canvas),this.glVersion=1,/^((?!chrome|android).)*safari/i.test(navigator.userAgent)&&navigator.userAgent.match(/iPhone/i)&&(this.glUseHalfFloatTex=!0),/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream&&(this.patch.config.canvas.hasOwnProperty("powerPreference")||(this.patch.config.canvas.powerPreference="high-performance"))),!this.gl)return void this.exitError("NO_WEBGL","sorry, could not initialize WebGL. Please check if your Browser supports WebGL or try to restart your browser.");const e=this.gl.getExtension("WEBGL_debug_renderer_info");e&&(this.glRenderer=this.gl.getParameter(e.UNMASKED_RENDERER_WEBGL),"Google SwiftShader"===this.glRenderer&&(this.glSlowRenderer=!0)),this.gl.getExtension("OES_standard_derivatives");const i=this.gl.getExtension("ANGLE_instanced_arrays")||this.gl;this.canvas.addEventListener("webglcontextlost",t=>{this._log.error("canvas lost...",t),this.emitEvent("webglcontextlost"),this.aborted=!0}),this.maxVaryingVectors=this.gl.getParameter(this.gl.MAX_VARYING_VECTORS),this.maxTextureUnits=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),this.maxTexSize=this.gl.getParameter(this.gl.MAX_TEXTURE_SIZE),this.maxUniformsFrag=this.gl.getParameter(this.gl.MAX_FRAGMENT_UNIFORM_VECTORS),this.maxUniformsVert=this.gl.getParameter(this.gl.MAX_VERTEX_UNIFORM_VECTORS),this.maxSamples=0,this.gl.MAX_SAMPLES&&(this.maxSamples=this.gl.getParameter(this.gl.MAX_SAMPLES)),i.vertexAttribDivisorANGLE&&(this.gl.vertexAttribDivisor=i.vertexAttribDivisorANGLE.bind(i),this.gl.drawElementsInstanced=i.drawElementsInstancedANGLE.bind(i)),this.updateSize()},this.getInfo=function(){return{glVersion:this.glVersion,glRenderer:this.glRenderer,glUseHalfFloatTex:this.glUseHalfFloatTex,maxVaryingVectors:this.maxVaryingVectors,maxTextureUnits:this.maxTextureUnits,maxTexSize:this.maxTexSize,maxUniformsFrag:this.maxUniformsFrag,maxUniformsVert:this.maxUniformsVert,maxSamples:this.maxSamples}},this.updateSize=function(){this.canvas.width=this.canvasWidth=this.canvas.clientWidth*this.pixelDensity,this.canvas.height=this.canvasHeight=this.canvas.clientHeight*this.pixelDensity},this.canvasWidth=-1,this.canvasHeight=-1,this.canvasScale=1;let n=-1,o=-1;this.getViewPort=function(){return e},this.resetViewPort=function(){this.gl.viewport(e[0],e[1],e[2],e[3])},this.setViewPort=function(t,i,s,r){e[0]=Math.round(t),e[1]=Math.round(i),e[2]=Math.round(s),e[3]=Math.round(r),this.gl.viewport(e[0],e[1],e[2],e[3])},this.screenShot=function(t,e,i,s){e&&(this.gl.clearColor(1,1,1,1),this.gl.colorMask(!1,!1,!1,!0),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.colorMask(!0,!0,!0,!0)),this.canvas&&this.canvas.toBlob&&this.canvas.toBlob(e=>{t?t(e):this._log.log("no screenshot callback...")},i,s)},this.endFrame=function(){if(this.patch.isEditorMode()&&CABLES.GL_MARKER.drawMarkerLayer(this),this.setPreviousShader(),this._vMatrixStack.length()>0&&this.logStackError("view matrix stack length !=0 at end of rendering..."),this._mMatrixStack.length()>0&&this.logStackError("mvmatrix stack length !=0 at end of rendering..."),this._pMatrixStack.length()>0&&this.logStackError("pmatrix stack length !=0 at end of rendering..."),this._glFrameBufferStack.length>0&&this.logStackError("glFrameBuffer stack length !=0 at end of rendering..."),this._stackDepthTest.length>0&&this.logStackError("depthtest stack length !=0 at end of rendering..."),this._stackDepthWrite.length>0&&this.logStackError("depthwrite stack length !=0 at end of rendering..."),this._stackDepthFunc.length>0&&this.logStackError("depthfunc stack length !=0 at end of rendering..."),this._stackBlend.length>0&&this.logStackError("blend stack length !=0 at end of rendering..."),this._stackBlendMode.length>0&&this.logStackError("blendMode stack length !=0 at end of rendering..."),this._shaderStack.length>0&&this.logStackError("this._shaderStack length !=0 at end of rendering..."),this._stackCullFace.length>0&&this.logStackError("this._stackCullFace length !=0 at end of rendering..."),this._stackCullFaceFacing.length>0&&this.logStackError("this._stackCullFaceFacing length !=0 at end of rendering..."),this._frameStarted=!1,n!=this.canvasWidth||o!=this.canvasHeight){n=this.canvasWidth,o=this.canvasHeight,this.setSize(this.canvasWidth/this.pixelDensity,this.canvasHeight/this.pixelDensity),this.updateSize();for(let t=0;t<r.length;t++)r[t]();this.emitEvent("resize")}this._cursor!=this._currentCursor&&(this._currentCursor=this.canvas.style.cursor=this._cursor)},this.logStackError=function(t){this._hadStackError||(this._hadStackError=!0,this._log.warn("["+this.canvas.id+"]: ",t))},this.getShader=function(){if(s&&(!this.frameStore||!0===this.frameStore.renderOffscreen==s.offScreenPass==!0))return s;for(let t=this._shaderStack.length-1;t>=0;t--)if(this._shaderStack[t]&&this.frameStore.renderOffscreen==this._shaderStack[t].offScreenPass)return this._shaderStack[t]},this.getDefaultShader=function(){return i},this.pushShader=this.setShader=function(t){this._shaderStack.push(t),s=t},this.popShader=this.setPreviousShader=function(){if(0===this._shaderStack.length)throw new Error("Invalid shader stack pop!");this._shaderStack.pop(),s=this._shaderStack[this._shaderStack.length-1]},this.pushGlFrameBuffer=function(t){this._glFrameBufferStack.push(t)},this.popGlFrameBuffer=function(){return 0==this._glFrameBufferStack.length?null:(this._glFrameBufferStack.pop(),this._glFrameBufferStack[this._glFrameBufferStack.length-1])},this.getCurrentGlFrameBuffer=function(){return 0===this._glFrameBufferStack.length?null:this._glFrameBufferStack[this._glFrameBufferStack.length-1]},this.pushFrameBuffer=function(t){this._frameBufferStack.push(t)},this.popFrameBuffer=function(){return 0==this._frameBufferStack.length?null:(this._frameBufferStack.pop(),this._frameBufferStack[this._frameBufferStack.length-1])},this.getCurrentFrameBuffer=function(){return 0===this._frameBufferStack.length?null:this._frameBufferStack[this._frameBufferStack.length-1]};const a=vec3.create();vec3.set(a,0,0,2);const l=vec3.create();vec3.set(l,0,0,0),this.renderStart=function(t,e,s){e||(e=l),s||(s=a),this.pushDepthTest(!0),this.pushDepthWrite(!0),this.pushDepthFunc(t.gl.LEQUAL),this.pushCullFaceFacing(t.gl.BACK),this.pushCullFace(!1),this.clearCanvasTransparent&&(t.gl.clearColor(0,0,0,0),t.gl.clear(t.gl.COLOR_BUFFER_BIT)),this.clearCanvasDepth&&t.gl.clear(t.gl.DEPTH_BUFFER_BIT),t.setViewPort(0,0,t.canvasWidth,t.canvasHeight),mat4.perspective(t.pMatrix,45,t.canvasWidth/t.canvasHeight,.1,1e3),mat4.identity(t.mMatrix),mat4.identity(t.vMatrix),mat4.translate(t.mMatrix,t.mMatrix,e),mat4.translate(t.vMatrix,t.vMatrix,s),t.pushPMatrix(),t.pushModelMatrix(),t.pushViewMatrix(),t.pushBlendMode(ot.BLEND_MODES.BLEND_NORMAL,!1);for(let t=0;t<this._textureslots.length;t++)this._textureslots[t]=null;if(this.pushShader(i),this._frameStarted=!0,this._onetimeCallbacks.length>0){for(let t=0;t<this._onetimeCallbacks.length;t++)this._onetimeCallbacks[t]();this._onetimeCallbacks.length=0}this.emitEvent("beginFrame")},this.renderEnd=function(t){t.popViewMatrix(),t.popModelMatrix(),t.popPMatrix(),this.popDepthTest(),this.popDepthWrite(),this.popDepthFunc(),this.popCullFaceFacing(),this.popCullFace(),this.popBlend(),this.popBlendMode(),t.endFrame(),this.emitEvent("endFrame")},this.getTexture=function(t){return this._textureslots[t]},this.checkFrameStarted=function(t){this._frameStarted||(this._log.warn("frame not started "+t),this.patch.printTriggerStack())},this.setTexture=function(t,e,i){return this.checkFrameStarted("cgl setTexture"),null===e&&(e=CGL.Texture.getEmptyTexture(this).tex),this._textureslots[t]!=e&&(this.gl.activeTexture(this.gl.TEXTURE0+t),this.gl.bindTexture(i||this.gl.TEXTURE_2D,e),this._textureslots[t]=e),!0},this.fullScreen=function(){this.canvas.requestFullscreen?this.canvas.requestFullscreen():this.canvas.mozRequestFullScreen?this.canvas.mozRequestFullScreen():this.canvas.webkitRequestFullscreen?this.canvas.webkitRequestFullscreen():this.canvas.msRequestFullscreen&&this.canvas.msRequestFullscreen()},this.setSize=function(t,e,i){i||(this.canvas.style.width=t+"px",this.canvas.style.height=e+"px"),this.canvas.width=t*this.pixelDensity,this.canvas.height=e*this.pixelDensity,this.updateSize()},this._resizeToWindowSize=function(){this.setSize(window.innerWidth,window.innerHeight),this.updateSize()},this._resizeToParentSize=function(){const t=this.canvas.parentElement;t?(this.setSize(t.clientWidth,t.clientHeight),this.updateSize()):this._log.error("cables: can not resize to container element")},this.setAutoResize=function(t){window.removeEventListener("resize",this._resizeToWindowSize.bind(this)),window.removeEventListener("resize",this._resizeToParentSize.bind(this)),"window"==t&&(window.addEventListener("resize",this._resizeToWindowSize.bind(this)),window.addEventListener("orientationchange",this._resizeToWindowSize.bind(this)),this._resizeToWindowSize()),"parent"==t&&(window.addEventListener("resize",this._resizeToParentSize.bind(this)),this._resizeToParentSize())},this.printError=function(t){if(!this.checkGlErrors)return;let e=!1,i=this.gl.getError();if(i!=this.gl.NO_ERROR){let s="";i==this.gl.OUT_OF_MEMORY&&(s="OUT_OF_MEMORY"),i==this.gl.INVALID_ENUM&&(s="INVALID_ENUM"),i==this.gl.INVALID_OPERATION&&(s="INVALID_OPERATION"),i==this.gl.INVALID_FRAMEBUFFER_OPERATION&&(s="INVALID_FRAMEBUFFER_OPERATION"),i==this.gl.INVALID_VALUE&&(s="INVALID_VALUE"),i==this.gl.CONTEXT_LOST_WEBGL&&(this.aborted=!0,s="CONTEXT_LOST_WEBGL"),i==this.gl.NO_ERROR&&(s="NO_ERROR"),e=!0,this._log.warn("gl error ["+this.canvas.id+"]: ",t,i,s),-1==this.canvas.id.indexOf("glGuiCanvas")&&(this._loggedGlError||(this.patch.printTriggerStack(),this._log.stack("glerror"),this._loggedGlError=!0))}return i=this.gl.getError(),e},this.saveScreenshot=function(t,e,i,s,r){this.patch.renderOneFrame();let n=this.canvas.clientWidth,o=this.canvas.clientHeight;function h(t,e,i){return Array(e-String(t).length+1).join(i||"0")+t}i&&(this.canvas.width=i,n=i),s&&(this.canvas.height=s,o=s);const a=new Date,l="".concat(String(a.getFullYear())+String(a.getMonth()+1)+String(a.getDate()),"_").concat(h(a.getHours(),2)).concat(h(a.getMinutes(),2)).concat(h(a.getSeconds(),2));t?t+=".png":t="cables_"+l+".png",this.patch.cgl.screenShot(function(i){if(this.canvas.width=n,this.canvas.height=o,i){const s=document.createElement("a");s.download=t,s.href=URL.createObjectURL(i),setTimeout((function(){s.click(),e&&e(i)}),100)}else this._log.log("screenshot: no blob")}.bind(this),r)}};Ot.prototype.addNextFrameOnceCallback=function(t){t&&this._onetimeCallbacks.push(t)},Ot.prototype.pushViewMatrix=function(){this.vMatrix=this._vMatrixStack.push(this.vMatrix)},Ot.prototype.popViewMatrix=function(){this.vMatrix=this._vMatrixStack.pop()},Ot.prototype.getViewMatrixStateCount=function(){return this._vMatrixStack.stateCounter},Ot.prototype.pushPMatrix=function(){this.pMatrix=this._pMatrixStack.push(this.pMatrix)},Ot.prototype.popPMatrix=function(){return this.pMatrix=this._pMatrixStack.pop(),this.pMatrix},Ot.prototype.getProjectionMatrixStateCount=function(){return this._pMatrixStack.stateCounter},Ot.prototype.pushMvMatrix=Ot.prototype.pushModelMatrix=function(){this.mMatrix=this._mMatrixStack.push(this.mMatrix)},Ot.prototype.popMvMatrix=Ot.prototype.popmMatrix=Ot.prototype.popModelMatrix=function(){return this.mMatrix=this._mMatrixStack.pop(),this.mMatrix},Ot.prototype.modelMatrix=function(){return this.mMatrix},Ot.prototype._stackDepthTest=[],Ot.prototype.pushDepthTest=function(t){this._stackDepthTest.push(t),t?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST)},Ot.prototype.stateDepthTest=function(){return this._stackDepthTest[this._stackDepthTest.length-1]},Ot.prototype.popDepthTest=function(){this._stackDepthTest.pop(),this._stackDepthTest[this._stackDepthTest.length-1]?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST)},Ot.prototype._stackDepthWrite=[],Ot.prototype.pushDepthWrite=function(t){t=t||!1,this._stackDepthWrite.push(t),this.gl.depthMask(t)},Ot.prototype.stateDepthWrite=function(){return this._stackDepthWrite[this._stackDepthWrite.length-1]},Ot.prototype.popDepthWrite=function(){this._stackDepthWrite.pop(),this.gl.depthMask(this._stackDepthWrite[this._stackDepthWrite.length-1]||!1)},Ot.prototype._stackCullFace=[],Ot.prototype.pushCullFace=function(t){this._stackCullFace.push(t),t?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE)},Ot.prototype.stateCullFace=function(){return this._stackCullFace[this._stackCullFace.length-1]},Ot.prototype.popCullFace=function(){this._stackCullFace.pop(),this._stackCullFace[this._stackCullFace.length-1]?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE)},Ot.prototype._stackCullFaceFacing=[],Ot.prototype.pushCullFaceFacing=function(t){this._stackCullFaceFacing.push(t),this.gl.cullFace(this._stackCullFaceFacing[this._stackCullFaceFacing.length-1])},Ot.prototype.stateCullFaceFacing=function(){return this._stackCullFaceFacing[this._stackCullFaceFacing.length-1]},Ot.prototype.popCullFaceFacing=function(){this._stackCullFaceFacing.pop(),this._stackCullFaceFacing.length>0&&this.gl.cullFace(this._stackCullFaceFacing[this._stackCullFaceFacing.length-1])},Ot.prototype._stackDepthFunc=[],Ot.prototype.pushDepthFunc=function(t){this._stackDepthFunc.push(t),this.gl.depthFunc(t)},Ot.prototype.stateDepthFunc=function(){return this._stackDepthFunc.length>0&&this._stackDepthFunc[this._stackDepthFunc.length-1]},Ot.prototype.popDepthFunc=function(){this._stackDepthFunc.pop(),this._stackDepthFunc.length>0&&this.gl.depthFunc(this._stackDepthFunc[this._stackDepthFunc.length-1])},Ot.prototype._stackBlend=[],Ot.prototype.pushBlend=function(t){this._stackBlend.push(t),t?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND)},Ot.prototype.popBlend=function(){this._stackBlend.pop(),this._stackBlend[this._stackBlend.length-1]?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND)},Ot.prototype.stateBlend=function(){return this._stackBlend[this._stackBlend.length-1]};Ot.prototype._stackBlendMode=[],Ot.prototype._stackBlendModePremul=[],Ot.prototype.pushBlendMode=function(t,e){this._stackBlendMode.push(t),this._stackBlendModePremul.push(e);const i=this._stackBlendMode.length-1;this.pushBlend(this._stackBlendMode[i]!==ot.BLEND_MODES.BLEND_NONE),this._setBlendMode(this._stackBlendMode[i],this._stackBlendModePremul[i])},Ot.prototype.popBlendMode=function(){this._stackBlendMode.pop(),this._stackBlendModePremul.pop();const t=this._stackBlendMode.length-1;this.popBlend(this._stackBlendMode[t]!==ot.BLEND_MODES.BLEND_NONE),t>=0&&this._setBlendMode(this._stackBlendMode[t],this._stackBlendModePremul[t])},Ot.prototype.glGetAttribLocation=function(t,e){return this.gl.getAttribLocation(t,e)},Ot.prototype.shouldDrawHelpers=function(t){return!this.frameStore.shadowPass&&(!!t.patch.isEditorMode()&&(CABLES.UI.renderHelper||CABLES.UI.renderHelperCurrent&&t.isCurrentUiOp()))},Ot.prototype._setBlendMode=function(t,e){const i=this.gl;t==ot.BLEND_MODES.BLEND_NONE||(t==ot.BLEND_MODES.BLEND_ADD?e?(i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD),i.blendFuncSeparate(i.ONE,i.ONE,i.ONE,i.ONE)):(i.blendEquation(i.FUNC_ADD),i.blendFunc(i.SRC_ALPHA,i.ONE)):t==ot.BLEND_MODES.BLEND_SUB?e?(i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD),i.blendFuncSeparate(i.ZERO,i.ZERO,i.ONE_MINUS_SRC_COLOR,i.ONE_MINUS_SRC_ALPHA)):(i.blendEquation(i.FUNC_ADD),i.blendFunc(i.ZERO,i.ONE_MINUS_SRC_COLOR)):t==ot.BLEND_MODES.BLEND_MUL?e?(i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD),i.blendFuncSeparate(i.ZERO,i.SRC_COLOR,i.ZERO,i.SRC_ALPHA)):(i.blendEquation(i.FUNC_ADD),i.blendFunc(i.ZERO,i.SRC_COLOR)):t==ot.BLEND_MODES.BLEND_NORMAL?e?(i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD),i.blendFuncSeparate(i.ONE,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA)):(i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD),i.blendFuncSeparate(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA)):this._log.log("setblendmode: unknown blendmode"))},Ot.prototype.setCursor=function(t){this._cursor=t};const Rt=Object.assign({Framebuffer:function(t,e,i,s){const r=t;this._log=new h("Framebuffer");const n=r.gl.getExtension("WEBGL_depth_texture")||r.gl.getExtension("WEBKIT_WEBGL_depth_texture")||r.gl.getExtension("MOZ_WEBGL_depth_texture")||r.gl.DEPTH_TEXTURE;n||r.exitError("NO_DEPTH_TEXTURE","no depth texture support");let o=e||512,a=i||512;(s=s||{isFloatingPointTexture:!1}).hasOwnProperty("clear")||(s.clear=!0),s.hasOwnProperty("filter")||(s.filter=L.FILTER_LINEAR);const l=new L(r,{isFloatingPointTexture:s.isFloatingPointTexture,filter:s.filter,wrap:s.wrap||L.CLAMP_TO_EDGE});let c=null;n&&(c=new L(r,{isDepthTexture:!0})),this._options=s;const u=r.gl.createFramebuffer(),g=r.gl.createRenderbuffer();this.getWidth=function(){return o},this.getHeight=function(){return a},this.getGlFrameBuffer=function(){return u},this.getDepthRenderBuffer=function(){return g},this.getTextureColor=function(){return l},this.getTextureDepth=function(){return c},this.setFilter=function(t){l.filter=t,l.setSize(o,a)},this.setSize=function(t,e){if(t<2&&(t=2),e<2&&(e=2),o=Math.ceil(t),a=Math.ceil(e),r.profileData.profileFrameBuffercreate++,r.gl.bindFramebuffer(r.gl.FRAMEBUFFER,u),r.gl.bindRenderbuffer(r.gl.RENDERBUFFER,g),l.setSize(o,a),c&&c.setSize(o,a),n&&r.gl.renderbufferStorage(r.gl.RENDERBUFFER,r.gl.DEPTH_COMPONENT16,o,a),r.gl.framebufferTexture2D(r.gl.FRAMEBUFFER,r.gl.COLOR_ATTACHMENT0,r.gl.TEXTURE_2D,l.tex,0),n&&(r.gl.framebufferRenderbuffer(r.gl.FRAMEBUFFER,r.gl.DEPTH_ATTACHMENT,r.gl.RENDERBUFFER,g),r.gl.framebufferTexture2D(r.gl.FRAMEBUFFER,r.gl.DEPTH_ATTACHMENT,r.gl.TEXTURE_2D,c.tex,0)),!r.gl.isFramebuffer(u))throw new Error("Invalid framebuffer");const i=r.gl.checkFramebufferStatus(r.gl.FRAMEBUFFER);switch(i){case r.gl.FRAMEBUFFER_COMPLETE:break;case r.gl.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:throw this._log.warn("FRAMEBUFFER_INCOMPLETE_ATTACHMENT...",o,a,l.tex,g),new Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");case r.gl.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:throw this._log.warn("FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT"),new Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");case r.gl.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:throw this._log.warn("FRAMEBUFFER_INCOMPLETE_DIMENSIONS"),new Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");case r.gl.FRAMEBUFFER_UNSUPPORTED:throw this._log.warn("FRAMEBUFFER_UNSUPPORTED"),new Error("Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED");case 36059:this._log.warn("Incomplete: FRAMEBUFFER_INCOMPLETE_DRAW_BUFFER from ext. Or Safari/iOS undefined behaviour.");break;default:throw this._log.warn("incomplete framebuffer",i),new Error("Incomplete framebuffer: "+i)}r.gl.bindTexture(r.gl.TEXTURE_2D,null),r.gl.bindRenderbuffer(r.gl.RENDERBUFFER,null),r.gl.bindFramebuffer(r.gl.FRAMEBUFFER,null)},this.renderStart=function(){r.pushModelMatrix(),r.gl.bindFramebuffer(r.gl.FRAMEBUFFER,u),r.pushGlFrameBuffer(u),r.pushFrameBuffer(this),r.pushPMatrix(),r.gl.viewport(0,0,o,a),this._options.clear&&(r.gl.clearColor(0,0,0,0),r.gl.clear(r.gl.COLOR_BUFFER_BIT|r.gl.DEPTH_BUFFER_BIT))},this.renderEnd=function(){r.popPMatrix(),r.gl.bindFramebuffer(r.gl.FRAMEBUFFER,r.popGlFrameBuffer()),r.popFrameBuffer(),r.popModelMatrix(),r.resetViewPort()},this.delete=function(){l.delete(),c&&c.delete(),r.gl.deleteRenderbuffer(g),r.gl.deleteFramebuffer(u)},this.setSize(o,a)},Framebuffer2:B,Geometry:Y,BoundingBox:z,Marker:function(t){const e=new Y("marker");e.setPointVertices([1e-5,0,0,1,0,0,0,1e-5,0,0,1,0,0,0,1e-5,0,0,1]);const i=new at(t,e,t.gl.LINES);i.setGeom(e);const s=new vt(t,"markermaterial"),r="".endl()+"precision highp float;".endl()+"IN vec3 axisColor;".endl()+"void main()".endl()+"{".endl()+"    vec4 col=vec4(axisColor,1.0);".endl()+"    outColor = col;".endl()+"}",n="".endl()+"IN vec3 vPosition;".endl()+"UNI mat4 projMatrix;".endl()+"UNI mat4 mvMatrix;".endl()+"OUT vec3 axisColor;".endl()+"void main()".endl()+"{".endl()+"   vec4 pos=vec4(vPosition, 1.0);".endl()+"   if(pos.x!=0.0)axisColor=vec3(1.0,0.3,0.0);".endl()+"   if(pos.y!=0.0)axisColor=vec3(0.0,1.0,0.2);".endl()+"   if(pos.z!=0.0)axisColor=vec3(0.0,0.5,1.0);".endl()+"   gl_Position = projMatrix * mvMatrix * pos;".endl()+"}";s.setSource(n,r),this._vScale=vec3.create(),this.draw=function(t,e,r){const n=e||2;t.pushModelMatrix(),t.pushShader(s),vec3.set(this._vScale,n,n,n),mat4.scale(t.mvMatrix,t.mvMatrix,this._vScale),t.pushDepthTest(1==r),i.render(t.getShader()),t.popDepthTest(),t.popShader(),t.popModelMatrix()}},WirePoint:function(t){const e=t.gl.createBuffer(),i=vec3.create();this.render=function(t,s){t.pushModelMatrix(),vec3.set(i,s,s,s),mat4.scale(t.mvMatrix,t.mvMatrix,i);const r=t.getShader();r&&(r.bind(),t.gl.bindBuffer(t.gl.ARRAY_BUFFER,e),t.gl.vertexAttribPointer(r.getAttrVertexPos(),e.itemSize,t.gl.FLOAT,!1,0,0),t.gl.enableVertexAttribArray(r.getAttrVertexPos()),t.gl.bindBuffer(t.gl.ARRAY_BUFFER,e),t.gl.drawArrays(t.gl.LINE_STRIP,0,e.numItems)),t.popModelMatrix()},function(){const i=[];let s=0,r=0;for(s=0;s<=Math.round(24);s++)r=360/Math.round(24)*s*dt,i.push(.5*Math.cos(r)),i.push(0),i.push(.5*Math.sin(r));for(s=0;s<=Math.round(24);s++)r=360/Math.round(24)*s*dt,i.push(.5*Math.cos(r)),i.push(.5*Math.sin(r)),i.push(0);for(s=0;s<=Math.round(24);s++)r=360/Math.round(24)*s*dt,i.push(0),i.push(.5*Math.cos(r)),i.push(.5*Math.sin(r));t.gl.bindBuffer(t.gl.ARRAY_BUFFER,e),t.gl.bufferData(t.gl.ARRAY_BUFFER,new Float32Array(i),t.gl.STATIC_DRAW),e.itemSize=3,e.numItems=i.length/e.itemSize}()},WireCube:function(t){const e=t.gl.createBuffer(),i=vec3.create();this.render=function(t,s,r,n){t.pushModelMatrix(),vec3.set(i,s||1,r||1,n||1),mat4.scale(t.mvMatrix,t.mvMatrix,i);const o=t.getShader();o&&(o.bind(),t.gl.bindBuffer(t.gl.ARRAY_BUFFER,e),t.gl.vertexAttribPointer(o.getAttrVertexPos(),e.itemSize,t.gl.FLOAT,!1,0,0),t.gl.enableVertexAttribArray(o.getAttrVertexPos()),t.gl.bindBuffer(t.gl.ARRAY_BUFFER,e),t.gl.drawArrays(t.gl.LINE_STRIP,0,e.numItems)),t.popModelMatrix()},function(){const i=[];i.push(-1,-1,1),i.push(1,-1,1),i.push(1,1,1),i.push(-1,1,1),i.push(-1,-1,1),i.push(-1,-1,-1),i.push(1,-1,-1),i.push(1,1,-1),i.push(-1,1,-1),i.push(-1,-1,-1),i.push(-1,-1,-1),i.push(-1,1,-1),i.push(-1,1,1),i.push(-1,-1,1),i.push(-1,-1,-1),i.push(1,-1,-1),i.push(1,1,-1),i.push(1,1,1),i.push(1,-1,1),i.push(1,-1,-1),t.gl.bindBuffer(t.gl.ARRAY_BUFFER,e),t.gl.bufferData(t.gl.ARRAY_BUFFER,new Float32Array(i),t.gl.STATIC_DRAW),e.itemSize=3,e.numItems=i.length/e.itemSize}()},MatrixStack:xt,Mesh:at,MESH:ht,ShaderLibMods:ut,Shader:vt,Uniform:rt,MESHES:lt,Context:Ot,Texture:L,TextureEffect:ct,isWindows:ft,getWheelSpeed:Et,getWheelDelta:Tt,onLoadingAssetsFinished:null,profileData:void 0,UniColorShader:class{constructor(t){this.shader=new CGL.Shader(t,"markermaterial");const e="".endl()+"void main()".endl()+"{".endl()+"    outColor = vec4(color.rgb,1.0);".endl()+"}",i="".endl()+"IN vec3 vPosition;".endl()+"UNI mat4 projMatrix;".endl()+"UNI mat4 mvMatrix;".endl()+"void main()".endl()+"{".endl()+"   gl_Position = projMatrix * mvMatrix * vec4(vPosition,1.0);".endl()+"}";this.shader.setSource(i,e),this.coloruni=this.shader.addUniformFrag("4f","color",[1,.777,1,1])}setColor(t,e,i,s){this.coloruni.set(t,e,i,s)}}},ot.BLEND_MODES,ot.SHADER,ot.MATH,ot.BLEND_MODES);window.CGL=Rt;const St=function(t){W.apply(this),this.id=CABLES.uuid(),this.portIn=null,this.portOut=null,this.scene=t,this.activityCounter=0,this.ignoreInSerialize=!1};St.prototype.setValue=function(t){void 0===t?this._setValue():this.portIn.set(t)},St.prototype.activity=function(){this.activityCounter++},St.prototype._setValue=function(){if(!this.portOut)return void this.remove();const t=this.portOut.get();t==t&&(this.portIn.type!=l.OP_PORT_TYPE_FUNCTION&&this.activity(),(this.portIn.get()!==t||this.portIn.changeAlways)&&this.portIn.set(t))},St.prototype.getOtherPort=function(t){return t==this.portIn?this.portOut:this.portIn},St.prototype.remove=function(){this.portIn&&this.portIn.removeLink(this),this.portOut&&this.portOut.removeLink(this),this.scene&&this.scene.emitEvent("onUnLink",this.portIn,this.portOut,this),!this.portIn||this.portIn.type!=l.OP_PORT_TYPE_OBJECT&&this.portIn.type!=l.OP_PORT_TYPE_ARRAY||(this.portIn.set(null),this.portIn.links.length>0&&this.portIn.set(this.portIn.links[0].getOtherPort(this.portIn).get())),this.portIn&&this.portIn.parent._checkLinksNeededToWork(),this.portOut&&this.portOut.parent._checkLinksNeededToWork(),this.portIn=null,this.portOut=null,this.scene=null},St.prototype.link=function(t,e){if(!St.canLink(t,e))return console.warn("[core_link] cannot link ports!",t,e),!1;t.direction==c.PORT_DIR_IN?(this.portIn=t,this.portOut=e):(this.portIn=e,this.portOut=t),t.addLink(this),e.addLink(this),this.setValue(),t.onLink&&t.onLink(this),e.onLink&&e.onLink(this),t.parent._checkLinksNeededToWork(),e.parent._checkLinksNeededToWork()},St.prototype.getSerialized=function(){const t={};return t.portIn=this.portIn.getName(),t.portOut=this.portOut.getName(),t.objIn=this.portIn.parent.id,t.objOut=this.portOut.parent.id,t},St.canLinkText=function(t,e){if(t.direction==e.direction){let t="(out)";return e.direction==c.PORT_DIR_IN&&(t="(in)"),"can not link: same direction "+t}return t.parent==e.parent?"can not link: same op":t.type!=l.OP_PORT_TYPE_DYNAMIC&&e.type!=l.OP_PORT_TYPE_DYNAMIC&&t.type!=e.type?"can not link: different type":t?e?t.direction==c.PORT_DIR_IN&&t.isAnimated()||e.direction==c.PORT_DIR_IN&&e.isAnimated()?"can not link: is animated":t.isLinkedTo(e)?"ports already linked":t.canLink&&!t.canLink(e)||e.canLink&&!e.canLink(t)?"Incompatible":"can link":"can not link: port 2 invalid":"can not link: port 1 invalid"},St.canLink=function(t,e){return!!t&&(!!e&&((t.direction!=c.PORT_DIR_IN||!t.isAnimated())&&((e.direction!=c.PORT_DIR_IN||!e.isAnimated())&&(!t.isHidden()&&!e.isHidden()&&(!t.isLinkedTo(e)&&(t.direction!=e.direction&&((t.type==e.type||t.type==l.OP_PORT_TYPE_DYNAMIC||e.type==l.OP_PORT_TYPE_DYNAMIC)&&(t.type==l.OP_PORT_TYPE_DYNAMIC||e.type==l.OP_PORT_TYPE_DYNAMIC||t.parent!=e.parent&&(!(t.canLink&&!t.canLink(e))&&!(e.canLink&&!e.canLink(t)))))))))))};const Pt=function(){W.apply(this),this._log=new h("core_op"),this.data={},this.storage={},this.objName="",this.portsOut=[],this.portsIn=[],this.portsInData=[],this.opId="",this.uiAttribs={},this.enabled=!0,this.patch=arguments[0],this.name=arguments[1],this._needsLinkedToWork=[],this._needsParentOp=null,this._shortOpName="",this.hasUiErrors=!1,this._uiErrors={},arguments[1]&&(this._shortOpName=CABLES.getShortOpName(arguments[1]),this.getTitle()),this.id=arguments[2]||T(),this.onAddPort=null,this.onCreate=null,this.onResize=null,this.onLoaded=null,this.onDelete=null,this.onUiAttrChange=null,this.onError=null,this._eventCallbacks={},this._instances=null,this.preRender=null,this.init=null};{Pt.prototype.clearUiAttrib=function(t){const e={name:null};this.uiAttrib(e)},Pt.prototype.getTitle=function(){return this.uiAttribs?(void 0!==this.uiAttribs.title&&""!==this.uiAttribs.title||-1!=this.objName.indexOf("Ops.Ui.")||(this.uiAttribs.title=this._shortOpName),void 0===this.uiAttribs.title&&(this.uiAttribs.title=this._shortOpName),this.uiAttribs.title):"nouiattribs"+this.name},Pt.prototype.setTitle=function(t){const e=this.name!=t;this.name=t,this.uiAttr({title:t}),e&&this.fireEvent("onTitleChange",t)};const t=function(t){if(t){(t.error||t.warning||t.hint)&&this._log.warn("old ui error/warning attribute in "+this.name+", use op.setUiError !",t),"object"!=typeof t&&this._log.error("op.uiAttrib attribs are not of type object"),this.uiAttribs||(this.uiAttribs={});for(const e in t)this.uiAttribs[e]=t[e];this.uiAttribs.hasOwnProperty("selected")&&0==this.uiAttribs.selected&&delete this.uiAttribs.selected,t.title&&t.title!=this.name&&this.setTitle(t.title),this.fireEvent("onUiAttribsChange",t),this.patch.emitEvent("onUiAttribsChange",this,t)}};Pt.prototype.setUiAttribs=Pt.prototype.setUiAttrib=Pt.prototype.uiAttr=t,Pt.prototype.getName=function(){return this.uiAttribs.name?this.uiAttribs.name:this.objName.split(".")},Pt.prototype.addOutPort=function(t){return t.direction=c.PORT_DIR_OUT,t.parent=this,this.portsOut.push(t),this.fireEvent("onPortAdd",t),t},Pt.prototype.hasDynamicPort=function(){let t=0;for(t=0;t<this.portsIn.length;t++){if(this.portsIn[t].type==l.OP_PORT_TYPE_DYNAMIC)return!0;if("dyn"==this.portsIn[t].getName())return!0}for(t=0;t<this.portsOut.length;t++){if(this.portsOut[t].type==l.OP_PORT_TYPE_DYNAMIC)return!0;if("dyn"==this.portsOut[t].getName())return!0}return!1},Pt.prototype.addInPort=function(t){if(!(t instanceof et))throw new Error("parameter is not a port!");return t.direction=c.PORT_DIR_IN,t.parent=this,this.portsIn.push(t),this.fireEvent("onPortAdd",t),t},Pt.prototype.inFunction=Pt.prototype.inTrigger=function(t,e){const i=this.addInPort(new et(this,t,l.OP_PORT_TYPE_FUNCTION));return void 0!==e&&i.set(e),i},Pt.prototype.inFunctionButton=Pt.prototype.inTriggerButton=function(t,e){const i=this.addInPort(new et(this,t,l.OP_PORT_TYPE_FUNCTION,{display:"button"}));return void 0!==e&&i.set(e),i},Pt.prototype.inFunctionButton=Pt.prototype.inUiTriggerButtons=function(t,e){const i=this.addInPort(new et(this,t,l.OP_PORT_TYPE_FUNCTION,{display:"buttons"}));return void 0!==e&&i.set(e),i},Pt.prototype.inValueFloat=Pt.prototype.inValue=Pt.prototype.inFloat=function(t,e){const i=this.addInPort(new et(this,t,l.OP_PORT_TYPE_VALUE));return void 0!==e&&(i.set(e),i.defaultValue=e),i},Pt.prototype.inValueBool=Pt.prototype.inBool=function(t,e){const i=this.addInPort(new et(this,t,l.OP_PORT_TYPE_VALUE,{display:"bool"}));return void 0!==e&&(i.set(e),i.defaultValue=i.get()),i},Pt.prototype.inValueString=function(t,e){const i=this.addInPort(new et(this,t,l.OP_PORT_TYPE_VALUE,{type:"string"}));return i.value="",void 0!==e&&(i.set(e),i.defaultValue=e),i},Pt.prototype.inString=function(t,e){const i=this.addInPort(new et(this,t,l.OP_PORT_TYPE_STRING,{type:"string"}));return e=e||"",i.value=e,i.set(e),i.defaultValue=e,i},Pt.prototype.inValueText=function(t,e){const i=this.addInPort(new et(this,t,l.OP_PORT_TYPE_VALUE,{type:"string",display:"text"}));return i.value="",void 0!==e&&(i.set(e),i.defaultValue=e),i},Pt.prototype.inTextarea=function(t,e){const i=this.addInPort(new et(this,t,l.OP_PORT_TYPE_STRING,{type:"string",display:"text"}));return i.value="",void 0!==e&&(i.set(e),i.defaultValue=e),i},Pt.prototype.inStringEditor=function(t,e,i,s=!0){const r=this.addInPort(new et(this,t,l.OP_PORT_TYPE_STRING,{type:"string",display:"editor",editorSyntax:i,hideFormatButton:s}));return r.value="",void 0!==e&&(r.set(e),r.defaultValue=e),r},Pt.prototype.inValueEditor=function(t,e,i,s=!0){const r=this.addInPort(new et(this,t,l.OP_PORT_TYPE_VALUE,{type:"string",display:"editor",editorSyntax:i,hideFormatButton:s}));return r.value="",void 0!==e&&(r.set(e),r.defaultValue=e),r},Pt.prototype.inValueSelect=Pt.prototype.inDropDown=function(t,e,i,s){let r=null;if(s){const i=new et(this,t,l.OP_PORT_TYPE_VALUE,{display:"dropdown",hidePort:!0,type:"string",values:e});r=this.addInPort(i)}else{const s=new et(this,t+" index",l.OP_PORT_TYPE_VALUE,{increment:"integer",hideParam:!0}),n=this.addInPort(s),o=new st(this,t,l.OP_PORT_TYPE_VALUE,{display:"dropdown",hidePort:!0,type:"string",values:e},n);if(o.indexPort=s,s.onLinkChanged=function(){o.setUiAttribs({greyout:s.isLinked()})},r=this.addInPort(o),void 0!==i){r.set(i);const t=e.findIndex(t=>t==i);n.setValue(t),r.defaultValue=i,n.defaultValue=t}}return r},Pt.prototype.inSwitch=function(t,e,i,s){let r=null;if(s){const i=new et(this,t,l.OP_PORT_TYPE_STRING,{display:"switch",hidePort:!0,type:"string",values:e});r=this.addInPort(i)}else{const s=new et(this,t+" index",l.OP_PORT_TYPE_VALUE,{increment:"integer",hideParam:!0}),n=this.addInPort(s),o=new it(this,t,l.OP_PORT_TYPE_STRING,{display:"switch",hidePort:!0,type:"string",values:e},n);if(s.onLinkChanged=function(){o.setUiAttribs({greyout:s.isLinked()})},r=this.addInPort(o),void 0!==i){r.set(i);const t=e.findIndex(t=>t==i);n.setValue(t),r.defaultValue=i,n.defaultValue=t}}return r},Pt.prototype.inValueInt=Pt.prototype.inInt=function(t,e){const i=this.addInPort(new et(this,t,l.OP_PORT_TYPE_VALUE,{increment:"integer"}));return void 0!==e&&(i.set(e),i.defaultValue=e),i},Pt.prototype.inFile=function(t,e,i){const s=this.addInPort(new et(this,t,l.OP_PORT_TYPE_VALUE,{display:"file",type:"string",filter:e}));return void 0!==i&&(s.set(i),s.defaultValue=i),s},Pt.prototype.inUrl=function(t,e,i){const s=this.addInPort(new et(this,t,l.OP_PORT_TYPE_STRING,{display:"file",type:"string",filter:e}));return void 0!==i&&(s.set(i),s.defaultValue=i),s},Pt.prototype.inTexture=function(t,e){const i=this.addInPort(new et(this,t,l.OP_PORT_TYPE_OBJECT,{display:"texture",objType:"texture",preview:!0}));return void 0!==e&&i.set(e),i},Pt.prototype.inObject=function(t,e,i){const s=this.addInPort(new et(this,t,l.OP_PORT_TYPE_OBJECT,{objType:i}));return void 0!==e&&s.set(e),s},Pt.prototype.inGradient=function(t,e){const i=this.addInPort(new et(this,t,l.OP_PORT_TYPE_VALUE,{display:"gradient",hidePort:!0}));return void 0!==e&&i.set(e),i},Pt.prototype.inArray=function(t,e,i){!i&&CABLES.UTILS.isNumeric(e)&&(i=e);const s=this.addInPort(new et(this,t,l.OP_PORT_TYPE_ARRAY,{stride:i}));return void 0===e||!Array.isArray(e)&&null!=e||s.set(e),s},Pt.prototype.inValueSlider=Pt.prototype.inFloatSlider=function(t,e,i,s){const r={display:"range"};null!=i&&null!=s&&(r.min=i,r.max=s);const n=this.addInPort(new et(this,t,l.OP_PORT_TYPE_VALUE,r));return void 0!==e&&(n.set(e),n.defaultValue=e),n},Pt.prototype.outFunction=Pt.prototype.outTrigger=function(t,e){const i=this.addOutPort(new et(this,t,l.OP_PORT_TYPE_FUNCTION));return void 0!==e&&i.set(e),i},Pt.prototype.outValue=Pt.prototype.outNumber=function(t,e){const i=this.addOutPort(new et(this,t,l.OP_PORT_TYPE_VALUE));return void 0!==e&&i.set(e),i},Pt.prototype.outValueBool=Pt.prototype.outBool=function(t,e){const i=this.addOutPort(new et(this,t,l.OP_PORT_TYPE_VALUE,{display:"bool"}));return void 0!==e?i.set(e):i.set(0),i},Pt.prototype.outBoolNum=function(t,e){const i=this.addOutPort(new et(this,t,l.OP_PORT_TYPE_VALUE,{display:"boolnum"}));return i.set=function(t){this.setValue(t?1:0)}.bind(i),void 0!==e?i.set(e):i.set(0),i},Pt.prototype.outValueString=function(t,e){const i=this.addOutPort(new et(this,t,l.OP_PORT_TYPE_VALUE,{type:"string"}));return void 0!==e&&i.set(e),i},Pt.prototype.outString=function(t,e){const i=this.addOutPort(new et(this,t,l.OP_PORT_TYPE_STRING,{type:"string"}));return void 0!==e?i.set(e):i.set(""),i},Pt.prototype.outObject=function(t,e,i){const s=this.addOutPort(new et(this,t,l.OP_PORT_TYPE_OBJECT,{objType:i||null}));return void 0!==e&&s.set(e),s.ignoreValueSerialize=!0,s},Pt.prototype.outArray=function(t,e,i){!i&&CABLES.UTILS.isNumeric(e)&&(i=e);const s=this.addOutPort(new et(this,t,l.OP_PORT_TYPE_ARRAY,{stride:i}));return void 0===e||!Array.isArray(e)&&null!=e||s.set(e),s.ignoreValueSerialize=!0,s},Pt.prototype.outTexture=function(t,e){const i=this.addOutPort(new et(this,t,l.OP_PORT_TYPE_OBJECT,{preview:!0,objType:"texture"}));return void 0!==e&&i.set(e),i.ignoreValueSerialize=!0,i},Pt.prototype.inDynamic=function(t,e,i,s){const r=new et(this,t,l.OP_PORT_TYPE_DYNAMIC,i);return r.shouldLink=function(t,i){if(e&&g.isArray(e)){for(let s=0;s<e.length;s++){if(t==this&&i.type===e[s])return!0;if(i==this&&t.type===e[s])return!0}return!1}return!0},this.addInPort(r),void 0!==s&&(r.set(s),r.defaultValue=s),r},Pt.prototype.printInfo=function(){for(let t=0;t<this.portsIn.length;t++)console.log("in: "+this.portsIn[t].getName());for(const t in this.portsOut)console.log("out: "+this.portsOut[t].getName())},Pt.prototype.getOutChilds=function(){const t=[];for(const e in this.portsOut)for(const i in this.portsOut[e].links)this.portsOut[e].type==l.OP_PORT_TYPE_FUNCTION&&t.push(this.portsOut[e].links[i].portIn.parent);return t},Pt.prototype.markChilds=function(){this.marked=!0;for(const t in this.portsOut)for(const e in this.portsOut[t].links)this.portsOut[t].parent.marked=!0,this.portsOut[t].links[e].portIn.parent!=this&&this.portsOut[t].links[e].portIn.parent.markChilds()},Pt.prototype.selectChilds=function(){this.setUiAttrib({selected:!0});for(const t in this.portsOut)for(const e in this.portsOut[t].links)this.portsOut[t].parent.setUiAttrib({selected:!0}),this.portsOut[t].links[e].portIn.parent!=this&&this.portsOut[t].links[e].portIn.parent.selectChilds()},Pt.prototype.deleteChilds=function(){const t=[];for(const e in this.portsOut)for(const i in this.portsOut[e].links)this.portsOut[e].links[i].portIn.parent!=this&&(this.portsOut[e].parent!=this&&t.push(this.portsOut[e].parent),t.push(this.portsOut[e].links[i].portIn.parent),this.portsOut[e].links[i].portIn.parent.deleteChilds());for(const e in t)this.patch.deleteOp(t[e].id)},Pt.prototype.removeLinks=function(){for(let t=0;t<this.portsIn.length;t++)this.portsIn[t].removeLinks();for(let t=0;t<this.portsOut.length;t++)this.portsOut[t].removeLinks()},Pt.prototype.countFittingPorts=function(t){let e=0;for(const i in this.portsOut)St.canLink(t,this.portsOut[i])&&e++;for(const i in this.portsIn)St.canLink(t,this.portsIn[i])&&e++;return e},Pt.prototype.findFittingPort=function(t,e=!1){if(e){for(const e in this.portsIn)if(St.canLink(t,this.portsIn[e]))return this.portsIn[e];for(const e in this.portsOut)if(St.canLink(t,this.portsOut[e]))return this.portsOut[e]}else{for(const e in this.portsOut)if(St.canLink(t,this.portsOut[e]))return this.portsOut[e];for(const e in this.portsIn)if(St.canLink(t,this.portsIn[e]))return this.portsIn[e]}},Pt.prototype.getSerialized=function(t){const e={};this.opId&&(e.opId=this.opId),e.objName=this.objName,e.id=this.id,e.uiAttribs=this.uiAttribs,this.storage&&Object.keys(this.storage).length>0&&(e.storage=this.storage),this.uiAttribs.title==this._shortOpName&&delete this.uiAttribs.title,this.uiAttribs.hasOwnProperty("working")&&1==this.uiAttribs.working&&delete this.uiAttribs.working,t&&this.uiAttribs.hasOwnProperty("uierrors")&&delete this.uiAttribs.uierrors,e.portsIn=[],e.portsOut=[];for(let t=0;t<this.portsIn.length;t++)e.portsIn.push(this.portsIn[t].getSerialized());for(const t in this.portsOut)e.portsOut.push(this.portsOut[t].getSerialized());return e},Pt.prototype.getFirstOutPortByType=function(t){for(const e in this.portsOut)if(this.portsOut[e].type==t)return this.portsOut[e]},Pt.prototype.getFirstInPortByType=function(t){for(const e in this.portsIn)if(this.portsIn[e].type==t)return this.portsIn[e]},Pt.prototype.getPort=Pt.prototype.getPortByName=function(t,e){if(e){for(let e=0;e<this.portsIn.length;e++)if(this.portsIn[e].getName().toLowerCase()==t)return this.portsIn[e];for(let e=0;e<this.portsOut.length;e++)if(this.portsOut[e].getName().toLowerCase()==t)return this.portsOut[e]}else{for(let e=0;e<this.portsIn.length;e++)if(this.portsIn[e].getName()==t)return this.portsIn[e];for(let e=0;e<this.portsOut.length;e++)if(this.portsOut[e].getName()==t)return this.portsOut[e]}},Pt.prototype.getPortById=function(t){for(let e=0;e<this.portsIn.length;e++)if(this.portsIn[e].id==t)return this.portsIn[e];for(let e=0;e<this.portsOut.length;e++)if(this.portsOut[e].id==t)return this.portsOut[e]},Pt.prototype.updateAnims=function(){for(let t=0;t<this.portsIn.length;t++)this.portsIn[t].updateAnim()},Pt.prototype.log=function(){const t="op "+this.objName;if(CABLES.UI&&!CABLES.UI.logFilter.shouldPrint(t,...arguments))return;if(!CABLES.UI&&this.patch.silent)return;const e=["[op "+this._shortOpName+"]"];e.push.apply(e,arguments),Function.prototype.apply.apply(console.log,[console,e])},Pt.prototype.error=Pt.prototype.logError=function(){const t=["[op "+this._shortOpName+"]"];t.push.apply(t,arguments),Function.prototype.apply.apply(console.error,[console,t]),window.gui&&window.gui.emitEvent("opLogEvent",this.objName,"error",arguments)},Pt.prototype.warn=Pt.prototype.logWarn=function(){const t=["[op "+this._shortOpName+"]"];t.push.apply(t,arguments),Function.prototype.apply.apply(console.warn,[console,t])},Pt.prototype.verbose=Pt.prototype.logVerbose=function(){const t="op "+this._shortOpName;if(CABLES.UI&&!CABLES.UI.logFilter.shouldPrint(t,...arguments))return;if(!CABLES.UI&&this.patch.silent)return;const e=["["+t+"]"];e.push.apply(e,arguments),Function.prototype.apply.apply(console.info,[console,e])},Pt.prototype.unLink=function(){for(let t=0;t<this.portsOut.length;t++)this.portsOut[t].removeLinks();for(let t=0;t<this.portsIn.length;t++)this.portsIn[t].removeLinks()},Pt.prototype.profile=function(t){for(let t=0;t<this.portsIn.length;t++)this.portsIn[t]._onTriggered=this.portsIn[t]._onTriggeredProfiling,this.portsIn[t].set=this.portsIn[t]._onSetProfiling},Pt.prototype.findParent=function(t){for(let e=0;e<this.portsIn.length;e++)if(this.portsIn[e].isLinked()){if(this.portsIn[e].links[0].portOut.parent.objName==t)return this.portsIn[e].links[0].portOut.parent;let i=null;if(i=this.portsIn[e].links[0].portOut.parent.findParent(t),i)return i}return null},Pt.prototype.cleanUp=function(){if(this._instances){for(let t=0;t<this._instances.length;t++)this._instances[t].onDelete&&this._instances[t].onDelete();this._instances.length=0}},Pt.prototype.instanced=function(t){if(console.log("instanced",this.patch.instancing.numCycles()),0===this.patch.instancing.numCycles())return!1;let e=0,i=0;if(!this._instances||this._instances.length!=this.patch.instancing.numCycles()){for(this._instances||(this._instances=[]),this._.log("creating instances of ",this.objName,this.patch.instancing.numCycles(),this._instances.length),this._instances.length=this.patch.instancing.numCycles(),e=0;e<this._instances.length;e++){this._instances[e]=this.patch.createOp(this.objName,!0),this._instances[e].instanced=function(){return!1},this._instances[e].uiAttr(this.uiAttribs);for(let t=0;t<this.portsOut.length;t++)this.portsOut[t].type==l.OP_PORT_TYPE_FUNCTION&&(this._instances[e].getPortByName(this.portsOut[t].name).trigger=this.portsOut[t].trigger.bind(this.portsOut[t]))}for(i=0;i<this.portsIn.length;i++)this.portsIn[i].onChange=null,this.portsIn[i].onValueChanged=null}for(i=0;i<this.portsIn.length;i++)this.portsIn[i].type!=l.OP_PORT_TYPE_VALUE&&this.portsIn[i].type!=l.OP_PORT_TYPE_ARRAY||this._instances[this.patch.instancing.index()].portsIn[i].set(this.portsIn[i].get()),this.portsIn[i].type,l.OP_PORT_TYPE_FUNCTION;for(i=0;i<this.portsOut.length;i++)this.portsOut[i].type==l.OP_PORT_TYPE_VALUE&&this.portsOut[i].set(this._instances[this.patch.instancing.index()].portsOut[i].get());return!0},Pt.prototype.initInstancable=function(){},Pt.prototype.setValues=function(t){for(const e in t){const i=this.getPortByName(e);i?i.set(t[e]):this._log.warn("op.setValues: port not found:",e)}},Pt.prototype.setUiError=function(t,e,i){if(!e&&!this.hasUiErrors)return;if(!e&&!this._uiErrors.hasOwnProperty(t))return;if(this._uiErrors.hasOwnProperty(t)&&this._uiErrors[t].txt==e)return;t.indexOf(" ")>-1&&this._log.warn("setuierror id cant have spaces! ",t),!e&&this._uiErrors.hasOwnProperty(t)?delete this._uiErrors[t]:!e||this._uiErrors.hasOwnProperty(t)&&this._uiErrors[t].txt==e||(null==i&&(i=2),this._uiErrors[t]={txt:e,level:i,id:t});const s=[];for(const t in this._uiErrors)s.push(this._uiErrors[t]);this.uiAttr({uierrors:s}),this.hasUiErrors=Object.keys(this._uiErrors).length},Pt.prototype.setError=function(t,e){this._log.warn("old error message op.error() - use op.setUiError()")},Pt.prototype.addListener=Pt.prototype.addEventListener=function(t,e){this._eventCallbacks[t]?this._eventCallbacks[t].push(e):this._eventCallbacks[t]=[e]},Pt.prototype.hasEventListener=function(t,e){if(t&&e){if(this._eventCallbacks[t]){return-1!=this._eventCallbacks[t].indexOf(e)}}else this._log.warn("hasListener: missing parameters")},Pt.prototype.removeEventListener=function(t,e){if(this._eventCallbacks[t]){const i=this._eventCallbacks[t].indexOf(e);-1==i?this._log.warn("eventlistener "+t+" not found..."):this._eventCallbacks[t].slice(i)}},Pt.prototype.fireEvent=function(t,e){if(this._eventCallbacks[t])for(let i=0;i<this._eventCallbacks[t].length;i++)this._eventCallbacks[t][i]&&this._eventCallbacks[t][i].cb(e);this.onUiAttrChange&&"onUiAttribsChange"==t&&this.onUiAttrChange(e)},Pt.prototype.setEnabled=function(t){this.enabled=t,this.fireEvent("onEnabledChange",t)},Pt.prototype.setPortGroup=function(t,e){for(let i=0;i<e.length;i++)e[i]&&(e[i].setUiAttribs?e[i].setUiAttribs({group:t}):this._log.error("setPortGroup: invalid port!"))},Pt.prototype.setUiAxisPorts=function(t,e,i){t&&t.setUiAttribs({axis:"X"}),e&&e.setUiAttribs({axis:"Y"}),i&&i.setUiAttribs({axis:"Z"})},Pt.prototype.removePort=function(t){for(let e=0;e<this.portsIn.length;e++)if(this.portsIn[e]==t)return this.portsIn.splice(e,1),this.fireEvent("onUiAttribsChange",{}),void this.fireEvent("onPortRemoved",{})},Pt.prototype._checkLinksNeededToWork=function(){},Pt.prototype.toWorkNeedsParent=function(t){this.patch.isEditorMode()&&(this._needsParentOp=t)},Pt.prototype.toWorkPortsNeedToBeLinked=function(){if(this.patch.isEditorMode())for(let t=0;t<arguments.length;t++)-1==this._needsLinkedToWork.indexOf(arguments[t])&&this._needsLinkedToWork.push(arguments[t])},Pt.prototype.toWorkPortsNeedToBeLinkedReset=function(){this.patch.isEditorMode()&&(this._needsLinkedToWork.length=0,this.checkLinkTimeWarnings&&this.checkLinkTimeWarnings())},Pt.prototype.initVarPorts=function(){for(let t=0;t<this.portsIn.length;t++)this.portsIn[t].getVariableName()&&this.portsIn[t].setVariable(this.portsIn[t].getVariableName())},Pt.prototype.refreshParams=function(){this.patch&&this.patch.isEditorMode()&&this.isCurrentUiOp()&&gui.opParams.show(this)},Pt.prototype.isCurrentUiOp=function(){if(this.patch.isEditorMode())return gui.patchView.isCurrentOp(this)},Pt.prototype.renderVizLayer=null}Pt.getNamespaceClassName=function(t){return t?t.startsWith("Ops.Gl")?"gl":t.startsWith("Ops.WebAudio")?"audio":t.startsWith("Ops.Devices")?"devices":t.startsWith("Ops.Html")||t.startsWith("Ops.Sidebar")?"html":t.startsWith("Ops.Math")?"math":t.startsWith("Ops.User")?"user":"default":"default"},Pt.isSubpatchOp=function(t){return"Ops.Ui.Patch"==t||"Ops.Ui.SubPatch"==t};const Nt=function(t){CABLES.EventTarget.apply(this),this._log=new h("LoadingStatus"),this._loadingAssets={},this._cbFinished=[],this._assetTasks=[],this._percent=0,this._count=0,this._countFinished=0,this._order=0,this._startTime=0,this._patch=t,this._wasFinishedPrinted=!1,this._loadingAssetTaskCb=!1};Nt.prototype.setOnFinishedLoading=function(t){this._cbFinished.push(t)},Nt.prototype.getNumAssets=function(){return this._countFinished},Nt.prototype.getProgress=function(){return this._percent},Nt.prototype.checkStatus=function(){this._countFinished=0,this._count=0;for(const t in this._loadingAssets)this._count++,this._loadingAssets[t].finished||this._countFinished++;if(this._percent=(this._count-this._countFinished)/this._count,0===this._countFinished){for(let t=0;t<this._cbFinished.length;t++)if(this._cbFinished[t]){const e=this._cbFinished[t];setTimeout(()=>{e(this._patch),this.emitEvent("finishedAll")},100)}this._wasFinishedPrinted||(this._wasFinishedPrinted=!0,this.print()),this.emitEvent("finishedAll")}},Nt.prototype.getList=function(){let t=[];for(const e in this._loadingAssets)t.push(this._loadingAssets[e]);return t},Nt.prototype.getListJobs=function(){let t=[];for(const e in this._loadingAssets)this._loadingAssets[e].finished||t.push(this._loadingAssets[e].name);return t},Nt.prototype.print=function(){if(this._patch.config.silent)return;const t=[];for(const e in this._loadingAssets)t.push([this._loadingAssets[e].order,this._loadingAssets[e].type,this._loadingAssets[e].name,(this._loadingAssets[e].timeEnd-this._loadingAssets[e].timeStart)/1e3+"s"]);this._log.groupCollapsed("finished loading "+this._order+" assets in "+(Date.now()-this._startTime)/1e3+"s"),this._log.table(t),this._log.groupEnd()},Nt.prototype.finished=function(t){this._loadingAssets[t]&&(this._loadingAssets[t].finished=!0,this._loadingAssets[t].timeEnd=Date.now()),this.checkStatus(),this.emitEvent("finishedTask")},Nt.prototype._startAssetTasks=function(){for(let t=0;t<this._assetTasks.length;t++)this._assetTasks[t]();this._assetTasks.length=0},Nt.prototype.addAssetLoadingTask=function(t){this._patch.isEditorMode()&&!CABLES.UI.loaded?(this._assetTasks.push(t),this._loadingAssetTaskCb||window.gui.addEventListener("uiloaded",this._startAssetTasks.bind(this)),this._loadingAssetTaskCb=!0):t(),this.emitEvent("addAssetTask")},Nt.prototype.existByName=function(t){for(let e in this._loadingAssets)if(this._loadingAssets[e].name==t&&!this._loadingAssets[e].finished)return!0},Nt.prototype.start=function(t,e){0==this._startTime&&(this._startTime=Date.now());const i=A();return this._loadingAssets[i]={id:i,type:t,name:e,finished:!1,timeStart:Date.now(),order:this._order},this._order++,this.emitEvent("startTask"),i};const Ft=function(){this._loops=[],this._indizes=[],this._index=0};Ft.prototype.pushLoop=function(t){this._loops.push(Math.abs(Math.floor(t))),this._indizes.push(this._index)},Ft.prototype.popLoop=function(){this._loops.pop(),this._index=this._indizes.pop(),0===this._loops.length&&(this._index=0)},Ft.prototype.numLoops=function(){return this._loops.length},Ft.prototype.numCycles=function(){if(0===this._loops.length)return 0;let t=this._loops[0];for(let e=1;e<this._loops.length;e++)t*=this._loops[e];return t},Ft.prototype.inLoop=function(){return this._loops.length>0},Ft.prototype.increment=function(){this._index++},Ft.prototype.index=function(){return this._index};const Ct=function(t){this.startFrame=t.getFrameNum();let e={},i=null,s=0;this.getItems=function(){return e},this.clear=function(){e={}},this.add=function(r,n){null!==i&&(n&&n.id==i||e[i]&&(e[i].timeUsed+=performance.now()-s,(!e[i].peakTime||pt()-e[i].peakTime>5e3)&&(e[i].peak=0,e[i].peakTime=pt()),e[i].peak=Math.max(e[i].peak,performance.now()-s))),null!==n?(e[n.id]||(e[n.id]={numTriggers:0,timeUsed:0}),e[n.id].lastFrame!=t.getFrameNum()&&(e[n.id].numTriggers=0),e[n.id].lastFrame=t.getFrameNum(),e[n.id].numTriggers++,e[n.id].opid=n.parent.id,e[n.id].title=n.parent.name+"."+n.name,e[n.id].subPatch=n.parent.uiAttribs.subPatch,i=n.id,s=performance.now()):i=null},this.print=function(){console.log("--------");for(const t in e)console.log(e[t].title+": "+e[t].numTriggers+" / "+e[t].timeUsed)}};var wt=class{constructor(t,e,i){this._name=t,this._changeListeners=[],this.type=i,this.setValue(e)}getValue(){return this._v}getName(){return this._name}setValue(t){this._v=t;for(let e=0;e<this._changeListeners.length;e++)this._changeListeners[e](t,this)}addListener(t){-1==this._changeListeners.indexOf(t)&&this._changeListeners.push(t)}removeListener(t){const e=this._changeListeners.indexOf(t);this._changeListeners.splice(e,1)}};const Mt=function(t){W.apply(this),this._log=new h("core_patch"),this.ops=[],this.settings={},this.config=t||{glCanvasResizeToWindow:!1,prefixAssetPath:"",prefixJsPath:"",silent:!0,onError:null,onFinishedLoading:null,onFirstFrameRendered:null,onPatchLoaded:null,fpsLimit:0},this.timer=new _t,this.freeTimer=new _t,this.animFrameOps=[],this.animFrameCallbacks=[],this.gui=!1,CABLES.logSilent=this.silent=!0,this.profiler=null,this.aborted=!1,this._crashedOps=[],this._renderOneFrame=!1,this._animReq=null,this._opIdCache={},this._triggerStack=[],this.loading=new Nt(this),this._perf={fps:0,ms:0,_fpsFrameCount:0,_fpsMsCount:0,_fpsStart:0},this._volumeListeners=[],this._paused=!1,this._frameNum=0,this.instancing=new Ft,this.onOneFrameRendered=null,this.namedTriggers={},this._origData=null,this._frameNext=0,this._frameInterval=0,this._lastFrameTime=0,this._frameWasdelayed=!0,function(){return!this}()||this._log.warn("not in strict mode: core patch"),this._isLocal=0===document.location.href.indexOf("file:"),this.config.hasOwnProperty("silent")&&(this.silent=CABLES.logSilent=this.config.silent),this.config.hasOwnProperty("doRequestAnimation")||(this.config.doRequestAnimation=!0),this.config.prefixAssetPath||(this.config.prefixAssetPath=""),this.config.prefixJsPath||(this.config.prefixJsPath=""),this.config.masterVolume||(this.config.masterVolume=1),this._variables={},this._variableListeners=[],this.vars={},t&&t.vars&&(this.vars=t.vars),this.cgl=new Ot(this),this.cgl.setCanvas(this.config.glCanvasId||this.config.glCanvas||"glcanvas"),!0===this.config.glCanvasResizeToWindow&&this.cgl.setAutoResize("window"),!0===this.config.glCanvasResizeToParent&&this.cgl.setAutoResize("parent"),this.loading.setOnFinishedLoading(this.config.onFinishedLoading),this.cgl.aborted&&(this.aborted=!0),this.cgl.silent&&(this.silent=!0),this.freeTimer.play(),this.exec(),this.aborted||(this.config.patch?this.deSerialize(this.config.patch):this.config.patchFile&&w(this.config.patchFile,(t,e)=>{const i=JSON.parse(e);if(t){return this._log.error("err",t),this._log.error("data",i),void this._log.error("data",i.msg)}this.deSerialize(i)}),this.timer.play()),console.log("made with https://cables.gl")};Mt.prototype.isPlaying=function(){return!this._paused},Mt.prototype.isRenderingOneFrame=function(){return this._renderOneFrame},Mt.prototype.renderOneFrame=function(){this._paused=!0,this._renderOneFrame=!0,this.exec(),this._renderOneFrame=!1},Mt.prototype.getFPS=function(){return this._perf.fps},Mt.prototype.isEditorMode=function(){return!0===this.config.editorMode},Mt.prototype.pause=function(){cancelAnimationFrame(this._animReq),this.emitEvent("pause"),this._animReq=null,this._paused=!0,this.freeTimer.pause()},Mt.prototype.resume=function(){this._paused&&(cancelAnimationFrame(this._animReq),this._paused=!1,this.freeTimer.play(),this.emitEvent("resume"),this.exec())},Mt.prototype.setVolume=function(t){this.config.masterVolume=t;for(let e=0;e<this._volumeListeners.length;e++)this._volumeListeners[e].onMasterVolumeChanged(t)},Mt.prototype.getAssetPath=function(){if(this.isEditorMode())return"/assets/"+gui.project()._id+"/";if(document.location.href.indexOf("cables.gl")>0){const t=document.location.href.split("/");return"/assets/"+t[t.length-1]+"/"}return"assets/"},Mt.prototype.getFilePath=function(t){return this._isLocal&&!this.config.allowLocalFileAccess&&this.exitError("localAccess","Browser security forbids loading files directly without a webserver. Upload files to a server to work. use allowLocalFileAccess:true to ignore this."),t?0===(t=String(t)).indexOf("https:")||0===t.indexOf("http:")||0===t.indexOf("data:")?t:(t=t.replace("//","/"),this.config.prefixAssetPath+t+(this.config.suffixAssetPath||"")):t},Mt.prototype.clear=function(){for(this.emitEvent("patchClearStart"),this.cgl.TextureEffectMesh=null,this.animFrameOps.length=0,this.timer=new _t;this.ops.length>0;)this.deleteOp(this.ops[0].id);this.emitEvent("patchClearEnd")},Mt.getOpClass=function(t){const e=t.split(".");let i=null;try{return 2==e.length?i=window[e[0]][e[1]]:3==e.length?i=window[e[0]][e[1]][e[2]]:4==e.length?i=window[e[0]][e[1]][e[2]][e[3]]:5==e.length?i=window[e[0]][e[1]][e[2]][e[3]][e[4]]:6==e.length?i=window[e[0]][e[1]][e[2]][e[3]][e[4]][e[5]]:7==e.length?i=window[e[0]][e[1]][e[2]][e[3]][e[4]][e[5]][e[6]]:8==e.length?i=window[e[0]][e[1]][e[2]][e[3]][e[4]][e[5]][e[6]][e[7]]:9==e.length?i=window[e[0]][e[1]][e[2]][e[3]][e[4]][e[5]][e[6]][e[7]][e[8]]:10==e.length&&(i=window[e[0]][e[1]][e[2]][e[3]][e[4]][e[5]][e[6]][e[7]][e[8]][e[9]]),i}catch(t){return null}},Mt.prototype.createOp=function(t,e){const i=t.split(".");let s=null,r="";try{if(-1==t.indexOf("Ops.")){const i=t;if(!CABLES.OPS[i])throw new Error("could not find op by id: "+i);r=CABLES.OPS[i].objName,s=new CABLES.OPS[i].f(this,r,e,i),s.opId=i}if(!s){r=t;if(!Mt.getOpClass(r))throw this.emitEvent("criticalError","unknown op","unknown op: "+r),this._log.error("unknown op: "+r),new Error("unknown op: "+r);if(2==i.length?s=new window[i[0]][i[1]](this,r,e):3==i.length?s=new window[i[0]][i[1]][i[2]](this,r,e):4==i.length?s=new window[i[0]][i[1]][i[2]][i[3]](this,r,e):5==i.length?s=new window[i[0]][i[1]][i[2]][i[3]][i[4]](this,r,e):6==i.length?s=new window[i[0]][i[1]][i[2]][i[3]][i[4]][i[5]](this,r,e):7==i.length?s=new window[i[0]][i[1]][i[2]][i[3]][i[4]][i[5]][i[6]](this,r,e):8==i.length?s=new window[i[0]][i[1]][i[2]][i[3]][i[4]][i[5]][i[6]][i[7]](this,r,e):9==i.length?s=new window[i[0]][i[1]][i[2]][i[3]][i[4]][i[5]][i[6]][i[7]][i[8]](this,r,e):10==i.length?s=new window[i[0]][i[1]][i[2]][i[3]][i[4]][i[5]][i[6]][i[7]][i[8]][i[9]](this,r,e):this._log.warn("parts.length",i.length),s){s.opId=null;for(const t in CABLES.OPS)CABLES.OPS[t].objName==r&&(s.opId=t)}}}catch(t){if(this._crashedOps.push(r),this.emitEvent("exceptionOp",t,r,s),!this.isEditorMode())throw this._log.error(t),this._log.error("[instancing error] "+r,t),CABLES.api&&CABLES.api.sendErrorReport(t),this.exitError("INSTANCE_ERR","Instancing Error "+r,t),new Error("instancing error "+r)}return s?(s.objName=r,s.patch=this):this._log.log("no op was created!?",t,e),s},Mt.prototype.addOp=function(t,e,i,s){const r=this.createOp(t,i);if(r){if(e&&e.hasOwnProperty("errors")&&delete e.errors,e&&e.hasOwnProperty("error")&&delete e.error,r.uiAttr(e),r.onCreate&&r.onCreate(),r.hasOwnProperty("onAnimFrame")&&this.addOnAnimFrame(r),r.hasOwnProperty("onMasterVolumeChanged")&&this._volumeListeners.push(r),this._opIdCache[r.id])return void this._log.warn("opid with id "+r.id+" already exists in patch!");this.ops.push(r),this._opIdCache[r.id]=r,this.emitEvent("onOpAdd",r,s),r.init&&r.init()}else this._log.error("addop: no op.....");return r},Mt.prototype.addOnAnimFrame=function(t){for(let e=0;e<this.animFrameOps.length;e++)if(this.animFrameOps[e]==t)return;this.animFrameOps.push(t)},Mt.prototype.removeOnAnimFrame=function(t){for(let e=0;e<this.animFrameOps.length;e++)if(this.animFrameOps[e]==t)return void this.animFrameOps.splice(e,1)},Mt.prototype.addOnAnimFrameCallback=function(t){this.animFrameCallbacks.push(t)},Mt.prototype.removeOnAnimCallback=function(t){for(let e=0;e<this.animFrameCallbacks.length;e++)if(this.animFrameCallbacks[e]==t)return void this.animFrameCallbacks.splice(e,1)},Mt.prototype.deleteOp=function(t,e,i){let s=!1;for(const r in this.ops)if(this.ops[r].id==t){const n=this.ops[r];let o=null,h=null;if(n){s=!0,e&&n.portsIn.length>0&&n.portsIn[0].isLinked()&&n.portsOut.length>0&&n.portsOut[0].isLinked()&&n.portsIn[0].getType()==n.portsOut[0].getType()&&(o=n.portsIn[0].links[0].getOtherPort(n.portsIn[0]),h=n.portsOut[0].links[0].getOtherPort(n.portsOut[0]));const a=this.ops[r];a.removeLinks(),a.emitEvent("onDelete",this.ops[r]),this.onDelete&&(this._log.warn("deprecated this.onDelete",this.onDelete),this.onDelete(a)),this.ops.splice(r,1),this.emitEvent("onOpDelete",a,i),a.onDelete&&a.onDelete(i),a.cleanUp(),null!==o&&null!==h&&this.link(o.parent,o.getName(),h.parent,h.getName()),delete this._opIdCache[t];break}}s||this._log.warn("core patch deleteop: not found...")},Mt.prototype.getFrameNum=function(){return this._frameNum},Mt.prototype.renderFrame=function(t){this.timer.update(),this.freeTimer.update();const e=this.timer.getTime(),i=performance.now();for(let t=0;t<this.animFrameCallbacks.length;++t)this.animFrameCallbacks[t]&&this.animFrameCallbacks[t](e,this._frameNum);for(let t=0;t<this.animFrameOps.length;++t)this.animFrameOps[t].onAnimFrame&&this.animFrameOps[t].onAnimFrame(e);this.cgl.profileData.profileOnAnimFrameOps=performance.now()-i,this.emitEvent("onRenderFrame",e),this._frameNum++,1==this._frameNum&&this.config.onFirstFrameRendered&&this.config.onFirstFrameRendered()},Mt.prototype.exec=function(t){if(!this._renderOneFrame&&(this._paused||this.aborted))return;this.config.fpsLimit=this.config.fpsLimit||0,this.config.fpsLimit&&(this._frameInterval=1e3/this.config.fpsLimit);const e=CABLES.now(),i=e-this._frameNext;if(this.isEditorMode()&&!this._renderOneFrame&&e-this._lastFrameTime>=500&&0!==this._lastFrameTime&&!this._frameWasdelayed)return this._lastFrameTime=0,setTimeout(this.exec.bind(this),500),this.emitEvent("renderDelayStart"),void(this._frameWasdelayed=!0);if(this._renderOneFrame||0===this.config.fpsLimit||i>this._frameInterval||this._frameWasdelayed){const t=CABLES.now();this.renderFrame(),this._perf._lastFrameTime=CABLES.now(),this._perf._fpsFrameCount++,this._perf._fpsMsCount+=CABLES.now()-t,this._frameInterval&&(this._frameNext=e-i%this._frameInterval)}this._frameWasdelayed&&(this.emitEvent("renderDelayEnd"),this._frameWasdelayed=!1),this._renderOneFrame&&(this.onOneFrameRendered&&this.onOneFrameRendered(),this.emitEvent("renderedOneFrame"),this._renderOneFrame=!1),CABLES.now()-this._perf._fpsStart>=1e3&&this._perf.fps!=this._perf._fpsFrameCount&&(this._perf.fps=this._perf._fpsFrameCount,this._perf.ms=Math.round(this._perf._fpsMsCount/this._perf._fpsFrameCount),this.emitEvent("performance",this._perf),this._perf._fpsFrameCount=0,this._perf._fpsMsCount=0,this._perf._fpsStart=CABLES.now()),this.config.doRequestAnimation&&(this._animReq=requestAnimationFrame(this.exec.bind(this)))},Mt.prototype.link=function(t,e,i,s,r,n){if(!t)return void this._log.warn("link: op1 is null ");if(!i)return void this._log.warn("link: op2 is null");const o=t.getPort(e,r),h=i.getPort(s,r);if(o)if(h){if(!o.shouldLink(o,h)||!h.shouldLink(o,h))return!1;if(St.canLink(o,h)){const t=new St(this);return t.link(o,h),this.emitEvent("onLink",o,h,t,n),t}}else this._log.warn("port not found! "+s+" of "+i.name+"("+i.objName+")");else this._log.warn("port not found! "+e+"("+t.objName+")")},Mt.prototype.serialize=function(t){const e={};(t=t||{}).hasOwnProperty("removeBlueprints")||(t.removeBlueprints=!0),t.hasOwnProperty("removeFromNetworkAttr")||(t.removeFromNetworkAttr=!0),e.ops=[],e.settings=this.settings;for(const i in this.ops){const s=this.ops[i];t.removeBlueprints&&s.storage&&s.storage.blueprint||(t.removeFromNetworkAttr&&s.uiAttribs&&s.uiAttribs.hasOwnProperty("fromNetwork")&&delete s.uiAttribs.fromNetwork,e.ops.push(s.getSerialized()))}return t.asObject?e:JSON.stringify(e)},Mt.prototype.getOpById=function(t){return this._opIdCache[t]},Mt.prototype.getOpsByName=function(t){const e=[];for(const i in this.ops)this.ops[i].name==t&&e.push(this.ops[i]);return e},Mt.prototype.getOpsByObjName=function(t){const e=[];for(const i in this.ops)this.ops[i].objName==t&&e.push(this.ops[i]);return e},Mt.prototype.loadLib=function(t){C("/ui/libs/"+t+".js",(t,e)=>{const i=document.createElement("script");i.type="text/javascript",i.text=e,document.getElementsByTagName("head")[0].appendChild(i)},"GET")},Mt.prototype.reloadOp=function(t,e){let i=0;const s=[],r=[];for(const e in this.ops)this.ops[e].objName==t&&r.push(this.ops[e]);for(let e=0;e<r.length;e++){i++;const n=r[e];n.deleted=!0;const o=this,h=this.addOp(t,n.uiAttribs);if(!h)continue;let a,l;for(a in n&&n.storage&&(h.storage=n.storage),s.push(h),n.portsIn)if(0===n.portsIn[a].links.length){const t=h.getPort(n.portsIn[a].name);t?(t.set(n.portsIn[a].get()),n.portsIn[a].getVariableName()&&t.setVariable(n.portsIn[a].getVariableName())):this._log.error("[reloadOp] could not set port "+n.portsIn[a].name+", propably renamed port ?")}else for(;n.portsIn[a].links.length;){const t=n.portsIn[a].links[0].portIn.name,e=n.portsIn[a].links[0].portOut.name,i=n.portsIn[a].links[0].portOut.parent;n.portsIn[a].links[0].remove(),l=o.link(h,t,i,e),l?l.setValue():this._log.warn("[reloadOp] relink after op reload not successfull for port "+e)}for(a in n.portsOut)for(;n.portsOut[a].links.length;){const t=n.portsOut[a].links[0].portOut.name,e=n.portsOut[a].links[0].portIn.name,i=n.portsOut[a].links[0].portIn.parent;n.portsOut[a].links[0].remove(),l=o.link(h,t,i,e),l?l.setValue():this._log.warn("relink after op reload not successfull for port "+e)}this.deleteOp(n.id,!1,!0)}e(i,s)},Mt.prototype.getSubPatchOps=function(t){const e=[];for(const i in this.ops)this.ops[i].uiAttribs&&this.ops[i].uiAttribs.subPatch==t&&e.push(this.ops[i]);return e},Mt.prototype.getSubPatchOp=function(t,e){for(const i in this.ops)if(this.ops[i].uiAttribs&&this.ops[i].uiAttribs.subPatch==t&&this.ops[i].objName==e)return this.ops[i];return!1},Mt.prototype.deSerialize=function(t,e){if(this.aborted)return;const i=[],s=this.loading.start("core","deserialize");this.namespace=t.namespace||"",this.name=t.name||"","string"==typeof t&&(t=JSON.parse(t));const r=this;function n(t,e,i,s){r.link(r.getOpById(t),i,r.getOpById(e),s,!1,!0)}this.settings=t.settings,this.emitEvent("patchLoadStart");for(const s in t.ops){const r=CABLES.now(),n=t.ops[s];let o=null;try{o=n.opId?this.addOp(n.opId,n.uiAttribs,n.id,!0):this.addOp(n.objName,n.uiAttribs,n.id,!0)}catch(t){throw this._log.warn("[instancing error] op data:",n,t),new Error("instancing error: "+n.objName)}if(o){e&&(o.id=T()),o.portsInData=n.portsIn,o._origData=n,o.storage=n.storage;for(const t in n.portsIn){const e=n.portsIn[t],i=o.getPort(e.name);!i||"bool"!=i.uiAttribs.display&&"bool"!=i.uiAttribs.type||isNaN(e.value)||(e.value=!0===e.value),i&&void 0!==e.value&&i.type!=l.OP_PORT_TYPE_TEXTURE&&i.set(e.value),i&&i.deSerializeSettings(e)}for(const e in n.portsOut){const i=o.getPort(n.portsOut[e].name);i&&i.type!=l.OP_PORT_TYPE_TEXTURE&&n.portsOut[e].hasOwnProperty("value")&&i.set(t.ops[s].portsOut[e].value)}i.push(o)}const h=Math.round(100*(CABLES.now()-r))/100;!this.silent&&h>200&&this._log.warn("long op init ",t.ops[s].objName,h)}for(const t in this.ops)this.ops[t].onLoadedValueSet&&(this.ops[t].onLoadedValueSet(this.ops[t]._origData),this.ops[t].onLoadedValueSet=null,this.ops[t]._origData=null);if(t.ops)for(let e=0;e<t.ops.length;e++){if(t.ops[e].portsIn)for(let i=0;i<t.ops[e].portsIn.length;i++)if(t.ops[e].portsIn[i].links)for(let s=0;s<t.ops[e].portsIn[i].links.length;s++)t.ops[e].portsIn[i].links[s]&&n(t.ops[e].portsIn[i].links[s].objIn,t.ops[e].portsIn[i].links[s].objOut,t.ops[e].portsIn[i].links[s].portIn,t.ops[e].portsIn[i].links[s].portOut);if(t.ops[e].portsOut)for(let i=0;i<t.ops[e].portsOut.length;i++)if(t.ops[e].portsOut[i].links)for(let s=0;s<t.ops[e].portsOut[i].links.length;s++)t.ops[e].portsOut[i].links[s]&&n(t.ops[e].portsOut[i].links[s].objIn,t.ops[e].portsOut[i].links[s].objOut,t.ops[e].portsOut[i].links[s].portIn,t.ops[e].portsOut[i].links[s].portOut)}for(const t in this.ops)this.ops[t].onLoaded&&(this.ops[t].onLoaded(),this.ops[t].onLoaded=null);for(const t in this.ops)this.ops[t].init&&(this.ops[t].init(),this.ops[t].init=null);if(this.config.variables)for(const t in this.config.variables)this.setVarValue(t,this.config.variables[t]);for(const t in this.ops)this.ops[t].initVarPorts(),delete this.ops[t].uiAttribs.pasted;setTimeout(()=>{this.loading.finished(s)},100),this.config.onPatchLoaded&&this.config.onPatchLoaded(this),this.emitEvent("patchLoadEnd",i,t,e)},Mt.prototype.profile=function(t){this.profiler=new Ct(this);for(const e in this.ops)this.ops[e].profile(t)},Mt.prototype.setVariable=function(t,e){void 0!==this._variables[t]?this._variables[t].setValue(e):this._log.warn("variable "+t+" not found!")},Mt.prototype._sortVars=function(){if(!this.isEditorMode())return;const t={};Object.keys(this._variables).sort((t,e)=>t.localeCompare(e,"en",{sensitivity:"base"})).forEach(e=>{t[e]=this._variables[e]}),this._variables=t},Mt.prototype.hasVar=function(t){return void 0!==this._variables[t]},Mt.prototype.setVarValue=function(t,e,i){return this.hasVar(t)?this._variables[t].setValue(e):(this._variables[t]=new wt(t,e,i),this._sortVars(),this.emitEvent("variablesChanged")),this._variables[t]},Mt.prototype.getVarValue=function(t,e){if(this._variables.hasOwnProperty(t))return this._variables[t].getValue()},Mt.prototype.getVar=function(t){if(this._variables.hasOwnProperty(t))return this._variables[t]},Mt.prototype.deleteVar=function(t){for(let e=0;e<this.ops.length;e++)for(let i=0;i<this.ops[e].portsIn.length;i++)this.ops[e].portsIn[i].getVariableName()==t&&this.ops[e].portsIn[i].setVariable(null);delete this._variables[t],this.emitEvent("variableDeleted",t),this.emitEvent("variablesChanged")},Mt.prototype.getVars=function(t){if(void 0===t)return this._variables;const e=[];t==CABLES.OP_PORT_TYPE_STRING&&(t="string"),t==CABLES.OP_PORT_TYPE_VALUE&&(t="number"),t==CABLES.OP_PORT_TYPE_ARRAY&&(t="array"),t==CABLES.OP_PORT_TYPE_OBJECT&&(t="object");for(const i in this._variables)this._variables[i].type&&this._variables[i].type!=t||e.push(this._variables[i]);return e},Mt.prototype.exitError=function(t,e,i){if(this.aborted=!0,this&&this.config&&this.config.onError)this.config.onError(t,e);else if(!this.isEditorMode()){const s=document.createElement("div"),r=this.cgl.canvas.getBoundingClientRect();s.setAttribute("style","position:absolute;border:5px solid red;padding:15px;background-color:black;color:white;font-family:monospace;"),s.style.top=r.top+"px",s.style.left=r.left+"px";let n="cables - An error occured:<br/>";n+="["+t+"] - "+e,i&&(n+="<br/>Exception: "+i.message),s.innerHTML=n;const o=this.cgl.canvas.parentElement;for(;o.hasChildNodes();)o.removeChild(o.lastChild);document.body.appendChild(s)}},Mt.prototype.preRenderOps=function(){this._log.log("prerendering...");for(let t=0;t<this.ops.length;t++)this.ops[t].preRender&&(this.ops[t].preRender(),this._log.log("prerender "+this.ops[t].objName))},Mt.prototype.dispose=function(){this.pause(),this.clear()},Mt.prototype.pushTriggerStack=function(t){this._triggerStack.push(t)},Mt.prototype.popTriggerStack=function(){this._triggerStack.pop()},Mt.prototype.printTriggerStack=function(){if(0==this._triggerStack.length)return void console.log("stack length",this._triggerStack.length);console.groupCollapsed("trigger port stack "+this._triggerStack[this._triggerStack.length-1].parent.name+"."+this._triggerStack[this._triggerStack.length-1].name);const t=[];for(let e=0;e<this._triggerStack.length;e++)t.push(e+". "+this._triggerStack[e].parent.name+" "+this._triggerStack[e].name);console.table(t),console.groupEnd()};var Ut=Mt;const Lt={addPatch:function(t,e){let i=t,s=A();if("string"==typeof t&&(s=t,i=document.getElementById(s),!i))return void console.error(s+" Polyshape Container Element not found!");const r=document.createElement("canvas");return r.id="glcanvas_"+s,r.width=i.clientWidth,r.height=i.clientHeight,window.addEventListener("resize",function(){this.setAttribute("width",i.clientWidth),this.height=i.clientHeight}.bind(r)),i.appendChild(r),(e=e||{}).glCanvasId=r.id,e.onError||(e.onError=function(t){console.error(t)}),CABLES.patch=new Ut(e),r}},Bt={toneJsInitialized:!1,createAudioContext:function(t){if(window.AudioContext=window.AudioContext||window.webkitAudioContext,window.AudioContext)return window.audioContext||(window.audioContext=new AudioContext),window.Tone&&!Bt.toneJsInitialized&&(Tone.setContext(window.audioContext),Bt.toneJsInitialized=!0),window.audioContext;t.patch.config.onError("NO_WEBAUDIO","Web Audio is not supported in this browser.")},getAudioContext:function(){return window.audioContext},createAudioInPort:function(t,e,i,s){if(!t||!e||!i){const e="ERROR: createAudioInPort needs three parameters, op, portName and audioNode";throw t.log(e),new Error(e)}s||(s=0),t.webAudio=t.webAudio||{},t.webAudio.audioInPorts=t.webAudio.audioInPorts||[];const r=t.inObject(e);return r.webAudio={},r.webAudio.previousAudioInNode=null,r.webAudio.audioNode=i,t.webAudio.audioInPorts[e]=r,r.onChange=function(){const e=r.get();if(e)try{e.connect?(e.connect(r.webAudio.audioNode,0,s),t.setUiError("audioCtx",null)):t.setUiError("audioCtx","The passed input is not an audio context. Please make sure you connect an audio context to the input.",2)}catch(i){throw t.log("Error: Failed to connect web audio node!",i),t.log("port.webAudio.audioNode",r.webAudio.audioNode),t.log("audioInNode: ",e),t.log("inputChannelIndex:",s),t.log("audioInNode.connect: ",e.connect),i}else if(r.webAudio.previousAudioInNode)try{r.webAudio.previousAudioInNode.disconnect&&r.webAudio.previousAudioInNode.disconnect(r.webAudio.audioNode,0,s),t.setUiError("audioCtx",null)}catch(e){try{r.webAudio.previousAudioInNode.disconnect(r.webAudio.audioNode)}catch(i){throw t.log("Disconnecting audio node with in/out port index, as well as without in/out-port-index did not work ",e),e.printStackTrace&&e.printStackTrace(),e}}r.webAudio.previousAudioInNode=e},r},replaceNodeInPort:function(t,e,i){const s=t.webAudio.previousAudioInNode;if(s&&s.disconnect){try{s.disconnect(e)}catch(t){throw t.printStackTrace&&t.printStackTrace(),new Error("replaceNodeInPort: Could not disconnect old audio node. "+t.name+" "+t.message)}t.webAudio.audioNode=i;try{s.connect(i)}catch(t){throw t.printStackTrace&&t.printStackTrace(),new Error("replaceNodeInPort: Could not connect to new node. "+t.name+" "+t.message)}}},createAudioOutPort:function(t,e,i){if(!t||!e||!i){const e="ERROR: createAudioOutPort needs three parameters, op, portName and audioNode";throw t.log(e),new Error(e)}const s=t.outObject(e);return s.set(i),s},createAudioParamInPort:function(t,e,i,s,r){if(!t||!e||!i)return t.log("ERROR: createAudioParamInPort needs three parameters, op, portName and audioNode"),t&&t.name&&t.log("opname: ",t.name),t.log("portName",e),void t.log("audioNode: ",i);t.webAudio=t.webAudio||{},t.webAudio.audioInPorts=t.webAudio.audioInPorts||[];const n=t.inDynamic(e,[l.OP_PORT_TYPE_VALUE,l.OP_PORT_TYPE_OBJECT],s,r);return n.webAudio={},n.webAudio.previousAudioInNode=null,n.webAudio.audioNode=i,t.webAudio.audioInPorts[e]=n,n.onChange=function(){const e=n.get(),i=n.webAudio.audioNode,s=Bt.getAudioContext();if(null!=e)if("object"==typeof e&&e.connect){try{e.connect(i)}catch(e){throw t.log("Could not connect audio node: ",e),e.printStackTrace&&e.printStackTrace(),e}n.webAudio.previousAudioInNode=e}else{if(i._param&&i._param.minValue&&i._param.maxValue)if(e>=i._param.minValue&&e<=i._param.maxValue)try{i.setValueAtTime?i.setValueAtTime(e,s.currentTime):i.value=e}catch(e){throw t.log("Possible AudioParam problem with tone.js op: ",e),e.printStackTrace&&e.printStackTrace(),e}else t.log("Warning: The value for an audio parameter is out of range!");else if(i.minValue&&i.maxValue)if(e>=i.minValue&&e<=i.maxValue)try{i.setValueAtTime?i.setValueAtTime(e,s.currentTime):i.value=e}catch(e){throw t.log("AudioParam has minValue / maxValue defined, and value is in range, but setting the value failed! ",e),e.printStackTrace&&e.printStackTrace(),e}else t.log("Warning: The value for an audio parameter is out of range!");else try{i.setValueAtTime?i.setValueAtTime(e,s.currentTime):i.value=e}catch(e){throw t.log("Possible AudioParam problem (without minValue / maxValue): ",e),e.printStackTrace&&e.printStackTrace(),e}if(n.webAudio.previousAudioInNode&&n.webAudio.previousAudioInNode.disconnect){try{n.webAudio.previousAudioInNode.disconnect(i)}catch(e){throw t.log("Could not disconnect previous audio node: ",e),e}n.webAudio.previousAudioInNode=void 0}}else n.webAudio.previousAudioInNode},n},loadAudioFile:function(t,e,i,s,r){const n=Bt.createAudioContext();let o=null;(r||void 0===r)&&(o=t.loading.start("audio",e),t.isEditorMode()&&gui.jobs().start({id:"loadaudio"+o,title:" loading audio ("+e+")"}));const h=new XMLHttpRequest;e&&(h.open("GET",e,!0),h.responseType="arraybuffer",h.onload=function(){t.loading.finished(o),t.isEditorMode()&&gui.jobs().finish("loadaudio"+o),n.decodeAudioData(h.response,i,s)},h.send())},isValidToneTime:function(t){try{new Tone.Time(t)}catch(t){return!1}return!0},isValidToneNote:function(t){try{Tone.Frequency(t)}catch(t){return!1}return!0}},kt=function(t,e,i){this._patch=t,this.connector=i,this._log=new h("PatchConnectionReceiver")};kt.prototype._addOp=function(t){let e=null;t.vars.uiAttribs&&(e=t.vars.uiAttribs);const i=this._patch.addOp(t.vars.objName,e,t.vars.opId,!0);i&&(i.id=t.vars.opId,t.vars.portsIn&&t.vars.portsIn.forEach(t=>{const e=i.getPortByName(t.name);e&&e.set(t.value)}))},kt.prototype._receive=function(t){let e={};if(e=t.hasOwnProperty("event")?t:JSON.parse(t.data),e.event==u.PACO_OP_CREATE){if(this._patch.getOpById(e.vars.opId))return;this._log.verbose("op create:",e.vars.objName),window.gui?gui.serverOps.loadOpLibs(e.vars.objName,()=>{this._addOp(e)}):this._addOp(e)}else if(e.event==u.PACO_DESERIALIZE)e.vars.json&&(window.gui?gui.serverOps.loadProjectLibs(e.vars.json,()=>{this._patch.deSerialize(e.vars.json,e.vars.genIds)}):this._patch.deSerialize(e.vars.json,e.vars.genIds));else if(e.event==u.PACO_LOAD)this._log.verbose("PACO load patch....."),this._patch.clear(),window.gui?gui.serverOps.loadProjectLibs(JSON.parse(e.vars.patch),()=>{this._patch.deSerialize(e.vars.patch)}):this._patch.deSerialize(e.vars.patch);else if(e.event==u.PACO_CLEAR)this._patch.clear(),this._log.log("clear");else if(e.event==u.PACO_OP_DELETE){this._log.verbose("op delete",e.vars.objName);this._patch.getOpById(e.vars.op);this._patch.deleteOp(e.vars.op,!0)}else if(e.event==u.PACO_OP_ENABLE){const t=this._patch.getOpById(e.vars.op);t&&(t.enabled=!0)}else if(e.event==u.PACO_OP_DISABLE){const t=this._patch.getOpById(e.vars.op);t&&(t.enabled=!1)}else if(e.event==u.PACO_UIATTRIBS){const t=this._patch.getOpById(e.vars.op);t&&t.setUiAttrib(e.vars.uiAttribs)}else if(e.event==u.PACO_UNLINK){const t=this._patch.getOpById(e.vars.op1),i=this._patch.getOpById(e.vars.op2);if(!t||!i)return;const s=t.getPort(e.vars.port1),r=i.getPort(e.vars.port2);s&&r?s.removeLinkTo(r):this._log.warn("paco unlink could not find port...")}else if(e.event==u.PACO_LINK){const t=this._patch.getOpById(e.vars.op1),i=this._patch.getOpById(e.vars.op2);t&&i&&this._patch.link(t,e.vars.port1,i,e.vars.port2)}else if(e.event==u.PACO_VALUECHANGE){if("+ create new one"===e.vars.v)return;const t=this._patch.getOpById(e.vars.op);if(t){const i=t.getPort(e.vars.port);i&&i.set(e.vars.v)}}else if(e.event==u.PACO_VARIABLES){const t=this._patch.getOpById(e.vars.opId);t&&t.varName&&t.varName.set(e.vars.varName)}else if(e.event==u.PACO_TRIGGERS){const t=this._patch.getOpById(e.vars.opId);t&&t.varName&&t.varName.set(e.vars.varName)}else if(e.event==u.PACO_PORT_SETVARIABLE){const t=this._patch.getOpById(e.vars.opId);if(t){const i=t.getPortByName(e.vars.portName);i&&i.setVariable(e.vars.variableName)}}else if(e.event==u.PACO_PORT_SETANIMATED){const t=this._patch.getOpById(e.vars.opId);if(t){t.portsIn[e.vars.portIndex]&&e.vars.hasOwnProperty("targetState")&&this._patch.emitEvent("pacoPortValueSetAnimated",t,e.vars.portIndex,e.vars.targetState,e.vars.defaultValue)}}else if(e.event==u.PACO_PORT_ANIM_UPDATED){const t=this._patch.getOpById(e.vars.opId);if(t){const i=t.getPortByName(e.vars.portName);if(i){const t=i.getSerialized();t.anim=e.vars.anim,i.anim=null,i.deSerializeSettings(t),this._patch.emitEvent("pacoPortAnimUpdated",i)}}}else this._log.warn("unknown patchConnectionEvent!",t)};const Dt=function(t){this.connectors=[],this.paused=!1,t.addEventListener("onOpDelete",t=>{this.send(CABLES.PACO_OP_DELETE,{op:t.id,objName:t.objName})}),t.addEventListener("patchClearStart",()=>{this.paused=!0}),t.addEventListener("patchClearEnd",()=>{this.paused=!1}),t.addEventListener("patchLoadStart",()=>{this.paused=!0}),t.addEventListener("patchLoadEnd",(t,e,i)=>{this.paused=!1,this.send(CABLES.PACO_DESERIALIZE,{json:e,genIds:i})}),t.addEventListener("onOpAdd",t=>{const e=[];t.portsIn.forEach(t=>{const i={id:t.id,name:t.name,value:t.get()};e.push(i)});let i={};t.uiAttribs&&(i={...t.uiAttribs}),this.send(CABLES.PACO_OP_CREATE,{opId:t.id,objName:t.objName,uiAttribs:i,portsIn:e})}),t.addEventListener("onUnLink",(t,e)=>{this.send(CABLES.PACO_UNLINK,{op1:t.parent.id,op2:e.parent.id,port1:t.getName(),port2:e.getName()})}),t.addEventListener("onUiAttribsChange",(t,e)=>{e&&(delete e.extendTitle,delete e.history,delete e.translate,Object.keys(e).length>0&&this.send(CABLES.PACO_UIATTRIBS,{op:t.id,uiAttribs:e}))}),t.addEventListener("opVariableNameChanged",(t,e)=>{const i={opId:t.id,varName:e};this.send(CABLES.PACO_VARIABLES,i)}),t.addEventListener("opTriggerNameChanged",(t,e)=>{const i={opId:t.id,varName:e};this.send(CABLES.PACO_TRIGGERS,i)}),t.addEventListener("onLink",(t,e)=>{this.send(CABLES.PACO_LINK,{op1:t.parent.id,op2:e.parent.id,port1:t.name,port2:e.name})}),t.addEventListener("portSetVariable",(t,e,i)=>{const s={opId:t.id,portName:e.name,variableName:i};this.send(CABLES.PACO_PORT_SETVARIABLE,s)}),t.addEventListener("portAnimUpdated",(t,e,i)=>{if(t&&e){const s={opId:t.id,portName:e.name,anim:i.getSerialized()};this.send(CABLES.PACO_PORT_ANIM_UPDATED,s)}})};Dt.prototype.send=function(t,e){if(!this.paused&&(t!==CABLES.PACO_VALUECHANGE||"+ create new one"!==e.v))for(let i=0;i<this.connectors.length;i++)this.connectors[i].send(t,e)};const Vt=function(){window.BroadcastChannel&&(this.bc=new BroadcastChannel("test_channel"))};Vt.prototype.receive=function(t){this.bc&&(this._log.log("init"),this.bc.onmessage=t._receive.bind(t))},Vt.prototype.send=function(t,e){if(!this.bc)return;const i={};i.event=t,i.vars=e,this.bc.postMessage(JSON.stringify(i))};const Gt=Object.assign({EventTarget:W,EMBED:Lt,Link:St,Port:et,Op:Pt,Profiler:Ct,Patch:Ut,Instancing:Ft,Timer:_t,WEBAUDIO:Bt,Variable:function(){let t=null;const e=[];this.onChanged=function(t){e.push(t)},this.getValue=function(){return t},this.setValue=function(e){t=e,this.emitChanged()},this.emitChanged=function(){for(let t=0;t<e.length;t++)e[t]()}},LoadingStatus:Nt,now:pt,internalNow:gt},r,s,n,a,o,c,u,a,l);e.default=Gt;(function(){return!this})()||console.warn("not in strict mode: index core")}]).default;
//# sourceMappingURL=cables.min.js.map

var CABLES = CABLES || {}; CABLES.build = {"timestamp":1655965375354,"created":"2022-06-23T06:22:55.354Z","git":{"branch":"master","commit":"a017e1124e10993e96f805145f3c42b3aa81351e","date":"2022-06-23T06:11:00.000Z","message":"Merge remote-tracking branch 'origin/master' into develop"}};
/*!
@fileoverview gl-matrix - High performance matrix and vector operations
@author Brandon Jones
@author Colin MacKenzie IV
@version 3.1.0

Copyright (c) 2015-2019, Brandon Jones, Colin MacKenzie IV.

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.

*/
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((t=t||self).glMatrix={})}(this,function(t){"use strict";var n=1e-6,a="undefined"!=typeof Float32Array?Float32Array:Array,r=Math.random;var u=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=0,n=arguments.length;n--;)t+=arguments[n]*arguments[n];return Math.sqrt(t)});var e=Object.freeze({EPSILON:n,get ARRAY_TYPE(){return a},RANDOM:r,setMatrixArrayType:function(t){a=t},toRadian:function(t){return t*u},equals:function(t,a){return Math.abs(t-a)<=n*Math.max(1,Math.abs(t),Math.abs(a))}});function o(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=a[0],c=a[1],h=a[2],s=a[3];return t[0]=r*i+e*c,t[1]=u*i+o*c,t[2]=r*h+e*s,t[3]=u*h+o*s,t}function i(t,n,a){return t[0]=n[0]-a[0],t[1]=n[1]-a[1],t[2]=n[2]-a[2],t[3]=n[3]-a[3],t}var c=o,h=i,s=Object.freeze({create:function(){var t=new a(4);return a!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},clone:function(t){var n=new a(4);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n},copy:function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},fromValues:function(t,n,r,u){var e=new a(4);return e[0]=t,e[1]=n,e[2]=r,e[3]=u,e},set:function(t,n,a,r,u){return t[0]=n,t[1]=a,t[2]=r,t[3]=u,t},transpose:function(t,n){if(t===n){var a=n[1];t[1]=n[2],t[2]=a}else t[0]=n[0],t[1]=n[2],t[2]=n[1],t[3]=n[3];return t},invert:function(t,n){var a=n[0],r=n[1],u=n[2],e=n[3],o=a*e-u*r;return o?(o=1/o,t[0]=e*o,t[1]=-r*o,t[2]=-u*o,t[3]=a*o,t):null},adjoint:function(t,n){var a=n[0];return t[0]=n[3],t[1]=-n[1],t[2]=-n[2],t[3]=a,t},determinant:function(t){return t[0]*t[3]-t[2]*t[1]},multiply:o,rotate:function(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=Math.sin(a),c=Math.cos(a);return t[0]=r*c+e*i,t[1]=u*c+o*i,t[2]=r*-i+e*c,t[3]=u*-i+o*c,t},scale:function(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=a[0],c=a[1];return t[0]=r*i,t[1]=u*i,t[2]=e*c,t[3]=o*c,t},fromRotation:function(t,n){var a=Math.sin(n),r=Math.cos(n);return t[0]=r,t[1]=a,t[2]=-a,t[3]=r,t},fromScaling:function(t,n){return t[0]=n[0],t[1]=0,t[2]=0,t[3]=n[1],t},str:function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},frob:function(t){return Math.hypot(t[0],t[1],t[2],t[3])},LDU:function(t,n,a,r){return t[2]=r[2]/r[0],a[0]=r[0],a[1]=r[1],a[3]=r[3]-t[2]*a[1],[t,n,a]},add:function(t,n,a){return t[0]=n[0]+a[0],t[1]=n[1]+a[1],t[2]=n[2]+a[2],t[3]=n[3]+a[3],t},subtract:i,exactEquals:function(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]},equals:function(t,a){var r=t[0],u=t[1],e=t[2],o=t[3],i=a[0],c=a[1],h=a[2],s=a[3];return Math.abs(r-i)<=n*Math.max(1,Math.abs(r),Math.abs(i))&&Math.abs(u-c)<=n*Math.max(1,Math.abs(u),Math.abs(c))&&Math.abs(e-h)<=n*Math.max(1,Math.abs(e),Math.abs(h))&&Math.abs(o-s)<=n*Math.max(1,Math.abs(o),Math.abs(s))},multiplyScalar:function(t,n,a){return t[0]=n[0]*a,t[1]=n[1]*a,t[2]=n[2]*a,t[3]=n[3]*a,t},multiplyScalarAndAdd:function(t,n,a,r){return t[0]=n[0]+a[0]*r,t[1]=n[1]+a[1]*r,t[2]=n[2]+a[2]*r,t[3]=n[3]+a[3]*r,t},mul:c,sub:h});function M(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=n[4],c=n[5],h=a[0],s=a[1],M=a[2],f=a[3],l=a[4],v=a[5];return t[0]=r*h+e*s,t[1]=u*h+o*s,t[2]=r*M+e*f,t[3]=u*M+o*f,t[4]=r*l+e*v+i,t[5]=u*l+o*v+c,t}function f(t,n,a){return t[0]=n[0]-a[0],t[1]=n[1]-a[1],t[2]=n[2]-a[2],t[3]=n[3]-a[3],t[4]=n[4]-a[4],t[5]=n[5]-a[5],t}var l=M,v=f,b=Object.freeze({create:function(){var t=new a(6);return a!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t},clone:function(t){var n=new a(6);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n},copy:function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},fromValues:function(t,n,r,u,e,o){var i=new a(6);return i[0]=t,i[1]=n,i[2]=r,i[3]=u,i[4]=e,i[5]=o,i},set:function(t,n,a,r,u,e,o){return t[0]=n,t[1]=a,t[2]=r,t[3]=u,t[4]=e,t[5]=o,t},invert:function(t,n){var a=n[0],r=n[1],u=n[2],e=n[3],o=n[4],i=n[5],c=a*e-r*u;return c?(c=1/c,t[0]=e*c,t[1]=-r*c,t[2]=-u*c,t[3]=a*c,t[4]=(u*i-e*o)*c,t[5]=(r*o-a*i)*c,t):null},determinant:function(t){return t[0]*t[3]-t[1]*t[2]},multiply:M,rotate:function(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=n[4],c=n[5],h=Math.sin(a),s=Math.cos(a);return t[0]=r*s+e*h,t[1]=u*s+o*h,t[2]=r*-h+e*s,t[3]=u*-h+o*s,t[4]=i,t[5]=c,t},scale:function(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=n[4],c=n[5],h=a[0],s=a[1];return t[0]=r*h,t[1]=u*h,t[2]=e*s,t[3]=o*s,t[4]=i,t[5]=c,t},translate:function(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=n[4],c=n[5],h=a[0],s=a[1];return t[0]=r,t[1]=u,t[2]=e,t[3]=o,t[4]=r*h+e*s+i,t[5]=u*h+o*s+c,t},fromRotation:function(t,n){var a=Math.sin(n),r=Math.cos(n);return t[0]=r,t[1]=a,t[2]=-a,t[3]=r,t[4]=0,t[5]=0,t},fromScaling:function(t,n){return t[0]=n[0],t[1]=0,t[2]=0,t[3]=n[1],t[4]=0,t[5]=0,t},fromTranslation:function(t,n){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=n[0],t[5]=n[1],t},str:function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},frob:function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)},add:function(t,n,a){return t[0]=n[0]+a[0],t[1]=n[1]+a[1],t[2]=n[2]+a[2],t[3]=n[3]+a[3],t[4]=n[4]+a[4],t[5]=n[5]+a[5],t},subtract:f,multiplyScalar:function(t,n,a){return t[0]=n[0]*a,t[1]=n[1]*a,t[2]=n[2]*a,t[3]=n[3]*a,t[4]=n[4]*a,t[5]=n[5]*a,t},multiplyScalarAndAdd:function(t,n,a,r){return t[0]=n[0]+a[0]*r,t[1]=n[1]+a[1]*r,t[2]=n[2]+a[2]*r,t[3]=n[3]+a[3]*r,t[4]=n[4]+a[4]*r,t[5]=n[5]+a[5]*r,t},exactEquals:function(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]&&t[4]===n[4]&&t[5]===n[5]},equals:function(t,a){var r=t[0],u=t[1],e=t[2],o=t[3],i=t[4],c=t[5],h=a[0],s=a[1],M=a[2],f=a[3],l=a[4],v=a[5];return Math.abs(r-h)<=n*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(u-s)<=n*Math.max(1,Math.abs(u),Math.abs(s))&&Math.abs(e-M)<=n*Math.max(1,Math.abs(e),Math.abs(M))&&Math.abs(o-f)<=n*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(i-l)<=n*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(c-v)<=n*Math.max(1,Math.abs(c),Math.abs(v))},mul:l,sub:v});function m(){var t=new a(9);return a!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function d(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=n[4],c=n[5],h=n[6],s=n[7],M=n[8],f=a[0],l=a[1],v=a[2],b=a[3],m=a[4],d=a[5],x=a[6],p=a[7],y=a[8];return t[0]=f*r+l*o+v*h,t[1]=f*u+l*i+v*s,t[2]=f*e+l*c+v*M,t[3]=b*r+m*o+d*h,t[4]=b*u+m*i+d*s,t[5]=b*e+m*c+d*M,t[6]=x*r+p*o+y*h,t[7]=x*u+p*i+y*s,t[8]=x*e+p*c+y*M,t}function x(t,n,a){return t[0]=n[0]-a[0],t[1]=n[1]-a[1],t[2]=n[2]-a[2],t[3]=n[3]-a[3],t[4]=n[4]-a[4],t[5]=n[5]-a[5],t[6]=n[6]-a[6],t[7]=n[7]-a[7],t[8]=n[8]-a[8],t}var p=d,y=x,q=Object.freeze({create:m,fromMat4:function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[4],t[4]=n[5],t[5]=n[6],t[6]=n[8],t[7]=n[9],t[8]=n[10],t},clone:function(t){var n=new a(9);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n},copy:function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t},fromValues:function(t,n,r,u,e,o,i,c,h){var s=new a(9);return s[0]=t,s[1]=n,s[2]=r,s[3]=u,s[4]=e,s[5]=o,s[6]=i,s[7]=c,s[8]=h,s},set:function(t,n,a,r,u,e,o,i,c,h){return t[0]=n,t[1]=a,t[2]=r,t[3]=u,t[4]=e,t[5]=o,t[6]=i,t[7]=c,t[8]=h,t},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},transpose:function(t,n){if(t===n){var a=n[1],r=n[2],u=n[5];t[1]=n[3],t[2]=n[6],t[3]=a,t[5]=n[7],t[6]=r,t[7]=u}else t[0]=n[0],t[1]=n[3],t[2]=n[6],t[3]=n[1],t[4]=n[4],t[5]=n[7],t[6]=n[2],t[7]=n[5],t[8]=n[8];return t},invert:function(t,n){var a=n[0],r=n[1],u=n[2],e=n[3],o=n[4],i=n[5],c=n[6],h=n[7],s=n[8],M=s*o-i*h,f=-s*e+i*c,l=h*e-o*c,v=a*M+r*f+u*l;return v?(v=1/v,t[0]=M*v,t[1]=(-s*r+u*h)*v,t[2]=(i*r-u*o)*v,t[3]=f*v,t[4]=(s*a-u*c)*v,t[5]=(-i*a+u*e)*v,t[6]=l*v,t[7]=(-h*a+r*c)*v,t[8]=(o*a-r*e)*v,t):null},adjoint:function(t,n){var a=n[0],r=n[1],u=n[2],e=n[3],o=n[4],i=n[5],c=n[6],h=n[7],s=n[8];return t[0]=o*s-i*h,t[1]=u*h-r*s,t[2]=r*i-u*o,t[3]=i*c-e*s,t[4]=a*s-u*c,t[5]=u*e-a*i,t[6]=e*h-o*c,t[7]=r*c-a*h,t[8]=a*o-r*e,t},determinant:function(t){var n=t[0],a=t[1],r=t[2],u=t[3],e=t[4],o=t[5],i=t[6],c=t[7],h=t[8];return n*(h*e-o*c)+a*(-h*u+o*i)+r*(c*u-e*i)},multiply:d,translate:function(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=n[4],c=n[5],h=n[6],s=n[7],M=n[8],f=a[0],l=a[1];return t[0]=r,t[1]=u,t[2]=e,t[3]=o,t[4]=i,t[5]=c,t[6]=f*r+l*o+h,t[7]=f*u+l*i+s,t[8]=f*e+l*c+M,t},rotate:function(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=n[4],c=n[5],h=n[6],s=n[7],M=n[8],f=Math.sin(a),l=Math.cos(a);return t[0]=l*r+f*o,t[1]=l*u+f*i,t[2]=l*e+f*c,t[3]=l*o-f*r,t[4]=l*i-f*u,t[5]=l*c-f*e,t[6]=h,t[7]=s,t[8]=M,t},scale:function(t,n,a){var r=a[0],u=a[1];return t[0]=r*n[0],t[1]=r*n[1],t[2]=r*n[2],t[3]=u*n[3],t[4]=u*n[4],t[5]=u*n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t},fromTranslation:function(t,n){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=n[0],t[7]=n[1],t[8]=1,t},fromRotation:function(t,n){var a=Math.sin(n),r=Math.cos(n);return t[0]=r,t[1]=a,t[2]=0,t[3]=-a,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},fromScaling:function(t,n){return t[0]=n[0],t[1]=0,t[2]=0,t[3]=0,t[4]=n[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},fromMat2d:function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=0,t[3]=n[2],t[4]=n[3],t[5]=0,t[6]=n[4],t[7]=n[5],t[8]=1,t},fromQuat:function(t,n){var a=n[0],r=n[1],u=n[2],e=n[3],o=a+a,i=r+r,c=u+u,h=a*o,s=r*o,M=r*i,f=u*o,l=u*i,v=u*c,b=e*o,m=e*i,d=e*c;return t[0]=1-M-v,t[3]=s-d,t[6]=f+m,t[1]=s+d,t[4]=1-h-v,t[7]=l-b,t[2]=f-m,t[5]=l+b,t[8]=1-h-M,t},normalFromMat4:function(t,n){var a=n[0],r=n[1],u=n[2],e=n[3],o=n[4],i=n[5],c=n[6],h=n[7],s=n[8],M=n[9],f=n[10],l=n[11],v=n[12],b=n[13],m=n[14],d=n[15],x=a*i-r*o,p=a*c-u*o,y=a*h-e*o,q=r*c-u*i,g=r*h-e*i,A=u*h-e*c,w=s*b-M*v,R=s*m-f*v,z=s*d-l*v,P=M*m-f*b,j=M*d-l*b,I=f*d-l*m,S=x*I-p*j+y*P+q*z-g*R+A*w;return S?(S=1/S,t[0]=(i*I-c*j+h*P)*S,t[1]=(c*z-o*I-h*R)*S,t[2]=(o*j-i*z+h*w)*S,t[3]=(u*j-r*I-e*P)*S,t[4]=(a*I-u*z+e*R)*S,t[5]=(r*z-a*j-e*w)*S,t[6]=(b*A-m*g+d*q)*S,t[7]=(m*y-v*A-d*p)*S,t[8]=(v*g-b*y+d*x)*S,t):null},projection:function(t,n,a){return t[0]=2/n,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/a,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t},str:function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},frob:function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},add:function(t,n,a){return t[0]=n[0]+a[0],t[1]=n[1]+a[1],t[2]=n[2]+a[2],t[3]=n[3]+a[3],t[4]=n[4]+a[4],t[5]=n[5]+a[5],t[6]=n[6]+a[6],t[7]=n[7]+a[7],t[8]=n[8]+a[8],t},subtract:x,multiplyScalar:function(t,n,a){return t[0]=n[0]*a,t[1]=n[1]*a,t[2]=n[2]*a,t[3]=n[3]*a,t[4]=n[4]*a,t[5]=n[5]*a,t[6]=n[6]*a,t[7]=n[7]*a,t[8]=n[8]*a,t},multiplyScalarAndAdd:function(t,n,a,r){return t[0]=n[0]+a[0]*r,t[1]=n[1]+a[1]*r,t[2]=n[2]+a[2]*r,t[3]=n[3]+a[3]*r,t[4]=n[4]+a[4]*r,t[5]=n[5]+a[5]*r,t[6]=n[6]+a[6]*r,t[7]=n[7]+a[7]*r,t[8]=n[8]+a[8]*r,t},exactEquals:function(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]&&t[4]===n[4]&&t[5]===n[5]&&t[6]===n[6]&&t[7]===n[7]&&t[8]===n[8]},equals:function(t,a){var r=t[0],u=t[1],e=t[2],o=t[3],i=t[4],c=t[5],h=t[6],s=t[7],M=t[8],f=a[0],l=a[1],v=a[2],b=a[3],m=a[4],d=a[5],x=a[6],p=a[7],y=a[8];return Math.abs(r-f)<=n*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(u-l)<=n*Math.max(1,Math.abs(u),Math.abs(l))&&Math.abs(e-v)<=n*Math.max(1,Math.abs(e),Math.abs(v))&&Math.abs(o-b)<=n*Math.max(1,Math.abs(o),Math.abs(b))&&Math.abs(i-m)<=n*Math.max(1,Math.abs(i),Math.abs(m))&&Math.abs(c-d)<=n*Math.max(1,Math.abs(c),Math.abs(d))&&Math.abs(h-x)<=n*Math.max(1,Math.abs(h),Math.abs(x))&&Math.abs(s-p)<=n*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(M-y)<=n*Math.max(1,Math.abs(M),Math.abs(y))},mul:p,sub:y});function g(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function A(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=n[4],c=n[5],h=n[6],s=n[7],M=n[8],f=n[9],l=n[10],v=n[11],b=n[12],m=n[13],d=n[14],x=n[15],p=a[0],y=a[1],q=a[2],g=a[3];return t[0]=p*r+y*i+q*M+g*b,t[1]=p*u+y*c+q*f+g*m,t[2]=p*e+y*h+q*l+g*d,t[3]=p*o+y*s+q*v+g*x,p=a[4],y=a[5],q=a[6],g=a[7],t[4]=p*r+y*i+q*M+g*b,t[5]=p*u+y*c+q*f+g*m,t[6]=p*e+y*h+q*l+g*d,t[7]=p*o+y*s+q*v+g*x,p=a[8],y=a[9],q=a[10],g=a[11],t[8]=p*r+y*i+q*M+g*b,t[9]=p*u+y*c+q*f+g*m,t[10]=p*e+y*h+q*l+g*d,t[11]=p*o+y*s+q*v+g*x,p=a[12],y=a[13],q=a[14],g=a[15],t[12]=p*r+y*i+q*M+g*b,t[13]=p*u+y*c+q*f+g*m,t[14]=p*e+y*h+q*l+g*d,t[15]=p*o+y*s+q*v+g*x,t}function w(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=r+r,c=u+u,h=e+e,s=r*i,M=r*c,f=r*h,l=u*c,v=u*h,b=e*h,m=o*i,d=o*c,x=o*h;return t[0]=1-(l+b),t[1]=M+x,t[2]=f-d,t[3]=0,t[4]=M-x,t[5]=1-(s+b),t[6]=v+m,t[7]=0,t[8]=f+d,t[9]=v-m,t[10]=1-(s+l),t[11]=0,t[12]=a[0],t[13]=a[1],t[14]=a[2],t[15]=1,t}function R(t,n){return t[0]=n[12],t[1]=n[13],t[2]=n[14],t}function z(t,n){var a=n[0],r=n[1],u=n[2],e=n[4],o=n[5],i=n[6],c=n[8],h=n[9],s=n[10];return t[0]=Math.hypot(a,r,u),t[1]=Math.hypot(e,o,i),t[2]=Math.hypot(c,h,s),t}function P(t,n){var r=new a(3);z(r,n);var u=1/r[0],e=1/r[1],o=1/r[2],i=n[0]*u,c=n[1]*e,h=n[2]*o,s=n[4]*u,M=n[5]*e,f=n[6]*o,l=n[8]*u,v=n[9]*e,b=n[10]*o,m=i+M+b,d=0;return m>0?(d=2*Math.sqrt(m+1),t[3]=.25*d,t[0]=(f-v)/d,t[1]=(l-h)/d,t[2]=(c-s)/d):i>M&&i>b?(d=2*Math.sqrt(1+i-M-b),t[3]=(f-v)/d,t[0]=.25*d,t[1]=(c+s)/d,t[2]=(l+h)/d):M>b?(d=2*Math.sqrt(1+M-i-b),t[3]=(l-h)/d,t[0]=(c+s)/d,t[1]=.25*d,t[2]=(f+v)/d):(d=2*Math.sqrt(1+b-i-M),t[3]=(c-s)/d,t[0]=(l+h)/d,t[1]=(f+v)/d,t[2]=.25*d),t}function j(t,n,a){return t[0]=n[0]-a[0],t[1]=n[1]-a[1],t[2]=n[2]-a[2],t[3]=n[3]-a[3],t[4]=n[4]-a[4],t[5]=n[5]-a[5],t[6]=n[6]-a[6],t[7]=n[7]-a[7],t[8]=n[8]-a[8],t[9]=n[9]-a[9],t[10]=n[10]-a[10],t[11]=n[11]-a[11],t[12]=n[12]-a[12],t[13]=n[13]-a[13],t[14]=n[14]-a[14],t[15]=n[15]-a[15],t}var I=A,S=j,E=Object.freeze({create:function(){var t=new a(16);return a!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},clone:function(t){var n=new a(16);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},copy:function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t},fromValues:function(t,n,r,u,e,o,i,c,h,s,M,f,l,v,b,m){var d=new a(16);return d[0]=t,d[1]=n,d[2]=r,d[3]=u,d[4]=e,d[5]=o,d[6]=i,d[7]=c,d[8]=h,d[9]=s,d[10]=M,d[11]=f,d[12]=l,d[13]=v,d[14]=b,d[15]=m,d},set:function(t,n,a,r,u,e,o,i,c,h,s,M,f,l,v,b,m){return t[0]=n,t[1]=a,t[2]=r,t[3]=u,t[4]=e,t[5]=o,t[6]=i,t[7]=c,t[8]=h,t[9]=s,t[10]=M,t[11]=f,t[12]=l,t[13]=v,t[14]=b,t[15]=m,t},identity:g,transpose:function(t,n){if(t===n){var a=n[1],r=n[2],u=n[3],e=n[6],o=n[7],i=n[11];t[1]=n[4],t[2]=n[8],t[3]=n[12],t[4]=a,t[6]=n[9],t[7]=n[13],t[8]=r,t[9]=e,t[11]=n[14],t[12]=u,t[13]=o,t[14]=i}else t[0]=n[0],t[1]=n[4],t[2]=n[8],t[3]=n[12],t[4]=n[1],t[5]=n[5],t[6]=n[9],t[7]=n[13],t[8]=n[2],t[9]=n[6],t[10]=n[10],t[11]=n[14],t[12]=n[3],t[13]=n[7],t[14]=n[11],t[15]=n[15];return t},invert:function(t,n){var a=n[0],r=n[1],u=n[2],e=n[3],o=n[4],i=n[5],c=n[6],h=n[7],s=n[8],M=n[9],f=n[10],l=n[11],v=n[12],b=n[13],m=n[14],d=n[15],x=a*i-r*o,p=a*c-u*o,y=a*h-e*o,q=r*c-u*i,g=r*h-e*i,A=u*h-e*c,w=s*b-M*v,R=s*m-f*v,z=s*d-l*v,P=M*m-f*b,j=M*d-l*b,I=f*d-l*m,S=x*I-p*j+y*P+q*z-g*R+A*w;return S?(S=1/S,t[0]=(i*I-c*j+h*P)*S,t[1]=(u*j-r*I-e*P)*S,t[2]=(b*A-m*g+d*q)*S,t[3]=(f*g-M*A-l*q)*S,t[4]=(c*z-o*I-h*R)*S,t[5]=(a*I-u*z+e*R)*S,t[6]=(m*y-v*A-d*p)*S,t[7]=(s*A-f*y+l*p)*S,t[8]=(o*j-i*z+h*w)*S,t[9]=(r*z-a*j-e*w)*S,t[10]=(v*g-b*y+d*x)*S,t[11]=(M*y-s*g-l*x)*S,t[12]=(i*R-o*P-c*w)*S,t[13]=(a*P-r*R+u*w)*S,t[14]=(b*p-v*q-m*x)*S,t[15]=(s*q-M*p+f*x)*S,t):null},adjoint:function(t,n){var a=n[0],r=n[1],u=n[2],e=n[3],o=n[4],i=n[5],c=n[6],h=n[7],s=n[8],M=n[9],f=n[10],l=n[11],v=n[12],b=n[13],m=n[14],d=n[15];return t[0]=i*(f*d-l*m)-M*(c*d-h*m)+b*(c*l-h*f),t[1]=-(r*(f*d-l*m)-M*(u*d-e*m)+b*(u*l-e*f)),t[2]=r*(c*d-h*m)-i*(u*d-e*m)+b*(u*h-e*c),t[3]=-(r*(c*l-h*f)-i*(u*l-e*f)+M*(u*h-e*c)),t[4]=-(o*(f*d-l*m)-s*(c*d-h*m)+v*(c*l-h*f)),t[5]=a*(f*d-l*m)-s*(u*d-e*m)+v*(u*l-e*f),t[6]=-(a*(c*d-h*m)-o*(u*d-e*m)+v*(u*h-e*c)),t[7]=a*(c*l-h*f)-o*(u*l-e*f)+s*(u*h-e*c),t[8]=o*(M*d-l*b)-s*(i*d-h*b)+v*(i*l-h*M),t[9]=-(a*(M*d-l*b)-s*(r*d-e*b)+v*(r*l-e*M)),t[10]=a*(i*d-h*b)-o*(r*d-e*b)+v*(r*h-e*i),t[11]=-(a*(i*l-h*M)-o*(r*l-e*M)+s*(r*h-e*i)),t[12]=-(o*(M*m-f*b)-s*(i*m-c*b)+v*(i*f-c*M)),t[13]=a*(M*m-f*b)-s*(r*m-u*b)+v*(r*f-u*M),t[14]=-(a*(i*m-c*b)-o*(r*m-u*b)+v*(r*c-u*i)),t[15]=a*(i*f-c*M)-o*(r*f-u*M)+s*(r*c-u*i),t},determinant:function(t){var n=t[0],a=t[1],r=t[2],u=t[3],e=t[4],o=t[5],i=t[6],c=t[7],h=t[8],s=t[9],M=t[10],f=t[11],l=t[12],v=t[13],b=t[14],m=t[15];return(n*o-a*e)*(M*m-f*b)-(n*i-r*e)*(s*m-f*v)+(n*c-u*e)*(s*b-M*v)+(a*i-r*o)*(h*m-f*l)-(a*c-u*o)*(h*b-M*l)+(r*c-u*i)*(h*v-s*l)},multiply:A,translate:function(t,n,a){var r,u,e,o,i,c,h,s,M,f,l,v,b=a[0],m=a[1],d=a[2];return n===t?(t[12]=n[0]*b+n[4]*m+n[8]*d+n[12],t[13]=n[1]*b+n[5]*m+n[9]*d+n[13],t[14]=n[2]*b+n[6]*m+n[10]*d+n[14],t[15]=n[3]*b+n[7]*m+n[11]*d+n[15]):(r=n[0],u=n[1],e=n[2],o=n[3],i=n[4],c=n[5],h=n[6],s=n[7],M=n[8],f=n[9],l=n[10],v=n[11],t[0]=r,t[1]=u,t[2]=e,t[3]=o,t[4]=i,t[5]=c,t[6]=h,t[7]=s,t[8]=M,t[9]=f,t[10]=l,t[11]=v,t[12]=r*b+i*m+M*d+n[12],t[13]=u*b+c*m+f*d+n[13],t[14]=e*b+h*m+l*d+n[14],t[15]=o*b+s*m+v*d+n[15]),t},scale:function(t,n,a){var r=a[0],u=a[1],e=a[2];return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=n[3]*r,t[4]=n[4]*u,t[5]=n[5]*u,t[6]=n[6]*u,t[7]=n[7]*u,t[8]=n[8]*e,t[9]=n[9]*e,t[10]=n[10]*e,t[11]=n[11]*e,t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t},rotate:function(t,a,r,u){var e,o,i,c,h,s,M,f,l,v,b,m,d,x,p,y,q,g,A,w,R,z,P,j,I=u[0],S=u[1],E=u[2],O=Math.hypot(I,S,E);return O<n?null:(I*=O=1/O,S*=O,E*=O,e=Math.sin(r),i=1-(o=Math.cos(r)),c=a[0],h=a[1],s=a[2],M=a[3],f=a[4],l=a[5],v=a[6],b=a[7],m=a[8],d=a[9],x=a[10],p=a[11],y=I*I*i+o,q=S*I*i+E*e,g=E*I*i-S*e,A=I*S*i-E*e,w=S*S*i+o,R=E*S*i+I*e,z=I*E*i+S*e,P=S*E*i-I*e,j=E*E*i+o,t[0]=c*y+f*q+m*g,t[1]=h*y+l*q+d*g,t[2]=s*y+v*q+x*g,t[3]=M*y+b*q+p*g,t[4]=c*A+f*w+m*R,t[5]=h*A+l*w+d*R,t[6]=s*A+v*w+x*R,t[7]=M*A+b*w+p*R,t[8]=c*z+f*P+m*j,t[9]=h*z+l*P+d*j,t[10]=s*z+v*P+x*j,t[11]=M*z+b*P+p*j,a!==t&&(t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15]),t)},rotateX:function(t,n,a){var r=Math.sin(a),u=Math.cos(a),e=n[4],o=n[5],i=n[6],c=n[7],h=n[8],s=n[9],M=n[10],f=n[11];return n!==t&&(t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t[4]=e*u+h*r,t[5]=o*u+s*r,t[6]=i*u+M*r,t[7]=c*u+f*r,t[8]=h*u-e*r,t[9]=s*u-o*r,t[10]=M*u-i*r,t[11]=f*u-c*r,t},rotateY:function(t,n,a){var r=Math.sin(a),u=Math.cos(a),e=n[0],o=n[1],i=n[2],c=n[3],h=n[8],s=n[9],M=n[10],f=n[11];return n!==t&&(t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t[0]=e*u-h*r,t[1]=o*u-s*r,t[2]=i*u-M*r,t[3]=c*u-f*r,t[8]=e*r+h*u,t[9]=o*r+s*u,t[10]=i*r+M*u,t[11]=c*r+f*u,t},rotateZ:function(t,n,a){var r=Math.sin(a),u=Math.cos(a),e=n[0],o=n[1],i=n[2],c=n[3],h=n[4],s=n[5],M=n[6],f=n[7];return n!==t&&(t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t[0]=e*u+h*r,t[1]=o*u+s*r,t[2]=i*u+M*r,t[3]=c*u+f*r,t[4]=h*u-e*r,t[5]=s*u-o*r,t[6]=M*u-i*r,t[7]=f*u-c*r,t},fromTranslation:function(t,n){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t},fromScaling:function(t,n){return t[0]=n[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=n[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},fromRotation:function(t,a,r){var u,e,o,i=r[0],c=r[1],h=r[2],s=Math.hypot(i,c,h);return s<n?null:(i*=s=1/s,c*=s,h*=s,u=Math.sin(a),o=1-(e=Math.cos(a)),t[0]=i*i*o+e,t[1]=c*i*o+h*u,t[2]=h*i*o-c*u,t[3]=0,t[4]=i*c*o-h*u,t[5]=c*c*o+e,t[6]=h*c*o+i*u,t[7]=0,t[8]=i*h*o+c*u,t[9]=c*h*o-i*u,t[10]=h*h*o+e,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},fromXRotation:function(t,n){var a=Math.sin(n),r=Math.cos(n);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=a,t[7]=0,t[8]=0,t[9]=-a,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},fromYRotation:function(t,n){var a=Math.sin(n),r=Math.cos(n);return t[0]=r,t[1]=0,t[2]=-a,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=a,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},fromZRotation:function(t,n){var a=Math.sin(n),r=Math.cos(n);return t[0]=r,t[1]=a,t[2]=0,t[3]=0,t[4]=-a,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},fromRotationTranslation:w,fromQuat2:function(t,n){var r=new a(3),u=-n[0],e=-n[1],o=-n[2],i=n[3],c=n[4],h=n[5],s=n[6],M=n[7],f=u*u+e*e+o*o+i*i;return f>0?(r[0]=2*(c*i+M*u+h*o-s*e)/f,r[1]=2*(h*i+M*e+s*u-c*o)/f,r[2]=2*(s*i+M*o+c*e-h*u)/f):(r[0]=2*(c*i+M*u+h*o-s*e),r[1]=2*(h*i+M*e+s*u-c*o),r[2]=2*(s*i+M*o+c*e-h*u)),w(t,n,r),t},getTranslation:R,getScaling:z,getRotation:P,fromRotationTranslationScale:function(t,n,a,r){var u=n[0],e=n[1],o=n[2],i=n[3],c=u+u,h=e+e,s=o+o,M=u*c,f=u*h,l=u*s,v=e*h,b=e*s,m=o*s,d=i*c,x=i*h,p=i*s,y=r[0],q=r[1],g=r[2];return t[0]=(1-(v+m))*y,t[1]=(f+p)*y,t[2]=(l-x)*y,t[3]=0,t[4]=(f-p)*q,t[5]=(1-(M+m))*q,t[6]=(b+d)*q,t[7]=0,t[8]=(l+x)*g,t[9]=(b-d)*g,t[10]=(1-(M+v))*g,t[11]=0,t[12]=a[0],t[13]=a[1],t[14]=a[2],t[15]=1,t},fromRotationTranslationScaleOrigin:function(t,n,a,r,u){var e=n[0],o=n[1],i=n[2],c=n[3],h=e+e,s=o+o,M=i+i,f=e*h,l=e*s,v=e*M,b=o*s,m=o*M,d=i*M,x=c*h,p=c*s,y=c*M,q=r[0],g=r[1],A=r[2],w=u[0],R=u[1],z=u[2],P=(1-(b+d))*q,j=(l+y)*q,I=(v-p)*q,S=(l-y)*g,E=(1-(f+d))*g,O=(m+x)*g,T=(v+p)*A,D=(m-x)*A,F=(1-(f+b))*A;return t[0]=P,t[1]=j,t[2]=I,t[3]=0,t[4]=S,t[5]=E,t[6]=O,t[7]=0,t[8]=T,t[9]=D,t[10]=F,t[11]=0,t[12]=a[0]+w-(P*w+S*R+T*z),t[13]=a[1]+R-(j*w+E*R+D*z),t[14]=a[2]+z-(I*w+O*R+F*z),t[15]=1,t},fromQuat:function(t,n){var a=n[0],r=n[1],u=n[2],e=n[3],o=a+a,i=r+r,c=u+u,h=a*o,s=r*o,M=r*i,f=u*o,l=u*i,v=u*c,b=e*o,m=e*i,d=e*c;return t[0]=1-M-v,t[1]=s+d,t[2]=f-m,t[3]=0,t[4]=s-d,t[5]=1-h-v,t[6]=l+b,t[7]=0,t[8]=f+m,t[9]=l-b,t[10]=1-h-M,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},frustum:function(t,n,a,r,u,e,o){var i=1/(a-n),c=1/(u-r),h=1/(e-o);return t[0]=2*e*i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*e*c,t[6]=0,t[7]=0,t[8]=(a+n)*i,t[9]=(u+r)*c,t[10]=(o+e)*h,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*e*2*h,t[15]=0,t},perspective:function(t,n,a,r,u){var e,o=1/Math.tan(n/2);return t[0]=o/a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=u&&u!==1/0?(e=1/(r-u),t[10]=(u+r)*e,t[14]=2*u*r*e):(t[10]=-1,t[14]=-2*r),t},perspectiveFromFieldOfView:function(t,n,a,r){var u=Math.tan(n.upDegrees*Math.PI/180),e=Math.tan(n.downDegrees*Math.PI/180),o=Math.tan(n.leftDegrees*Math.PI/180),i=Math.tan(n.rightDegrees*Math.PI/180),c=2/(o+i),h=2/(u+e);return t[0]=c,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=h,t[6]=0,t[7]=0,t[8]=-(o-i)*c*.5,t[9]=(u-e)*h*.5,t[10]=r/(a-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*a/(a-r),t[15]=0,t},ortho:function(t,n,a,r,u,e,o){var i=1/(n-a),c=1/(r-u),h=1/(e-o);return t[0]=-2*i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*h,t[11]=0,t[12]=(n+a)*i,t[13]=(u+r)*c,t[14]=(o+e)*h,t[15]=1,t},lookAt:function(t,a,r,u){var e,o,i,c,h,s,M,f,l,v,b=a[0],m=a[1],d=a[2],x=u[0],p=u[1],y=u[2],q=r[0],A=r[1],w=r[2];return Math.abs(b-q)<n&&Math.abs(m-A)<n&&Math.abs(d-w)<n?g(t):(M=b-q,f=m-A,l=d-w,e=p*(l*=v=1/Math.hypot(M,f,l))-y*(f*=v),o=y*(M*=v)-x*l,i=x*f-p*M,(v=Math.hypot(e,o,i))?(e*=v=1/v,o*=v,i*=v):(e=0,o=0,i=0),c=f*i-l*o,h=l*e-M*i,s=M*o-f*e,(v=Math.hypot(c,h,s))?(c*=v=1/v,h*=v,s*=v):(c=0,h=0,s=0),t[0]=e,t[1]=c,t[2]=M,t[3]=0,t[4]=o,t[5]=h,t[6]=f,t[7]=0,t[8]=i,t[9]=s,t[10]=l,t[11]=0,t[12]=-(e*b+o*m+i*d),t[13]=-(c*b+h*m+s*d),t[14]=-(M*b+f*m+l*d),t[15]=1,t)},targetTo:function(t,n,a,r){var u=n[0],e=n[1],o=n[2],i=r[0],c=r[1],h=r[2],s=u-a[0],M=e-a[1],f=o-a[2],l=s*s+M*M+f*f;l>0&&(s*=l=1/Math.sqrt(l),M*=l,f*=l);var v=c*f-h*M,b=h*s-i*f,m=i*M-c*s;return(l=v*v+b*b+m*m)>0&&(v*=l=1/Math.sqrt(l),b*=l,m*=l),t[0]=v,t[1]=b,t[2]=m,t[3]=0,t[4]=M*m-f*b,t[5]=f*v-s*m,t[6]=s*b-M*v,t[7]=0,t[8]=s,t[9]=M,t[10]=f,t[11]=0,t[12]=u,t[13]=e,t[14]=o,t[15]=1,t},str:function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},frob:function(t){return Math.hypot(t[0],t[1],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},add:function(t,n,a){return t[0]=n[0]+a[0],t[1]=n[1]+a[1],t[2]=n[2]+a[2],t[3]=n[3]+a[3],t[4]=n[4]+a[4],t[5]=n[5]+a[5],t[6]=n[6]+a[6],t[7]=n[7]+a[7],t[8]=n[8]+a[8],t[9]=n[9]+a[9],t[10]=n[10]+a[10],t[11]=n[11]+a[11],t[12]=n[12]+a[12],t[13]=n[13]+a[13],t[14]=n[14]+a[14],t[15]=n[15]+a[15],t},subtract:j,multiplyScalar:function(t,n,a){return t[0]=n[0]*a,t[1]=n[1]*a,t[2]=n[2]*a,t[3]=n[3]*a,t[4]=n[4]*a,t[5]=n[5]*a,t[6]=n[6]*a,t[7]=n[7]*a,t[8]=n[8]*a,t[9]=n[9]*a,t[10]=n[10]*a,t[11]=n[11]*a,t[12]=n[12]*a,t[13]=n[13]*a,t[14]=n[14]*a,t[15]=n[15]*a,t},multiplyScalarAndAdd:function(t,n,a,r){return t[0]=n[0]+a[0]*r,t[1]=n[1]+a[1]*r,t[2]=n[2]+a[2]*r,t[3]=n[3]+a[3]*r,t[4]=n[4]+a[4]*r,t[5]=n[5]+a[5]*r,t[6]=n[6]+a[6]*r,t[7]=n[7]+a[7]*r,t[8]=n[8]+a[8]*r,t[9]=n[9]+a[9]*r,t[10]=n[10]+a[10]*r,t[11]=n[11]+a[11]*r,t[12]=n[12]+a[12]*r,t[13]=n[13]+a[13]*r,t[14]=n[14]+a[14]*r,t[15]=n[15]+a[15]*r,t},exactEquals:function(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]&&t[4]===n[4]&&t[5]===n[5]&&t[6]===n[6]&&t[7]===n[7]&&t[8]===n[8]&&t[9]===n[9]&&t[10]===n[10]&&t[11]===n[11]&&t[12]===n[12]&&t[13]===n[13]&&t[14]===n[14]&&t[15]===n[15]},equals:function(t,a){var r=t[0],u=t[1],e=t[2],o=t[3],i=t[4],c=t[5],h=t[6],s=t[7],M=t[8],f=t[9],l=t[10],v=t[11],b=t[12],m=t[13],d=t[14],x=t[15],p=a[0],y=a[1],q=a[2],g=a[3],A=a[4],w=a[5],R=a[6],z=a[7],P=a[8],j=a[9],I=a[10],S=a[11],E=a[12],O=a[13],T=a[14],D=a[15];return Math.abs(r-p)<=n*Math.max(1,Math.abs(r),Math.abs(p))&&Math.abs(u-y)<=n*Math.max(1,Math.abs(u),Math.abs(y))&&Math.abs(e-q)<=n*Math.max(1,Math.abs(e),Math.abs(q))&&Math.abs(o-g)<=n*Math.max(1,Math.abs(o),Math.abs(g))&&Math.abs(i-A)<=n*Math.max(1,Math.abs(i),Math.abs(A))&&Math.abs(c-w)<=n*Math.max(1,Math.abs(c),Math.abs(w))&&Math.abs(h-R)<=n*Math.max(1,Math.abs(h),Math.abs(R))&&Math.abs(s-z)<=n*Math.max(1,Math.abs(s),Math.abs(z))&&Math.abs(M-P)<=n*Math.max(1,Math.abs(M),Math.abs(P))&&Math.abs(f-j)<=n*Math.max(1,Math.abs(f),Math.abs(j))&&Math.abs(l-I)<=n*Math.max(1,Math.abs(l),Math.abs(I))&&Math.abs(v-S)<=n*Math.max(1,Math.abs(v),Math.abs(S))&&Math.abs(b-E)<=n*Math.max(1,Math.abs(b),Math.abs(E))&&Math.abs(m-O)<=n*Math.max(1,Math.abs(m),Math.abs(O))&&Math.abs(d-T)<=n*Math.max(1,Math.abs(d),Math.abs(T))&&Math.abs(x-D)<=n*Math.max(1,Math.abs(x),Math.abs(D))},mul:I,sub:S});function O(){var t=new a(3);return a!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function T(t){var n=t[0],a=t[1],r=t[2];return Math.hypot(n,a,r)}function D(t,n,r){var u=new a(3);return u[0]=t,u[1]=n,u[2]=r,u}function F(t,n,a){return t[0]=n[0]-a[0],t[1]=n[1]-a[1],t[2]=n[2]-a[2],t}function L(t,n,a){return t[0]=n[0]*a[0],t[1]=n[1]*a[1],t[2]=n[2]*a[2],t}function V(t,n,a){return t[0]=n[0]/a[0],t[1]=n[1]/a[1],t[2]=n[2]/a[2],t}function Q(t,n){var a=n[0]-t[0],r=n[1]-t[1],u=n[2]-t[2];return Math.hypot(a,r,u)}function Y(t,n){var a=n[0]-t[0],r=n[1]-t[1],u=n[2]-t[2];return a*a+r*r+u*u}function X(t){var n=t[0],a=t[1],r=t[2];return n*n+a*a+r*r}function Z(t,n){var a=n[0],r=n[1],u=n[2],e=a*a+r*r+u*u;return e>0&&(e=1/Math.sqrt(e)),t[0]=n[0]*e,t[1]=n[1]*e,t[2]=n[2]*e,t}function _(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]}function B(t,n,a){var r=n[0],u=n[1],e=n[2],o=a[0],i=a[1],c=a[2];return t[0]=u*c-e*i,t[1]=e*o-r*c,t[2]=r*i-u*o,t}var N,k=F,U=L,W=V,C=Q,G=Y,H=T,J=X,K=(N=O(),function(t,n,a,r,u,e){var o,i;for(n||(n=3),a||(a=0),i=r?Math.min(r*n+a,t.length):t.length,o=a;o<i;o+=n)N[0]=t[o],N[1]=t[o+1],N[2]=t[o+2],u(N,N,e),t[o]=N[0],t[o+1]=N[1],t[o+2]=N[2];return t}),$=Object.freeze({create:O,clone:function(t){var n=new a(3);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n},length:T,fromValues:D,copy:function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t},set:function(t,n,a,r){return t[0]=n,t[1]=a,t[2]=r,t},add:function(t,n,a){return t[0]=n[0]+a[0],t[1]=n[1]+a[1],t[2]=n[2]+a[2],t},subtract:F,multiply:L,divide:V,ceil:function(t,n){return t[0]=Math.ceil(n[0]),t[1]=Math.ceil(n[1]),t[2]=Math.ceil(n[2]),t},floor:function(t,n){return t[0]=Math.floor(n[0]),t[1]=Math.floor(n[1]),t[2]=Math.floor(n[2]),t},min:function(t,n,a){return t[0]=Math.min(n[0],a[0]),t[1]=Math.min(n[1],a[1]),t[2]=Math.min(n[2],a[2]),t},max:function(t,n,a){return t[0]=Math.max(n[0],a[0]),t[1]=Math.max(n[1],a[1]),t[2]=Math.max(n[2],a[2]),t},round:function(t,n){return t[0]=Math.round(n[0]),t[1]=Math.round(n[1]),t[2]=Math.round(n[2]),t},scale:function(t,n,a){return t[0]=n[0]*a,t[1]=n[1]*a,t[2]=n[2]*a,t},scaleAndAdd:function(t,n,a,r){return t[0]=n[0]+a[0]*r,t[1]=n[1]+a[1]*r,t[2]=n[2]+a[2]*r,t},distance:Q,squaredDistance:Y,squaredLength:X,negate:function(t,n){return t[0]=-n[0],t[1]=-n[1],t[2]=-n[2],t},inverse:function(t,n){return t[0]=1/n[0],t[1]=1/n[1],t[2]=1/n[2],t},normalize:Z,dot:_,cross:B,lerp:function(t,n,a,r){var u=n[0],e=n[1],o=n[2];return t[0]=u+r*(a[0]-u),t[1]=e+r*(a[1]-e),t[2]=o+r*(a[2]-o),t},hermite:function(t,n,a,r,u,e){var o=e*e,i=o*(2*e-3)+1,c=o*(e-2)+e,h=o*(e-1),s=o*(3-2*e);return t[0]=n[0]*i+a[0]*c+r[0]*h+u[0]*s,t[1]=n[1]*i+a[1]*c+r[1]*h+u[1]*s,t[2]=n[2]*i+a[2]*c+r[2]*h+u[2]*s,t},bezier:function(t,n,a,r,u,e){var o=1-e,i=o*o,c=e*e,h=i*o,s=3*e*i,M=3*c*o,f=c*e;return t[0]=n[0]*h+a[0]*s+r[0]*M+u[0]*f,t[1]=n[1]*h+a[1]*s+r[1]*M+u[1]*f,t[2]=n[2]*h+a[2]*s+r[2]*M+u[2]*f,t},random:function(t,n){n=n||1;var a=2*r()*Math.PI,u=2*r()-1,e=Math.sqrt(1-u*u)*n;return t[0]=Math.cos(a)*e,t[1]=Math.sin(a)*e,t[2]=u*n,t},transformMat4:function(t,n,a){var r=n[0],u=n[1],e=n[2],o=a[3]*r+a[7]*u+a[11]*e+a[15];return o=o||1,t[0]=(a[0]*r+a[4]*u+a[8]*e+a[12])/o,t[1]=(a[1]*r+a[5]*u+a[9]*e+a[13])/o,t[2]=(a[2]*r+a[6]*u+a[10]*e+a[14])/o,t},transformMat3:function(t,n,a){var r=n[0],u=n[1],e=n[2];return t[0]=r*a[0]+u*a[3]+e*a[6],t[1]=r*a[1]+u*a[4]+e*a[7],t[2]=r*a[2]+u*a[5]+e*a[8],t},transformQuat:function(t,n,a){var r=a[0],u=a[1],e=a[2],o=a[3],i=n[0],c=n[1],h=n[2],s=u*h-e*c,M=e*i-r*h,f=r*c-u*i,l=u*f-e*M,v=e*s-r*f,b=r*M-u*s,m=2*o;return s*=m,M*=m,f*=m,l*=2,v*=2,b*=2,t[0]=i+s+l,t[1]=c+M+v,t[2]=h+f+b,t},rotateX:function(t,n,a,r){var u=[],e=[];return u[0]=n[0]-a[0],u[1]=n[1]-a[1],u[2]=n[2]-a[2],e[0]=u[0],e[1]=u[1]*Math.cos(r)-u[2]*Math.sin(r),e[2]=u[1]*Math.sin(r)+u[2]*Math.cos(r),t[0]=e[0]+a[0],t[1]=e[1]+a[1],t[2]=e[2]+a[2],t},rotateY:function(t,n,a,r){var u=[],e=[];return u[0]=n[0]-a[0],u[1]=n[1]-a[1],u[2]=n[2]-a[2],e[0]=u[2]*Math.sin(r)+u[0]*Math.cos(r),e[1]=u[1],e[2]=u[2]*Math.cos(r)-u[0]*Math.sin(r),t[0]=e[0]+a[0],t[1]=e[1]+a[1],t[2]=e[2]+a[2],t},rotateZ:function(t,n,a,r){var u=[],e=[];return u[0]=n[0]-a[0],u[1]=n[1]-a[1],u[2]=n[2]-a[2],e[0]=u[0]*Math.cos(r)-u[1]*Math.sin(r),e[1]=u[0]*Math.sin(r)+u[1]*Math.cos(r),e[2]=u[2],t[0]=e[0]+a[0],t[1]=e[1]+a[1],t[2]=e[2]+a[2],t},angle:function(t,n){var a=D(t[0],t[1],t[2]),r=D(n[0],n[1],n[2]);Z(a,a),Z(r,r);var u=_(a,r);return u>1?0:u<-1?Math.PI:Math.acos(u)},zero:function(t){return t[0]=0,t[1]=0,t[2]=0,t},str:function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},exactEquals:function(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]},equals:function(t,a){var r=t[0],u=t[1],e=t[2],o=a[0],i=a[1],c=a[2];return Math.abs(r-o)<=n*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(u-i)<=n*Math.max(1,Math.abs(u),Math.abs(i))&&Math.abs(e-c)<=n*Math.max(1,Math.abs(e),Math.abs(c))},sub:k,mul:U,div:W,dist:C,sqrDist:G,len:H,sqrLen:J,forEach:K});function tt(){var t=new a(4);return a!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function nt(t){var n=new a(4);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n}function at(t,n,r,u){var e=new a(4);return e[0]=t,e[1]=n,e[2]=r,e[3]=u,e}function rt(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t}function ut(t,n,a,r,u){return t[0]=n,t[1]=a,t[2]=r,t[3]=u,t}function et(t,n,a){return t[0]=n[0]+a[0],t[1]=n[1]+a[1],t[2]=n[2]+a[2],t[3]=n[3]+a[3],t}function ot(t,n,a){return t[0]=n[0]-a[0],t[1]=n[1]-a[1],t[2]=n[2]-a[2],t[3]=n[3]-a[3],t}function it(t,n,a){return t[0]=n[0]*a[0],t[1]=n[1]*a[1],t[2]=n[2]*a[2],t[3]=n[3]*a[3],t}function ct(t,n,a){return t[0]=n[0]/a[0],t[1]=n[1]/a[1],t[2]=n[2]/a[2],t[3]=n[3]/a[3],t}function ht(t,n,a){return t[0]=n[0]*a,t[1]=n[1]*a,t[2]=n[2]*a,t[3]=n[3]*a,t}function st(t,n){var a=n[0]-t[0],r=n[1]-t[1],u=n[2]-t[2],e=n[3]-t[3];return Math.hypot(a,r,u,e)}function Mt(t,n){var a=n[0]-t[0],r=n[1]-t[1],u=n[2]-t[2],e=n[3]-t[3];return a*a+r*r+u*u+e*e}function ft(t){var n=t[0],a=t[1],r=t[2],u=t[3];return Math.hypot(n,a,r,u)}function lt(t){var n=t[0],a=t[1],r=t[2],u=t[3];return n*n+a*a+r*r+u*u}function vt(t,n){var a=n[0],r=n[1],u=n[2],e=n[3],o=a*a+r*r+u*u+e*e;return o>0&&(o=1/Math.sqrt(o)),t[0]=a*o,t[1]=r*o,t[2]=u*o,t[3]=e*o,t}function bt(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]+t[3]*n[3]}function mt(t,n,a,r){var u=n[0],e=n[1],o=n[2],i=n[3];return t[0]=u+r*(a[0]-u),t[1]=e+r*(a[1]-e),t[2]=o+r*(a[2]-o),t[3]=i+r*(a[3]-i),t}function dt(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]}function xt(t,a){var r=t[0],u=t[1],e=t[2],o=t[3],i=a[0],c=a[1],h=a[2],s=a[3];return Math.abs(r-i)<=n*Math.max(1,Math.abs(r),Math.abs(i))&&Math.abs(u-c)<=n*Math.max(1,Math.abs(u),Math.abs(c))&&Math.abs(e-h)<=n*Math.max(1,Math.abs(e),Math.abs(h))&&Math.abs(o-s)<=n*Math.max(1,Math.abs(o),Math.abs(s))}var pt=ot,yt=it,qt=ct,gt=st,At=Mt,wt=ft,Rt=lt,zt=function(){var t=tt();return function(n,a,r,u,e,o){var i,c;for(a||(a=4),r||(r=0),c=u?Math.min(u*a+r,n.length):n.length,i=r;i<c;i+=a)t[0]=n[i],t[1]=n[i+1],t[2]=n[i+2],t[3]=n[i+3],e(t,t,o),n[i]=t[0],n[i+1]=t[1],n[i+2]=t[2],n[i+3]=t[3];return n}}(),Pt=Object.freeze({create:tt,clone:nt,fromValues:at,copy:rt,set:ut,add:et,subtract:ot,multiply:it,divide:ct,ceil:function(t,n){return t[0]=Math.ceil(n[0]),t[1]=Math.ceil(n[1]),t[2]=Math.ceil(n[2]),t[3]=Math.ceil(n[3]),t},floor:function(t,n){return t[0]=Math.floor(n[0]),t[1]=Math.floor(n[1]),t[2]=Math.floor(n[2]),t[3]=Math.floor(n[3]),t},min:function(t,n,a){return t[0]=Math.min(n[0],a[0]),t[1]=Math.min(n[1],a[1]),t[2]=Math.min(n[2],a[2]),t[3]=Math.min(n[3],a[3]),t},max:function(t,n,a){return t[0]=Math.max(n[0],a[0]),t[1]=Math.max(n[1],a[1]),t[2]=Math.max(n[2],a[2]),t[3]=Math.max(n[3],a[3]),t},round:function(t,n){return t[0]=Math.round(n[0]),t[1]=Math.round(n[1]),t[2]=Math.round(n[2]),t[3]=Math.round(n[3]),t},scale:ht,scaleAndAdd:function(t,n,a,r){return t[0]=n[0]+a[0]*r,t[1]=n[1]+a[1]*r,t[2]=n[2]+a[2]*r,t[3]=n[3]+a[3]*r,t},distance:st,squaredDistance:Mt,length:ft,squaredLength:lt,negate:function(t,n){return t[0]=-n[0],t[1]=-n[1],t[2]=-n[2],t[3]=-n[3],t},inverse:function(t,n){return t[0]=1/n[0],t[1]=1/n[1],t[2]=1/n[2],t[3]=1/n[3],t},normalize:vt,dot:bt,cross:function(t,n,a,r){var u=a[0]*r[1]-a[1]*r[0],e=a[0]*r[2]-a[2]*r[0],o=a[0]*r[3]-a[3]*r[0],i=a[1]*r[2]-a[2]*r[1],c=a[1]*r[3]-a[3]*r[1],h=a[2]*r[3]-a[3]*r[2],s=n[0],M=n[1],f=n[2],l=n[3];return t[0]=M*h-f*c+l*i,t[1]=-s*h+f*o-l*e,t[2]=s*c-M*o+l*u,t[3]=-s*i+M*e-f*u,t},lerp:mt,random:function(t,n){var a,u,e,o,i,c;n=n||1;do{i=(a=2*r()-1)*a+(u=2*r()-1)*u}while(i>=1);do{c=(e=2*r()-1)*e+(o=2*r()-1)*o}while(c>=1);var h=Math.sqrt((1-i)/c);return t[0]=n*a,t[1]=n*u,t[2]=n*e*h,t[3]=n*o*h,t},transformMat4:function(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3];return t[0]=a[0]*r+a[4]*u+a[8]*e+a[12]*o,t[1]=a[1]*r+a[5]*u+a[9]*e+a[13]*o,t[2]=a[2]*r+a[6]*u+a[10]*e+a[14]*o,t[3]=a[3]*r+a[7]*u+a[11]*e+a[15]*o,t},transformQuat:function(t,n,a){var r=n[0],u=n[1],e=n[2],o=a[0],i=a[1],c=a[2],h=a[3],s=h*r+i*e-c*u,M=h*u+c*r-o*e,f=h*e+o*u-i*r,l=-o*r-i*u-c*e;return t[0]=s*h+l*-o+M*-c-f*-i,t[1]=M*h+l*-i+f*-o-s*-c,t[2]=f*h+l*-c+s*-i-M*-o,t[3]=n[3],t},zero:function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},str:function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},exactEquals:dt,equals:xt,sub:pt,mul:yt,div:qt,dist:gt,sqrDist:At,len:wt,sqrLen:Rt,forEach:zt});function jt(){var t=new a(4);return a!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function It(t,n,a){a*=.5;var r=Math.sin(a);return t[0]=r*n[0],t[1]=r*n[1],t[2]=r*n[2],t[3]=Math.cos(a),t}function St(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=a[0],c=a[1],h=a[2],s=a[3];return t[0]=r*s+o*i+u*h-e*c,t[1]=u*s+o*c+e*i-r*h,t[2]=e*s+o*h+r*c-u*i,t[3]=o*s-r*i-u*c-e*h,t}function Et(t,n,a){a*=.5;var r=n[0],u=n[1],e=n[2],o=n[3],i=Math.sin(a),c=Math.cos(a);return t[0]=r*c+o*i,t[1]=u*c+e*i,t[2]=e*c-u*i,t[3]=o*c-r*i,t}function Ot(t,n,a){a*=.5;var r=n[0],u=n[1],e=n[2],o=n[3],i=Math.sin(a),c=Math.cos(a);return t[0]=r*c-e*i,t[1]=u*c+o*i,t[2]=e*c+r*i,t[3]=o*c-u*i,t}function Tt(t,n,a){a*=.5;var r=n[0],u=n[1],e=n[2],o=n[3],i=Math.sin(a),c=Math.cos(a);return t[0]=r*c+u*i,t[1]=u*c-r*i,t[2]=e*c+o*i,t[3]=o*c-e*i,t}function Dt(t,n){var a=n[0],r=n[1],u=n[2],e=n[3],o=Math.sqrt(a*a+r*r+u*u),i=Math.exp(e),c=o>0?i*Math.sin(o)/o:0;return t[0]=a*c,t[1]=r*c,t[2]=u*c,t[3]=i*Math.cos(o),t}function Ft(t,n){var a=n[0],r=n[1],u=n[2],e=n[3],o=Math.sqrt(a*a+r*r+u*u),i=o>0?Math.atan2(o,e)/o:0;return t[0]=a*i,t[1]=r*i,t[2]=u*i,t[3]=.5*Math.log(a*a+r*r+u*u+e*e),t}function Lt(t,a,r,u){var e,o,i,c,h,s=a[0],M=a[1],f=a[2],l=a[3],v=r[0],b=r[1],m=r[2],d=r[3];return(o=s*v+M*b+f*m+l*d)<0&&(o=-o,v=-v,b=-b,m=-m,d=-d),1-o>n?(e=Math.acos(o),i=Math.sin(e),c=Math.sin((1-u)*e)/i,h=Math.sin(u*e)/i):(c=1-u,h=u),t[0]=c*s+h*v,t[1]=c*M+h*b,t[2]=c*f+h*m,t[3]=c*l+h*d,t}function Vt(t,n){var a,r=n[0]+n[4]+n[8];if(r>0)a=Math.sqrt(r+1),t[3]=.5*a,a=.5/a,t[0]=(n[5]-n[7])*a,t[1]=(n[6]-n[2])*a,t[2]=(n[1]-n[3])*a;else{var u=0;n[4]>n[0]&&(u=1),n[8]>n[3*u+u]&&(u=2);var e=(u+1)%3,o=(u+2)%3;a=Math.sqrt(n[3*u+u]-n[3*e+e]-n[3*o+o]+1),t[u]=.5*a,a=.5/a,t[3]=(n[3*e+o]-n[3*o+e])*a,t[e]=(n[3*e+u]+n[3*u+e])*a,t[o]=(n[3*o+u]+n[3*u+o])*a}return t}var Qt,Yt,Xt,Zt,_t,Bt,Nt=nt,kt=at,Ut=rt,Wt=ut,Ct=et,Gt=St,Ht=ht,Jt=bt,Kt=mt,$t=ft,tn=$t,nn=lt,an=nn,rn=vt,un=dt,en=xt,on=(Qt=O(),Yt=D(1,0,0),Xt=D(0,1,0),function(t,n,a){var r=_(n,a);return r<-.999999?(B(Qt,Yt,n),H(Qt)<1e-6&&B(Qt,Xt,n),Z(Qt,Qt),It(t,Qt,Math.PI),t):r>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(B(Qt,n,a),t[0]=Qt[0],t[1]=Qt[1],t[2]=Qt[2],t[3]=1+r,rn(t,t))}),cn=(Zt=jt(),_t=jt(),function(t,n,a,r,u,e){return Lt(Zt,n,u,e),Lt(_t,a,r,e),Lt(t,Zt,_t,2*e*(1-e)),t}),hn=(Bt=m(),function(t,n,a,r){return Bt[0]=a[0],Bt[3]=a[1],Bt[6]=a[2],Bt[1]=r[0],Bt[4]=r[1],Bt[7]=r[2],Bt[2]=-n[0],Bt[5]=-n[1],Bt[8]=-n[2],rn(t,Vt(t,Bt))}),sn=Object.freeze({create:jt,identity:function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},setAxisAngle:It,getAxisAngle:function(t,a){var r=2*Math.acos(a[3]),u=Math.sin(r/2);return u>n?(t[0]=a[0]/u,t[1]=a[1]/u,t[2]=a[2]/u):(t[0]=1,t[1]=0,t[2]=0),r},getAngle:function(t,n){var a=Jt(t,n);return Math.acos(2*a*a-1)},multiply:St,rotateX:Et,rotateY:Ot,rotateZ:Tt,calculateW:function(t,n){var a=n[0],r=n[1],u=n[2];return t[0]=a,t[1]=r,t[2]=u,t[3]=Math.sqrt(Math.abs(1-a*a-r*r-u*u)),t},exp:Dt,ln:Ft,pow:function(t,n,a){return Ft(t,n),Ht(t,t,a),Dt(t,t),t},slerp:Lt,random:function(t){var n=r(),a=r(),u=r(),e=Math.sqrt(1-n),o=Math.sqrt(n);return t[0]=e*Math.sin(2*Math.PI*a),t[1]=e*Math.cos(2*Math.PI*a),t[2]=o*Math.sin(2*Math.PI*u),t[3]=o*Math.cos(2*Math.PI*u),t},invert:function(t,n){var a=n[0],r=n[1],u=n[2],e=n[3],o=a*a+r*r+u*u+e*e,i=o?1/o:0;return t[0]=-a*i,t[1]=-r*i,t[2]=-u*i,t[3]=e*i,t},conjugate:function(t,n){return t[0]=-n[0],t[1]=-n[1],t[2]=-n[2],t[3]=n[3],t},fromMat3:Vt,fromEuler:function(t,n,a,r){var u=.5*Math.PI/180;n*=u,a*=u,r*=u;var e=Math.sin(n),o=Math.cos(n),i=Math.sin(a),c=Math.cos(a),h=Math.sin(r),s=Math.cos(r);return t[0]=e*c*s-o*i*h,t[1]=o*i*s+e*c*h,t[2]=o*c*h-e*i*s,t[3]=o*c*s+e*i*h,t},str:function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},clone:Nt,fromValues:kt,copy:Ut,set:Wt,add:Ct,mul:Gt,scale:Ht,dot:Jt,lerp:Kt,length:$t,len:tn,squaredLength:nn,sqrLen:an,normalize:rn,exactEquals:un,equals:en,rotationTo:on,sqlerp:cn,setAxes:hn});function Mn(t,n,a){var r=.5*a[0],u=.5*a[1],e=.5*a[2],o=n[0],i=n[1],c=n[2],h=n[3];return t[0]=o,t[1]=i,t[2]=c,t[3]=h,t[4]=r*h+u*c-e*i,t[5]=u*h+e*o-r*c,t[6]=e*h+r*i-u*o,t[7]=-r*o-u*i-e*c,t}function fn(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t}var ln=Ut;var vn=Ut;function bn(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=a[4],c=a[5],h=a[6],s=a[7],M=n[4],f=n[5],l=n[6],v=n[7],b=a[0],m=a[1],d=a[2],x=a[3];return t[0]=r*x+o*b+u*d-e*m,t[1]=u*x+o*m+e*b-r*d,t[2]=e*x+o*d+r*m-u*b,t[3]=o*x-r*b-u*m-e*d,t[4]=r*s+o*i+u*h-e*c+M*x+v*b+f*d-l*m,t[5]=u*s+o*c+e*i-r*h+f*x+v*m+l*b-M*d,t[6]=e*s+o*h+r*c-u*i+l*x+v*d+M*m-f*b,t[7]=o*s-r*i-u*c-e*h+v*x-M*b-f*m-l*d,t}var mn=bn;var dn=Jt;var xn=$t,pn=xn,yn=nn,qn=yn;var gn=Object.freeze({create:function(){var t=new a(8);return a!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t},clone:function(t){var n=new a(8);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n},fromValues:function(t,n,r,u,e,o,i,c){var h=new a(8);return h[0]=t,h[1]=n,h[2]=r,h[3]=u,h[4]=e,h[5]=o,h[6]=i,h[7]=c,h},fromRotationTranslationValues:function(t,n,r,u,e,o,i){var c=new a(8);c[0]=t,c[1]=n,c[2]=r,c[3]=u;var h=.5*e,s=.5*o,M=.5*i;return c[4]=h*u+s*r-M*n,c[5]=s*u+M*t-h*r,c[6]=M*u+h*n-s*t,c[7]=-h*t-s*n-M*r,c},fromRotationTranslation:Mn,fromTranslation:function(t,n){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*n[0],t[5]=.5*n[1],t[6]=.5*n[2],t[7]=0,t},fromRotation:function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},fromMat4:function(t,n){var r=jt();P(r,n);var u=new a(3);return R(u,n),Mn(t,r,u),t},copy:fn,identity:function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},set:function(t,n,a,r,u,e,o,i,c){return t[0]=n,t[1]=a,t[2]=r,t[3]=u,t[4]=e,t[5]=o,t[6]=i,t[7]=c,t},getReal:ln,getDual:function(t,n){return t[0]=n[4],t[1]=n[5],t[2]=n[6],t[3]=n[7],t},setReal:vn,setDual:function(t,n){return t[4]=n[0],t[5]=n[1],t[6]=n[2],t[7]=n[3],t},getTranslation:function(t,n){var a=n[4],r=n[5],u=n[6],e=n[7],o=-n[0],i=-n[1],c=-n[2],h=n[3];return t[0]=2*(a*h+e*o+r*c-u*i),t[1]=2*(r*h+e*i+u*o-a*c),t[2]=2*(u*h+e*c+a*i-r*o),t},translate:function(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=.5*a[0],c=.5*a[1],h=.5*a[2],s=n[4],M=n[5],f=n[6],l=n[7];return t[0]=r,t[1]=u,t[2]=e,t[3]=o,t[4]=o*i+u*h-e*c+s,t[5]=o*c+e*i-r*h+M,t[6]=o*h+r*c-u*i+f,t[7]=-r*i-u*c-e*h+l,t},rotateX:function(t,n,a){var r=-n[0],u=-n[1],e=-n[2],o=n[3],i=n[4],c=n[5],h=n[6],s=n[7],M=i*o+s*r+c*e-h*u,f=c*o+s*u+h*r-i*e,l=h*o+s*e+i*u-c*r,v=s*o-i*r-c*u-h*e;return Et(t,n,a),r=t[0],u=t[1],e=t[2],o=t[3],t[4]=M*o+v*r+f*e-l*u,t[5]=f*o+v*u+l*r-M*e,t[6]=l*o+v*e+M*u-f*r,t[7]=v*o-M*r-f*u-l*e,t},rotateY:function(t,n,a){var r=-n[0],u=-n[1],e=-n[2],o=n[3],i=n[4],c=n[5],h=n[6],s=n[7],M=i*o+s*r+c*e-h*u,f=c*o+s*u+h*r-i*e,l=h*o+s*e+i*u-c*r,v=s*o-i*r-c*u-h*e;return Ot(t,n,a),r=t[0],u=t[1],e=t[2],o=t[3],t[4]=M*o+v*r+f*e-l*u,t[5]=f*o+v*u+l*r-M*e,t[6]=l*o+v*e+M*u-f*r,t[7]=v*o-M*r-f*u-l*e,t},rotateZ:function(t,n,a){var r=-n[0],u=-n[1],e=-n[2],o=n[3],i=n[4],c=n[5],h=n[6],s=n[7],M=i*o+s*r+c*e-h*u,f=c*o+s*u+h*r-i*e,l=h*o+s*e+i*u-c*r,v=s*o-i*r-c*u-h*e;return Tt(t,n,a),r=t[0],u=t[1],e=t[2],o=t[3],t[4]=M*o+v*r+f*e-l*u,t[5]=f*o+v*u+l*r-M*e,t[6]=l*o+v*e+M*u-f*r,t[7]=v*o-M*r-f*u-l*e,t},rotateByQuatAppend:function(t,n,a){var r=a[0],u=a[1],e=a[2],o=a[3],i=n[0],c=n[1],h=n[2],s=n[3];return t[0]=i*o+s*r+c*e-h*u,t[1]=c*o+s*u+h*r-i*e,t[2]=h*o+s*e+i*u-c*r,t[3]=s*o-i*r-c*u-h*e,i=n[4],c=n[5],h=n[6],s=n[7],t[4]=i*o+s*r+c*e-h*u,t[5]=c*o+s*u+h*r-i*e,t[6]=h*o+s*e+i*u-c*r,t[7]=s*o-i*r-c*u-h*e,t},rotateByQuatPrepend:function(t,n,a){var r=n[0],u=n[1],e=n[2],o=n[3],i=a[0],c=a[1],h=a[2],s=a[3];return t[0]=r*s+o*i+u*h-e*c,t[1]=u*s+o*c+e*i-r*h,t[2]=e*s+o*h+r*c-u*i,t[3]=o*s-r*i-u*c-e*h,i=a[4],c=a[5],h=a[6],s=a[7],t[4]=r*s+o*i+u*h-e*c,t[5]=u*s+o*c+e*i-r*h,t[6]=e*s+o*h+r*c-u*i,t[7]=o*s-r*i-u*c-e*h,t},rotateAroundAxis:function(t,a,r,u){if(Math.abs(u)<n)return fn(t,a);var e=Math.hypot(r[0],r[1],r[2]);u*=.5;var o=Math.sin(u),i=o*r[0]/e,c=o*r[1]/e,h=o*r[2]/e,s=Math.cos(u),M=a[0],f=a[1],l=a[2],v=a[3];t[0]=M*s+v*i+f*h-l*c,t[1]=f*s+v*c+l*i-M*h,t[2]=l*s+v*h+M*c-f*i,t[3]=v*s-M*i-f*c-l*h;var b=a[4],m=a[5],d=a[6],x=a[7];return t[4]=b*s+x*i+m*h-d*c,t[5]=m*s+x*c+d*i-b*h,t[6]=d*s+x*h+b*c-m*i,t[7]=x*s-b*i-m*c-d*h,t},add:function(t,n,a){return t[0]=n[0]+a[0],t[1]=n[1]+a[1],t[2]=n[2]+a[2],t[3]=n[3]+a[3],t[4]=n[4]+a[4],t[5]=n[5]+a[5],t[6]=n[6]+a[6],t[7]=n[7]+a[7],t},multiply:bn,mul:mn,scale:function(t,n,a){return t[0]=n[0]*a,t[1]=n[1]*a,t[2]=n[2]*a,t[3]=n[3]*a,t[4]=n[4]*a,t[5]=n[5]*a,t[6]=n[6]*a,t[7]=n[7]*a,t},dot:dn,lerp:function(t,n,a,r){var u=1-r;return dn(n,a)<0&&(r=-r),t[0]=n[0]*u+a[0]*r,t[1]=n[1]*u+a[1]*r,t[2]=n[2]*u+a[2]*r,t[3]=n[3]*u+a[3]*r,t[4]=n[4]*u+a[4]*r,t[5]=n[5]*u+a[5]*r,t[6]=n[6]*u+a[6]*r,t[7]=n[7]*u+a[7]*r,t},invert:function(t,n){var a=yn(n);return t[0]=-n[0]/a,t[1]=-n[1]/a,t[2]=-n[2]/a,t[3]=n[3]/a,t[4]=-n[4]/a,t[5]=-n[5]/a,t[6]=-n[6]/a,t[7]=n[7]/a,t},conjugate:function(t,n){return t[0]=-n[0],t[1]=-n[1],t[2]=-n[2],t[3]=n[3],t[4]=-n[4],t[5]=-n[5],t[6]=-n[6],t[7]=n[7],t},length:xn,len:pn,squaredLength:yn,sqrLen:qn,normalize:function(t,n){var a=yn(n);if(a>0){a=Math.sqrt(a);var r=n[0]/a,u=n[1]/a,e=n[2]/a,o=n[3]/a,i=n[4],c=n[5],h=n[6],s=n[7],M=r*i+u*c+e*h+o*s;t[0]=r,t[1]=u,t[2]=e,t[3]=o,t[4]=(i-r*M)/a,t[5]=(c-u*M)/a,t[6]=(h-e*M)/a,t[7]=(s-o*M)/a}return t},str:function(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"},exactEquals:function(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]&&t[4]===n[4]&&t[5]===n[5]&&t[6]===n[6]&&t[7]===n[7]},equals:function(t,a){var r=t[0],u=t[1],e=t[2],o=t[3],i=t[4],c=t[5],h=t[6],s=t[7],M=a[0],f=a[1],l=a[2],v=a[3],b=a[4],m=a[5],d=a[6],x=a[7];return Math.abs(r-M)<=n*Math.max(1,Math.abs(r),Math.abs(M))&&Math.abs(u-f)<=n*Math.max(1,Math.abs(u),Math.abs(f))&&Math.abs(e-l)<=n*Math.max(1,Math.abs(e),Math.abs(l))&&Math.abs(o-v)<=n*Math.max(1,Math.abs(o),Math.abs(v))&&Math.abs(i-b)<=n*Math.max(1,Math.abs(i),Math.abs(b))&&Math.abs(c-m)<=n*Math.max(1,Math.abs(c),Math.abs(m))&&Math.abs(h-d)<=n*Math.max(1,Math.abs(h),Math.abs(d))&&Math.abs(s-x)<=n*Math.max(1,Math.abs(s),Math.abs(x))}});function An(){var t=new a(2);return a!=Float32Array&&(t[0]=0,t[1]=0),t}function wn(t,n,a){return t[0]=n[0]-a[0],t[1]=n[1]-a[1],t}function Rn(t,n,a){return t[0]=n[0]*a[0],t[1]=n[1]*a[1],t}function zn(t,n,a){return t[0]=n[0]/a[0],t[1]=n[1]/a[1],t}function Pn(t,n){var a=n[0]-t[0],r=n[1]-t[1];return Math.hypot(a,r)}function jn(t,n){var a=n[0]-t[0],r=n[1]-t[1];return a*a+r*r}function In(t){var n=t[0],a=t[1];return Math.hypot(n,a)}function Sn(t){var n=t[0],a=t[1];return n*n+a*a}var En=In,On=wn,Tn=Rn,Dn=zn,Fn=Pn,Ln=jn,Vn=Sn,Qn=function(){var t=An();return function(n,a,r,u,e,o){var i,c;for(a||(a=2),r||(r=0),c=u?Math.min(u*a+r,n.length):n.length,i=r;i<c;i+=a)t[0]=n[i],t[1]=n[i+1],e(t,t,o),n[i]=t[0],n[i+1]=t[1];return n}}(),Yn=Object.freeze({create:An,clone:function(t){var n=new a(2);return n[0]=t[0],n[1]=t[1],n},fromValues:function(t,n){var r=new a(2);return r[0]=t,r[1]=n,r},copy:function(t,n){return t[0]=n[0],t[1]=n[1],t},set:function(t,n,a){return t[0]=n,t[1]=a,t},add:function(t,n,a){return t[0]=n[0]+a[0],t[1]=n[1]+a[1],t},subtract:wn,multiply:Rn,divide:zn,ceil:function(t,n){return t[0]=Math.ceil(n[0]),t[1]=Math.ceil(n[1]),t},floor:function(t,n){return t[0]=Math.floor(n[0]),t[1]=Math.floor(n[1]),t},min:function(t,n,a){return t[0]=Math.min(n[0],a[0]),t[1]=Math.min(n[1],a[1]),t},max:function(t,n,a){return t[0]=Math.max(n[0],a[0]),t[1]=Math.max(n[1],a[1]),t},round:function(t,n){return t[0]=Math.round(n[0]),t[1]=Math.round(n[1]),t},scale:function(t,n,a){return t[0]=n[0]*a,t[1]=n[1]*a,t},scaleAndAdd:function(t,n,a,r){return t[0]=n[0]+a[0]*r,t[1]=n[1]+a[1]*r,t},distance:Pn,squaredDistance:jn,length:In,squaredLength:Sn,negate:function(t,n){return t[0]=-n[0],t[1]=-n[1],t},inverse:function(t,n){return t[0]=1/n[0],t[1]=1/n[1],t},normalize:function(t,n){var a=n[0],r=n[1],u=a*a+r*r;return u>0&&(u=1/Math.sqrt(u)),t[0]=n[0]*u,t[1]=n[1]*u,t},dot:function(t,n){return t[0]*n[0]+t[1]*n[1]},cross:function(t,n,a){var r=n[0]*a[1]-n[1]*a[0];return t[0]=t[1]=0,t[2]=r,t},lerp:function(t,n,a,r){var u=n[0],e=n[1];return t[0]=u+r*(a[0]-u),t[1]=e+r*(a[1]-e),t},random:function(t,n){n=n||1;var a=2*r()*Math.PI;return t[0]=Math.cos(a)*n,t[1]=Math.sin(a)*n,t},transformMat2:function(t,n,a){var r=n[0],u=n[1];return t[0]=a[0]*r+a[2]*u,t[1]=a[1]*r+a[3]*u,t},transformMat2d:function(t,n,a){var r=n[0],u=n[1];return t[0]=a[0]*r+a[2]*u+a[4],t[1]=a[1]*r+a[3]*u+a[5],t},transformMat3:function(t,n,a){var r=n[0],u=n[1];return t[0]=a[0]*r+a[3]*u+a[6],t[1]=a[1]*r+a[4]*u+a[7],t},transformMat4:function(t,n,a){var r=n[0],u=n[1];return t[0]=a[0]*r+a[4]*u+a[12],t[1]=a[1]*r+a[5]*u+a[13],t},rotate:function(t,n,a,r){var u=n[0]-a[0],e=n[1]-a[1],o=Math.sin(r),i=Math.cos(r);return t[0]=u*i-e*o+a[0],t[1]=u*o+e*i+a[1],t},angle:function(t,n){var a=t[0],r=t[1],u=n[0],e=n[1],o=a*a+r*r;o>0&&(o=1/Math.sqrt(o));var i=u*u+e*e;i>0&&(i=1/Math.sqrt(i));var c=(a*u+r*e)*o*i;return c>1?0:c<-1?Math.PI:Math.acos(c)},zero:function(t){return t[0]=0,t[1]=0,t},str:function(t){return"vec2("+t[0]+", "+t[1]+")"},exactEquals:function(t,n){return t[0]===n[0]&&t[1]===n[1]},equals:function(t,a){var r=t[0],u=t[1],e=a[0],o=a[1];return Math.abs(r-e)<=n*Math.max(1,Math.abs(r),Math.abs(e))&&Math.abs(u-o)<=n*Math.max(1,Math.abs(u),Math.abs(o))},len:En,sub:On,mul:Tn,div:Dn,dist:Fn,sqrDist:Ln,sqrLen:Vn,forEach:Qn});t.glMatrix=e,t.mat2=s,t.mat2d=b,t.mat3=q,t.mat4=E,t.quat=sn,t.quat2=gn,t.vec2=Yn,t.vec3=$,t.vec4=Pt,Object.defineProperty(t,"__esModule",{value:!0})});

// ["glMatrix", "mat2", "mat2d", "mat3", "mat4", "quat", "quat2", "vec2", "vec3", "vec4"]
window.glMatrix = glMatrix;
window.mat2 = glMatrix.mat2;
window.mat2d = glMatrix.mat2d;
window.mat3 = glMatrix.mat3;
window.mat4 = glMatrix.mat4;
window.quat = glMatrix.quat;
window.quat2 = glMatrix.quat2;
window.vec2 = glMatrix.vec2;
window.vec3 = glMatrix.vec3;
window.vec4 = glMatrix.vec4;



var CABLES = CABLES || {}; CABLES.build = {"timestamp":1655965375354,"created":"2022-06-23T06:22:55.354Z","git":{"branch":"master","commit":"a017e1124e10993e96f805145f3c42b3aa81351e","date":"2022-06-23T06:11:00.000Z","message":"Merge remote-tracking branch 'origin/master' into develop"}};
if(!CABLES.exportedPatches)CABLES.exportedPatches={};CABLES.exportedPatches["vH-sB6"]={settings:{opExample:[],licence:"none",isPublic:false},ops:[{objName:"Ops.Gl.MainLoop",id:"0",uiAttribs:{subPatch:0},portsIn:[{name:"FPS Limit",value:0},{name:"Reduce FPS not focussed",value:true},{name:"Reduce FPS loading",value:false},{name:"Clear",value:true},{name:"ClearAlpha",value:true},{name:"Fullscreen Button",value:false},{name:"Active",value:true},{name:"Hires Displays",value:true},{name:"Pixel Unit index",value:0},{name:"Pixel Unit",value:"Display"}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"4",objOut:"0"}]},{name:"width",value:859},{name:"height",value:648}]},{objName:"Ops.Gl.RenderGeometry",id:"1",uiAttribs:{subPatch:"e88c760e-6c22-407a-8194-54c9884b404e"},portsIn:[{name:"render"},{name:"Geometry"},{name:"Update All",value:true},{name:"Update Face Indices",value:false},{name:"Update Vertices",value:false},{name:"Update Texcoords",value:false},{name:"Vertex Numbers",value:false}],portsOut:[{name:"trigger",links:[{portIn:"out0 Ops.Gl.GLTF.GltfNode_v2 Render",portOut:"trigger",objIn:"15",objOut:"1"}]}]},{objName:"Ops.Sequence",id:"2",uiAttribs:{subPatch:0},portsIn:[{name:"exe"},{name:"Clean up connections",value:0},{name:"exe 0",value:0},{name:"exe 1",value:0},{name:"exe 2",value:0},{name:"exe 3",value:0},{name:"exe 4",value:0},{name:"exe 5",value:0},{name:"exe 6",value:0},{name:"exe 7",value:0},{name:"exe 8",value:0},{name:"exe 9",value:0},{name:"exe 10",value:0},{name:"exe 11",value:0},{name:"exe 12",value:0},{name:"exe 13",value:0},{name:"exe 14",value:0}],portsOut:[{name:"trigger 0",links:[{portIn:"exe",portOut:"trigger 0",objIn:"462",objOut:"2"},{portIn:"Execute",portOut:"trigger 0",objIn:"463",objOut:"2"}]},{name:"trigger 1",links:[{portIn:"Execute",portOut:"trigger 1",objIn:"21",objOut:"2"}]},{name:"trigger 2",value:0},{name:"trigger 3",value:0},{name:"trigger 4",value:0},{name:"trigger 5",value:0},{name:"trigger 6",value:0},{name:"trigger 7",value:0},{name:"trigger 8",value:0},{name:"trigger 9",value:0},{name:"trigger 10",value:0},{name:"trigger 11",value:0},{name:"trigger 12",value:0},{name:"trigger 13",value:0},{name:"trigger 14",value:0},{name:"trigger 15",value:0}]},{objName:"Ops.Gl.Matrix.OrbitControls",id:"3",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"min distance",value:.43},{name:"max distance",value:5.76},{name:"min rot y",value:0},{name:"max rot y",value:0},{name:"initial radius",value:1.49},{name:"initial axis y",value:.641},{name:"initial axis x",value:.25},{name:"mul",value:.42},{name:"Smoothness",value:3},{name:"Speed X",value:.5},{name:"Speed Y",value:.5},{name:"Active",value:true},{name:"Allow Panning",value:true},{name:"Allow Zooming",value:true},{name:"Allow Rotation",value:true},{name:"restricted",value:true},{name:"Reset"}],portsOut:[{name:"trigger",links:[{portIn:"exe",portOut:"trigger",objIn:"2",objOut:"3"}]},{name:"radius",value:.6258},{name:"Rot X",value:90},{name:"Rot Y",value:115.38}]},{objName:"Ops.Gl.ClearColor",id:"4",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"r",value:0},{name:"g",value:0},{name:"b",value:0},{name:"a",value:1}],portsOut:[{name:"trigger",links:[{portIn:"exe",portOut:"trigger",objIn:"20",objOut:"4"}]}]},{objName:"Ops.Gl.Matrix.Transform",id:"5",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"posX",value:0},{name:"posY",value:.07},{name:"posZ",value:0},{name:"scale",value:1},{name:"rotX",value:-90},{name:"rotY",value:0},{name:"rotZ",value:0}],portsOut:[{name:"trigger",links:[{portIn:"Execute",portOut:"trigger",objIn:"86",objOut:"5"}]}]},{objName:"Ops.Trigger.RouteTrigger",id:"6",uiAttribs:{subPatch:"e88c760e-6c22-407a-8194-54c9884b404e"},portsIn:[{name:"Execute"},{name:"Switch Value"}],portsOut:[{name:"Next Trigger",value:0},{name:"Switched Value",value:1},{name:"Trigger 0",links:[{portIn:"Trigger In",portOut:"Trigger 0",objIn:"11",objOut:"6"}]},{name:"Trigger 1",links:[{portIn:"render",portOut:"Trigger 1",objIn:"10",objOut:"6"}]},{name:"Trigger 2",value:0},{name:"Trigger 3",value:0},{name:"Trigger 4",value:0},{name:"Trigger 5",value:0},{name:"Trigger 6",value:0},{name:"Trigger 7",value:0},{name:"Trigger 8",value:0},{name:"Trigger 9",value:0},{name:"Trigger 10",value:0},{name:"Trigger 11",value:0},{name:"Trigger 12",value:0},{name:"Trigger 13",value:0},{name:"Trigger 14",value:0},{name:"Trigger 15",value:0},{name:"Trigger 16",value:0},{name:"Trigger 17",value:0},{name:"Trigger 18",value:0},{name:"Trigger 19",value:0},{name:"Trigger 20",value:0},{name:"Trigger 21",value:0},{name:"Trigger 22",value:0},{name:"Trigger 23",value:0},{name:"Default Trigger",value:0}]},{objName:"Ops.Gl.Matrix.TransformView",id:"7",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"posX",value:0},{name:"posY",value:-.3},{name:"posZ",value:1.6},{name:"scale",value:1},{name:"rotX",value:10.85},{name:"rotY",value:0},{name:"rotZ",value:0}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"3",objOut:"7"}]}]},{objName:"Ops.Gl.Meshes.Grid",id:"8",uiAttribs:{subPatch:0},portsIn:[{name:"Render"},{name:"Num",value:20},{name:"Spacing",value:.15},{name:"Center",value:true}],portsOut:[{name:"Next",value:0}]},{objName:"Ops.Gl.Matrix.Transform",id:"9",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"posX",value:0},{name:"posY",value:0},{name:"posZ",value:0},{name:"scale",value:1},{name:"rotX",value:-90},{name:"rotY",value:0},{name:"rotZ",value:0}],portsOut:[{name:"trigger",links:[{portIn:"Render",portOut:"trigger",objIn:"8",objOut:"9"}]}]},{objName:"Ops.Gl.Shader.PointMaterial_v4",id:"10",uiAttribs:{subPatch:"e88c760e-6c22-407a-8194-54c9884b404e"},portsIn:[{name:"render"},{name:"PointSize",value:1.47},{name:"Size in Pixels",value:false},{name:"Random Size",value:0},{name:"Round",value:true},{name:"Round Antialias",value:false},{name:"Scale by Distance",value:false},{name:"r",value:1},{name:"g",value:1},{name:"b",value:1},{name:"a",value:1},{name:"Vertex Colors",value:true},{name:"texture",value:0},{name:"Colorize Texture",value:false},{name:"Texture Mask",value:0},{name:"Mask Channel index",value:0},{name:"Mask Channel",value:"R"},{name:"Texture Colorize",value:0},{name:"Colorize Randomize",value:true},{name:"Texture Opacity",value:0},{name:"Texture Point Size",value:0},{name:"Point Size Channel index",value:0},{name:"Point Size Channel",value:"R"},{name:"Texture Point Size Mul",value:1},{name:"Map Size 0 index",value:0},{name:"Map Size 0",value:"Black"},{name:"Flip Texture",value:false}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"1",objOut:"10"}]},{name:"shader"}]},{objName:"Ops.Gl.Phong.PhongMaterial_v6",id:"11",uiAttribs:{subPatch:"e88c760e-6c22-407a-8194-54c9884b404e"},portsIn:[{name:"Trigger In"},{name:"R",value:1},{name:"G",value:1},{name:"B",value:1},{name:"A",value:1},{name:"Enable",value:false},{name:"Albedo",value:.707},{name:"Roughness",value:.835},{name:"Active",value:false},{name:"Fresnel Intensity",value:.7},{name:"Fresnel Width",value:1},{name:"Fresnel Exponent",value:6},{name:"Fresnel R",value:1},{name:"Fresnel G",value:1},{name:"Fresnel B",value:1},{name:"Emissive Active",value:false},{name:"Color Intensity",value:.3},{name:"Emissive R",value:.7528171913638779},{name:"Emissive G",value:.36422624829379013},{name:"Emissive B",value:.3103095732889889},{name:"Shininess",value:4},{name:"Specular Amount",value:.5},{name:"Specular Model index",value:0},{name:"Specular Model",value:"Blinn"},{name:"Energy Conservation",value:false},{name:"Double Sided Material",value:false},{name:"Falloff Mode index",value:0},{name:"Falloff Mode",value:"A"},{name:"Diffuse Texture",value:0},{name:"Specular Texture",value:0},{name:"Normal Map",value:0},{name:"AO Texture",value:0},{name:"Emissive Texture",value:0},{name:"Emissive Mask",value:0},{name:"Opacity Texture",value:0},{name:"Environment Map",value:0},{name:"Env Map Mask"},{name:"Colorize Texture",value:true},{name:"Diffuse Repeat X",value:1},{name:"Diffuse Repeat Y",value:1},{name:"Texture Offset X",value:0},{name:"Texture Offset Y",value:0},{name:"Specular Intensity",value:1},{name:"Normal Map Intensity",value:.5},{name:"AO Intensity",value:1},{name:"Emissive Intensity",value:1},{name:"Emissive Mask Intensity",value:1},{name:"Env Map Intensity",value:1},{name:"Env Map Blend index",value:0},{name:"Env Map Blend",value:"Add"},{name:"Env Mask Intensity",value:1},{name:"Alpha Mask Source index",value:0},{name:"Alpha Mask Source",value:"Luminance"},{name:"Discard Transparent Pixels",value:false}],portsOut:[{name:"Trigger Out",links:[{portIn:"exe",portOut:"Trigger Out",objIn:"72",objOut:"11"}]},{name:"Shader"}]},{objName:"Ops.Gl.ShaderEffects.UseVertexColor",id:"12",uiAttribs:{subPatch:"e88c760e-6c22-407a-8194-54c9884b404e"},portsIn:[{name:"Render"}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"1",objOut:"12"}]}]},{objName:"Ops.Gl.Texture_v2",id:"13",uiAttribs:{subPatch:"e88c760e-6c22-407a-8194-54c9884b404e"},portsIn:[{name:"File",value:"assets/lib_matcaps_Chrome_Blue_Tint.png",display:"file"},{name:"Filter index",value:0},{name:"Filter",value:"nearest"},{name:"Wrap index",value:2},{name:"Wrap",value:"repeat"},{name:"Anisotropic index",value:0},{name:"Anisotropic",value:0},{name:"Flip",value:false},{name:"Pre Multiplied Alpha",value:false},{name:"Active",value:true},{name:"Save Memory",value:true}],portsOut:[{name:"Texture",links:[{portIn:"Env Map Mask",portOut:"Texture",objIn:"11",objOut:"13"}]},{name:"Width",value:256},{name:"Height",value:256},{name:"Aspect Ratio",value:1},{name:"Loaded",value:true},{name:"Loading",value:false}]},{objName:"Ops.Ui.PatchInput",id:"14",uiAttribs:{subPatch:"e88c760e-6c22-407a-8194-54c9884b404e"},portsIn:[],portsOut:[{name:"create port",value:0},{name:"in0 Ops.Gl.Matrix.Transform trigger",links:[{portIn:"Execute",portOut:"in0 Ops.Gl.Matrix.Transform trigger",objIn:"6",objOut:"14"},{portIn:"Exec",portOut:"in0 Ops.Gl.Matrix.Transform trigger",objIn:"118",objOut:"14"}]},{name:"in1 Ops.String.SwitchString Result",links:[{portIn:"PLY File",portOut:"in1 Ops.String.SwitchString Result",objIn:"65",objOut:"14"}]}]},{objName:"Ops.Ui.PatchOutput",id:"15",uiAttribs:{subPatch:"e88c760e-6c22-407a-8194-54c9884b404e"},portsIn:[{name:"create port",value:0},{name:"out0 Ops.Gl.GLTF.GltfNode_v2 Render"}],portsOut:[]},{objName:"Ops.Ui.SubPatch",id:"16",uiAttribs:{subPatch:0},portsIn:[{name:"create port",value:null},{name:"dataStr",value:'{"ports":[{"name":"in0 Ops.Gl.Matrix.Transform trigger","type":1,"title":"Render"},{"name":"in1 Ops.String.SwitchString Result","type":5,"title":"URL"}],"portsOut":[{"name":"out0 Ops.Gl.GLTF.GltfNode_v2 Render","type":1}]}'},{name:"patchId",value:"e88c760e-6c22-407a-8194-54c9884b404e"},{name:"in0 Ops.Gl.Matrix.Transform trigger"},{name:"in1 Ops.String.SwitchString Result"}],portsOut:[{name:"create port out",value:0},{name:"out0 Ops.Gl.GLTF.GltfNode_v2 Render"}]},{objName:"Ops.Sidebar.Sidebar",id:"17",uiAttribs:{subPatch:0},portsIn:[{name:"Visible"},{name:"Opacity",value:1},{name:"Default Minimized",value:false},{name:"Minimized Opacity",value:.5},{name:"Show undo button",value:false},{name:"Show Minimize",value:true},{name:"Title",value:"3D viewer"},{name:"Side",value:false}],portsOut:[{name:"childs",links:[{portIn:"link",portOut:"childs",objIn:"36",objOut:"17"}]},{name:"Opfened",value:true}]},{objName:"Ops.Trigger.RouteTrigger",id:"18",uiAttribs:{subPatch:0},portsIn:[{name:"Execute"},{name:"Switch Value"}],portsOut:[{name:"Next Trigger",value:0},{name:"Switched Value",links:[{portIn:"Value",portOut:"Switched Value",objIn:"27",objOut:"18"}]},{name:"Trigger 0",links:[{portIn:"render",portOut:"Trigger 0",objIn:"126",objOut:"18"}]},{name:"Trigger 1",value:0},{name:"Trigger 2",value:0},{name:"Trigger 3",value:0},{name:"Trigger 4",links:[{portIn:"Trigger",portOut:"Trigger 4",objIn:"50",objOut:"18"}]},{name:"Trigger 5",links:[{portIn:"Trigger",portOut:"Trigger 5",objIn:"53",objOut:"18"}]},{name:"Trigger 6",value:0},{name:"Trigger 7",value:0},{name:"Trigger 8",value:0},{name:"Trigger 9",value:0},{name:"Trigger 10",value:0},{name:"Trigger 11",value:0},{name:"Trigger 12",value:0},{name:"Trigger 13",value:0},{name:"Trigger 14",value:0},{name:"Trigger 15",value:0},{name:"Trigger 16",value:0},{name:"Trigger 17",value:0},{name:"Trigger 18",value:0},{name:"Trigger 19",value:0},{name:"Trigger 20",value:0},{name:"Trigger 21",value:0},{name:"Trigger 22",value:0},{name:"Trigger 23",value:0},{name:"Default Trigger",value:0}]},{objName:"Ops.Vars.VarGetNumber_v2",id:"19",uiAttribs:{subPatch:0},portsIn:[{name:"Variable",value:"showGrid"}],portsOut:[{name:"Value",links:[{portIn:"Pass Through",portOut:"Value",objIn:"21",objOut:"19"}]}]},{objName:"Ops.Sequence",id:"20",uiAttribs:{subPatch:0},portsIn:[{name:"exe"},{name:"Clean up connections",value:0},{name:"exe 0",value:0},{name:"exe 1",value:0},{name:"exe 2",value:0},{name:"exe 3",value:0},{name:"exe 4",value:0},{name:"exe 5",value:0},{name:"exe 6",value:0},{name:"exe 7",value:0},{name:"exe 8",value:0},{name:"exe 9",value:0},{name:"exe 10",value:0},{name:"exe 11",value:0},{name:"exe 12",value:0},{name:"exe 13",value:0},{name:"exe 14",value:0}],portsOut:[{name:"trigger 0",links:[{portIn:"Trigger",portOut:"trigger 0",objIn:"180",objOut:"20"}]},{name:"trigger 1",links:[{portIn:"Execute",portOut:"trigger 1",objIn:"18",objOut:"20"}]},{name:"trigger 2",value:0},{name:"trigger 3",value:0},{name:"trigger 4",value:0},{name:"trigger 5",value:0},{name:"trigger 6",value:0},{name:"trigger 7",value:0},{name:"trigger 8",value:0},{name:"trigger 9",value:0},{name:"trigger 10",value:0},{name:"trigger 11",value:0},{name:"trigger 12",value:0},{name:"trigger 13",value:0},{name:"trigger 14",value:0},{name:"trigger 15",value:0}]},{objName:"Ops.Trigger.GateTrigger",id:"21",uiAttribs:{subPatch:0},portsIn:[{name:"Execute"},{name:"Pass Through"}],portsOut:[{name:"Trigger out",links:[{portIn:"render",portOut:"Trigger out",objIn:"9",objOut:"21"}]}]},{objName:"Ops.Gl.GLTF.GltfScene_v3",id:"22",uiAttribs:{subPatch:0},portsIn:[{name:"data",value:'{"hiddenNodes":{"mesh_00":true}}'},{name:"Render"},{name:"glb File",value:"assets/620ce31dcef9e411244c5e84_part_5_obj_1.glb",display:"file"},{name:"Draw",value:true},{name:"Camera index",value:0},{name:"Camera",value:"None"},{name:"Animation",value:""},{name:"Show Structure",value:0},{name:"Center index",value:1},{name:"Center",value:"XYZ"},{name:"Rescale",value:false},{name:"Rescale Size",value:1},{name:"Time",value:0},{name:"Sync to timeline",value:false},{name:"Loop",value:false},{name:"Normals Format index",value:0},{name:"Normals Format",value:"XYZ"},{name:"Vertices Format index",value:0},{name:"Vertices Format",value:"XYZ"},{name:"Calc Normals",value:false},{name:"Materials",value:0},{name:"Hide Nodes"},{name:"Use Material Properties",value:true},{name:"Active",value:true}],portsOut:[{name:"Render Before",links:[{portIn:"render",portOut:"Render Before",objIn:"117",objOut:"22"}]},{name:"Next",links:[{portIn:"Render",portOut:"Next",objIn:"152",objOut:"22"},{portIn:"Exec",portOut:"Next",objIn:"164",objOut:"22"}]},{name:"Generator",value:"Khronos glTF Blender I/O v1.7.33"},{name:"GLTF Version",value:2},{name:"GLTF Extensions Used"},{name:"Anim Length",value:0},{name:"Anim Time",value:0},{name:"Json",links:[{portIn:"Object",portOut:"Json",objIn:"143",objOut:"22"}]},{name:"Anims"},{name:"BoundingPoints"},{name:"Bounds"},{name:"Finished",value:0},{name:"Loading",value:false}]},{objName:"Ops.Gl.Pbr.PbrMaterial",id:"23",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"R",value:.4866666590174039},{name:"G",value:.4866666590174039},{name:"B",value:.4866666590174039},{name:"A",value:1},{name:"Roughness",value:1},{name:"Metalness",value:0},{name:"Alpha Mode index",value:3},{name:"Alpha Mode",value:"Blend"},{name:"Tonemapping index",value:0},{name:"Tonemapping",value:"sRGB"},{name:"Exposure",value:1},{name:"Disable geometric roughness",value:false},{name:"Use roughness from normal map",value:false},{name:"Use Vertex Colours",value:false},{name:"Vertex Colour Mode index",value:0},{name:"Vertex Colour Mode",value:"colour"},{name:"Height Intensity",value:1},{name:"Faster heightmapping",value:false},{name:"Use Clear Coat",value:false},{name:"Clear Coat Roughness",value:.5},{name:"IBL LUT"},{name:"Diffuse Irradiance"},{name:"Pre-filtered envmap"},{name:"Num mip levels",value:0},{name:"Albedo",value:0},{name:"AORM",value:0},{name:"Normal map",value:0},{name:"Height",value:0},{name:"Lightmap",value:0},{name:"Diffuse Intensity",value:1},{name:"Specular Intensity",value:1},{name:"Lightmap is RGBE",value:false},{name:"Lightmap Intensity",value:1}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"63",objOut:"23"}]},{name:"Shader"}]},{objName:"Ops.Gl.Texture_v2",id:"24",uiAttribs:{subPatch:0},portsIn:[{name:"File",value:"assets/lib_hdr_gravelpath.rgbe.png",display:"file"},{name:"Filter index",value:0},{name:"Filter",value:"mipmap"},{name:"Wrap index",value:2},{name:"Wrap",value:"clamp to edge"},{name:"Anisotropic index",value:0},{name:"Anisotropic",value:"0"},{name:"Flip",value:false},{name:"Pre Multiplied Alpha",value:false},{name:"Active",value:true},{name:"Save Memory",value:true}],portsOut:[{name:"Texture",links:[{portIn:"RGBE Environment map",portOut:"Texture",objIn:"25",objOut:"24"}]},{name:"Width",value:1024},{name:"Height",value:512},{name:"Aspect Ratio",value:2},{name:"Loaded",value:true},{name:"Loading",value:false}]},{objName:"Ops.Gl.Pbr.PbrEnvironmentLight",id:"25",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"RGBE Environment map"},{name:"Size Irradiance map index",value:2},{name:"Size Irradiance map",value:"32"},{name:"Size pre-filtered environment index",value:1},{name:"Size pre-filtered environment",value:"64"},{name:"Size IBL LUT index",value:1},{name:"Size IBL LUT",value:"128"},{name:"Environment map does not contain RGBE data",value:false},{name:"Rotation",value:0},{name:"Use parallax correction",value:false},{name:"center X",value:0},{name:"center Y",value:1.8},{name:"center Z",value:0},{name:"Box min X",value:-1},{name:"Box min Y",value:-1},{name:"Box min Z",value:-1},{name:"Box max X",value:1},{name:"Box max Y",value:1},{name:"Box max Z",value:1}],portsOut:[{name:"next",links:[{portIn:"render",portOut:"next",objIn:"23",objOut:"25"}]},{name:"IBL LUT",links:[{portIn:"IBL LUT",portOut:"IBL LUT",objIn:"23",objOut:"25"},{portIn:"IBL LUT",portOut:"IBL LUT",objIn:"117",objOut:"25"}]},{name:"cubemap (diffuse irradiance)",links:[{portIn:"Diffuse Irradiance",portOut:"cubemap (diffuse irradiance)",objIn:"23",objOut:"25"},{portIn:"Diffuse Irradiance",portOut:"cubemap (diffuse irradiance)",objIn:"117",objOut:"25"}]},{name:"cubemap (pre-filtered environment map)",links:[{portIn:"Pre-filtered envmap",portOut:"cubemap (pre-filtered environment map)",objIn:"23",objOut:"25"},{portIn:"Pre-filtered envmap",portOut:"cubemap (pre-filtered environment map)",objIn:"117",objOut:"25"}]},{name:"Number of Pre-filtered mip levels",value:6}]},{objName:"Ops.Gl.Matrix.OrbitControls",id:"26",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"min distance",value:.05},{name:"max distance",value:99999},{name:"min rot y",value:0},{name:"max rot y",value:0},{name:"initial radius",value:1.33},{name:"initial axis y",value:.584},{name:"initial axis x",value:.25},{name:"mul",value:1},{name:"Smoothness",value:1},{name:"Speed X",value:1},{name:"Speed Y",value:1},{name:"Active",value:true},{name:"Allow Panning",value:true},{name:"Allow Zooming",value:true},{name:"Allow Rotation",value:true},{name:"restricted",value:true},{name:"Reset"}],portsOut:[{name:"trigger",links:[{portIn:"exe",portOut:"trigger",objIn:"35",objOut:"26"}]},{name:"radius",value:1.33},{name:"Rot X",value:90},{name:"Rot Y",value:105.11999999999999}]},{objName:"Ops.Value.TriggerOnChangeNumber",id:"27",uiAttribs:{subPatch:0},portsIn:[{name:"Value"}],portsOut:[{name:"Next",links:[{portIn:"Trigger",portOut:"Next",objIn:"28",objOut:"27"}]},{name:"Number",value:4}]},{objName:"Ops.Trigger.TriggerSend",id:"28",uiAttribs:{subPatch:0},portsIn:[{name:"Trigger"},{name:"Named Trigger",value:"resetCamera"}],portsOut:[]},{objName:"Ops.Trigger.TriggerReceive",id:"29",uiAttribs:{subPatch:0},portsIn:[{name:"Named Trigger",value:"resetCamera"}],portsOut:[{name:"Triggered",links:[{portIn:"Reset",portOut:"Triggered",objIn:"3",objOut:"29"}]}]},{objName:"Ops.Gl.Matrix.TransformView",id:"30",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"posX",value:0},{name:"posY",value:-.59},{name:"posZ",value:1.38},{name:"scale",value:1},{name:"rotX",value:0},{name:"rotY",value:0},{name:"rotZ",value:0}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"26",objOut:"30"}]}]},{objName:"Ops.Gl.Meshes.Grid",id:"31",uiAttribs:{subPatch:0},portsIn:[{name:"Render"},{name:"Num",value:20},{name:"Spacing",value:.24},{name:"Center",value:true}],portsOut:[{name:"Next",value:0}]},{objName:"Ops.Gl.Matrix.Transform",id:"32",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"posX",value:0},{name:"posY",value:0},{name:"posZ",value:0},{name:"scale",value:1},{name:"rotX",value:-90},{name:"rotY",value:0},{name:"rotZ",value:0}],portsOut:[{name:"trigger",links:[{portIn:"Render",portOut:"trigger",objIn:"31",objOut:"32"}]}]},{objName:"Ops.Vars.VarGetNumber_v2",id:"33",uiAttribs:{subPatch:0},portsIn:[{name:"Variable",value:"showGrid"}],portsOut:[{name:"Value",links:[{portIn:"Pass Through",portOut:"Value",objIn:"34",objOut:"33"}]}]},{objName:"Ops.Trigger.GateTrigger",id:"34",uiAttribs:{subPatch:0},portsIn:[{name:"Execute"},{name:"Pass Through"}],portsOut:[{name:"Trigger out",links:[{portIn:"render",portOut:"Trigger out",objIn:"32",objOut:"34"}]}]},{objName:"Ops.Sequence",id:"35",uiAttribs:{subPatch:0},portsIn:[{name:"exe"},{name:"Clean up connections",value:0},{name:"exe 0",value:0},{name:"exe 1",value:0},{name:"exe 2",value:0},{name:"exe 3",value:0},{name:"exe 4",value:0},{name:"exe 5",value:0},{name:"exe 6",value:0},{name:"exe 7",value:0},{name:"exe 8",value:0},{name:"exe 9",value:0},{name:"exe 10",value:0},{name:"exe 11",value:0},{name:"exe 12",value:0},{name:"exe 13",value:0},{name:"exe 14",value:0}],portsOut:[{name:"trigger 0",links:[{portIn:"render",portOut:"trigger 0",objIn:"25",objOut:"35"}]},{name:"trigger 1",links:[{portIn:"Execute",portOut:"trigger 1",objIn:"34",objOut:"35"}]},{name:"trigger 2",value:0},{name:"trigger 3",value:0},{name:"trigger 4",value:0},{name:"trigger 5",value:0},{name:"trigger 6",value:0},{name:"trigger 7",value:0},{name:"trigger 8",value:0},{name:"trigger 9",value:0},{name:"trigger 10",value:0},{name:"trigger 11",value:0},{name:"trigger 12",value:0},{name:"trigger 13",value:0},{name:"trigger 14",value:0},{name:"trigger 15",value:0}]},{objName:"Ops.Sidebar.SideBarSwitch",id:"36",uiAttribs:{subPatch:0},portsIn:[{name:"link"},{name:"Names"},{name:"Style index",value:1},{name:"Style",value:"Tabs"},{name:"Text",value:"Switch"},{name:"Input",value:0},{name:"Set Default",value:0},{name:"Grey Out",value:false},{name:"Default",value:0}],portsOut:[{name:"childs",links:[{portIn:"link",portOut:"childs",objIn:"39",objOut:"36"}]},{name:"Index",links:[{portIn:"Index",portOut:"Index",objIn:"38",objOut:"36"}]},{name:"String",links:[{portIn:"Input String",portOut:"String",objIn:"41",objOut:"36"}]}]},{objName:"Ops.Array.ParseArray_v2",id:"37",uiAttribs:{subPatch:0},portsIn:[{name:"text",value:"Empty 0,Part 4,Part 5"},{name:"separator",value:","},{name:"Numbers",value:false},{name:"Trim",value:true}],portsOut:[{name:"Parsed",value:0},{name:"array",links:[{portIn:"Names",portOut:"array",objIn:"36",objOut:"37"}]},{name:"length",value:3}]},{objName:"Ops.Value.RouteNumber",id:"38",uiAttribs:{subPatch:0},portsIn:[{name:"Index"},{name:"Value",value:1},{name:"Default Value",value:0},{name:"Set inactive to default",value:true}],portsOut:[{name:"Index 0 Value",value:0},{name:"Index 1 Value",links:[{portIn:"Visible",portOut:"Index 1 Value",objIn:"39",objOut:"38"}]},{name:"Index 2 Value",links:[{portIn:"Visible",portOut:"Index 2 Value",objIn:"40",objOut:"38"}]},{name:"Index 3 Value",value:0},{name:"Index 4 Value",value:0},{name:"Index 5 Value",value:0},{name:"Index 6 Value",value:0},{name:"Index 7 Value",value:0},{name:"Index 8 Value",value:0},{name:"Index 9 Value",value:0}]},{objName:"Ops.Sidebar.Group",id:"39",uiAttribs:{subPatch:0},portsIn:[{name:"link"},{name:"Text",value:"Part 4"},{name:"Show Title",value:true},{name:"Default Minimized",value:false},{name:"Visible"}],portsOut:[{name:"next",links:[{portIn:"link",portOut:"next",objIn:"40",objOut:"39"}]},{name:"childs",links:[{portIn:"Link",portOut:"childs",objIn:"67",objOut:"39"}]}]},{objName:"Ops.Sidebar.Group",id:"40",uiAttribs:{subPatch:0},portsIn:[{name:"link"},{name:"Text",value:"Part 5"},{name:"Show Title",value:true},{name:"Default Minimized",value:false},{name:"Visible"}],portsOut:[{name:"next",links:[{portIn:"link",portOut:"next",objIn:"43",objOut:"40"}]},{name:"childs",links:[{portIn:"Link",portOut:"childs",objIn:"68",objOut:"40"}]}]},{objName:"Ops.String.Split_v2",id:"41",uiAttribs:{subPatch:0},portsIn:[{name:"Input String"},{name:"Separator",value:" "},{name:"Split Lines",value:false},{name:"Numbers",value:false}],portsOut:[{name:"Result",links:[{portIn:"Array",portOut:"Result",objIn:"42",objOut:"41"}]}]},{objName:"Ops.Json.ArrayGetStringByPath",id:"42",uiAttribs:{subPatch:0},portsIn:[{name:"Array"},{name:"Path",value:"1"},{name:"Return path if missing",value:false}],portsOut:[{name:"Output",links:[{portIn:"String",portOut:"Output",objIn:"127",objOut:"42"}]},{name:"Found",value:true}]},{objName:"Ops.Sidebar.Group",id:"43",uiAttribs:{subPatch:0},portsIn:[{name:"link"},{name:"Text",value:"Render options"},{name:"Show Title",value:true},{name:"Default Minimized",value:false},{name:"Visible",value:true}],portsOut:[{name:"next"},{name:"childs",links:[{portIn:"link",portOut:"childs",objIn:"60",objOut:"43"}]}]},{objName:"Ops.Sidebar.Toggle_v3",id:"44",uiAttribs:{subPatch:0},portsIn:[{name:"link"},{name:"Text",value:"Show grid"},{name:"Input",value:true},{name:"Set Default",value:0},{name:"Default",value:true},{name:"Grey Out",value:false},{name:"Visible",value:true}],portsOut:[{name:"childs",links:[{portIn:"link",portOut:"childs",objIn:"133",objOut:"44"}]},{name:"Value",links:[{portIn:"Value",portOut:"Value",objIn:"45",objOut:"44"}]}]},{objName:"Ops.Vars.VarSetNumber_v2",id:"45",uiAttribs:{subPatch:0},portsIn:[{name:"Value"},{name:"Variable",value:"showGrid"},{name:"Create new variable",value:0},{name:"",value:["Rename"]}],portsOut:[]},{objName:"Ops.Gl.Meshes.Cube_v2",id:"46",uiAttribs:{subPatch:0},portsIn:[{name:"Render"},{name:"Render Mesh",value:true},{name:"Width",value:1},{name:"Length",value:2},{name:"Height",value:.2},{name:"Center",value:true},{name:"Mapping index",value:0},{name:"Mapping",value:"Side"},{name:"Bias",value:0},{name:"Flip X",value:true},{name:"Top",value:true},{name:"Bottom",value:true},{name:"Left",value:true},{name:"Right",value:true},{name:"Front",value:true},{name:"Back",value:true}],portsOut:[{name:"Next",value:0},{name:"geometry"}]},{objName:"Ops.Gl.Matrix.Transform",id:"47",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"posX",value:0},{name:"posY",value:-.1},{name:"posZ",value:0},{name:"scale",value:1},{name:"rotX",value:0},{name:"rotY",value:0},{name:"rotZ",value:0}],portsOut:[{name:"trigger",links:[{portIn:"Render",portOut:"trigger",objIn:"46",objOut:"47"}]}]},{objName:"Ops.Math.Sum",id:"48",uiAttribs:{subPatch:0},portsIn:[{name:"number1"},{name:"number2",value:1}],portsOut:[{name:"result",links:[{portIn:"Value",portOut:"result",objIn:"129",objOut:"48"}]}]},{objName:"Ops.Trigger.TriggerReceive",id:"49",uiAttribs:{subPatch:0},portsIn:[{name:"Named Trigger",value:"resetCamera"}],portsOut:[{name:"Triggered",links:[{portIn:"Reset",portOut:"Triggered",objIn:"26",objOut:"49"}]}]},{objName:"Ops.Trigger.TriggerSend",id:"50",uiAttribs:{subPatch:0},portsIn:[{name:"Trigger"},{name:"Named Trigger",value:"scenePart4"}],portsOut:[]},{objName:"Ops.Trigger.TriggerReceive",id:"51",uiAttribs:{subPatch:0},portsIn:[{name:"Named Trigger",value:"scenePart4"}],portsOut:[{name:"Triggered",links:[{portIn:"render",portOut:"Triggered",objIn:"7",objOut:"51"}]}]},{objName:"Ops.Ui.Comment_v2",id:"52",uiAttribs:{subPatch:0},portsIn:[{name:"title",value:"Scenes"},{name:"text",value:""}],portsOut:[]},{objName:"Ops.Trigger.TriggerSend",id:"53",uiAttribs:{subPatch:0},portsIn:[{name:"Trigger"},{name:"Named Trigger",value:"scenePart5"}],portsOut:[]},{objName:"Ops.Trigger.TriggerReceive",id:"54",uiAttribs:{subPatch:0},portsIn:[{name:"Named Trigger",value:"scenePart5"}],portsOut:[{name:"Triggered",links:[{portIn:"Execute",portOut:"Triggered",objIn:"55",objOut:"54"}]}]},{objName:"Ops.Trigger.RouteTrigger",id:"55",uiAttribs:{subPatch:0},portsIn:[{name:"Execute"},{name:"Switch Value"}],portsOut:[{name:"Next Trigger",value:0},{name:"Switched Value",value:3},{name:"Trigger 0",value:0},{name:"Trigger 1",links:[{portIn:"render",portOut:"Trigger 1",objIn:"30",objOut:"55"}]},{name:"Trigger 2",value:0},{name:"Trigger 3",links:[{portIn:"render",portOut:"Trigger 3",objIn:"30",objOut:"55"}]},{name:"Trigger 4",value:0},{name:"Trigger 5",value:0},{name:"Trigger 6",value:0},{name:"Trigger 7",value:0},{name:"Trigger 8",value:0},{name:"Trigger 9",value:0},{name:"Trigger 10",value:0},{name:"Trigger 11",value:0},{name:"Trigger 12",value:0},{name:"Trigger 13",value:0},{name:"Trigger 14",value:0},{name:"Trigger 15",value:0},{name:"Trigger 16",value:0},{name:"Trigger 17",value:0},{name:"Trigger 18",value:0},{name:"Trigger 19",value:0},{name:"Trigger 20",value:0},{name:"Trigger 21",value:0},{name:"Trigger 22",value:0},{name:"Trigger 23",value:0},{name:"Default Trigger",value:0}]},{objName:"Ops.Vars.VarGetNumber_v2",id:"56",uiAttribs:{subPatch:0},portsIn:[{name:"Variable",value:"objId"}],portsOut:[{name:"Value",links:[{portIn:"Switch Value",portOut:"Value",objIn:"55",objOut:"56"}]}]},{objName:"Ops.Gl.GLTF.GltfScene_v3",id:"57",uiAttribs:{subPatch:0},portsIn:[{name:"data",value:'{"hiddenNodes":{"mesh_00":true}}'},{name:"Render"},{name:"glb File",value:"assets/620ce31dcef9e411244c5e84_part_5_obj_3.glb",display:"file"},{name:"Draw",value:true},{name:"Camera index",value:0},{name:"Camera",value:"None"},{name:"Animation",value:""},{name:"Show Structure",value:0},{name:"Center index",value:1},{name:"Center",value:"XYZ"},{name:"Rescale",value:true},{name:"Rescale Size",value:1},{name:"Time",value:0},{name:"Sync to timeline",value:false},{name:"Loop",value:false},{name:"Normals Format index",value:0},{name:"Normals Format",value:"XYZ"},{name:"Vertices Format index",value:0},{name:"Vertices Format",value:"XYZ"},{name:"Calc Normals",value:false},{name:"Materials",value:0},{name:"Hide Nodes",value:0},{name:"Use Material Properties",value:true},{name:"Active",value:true}],portsOut:[{name:"Render Before",value:0},{name:"Next",value:0},{name:"Generator",value:"Khronos glTF Blender I/O v1.7.33"},{name:"GLTF Version",value:2},{name:"GLTF Extensions Used"},{name:"Anim Length",value:0},{name:"Anim Time",value:0},{name:"Json"},{name:"Anims"},{name:"BoundingPoints"},{name:"Bounds"},{name:"Finished",value:0},{name:"Loading",value:false}]},{objName:"Ops.Trigger.RouteTrigger",id:"58",uiAttribs:{subPatch:0},portsIn:[{name:"Execute"},{name:"Switch Value"}],portsOut:[{name:"Next Trigger",value:0},{name:"Switched Value",value:3},{name:"Trigger 0",value:0},{name:"Trigger 1",links:[{portIn:"Render",portOut:"Trigger 1",objIn:"22",objOut:"58"}]},{name:"Trigger 2",links:[{portIn:"render",portOut:"Trigger 2",objIn:"303",objOut:"58"}]},{name:"Trigger 3",links:[{portIn:"render",portOut:"Trigger 3",objIn:"123",objOut:"58"},{portIn:"render",portOut:"Trigger 3",objIn:"124",objOut:"58"}]},{name:"Trigger 4",value:0},{name:"Trigger 5",value:0},{name:"Trigger 6",value:0},{name:"Trigger 7",value:0},{name:"Trigger 8",value:0},{name:"Trigger 9",value:0},{name:"Trigger 10",value:0},{name:"Trigger 11",value:0},{name:"Trigger 12",value:0},{name:"Trigger 13",value:0},{name:"Trigger 14",value:0},{name:"Trigger 15",value:0},{name:"Trigger 16",value:0},{name:"Trigger 17",value:0},{name:"Trigger 18",value:0},{name:"Trigger 19",value:0},{name:"Trigger 20",value:0},{name:"Trigger 21",value:0},{name:"Trigger 22",value:0},{name:"Trigger 23",value:0},{name:"Default Trigger",value:0}]},{objName:"Ops.Vars.VarGetNumber_v2",id:"59",uiAttribs:{subPatch:0},portsIn:[{name:"Variable",value:"objId"}],portsOut:[{name:"Value",links:[{portIn:"Switch Value",portOut:"Value",objIn:"58",objOut:"59"}]}]},{objName:"Ops.Sidebar.Button_v2",id:"60",uiAttribs:{subPatch:0},portsIn:[{name:"link"},{name:"Text",value:"Reset Camera"},{name:"Grey Out",value:false},{name:"Visible",value:true}],portsOut:[{name:"childs",links:[{portIn:"link",portOut:"childs",objIn:"44",objOut:"60"}]},{name:"Pressed Trigger",links:[{portIn:"Trigger",portOut:"Pressed Trigger",objIn:"61",objOut:"60"}]}]},{objName:"Ops.Trigger.TriggerSend",id:"61",uiAttribs:{subPatch:0},portsIn:[{name:"Trigger"},{name:"Named Trigger",value:"resetCamera"}],portsOut:[]},{objName:"Ops.Gl.GLTF.GltfScene_v3",id:"62",uiAttribs:{subPatch:0},portsIn:[{name:"data",value:'{"hiddenNodes":{"mesh_00":true}}'},{name:"Render"},{name:"glb File",value:"assets/620ce31dcef9e411244c5e84_part_5_obj_4.glb",display:"file"},{name:"Draw",value:true},{name:"Camera index",value:0},{name:"Camera",value:"None"},{name:"Animation",value:""},{name:"Show Structure",value:0},{name:"Center index",value:1},{name:"Center",value:"XYZ"},{name:"Rescale",value:true},{name:"Rescale Size",value:1},{name:"Time",value:0},{name:"Sync to timeline",value:false},{name:"Loop",value:false},{name:"Normals Format index",value:0},{name:"Normals Format",value:"XYZ"},{name:"Vertices Format index",value:0},{name:"Vertices Format",value:"XYZ"},{name:"Calc Normals",value:false},{name:"Materials",value:0},{name:"Hide Nodes",value:0},{name:"Use Material Properties",value:true},{name:"Active",value:true}],portsOut:[{name:"Render Before",value:0},{name:"Next",value:0},{name:"Generator",value:"Khronos glTF Blender I/O v1.7.33"},{name:"GLTF Version",value:2},{name:"GLTF Extensions Used"},{name:"Anim Length",value:0},{name:"Anim Time",value:0},{name:"Json"},{name:"Anims"},{name:"BoundingPoints"},{name:"Bounds"},{name:"Finished",value:0},{name:"Loading",value:false}]},{objName:"Ops.Gl.Matrix.Transform",id:"63",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"posX",value:0},{name:"posY",value:.5},{name:"posZ",value:0},{name:"scale",value:1},{name:"rotX",value:0},{name:"rotY",value:90},{name:"rotZ",value:0}],portsOut:[{name:"trigger",links:[{portIn:"Execute",portOut:"trigger",objIn:"58",objOut:"63"}]}]},{objName:"Ops.Gl.Geometry.GeometryInfo",id:"64",uiAttribs:{subPatch:"e88c760e-6c22-407a-8194-54c9884b404e"},portsIn:[{name:"Geometry"}],portsOut:[{name:"Indexed",value:null},{name:"Faces",value:null},{name:"Vertices",value:null},{name:"Normals",value:null},{name:"TexCoords",value:null},{name:"Tangents",value:null},{name:"BiTangents",value:null},{name:"VertexColors",links:[{portIn:"number1",portOut:"VertexColors",objIn:"71",objOut:"64"}]},{name:"Other Attributes",value:null}]},{objName:"Ops.User.kikohs.PLYLoader",id:"65",uiAttribs:{subPatch:"e88c760e-6c22-407a-8194-54c9884b404e"},portsIn:[{name:"PLY File",display:"file"},{name:"Auto-load",value:false},{name:"Custom Property map",value:0},{name:"Reload"}],portsOut:[{name:"Loaded",value:0},{name:"Geometry",links:[{portIn:"Geometry",portOut:"Geometry",objIn:"1",objOut:"65"},{portIn:"Geometry",portOut:"Geometry",objIn:"64",objOut:"65"}]},{name:"Loading",value:false},{name:"Is Point Cloud?",links:[{portIn:"Switch Value",portOut:"Is Point Cloud?",objIn:"6",objOut:"65"}]},{name:"Error",value:null}]},{objName:"Ops.Math.Sum",id:"66",uiAttribs:{subPatch:0},portsIn:[{name:"number1"},{name:"number2",value:1}],portsOut:[{name:"result",links:[{portIn:"Value",portOut:"result",objIn:"129",objOut:"66"}]}]},{objName:"Ops.User.kikohs.DropDown_withReset",id:"67",uiAttribs:{subPatch:0},portsIn:[{name:"Link"},{name:"Text",value:"Model"},{name:"Values"},{name:"Default",value:"Wall 1"},{name:"Grey Out",value:false},{name:"Visible",value:true},{name:"Lines",value:1},{name:"Reset"}],portsOut:[{name:"Children"},{name:"Result",value:"Wall 1"},{name:"Index",links:[{portIn:"number1",portOut:"Index",objIn:"66",objOut:"67"}]}]},{objName:"Ops.User.kikohs.DropDown_withReset",id:"68",uiAttribs:{subPatch:0},portsIn:[{name:"Link"},{name:"Text",value:"Model"},{name:"Values"},{name:"Default",value:"Wall"},{name:"Grey Out",value:false},{name:"Visible",value:true},{name:"Lines",value:1},{name:"Reset"}],portsOut:[{name:"Children"},{name:"Result",value:"Wall"},{name:"Index",links:[{portIn:"number1",portOut:"Index",objIn:"48",objOut:"68"}]}]},{objName:"Ops.Array.ParseArray_v2",id:"69",uiAttribs:{subPatch:0},portsIn:[{name:"text",value:"Layer 1, Layer 2, Layer 3, Layer 4, Layer 5, Layer 6, Layer 7, Layer 8,"},{name:"separator",value:","},{name:"Numbers",value:false},{name:"Trim",value:true}],portsOut:[{name:"Parsed",value:0},{name:"array",links:[{portIn:"Value",portOut:"array",objIn:"70",objOut:"69"}]},{name:"length",value:8}]},{objName:"Ops.Vars.VarSetArray_v2",id:"70",uiAttribs:{subPatch:0},portsIn:[{name:"Value"},{name:"Variable",value:"part4_labels"},{name:"Create new variable",value:0},{name:"",value:["Rename"]}],portsOut:[]},{objName:"Ops.Math.Compare.GreaterThan",id:"71",uiAttribs:{subPatch:"e88c760e-6c22-407a-8194-54c9884b404e"},portsIn:[{name:"number1"},{name:"number2",value:0}],portsOut:[{name:"result",links:[{portIn:"boolean",portOut:"result",objIn:"72",objOut:"71"}]}]},{objName:"Ops.Boolean.IfTrueThen_v2",id:"72",uiAttribs:{subPatch:"e88c760e-6c22-407a-8194-54c9884b404e"},portsIn:[{name:"exe"},{name:"boolean"}],portsOut:[{name:"then",links:[{portIn:"Render",portOut:"then",objIn:"12",objOut:"72"}]},{name:"else",links:[{portIn:"render",portOut:"else",objIn:"1",objOut:"72"}]}]},{objName:"Ops.Gl.RenderGeometry",id:"73",uiAttribs:{subPatch:"e3e9c579-084f-4560-896f-5af6e84c4210"},portsIn:[{name:"render"},{name:"Geometry"},{name:"Update All",value:true},{name:"Update Face Indices",value:false},{name:"Update Vertices",value:false},{name:"Update Texcoords",value:false},{name:"Vertex Numbers",value:false}],portsOut:[{name:"trigger",links:[{portIn:"out0 Ops.Gl.GLTF.GltfNode_v2 Render",portOut:"trigger",objIn:"79",objOut:"73"}]}]},{objName:"Ops.Trigger.RouteTrigger",id:"74",uiAttribs:{subPatch:"e3e9c579-084f-4560-896f-5af6e84c4210"},portsIn:[{name:"Execute"},{name:"Switch Value"}],portsOut:[{name:"Next Trigger",value:0},{name:"Switched Value",value:0},{name:"Trigger 0",links:[{portIn:"Trigger In",portOut:"Trigger 0",objIn:"76",objOut:"74"}]},{name:"Trigger 1",links:[{portIn:"render",portOut:"Trigger 1",objIn:"75",objOut:"74"}]},{name:"Trigger 2",value:0},{name:"Trigger 3",value:0},{name:"Trigger 4",value:0},{name:"Trigger 5",value:0},{name:"Trigger 6",value:0},{name:"Trigger 7",value:0},{name:"Trigger 8",value:0},{name:"Trigger 9",value:0},{name:"Trigger 10",value:0},{name:"Trigger 11",value:0},{name:"Trigger 12",value:0},{name:"Trigger 13",value:0},{name:"Trigger 14",value:0},{name:"Trigger 15",value:0},{name:"Trigger 16",value:0},{name:"Trigger 17",value:0},{name:"Trigger 18",value:0},{name:"Trigger 19",value:0},{name:"Trigger 20",value:0},{name:"Trigger 21",value:0},{name:"Trigger 22",value:0},{name:"Trigger 23",value:0},{name:"Default Trigger",value:0}]},{objName:"Ops.Gl.Shader.PointMaterial_v4",id:"75",uiAttribs:{subPatch:"e3e9c579-084f-4560-896f-5af6e84c4210"},portsIn:[{name:"render"},{name:"PointSize",value:1.47},{name:"Size in Pixels",value:false},{name:"Random Size",value:0},{name:"Round",value:true},{name:"Round Antialias",value:false},{name:"Scale by Distance",value:false},{name:"r",value:1},{name:"g",value:1},{name:"b",value:1},{name:"a",value:1},{name:"Vertex Colors",value:true},{name:"texture",value:0},{name:"Colorize Texture",value:false},{name:"Texture Mask",value:0},{name:"Mask Channel index",value:0},{name:"Mask Channel",value:"R"},{name:"Texture Colorize",value:0},{name:"Colorize Randomize",value:true},{name:"Texture Opacity",value:0},{name:"Texture Point Size",value:0},{name:"Point Size Channel index",value:0},{name:"Point Size Channel",value:"R"},{name:"Texture Point Size Mul",value:1},{name:"Map Size 0 index",value:0},{name:"Map Size 0",value:"Black"},{name:"Flip Texture",value:false}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"73",objOut:"75"}]},{name:"shader"}]},{objName:"Ops.Gl.Phong.PhongMaterial_v6",id:"76",uiAttribs:{subPatch:"e3e9c579-084f-4560-896f-5af6e84c4210"},portsIn:[{name:"Trigger In"},{name:"R",value:.15643332304007687},{name:"G",value:.7110372210831507},{name:"B",value:.8106666638453801},{name:"A",value:1},{name:"Enable",value:false},{name:"Albedo",value:.707},{name:"Roughness",value:.835},{name:"Active",value:false},{name:"Fresnel Intensity",value:.7},{name:"Fresnel Width",value:1},{name:"Fresnel Exponent",value:6},{name:"Fresnel R",value:1},{name:"Fresnel G",value:1},{name:"Fresnel B",value:1},{name:"Emissive Active",value:false},{name:"Color Intensity",value:.3},{name:"Emissive R",value:.7528171913638779},{name:"Emissive G",value:.36422624829379013},{name:"Emissive B",value:.3103095732889889},{name:"Shininess",value:4},{name:"Specular Amount",value:.5},{name:"Specular Model index",value:0},{name:"Specular Model",value:"Blinn"},{name:"Energy Conservation",value:false},{name:"Double Sided Material",value:false},{name:"Falloff Mode index",value:0},{name:"Falloff Mode",value:"A"},{name:"Diffuse Texture",value:0},{name:"Specular Texture",value:0},{name:"Normal Map",value:0},{name:"AO Texture",value:0},{name:"Emissive Texture",value:0},{name:"Emissive Mask",value:0},{name:"Opacity Texture",value:0},{name:"Environment Map",value:0},{name:"Env Map Mask",value:0},{name:"Colorize Texture",value:true},{name:"Diffuse Repeat X",value:1},{name:"Diffuse Repeat Y",value:1},{name:"Texture Offset X",value:0},{name:"Texture Offset Y",value:0},{name:"Specular Intensity",value:1},{name:"Normal Map Intensity",value:.5},{name:"AO Intensity",value:1},{name:"Emissive Intensity",value:1},{name:"Emissive Mask Intensity",value:1},{name:"Env Map Intensity",value:1},{name:"Env Map Blend index",value:0},{name:"Env Map Blend",value:"Add"},{name:"Env Mask Intensity",value:1},{name:"Alpha Mask Source index",value:0},{name:"Alpha Mask Source",value:"Luminance"},{name:"Discard Transparent Pixels",value:false}],portsOut:[{name:"Trigger Out",links:[{portIn:"exe",portOut:"Trigger Out",objIn:"84",objOut:"76"}]},{name:"Shader"}]},{objName:"Ops.Gl.ShaderEffects.UseVertexColor",id:"77",uiAttribs:{subPatch:"e3e9c579-084f-4560-896f-5af6e84c4210"},portsIn:[{name:"Render"}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"73",objOut:"77"}]}]},{objName:"Ops.Ui.PatchInput",id:"78",uiAttribs:{subPatch:"e3e9c579-084f-4560-896f-5af6e84c4210"},portsIn:[],portsOut:[{name:"create port",value:0},{name:"in0 Ops.Gl.Matrix.Transform trigger",links:[{portIn:"Execute",portOut:"in0 Ops.Gl.Matrix.Transform trigger",objIn:"74",objOut:"78"},{portIn:"Exec",portOut:"in0 Ops.Gl.Matrix.Transform trigger",objIn:"119",objOut:"78"}]},{name:"in1 Ops.String.SwitchString Result",links:[{portIn:"PLY File",portOut:"in1 Ops.String.SwitchString Result",objIn:"82",objOut:"78"}]}]},{objName:"Ops.Ui.PatchOutput",id:"79",uiAttribs:{subPatch:"e3e9c579-084f-4560-896f-5af6e84c4210"},portsIn:[{name:"create port",value:0},{name:"out0 Ops.Gl.GLTF.GltfNode_v2 Render"}],portsOut:[]},{objName:"Ops.Ui.SubPatch",id:"80",uiAttribs:{subPatch:0},portsIn:[{name:"create port",value:null},{name:"dataStr",value:'{"ports":[{"name":"in0 Ops.Gl.Matrix.Transform trigger","type":1,"title":"Render"},{"name":"in1 Ops.String.SwitchString Result","type":5,"title":"URL"}],"portsOut":[{"name":"out0 Ops.Gl.GLTF.GltfNode_v2 Render","type":1}]}'},{name:"patchId",value:"e3e9c579-084f-4560-896f-5af6e84c4210"},{name:"in0 Ops.Gl.Matrix.Transform trigger"},{name:"in1 Ops.String.SwitchString Result"}],portsOut:[{name:"create port out",value:0},{name:"out0 Ops.Gl.GLTF.GltfNode_v2 Render"}]},{objName:"Ops.Gl.Geometry.GeometryInfo",id:"81",uiAttribs:{subPatch:"e3e9c579-084f-4560-896f-5af6e84c4210"},portsIn:[{name:"Geometry"}],portsOut:[{name:"Indexed",value:null},{name:"Faces",value:null},{name:"Vertices",value:null},{name:"Normals",value:null},{name:"TexCoords",value:null},{name:"Tangents",value:null},{name:"BiTangents",value:null},{name:"VertexColors",links:[{portIn:"number1",portOut:"VertexColors",objIn:"83",objOut:"81"}]},{name:"Other Attributes",value:null}]},{objName:"Ops.User.kikohs.PLYLoader",id:"82",uiAttribs:{subPatch:"e3e9c579-084f-4560-896f-5af6e84c4210"},portsIn:[{name:"PLY File",display:"file"},{name:"Auto-load",value:false},{name:"Custom Property map",value:0},{name:"Reload"}],portsOut:[{name:"Loaded",value:0},{name:"Geometry",links:[{portIn:"Geometry",portOut:"Geometry",objIn:"73",objOut:"82"},{portIn:"Geometry",portOut:"Geometry",objIn:"81",objOut:"82"}]},{name:"Loading",value:false},{name:"Is Point Cloud?",links:[{portIn:"Switch Value",portOut:"Is Point Cloud?",objIn:"74",objOut:"82"}]},{name:"Error",value:null}]},{objName:"Ops.Math.Compare.GreaterThan",id:"83",uiAttribs:{subPatch:"e3e9c579-084f-4560-896f-5af6e84c4210"},portsIn:[{name:"number1"},{name:"number2",value:0}],portsOut:[{name:"result",links:[{portIn:"boolean",portOut:"result",objIn:"84",objOut:"83"}]}]},{objName:"Ops.Boolean.IfTrueThen_v2",id:"84",uiAttribs:{subPatch:"e3e9c579-084f-4560-896f-5af6e84c4210"},portsIn:[{name:"exe"},{name:"boolean"}],portsOut:[{name:"then",links:[{portIn:"Render",portOut:"then",objIn:"77",objOut:"84"}]},{name:"else",links:[{portIn:"render",portOut:"else",objIn:"73",objOut:"84"}]}]},{objName:"Ops.Cables.AssetPathURL",id:"85",uiAttribs:{subPatch:0},portsIn:[{name:"Filename",value:"stone1.ply"}],portsOut:[{name:"Path",links:[{portIn:"in1 Ops.String.SwitchString Result",portOut:"Path",objIn:"80",objOut:"85"}]}]},{objName:"Ops.Trigger.RouteTrigger",id:"86",uiAttribs:{subPatch:0},portsIn:[{name:"Execute"},{name:"Switch Value"}],portsOut:[{name:"Next Trigger",value:0},{name:"Switched Value",value:1},{name:"Trigger 0",value:0},{name:"Trigger 1",links:[{portIn:"render",portOut:"Trigger 1",objIn:"399",objOut:"86"}]},{name:"Trigger 2",links:[{portIn:"render",portOut:"Trigger 2",objIn:"400",objOut:"86"}]},{name:"Trigger 3",links:[{portIn:"render",portOut:"Trigger 3",objIn:"402",objOut:"86"}]},{name:"Trigger 4",links:[{portIn:"render",portOut:"Trigger 4",objIn:"403",objOut:"86"}]},{name:"Trigger 5",links:[{portIn:"render",portOut:"Trigger 5",objIn:"404",objOut:"86"}]},{name:"Trigger 6",links:[{portIn:"exe",portOut:"Trigger 6",objIn:"286",objOut:"86"}]},{name:"Trigger 7",links:[{portIn:"render",portOut:"Trigger 7",objIn:"401",objOut:"86"}]},{name:"Trigger 8",links:[{portIn:"render",portOut:"Trigger 8",objIn:"446",objOut:"86"}]},{name:"Trigger 9",value:0},{name:"Trigger 10",value:0},{name:"Trigger 11",value:0},{name:"Trigger 12",value:0},{name:"Trigger 13",value:0},{name:"Trigger 14",value:0},{name:"Trigger 15",value:0},{name:"Trigger 16",value:0},{name:"Trigger 17",value:0},{name:"Trigger 18",value:0},{name:"Trigger 19",value:0},{name:"Trigger 20",value:0},{name:"Trigger 21",value:0},{name:"Trigger 22",value:0},{name:"Trigger 23",value:0},{name:"Default Trigger",value:0}]},{objName:"Ops.Vars.VarGetNumber_v2",id:"87",uiAttribs:{subPatch:0},portsIn:[{name:"Variable",value:"objId"}],portsOut:[{name:"Value",links:[{portIn:"Switch Value",portOut:"Value",objIn:"86",objOut:"87"}]}]},{objName:"Ops.Sequence",id:"88",uiAttribs:{subPatch:0},portsIn:[{name:"exe",value:null},{name:"Clean up connections",value:0},{name:"exe 0",value:0},{name:"exe 1",value:0},{name:"exe 2",value:0},{name:"exe 3",value:0},{name:"exe 4",value:0},{name:"exe 5",value:0},{name:"exe 6",value:0},{name:"exe 7",value:0},{name:"exe 8",value:0},{name:"exe 9",value:0},{name:"exe 10",value:0},{name:"exe 11",value:0},{name:"exe 12",value:0},{name:"exe 13",value:0},{name:"exe 14",value:0}],portsOut:[{name:"trigger 0",links:[{portIn:"in0 Ops.Gl.Matrix.Transform trigger",portOut:"trigger 0",objIn:"16",objOut:"88"}]},{name:"trigger 1",links:[{portIn:"in0 Ops.Gl.Matrix.Transform trigger",portOut:"trigger 1",objIn:"80",objOut:"88"}]},{name:"trigger 2",links:[{portIn:"in0 Ops.Gl.Matrix.Transform trigger",portOut:"trigger 2",objIn:"97",objOut:"88"}]},{name:"trigger 3",value:0},{name:"trigger 4",value:0},{name:"trigger 5",value:0},{name:"trigger 6",value:0},{name:"trigger 7",value:0},{name:"trigger 8",value:0},{name:"trigger 9",value:0},{name:"trigger 10",value:0},{name:"trigger 11",value:0},{name:"trigger 12",value:0},{name:"trigger 13",value:0},{name:"trigger 14",value:0},{name:"trigger 15",value:0}]},{objName:"Ops.Cables.AssetPathURL",id:"89",uiAttribs:{subPatch:0},portsIn:[{name:"Filename",value:"part_4_obj_1.ply"}],portsOut:[{name:"Path",links:[{portIn:"in1 Ops.String.SwitchString Result",portOut:"Path",objIn:"16",objOut:"89"}]}]},{objName:"Ops.Gl.RenderGeometry",id:"90",uiAttribs:{subPatch:"9f4fb244-de1f-490a-8dba-69a6dc8069fa"},portsIn:[{name:"render"},{name:"Geometry"},{name:"Update All",value:true},{name:"Update Face Indices",value:false},{name:"Update Vertices",value:false},{name:"Update Texcoords",value:false},{name:"Vertex Numbers",value:false}],portsOut:[{name:"trigger",links:[{portIn:"out0 Ops.Gl.GLTF.GltfNode_v2 Render",portOut:"trigger",objIn:"96",objOut:"90"}]}]},{objName:"Ops.Trigger.RouteTrigger",id:"91",uiAttribs:{subPatch:"9f4fb244-de1f-490a-8dba-69a6dc8069fa"},portsIn:[{name:"Execute"},{name:"Switch Value"}],portsOut:[{name:"Next Trigger",value:0},{name:"Switched Value",value:0},{name:"Trigger 0",links:[{portIn:"Trigger In",portOut:"Trigger 0",objIn:"93",objOut:"91"}]},{name:"Trigger 1",links:[{portIn:"render",portOut:"Trigger 1",objIn:"92",objOut:"91"}]},{name:"Trigger 2",value:0},{name:"Trigger 3",value:0},{name:"Trigger 4",value:0},{name:"Trigger 5",value:0},{name:"Trigger 6",value:0},{name:"Trigger 7",value:0},{name:"Trigger 8",value:0},{name:"Trigger 9",value:0},{name:"Trigger 10",value:0},{name:"Trigger 11",value:0},{name:"Trigger 12",value:0},{name:"Trigger 13",value:0},{name:"Trigger 14",value:0},{name:"Trigger 15",value:0},{name:"Trigger 16",value:0},{name:"Trigger 17",value:0},{name:"Trigger 18",value:0},{name:"Trigger 19",value:0},{name:"Trigger 20",value:0},{name:"Trigger 21",value:0},{name:"Trigger 22",value:0},{name:"Trigger 23",value:0},{name:"Default Trigger",value:0}]},{objName:"Ops.Gl.Shader.PointMaterial_v4",id:"92",uiAttribs:{subPatch:"9f4fb244-de1f-490a-8dba-69a6dc8069fa"},portsIn:[{name:"render"},{name:"PointSize",value:1.47},{name:"Size in Pixels",value:false},{name:"Random Size",value:0},{name:"Round",value:true},{name:"Round Antialias",value:false},{name:"Scale by Distance",value:false},{name:"r",value:1},{name:"g",value:1},{name:"b",value:1},{name:"a",value:1},{name:"Vertex Colors",value:true},{name:"texture",value:0},{name:"Colorize Texture",value:false},{name:"Texture Mask",value:0},{name:"Mask Channel index",value:0},{name:"Mask Channel",value:"R"},{name:"Texture Colorize",value:0},{name:"Colorize Randomize",value:true},{name:"Texture Opacity",value:0},{name:"Texture Point Size",value:0},{name:"Point Size Channel index",value:0},{name:"Point Size Channel",value:"R"},{name:"Texture Point Size Mul",value:1},{name:"Map Size 0 index",value:0},{name:"Map Size 0",value:"Black"},{name:"Flip Texture",value:false}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"90",objOut:"92"}]},{name:"shader"}]},{objName:"Ops.Gl.Phong.PhongMaterial_v6",id:"93",uiAttribs:{subPatch:"9f4fb244-de1f-490a-8dba-69a6dc8069fa"},portsIn:[{name:"Trigger In"},{name:"R",value:.8506666644414266},{name:"G",value:.5094861914999278},{name:"B",value:.5094861914999278},{name:"A",value:1},{name:"Enable",value:false},{name:"Albedo",value:.707},{name:"Roughness",value:.835},{name:"Active",value:false},{name:"Fresnel Intensity",value:.7},{name:"Fresnel Width",value:1},{name:"Fresnel Exponent",value:6},{name:"Fresnel R",value:1},{name:"Fresnel G",value:1},{name:"Fresnel B",value:1},{name:"Emissive Active",value:false},{name:"Color Intensity",value:.3},{name:"Emissive R",value:.7528171913638779},{name:"Emissive G",value:.36422624829379013},{name:"Emissive B",value:.3103095732889889},{name:"Shininess",value:4},{name:"Specular Amount",value:.5},{name:"Specular Model index",value:0},{name:"Specular Model",value:"Blinn"},{name:"Energy Conservation",value:false},{name:"Double Sided Material",value:false},{name:"Falloff Mode index",value:0},{name:"Falloff Mode",value:"A"},{name:"Diffuse Texture",value:0},{name:"Specular Texture",value:0},{name:"Normal Map",value:0},{name:"AO Texture",value:0},{name:"Emissive Texture",value:0},{name:"Emissive Mask",value:0},{name:"Opacity Texture",value:0},{name:"Environment Map",value:0},{name:"Env Map Mask",value:0},{name:"Colorize Texture",value:true},{name:"Diffuse Repeat X",value:1},{name:"Diffuse Repeat Y",value:1},{name:"Texture Offset X",value:0},{name:"Texture Offset Y",value:0},{name:"Specular Intensity",value:1},{name:"Normal Map Intensity",value:.5},{name:"AO Intensity",value:1},{name:"Emissive Intensity",value:1},{name:"Emissive Mask Intensity",value:1},{name:"Env Map Intensity",value:1},{name:"Env Map Blend index",value:0},{name:"Env Map Blend",value:"Add"},{name:"Env Mask Intensity",value:1},{name:"Alpha Mask Source index",value:0},{name:"Alpha Mask Source",value:"Luminance"},{name:"Discard Transparent Pixels",value:false}],portsOut:[{name:"Trigger Out",links:[{portIn:"exe",portOut:"Trigger Out",objIn:"101",objOut:"93"}]},{name:"Shader"}]},{objName:"Ops.Gl.ShaderEffects.UseVertexColor",id:"94",uiAttribs:{subPatch:"9f4fb244-de1f-490a-8dba-69a6dc8069fa"},portsIn:[{name:"Render"}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"90",objOut:"94"}]}]},{objName:"Ops.Ui.PatchInput",id:"95",uiAttribs:{subPatch:"9f4fb244-de1f-490a-8dba-69a6dc8069fa"},portsIn:[],portsOut:[{name:"create port",value:0},{name:"in0 Ops.Gl.Matrix.Transform trigger",links:[{portIn:"Execute",portOut:"in0 Ops.Gl.Matrix.Transform trigger",objIn:"91",objOut:"95"},{portIn:"Exec",portOut:"in0 Ops.Gl.Matrix.Transform trigger",objIn:"120",objOut:"95"}]},{name:"in1 Ops.String.SwitchString Result",links:[{portIn:"PLY File",portOut:"in1 Ops.String.SwitchString Result",objIn:"99",objOut:"95"}]}]},{objName:"Ops.Ui.PatchOutput",id:"96",uiAttribs:{subPatch:"9f4fb244-de1f-490a-8dba-69a6dc8069fa"},portsIn:[{name:"create port",value:0},{name:"out0 Ops.Gl.GLTF.GltfNode_v2 Render"}],portsOut:[]},{objName:"Ops.Ui.SubPatch",id:"97",uiAttribs:{subPatch:0},portsIn:[{name:"create port",value:null},{name:"dataStr",value:'{"ports":[{"name":"in0 Ops.Gl.Matrix.Transform trigger","type":1,"title":"Render"},{"name":"in1 Ops.String.SwitchString Result","type":5,"title":"URL"}],"portsOut":[{"name":"out0 Ops.Gl.GLTF.GltfNode_v2 Render","type":1}]}'},{name:"patchId",value:"9f4fb244-de1f-490a-8dba-69a6dc8069fa"},{name:"in0 Ops.Gl.Matrix.Transform trigger"},{name:"in1 Ops.String.SwitchString Result"}],portsOut:[{name:"create port out",value:0},{name:"out0 Ops.Gl.GLTF.GltfNode_v2 Render"}]},{objName:"Ops.Gl.Geometry.GeometryInfo",id:"98",uiAttribs:{subPatch:"9f4fb244-de1f-490a-8dba-69a6dc8069fa"},portsIn:[{name:"Geometry"}],portsOut:[{name:"Indexed",value:null},{name:"Faces",value:null},{name:"Vertices",value:null},{name:"Normals",value:null},{name:"TexCoords",value:null},{name:"Tangents",value:null},{name:"BiTangents",value:null},{name:"VertexColors",links:[{portIn:"number1",portOut:"VertexColors",objIn:"100",objOut:"98"}]},{name:"Other Attributes",value:null}]},{objName:"Ops.User.kikohs.PLYLoader",id:"99",uiAttribs:{subPatch:"9f4fb244-de1f-490a-8dba-69a6dc8069fa"},portsIn:[{name:"PLY File",display:"file"},{name:"Auto-load",value:false},{name:"Custom Property map",value:0},{name:"Reload"}],portsOut:[{name:"Loaded",value:0},{name:"Geometry",links:[{portIn:"Geometry",portOut:"Geometry",objIn:"90",objOut:"99"},{portIn:"Geometry",portOut:"Geometry",objIn:"98",objOut:"99"}]},{name:"Loading",value:false},{name:"Is Point Cloud?",links:[{portIn:"Switch Value",portOut:"Is Point Cloud?",objIn:"91",objOut:"99"}]},{name:"Error",value:null}]},{objName:"Ops.Math.Compare.GreaterThan",id:"100",uiAttribs:{subPatch:"9f4fb244-de1f-490a-8dba-69a6dc8069fa"},portsIn:[{name:"number1"},{name:"number2",value:0}],portsOut:[{name:"result",links:[{portIn:"boolean",portOut:"result",objIn:"101",objOut:"100"}]}]},{objName:"Ops.Boolean.IfTrueThen_v2",id:"101",uiAttribs:{subPatch:"9f4fb244-de1f-490a-8dba-69a6dc8069fa"},portsIn:[{name:"exe"},{name:"boolean"}],portsOut:[{name:"then",links:[{portIn:"Render",portOut:"then",objIn:"94",objOut:"101"}]},{name:"else",links:[{portIn:"render",portOut:"else",objIn:"90",objOut:"101"}]}]},{objName:"Ops.Sequence",id:"102",uiAttribs:{subPatch:0},portsIn:[{name:"exe",value:null},{name:"Clean up connections",value:0},{name:"exe 0",value:0},{name:"exe 1",value:0},{name:"exe 2",value:0},{name:"exe 3",value:0},{name:"exe 4",value:0},{name:"exe 5",value:0},{name:"exe 6",value:0},{name:"exe 7",value:0},{name:"exe 8",value:0},{name:"exe 9",value:0},{name:"exe 10",value:0},{name:"exe 11",value:0},{name:"exe 12",value:0},{name:"exe 13",value:0},{name:"exe 14",value:0}],portsOut:[{name:"trigger 0",links:[{portIn:"render",portOut:"trigger 0",objIn:"116",objOut:"102"}]},{name:"trigger 1",value:0},{name:"trigger 2",value:0},{name:"trigger 3",value:0},{name:"trigger 4",value:0},{name:"trigger 5",value:0},{name:"trigger 6",value:0},{name:"trigger 7",value:0},{name:"trigger 8",value:0},{name:"trigger 9",value:0},{name:"trigger 10",value:0},{name:"trigger 11",value:0},{name:"trigger 12",value:0},{name:"trigger 13",value:0},{name:"trigger 14",value:0},{name:"trigger 15",value:0}]},{objName:"Ops.Gl.RenderGeometry",id:"103",uiAttribs:{subPatch:"4a591837-f958-49a8-ba17-a9aaddffe4aa"},portsIn:[{name:"render"},{name:"Geometry"},{name:"Update All",value:true},{name:"Update Face Indices",value:false},{name:"Update Vertices",value:false},{name:"Update Texcoords",value:false},{name:"Vertex Numbers",value:false}],portsOut:[{name:"trigger",links:[{portIn:"out0 Ops.Gl.GLTF.GltfNode_v2 Render",portOut:"trigger",objIn:"109",objOut:"103"}]}]},{objName:"Ops.Trigger.RouteTrigger",id:"104",uiAttribs:{subPatch:"4a591837-f958-49a8-ba17-a9aaddffe4aa"},portsIn:[{name:"Execute"},{name:"Switch Value"}],portsOut:[{name:"Next Trigger",value:0},{name:"Switched Value",value:1},{name:"Trigger 0",links:[{portIn:"Trigger In",portOut:"Trigger 0",objIn:"106",objOut:"104"}]},{name:"Trigger 1",links:[{portIn:"render",portOut:"Trigger 1",objIn:"105",objOut:"104"}]},{name:"Trigger 2",value:0},{name:"Trigger 3",value:0},{name:"Trigger 4",value:0},{name:"Trigger 5",value:0},{name:"Trigger 6",value:0},{name:"Trigger 7",value:0},{name:"Trigger 8",value:0},{name:"Trigger 9",value:0},{name:"Trigger 10",value:0},{name:"Trigger 11",value:0},{name:"Trigger 12",value:0},{name:"Trigger 13",value:0},{name:"Trigger 14",value:0},{name:"Trigger 15",value:0},{name:"Trigger 16",value:0},{name:"Trigger 17",value:0},{name:"Trigger 18",value:0},{name:"Trigger 19",value:0},{name:"Trigger 20",value:0},{name:"Trigger 21",value:0},{name:"Trigger 22",value:0},{name:"Trigger 23",value:0},{name:"Default Trigger",value:0}]},{objName:"Ops.Gl.Shader.PointMaterial_v4",id:"105",uiAttribs:{subPatch:"4a591837-f958-49a8-ba17-a9aaddffe4aa"},portsIn:[{name:"render"},{name:"PointSize",value:1.47},{name:"Size in Pixels",value:false},{name:"Random Size",value:0},{name:"Round",value:true},{name:"Round Antialias",value:false},{name:"Scale by Distance",value:false},{name:"r",value:1},{name:"g",value:1},{name:"b",value:1},{name:"a",value:1},{name:"Vertex Colors",value:true},{name:"texture",value:0},{name:"Colorize Texture",value:false},{name:"Texture Mask",value:0},{name:"Mask Channel index",value:0},{name:"Mask Channel",value:"R"},{name:"Texture Colorize",value:0},{name:"Colorize Randomize",value:true},{name:"Texture Opacity",value:0},{name:"Texture Point Size",value:0},{name:"Point Size Channel index",value:0},{name:"Point Size Channel",value:"R"},{name:"Texture Point Size Mul",value:1},{name:"Map Size 0 index",value:0},{name:"Map Size 0",value:"Black"},{name:"Flip Texture",value:false}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"103",objOut:"105"}]},{name:"shader"}]},{objName:"Ops.Gl.Phong.PhongMaterial_v6",id:"106",uiAttribs:{subPatch:"4a591837-f958-49a8-ba17-a9aaddffe4aa"},portsIn:[{name:"Trigger In"},{name:"R",value:.8506666644414266},{name:"G",value:.5094861914999278},{name:"B",value:.5094861914999278},{name:"A",value:1},{name:"Enable",value:false},{name:"Albedo",value:.707},{name:"Roughness",value:.835},{name:"Active",value:false},{name:"Fresnel Intensity",value:.7},{name:"Fresnel Width",value:1},{name:"Fresnel Exponent",value:6},{name:"Fresnel R",value:1},{name:"Fresnel G",value:1},{name:"Fresnel B",value:1},{name:"Emissive Active",value:false},{name:"Color Intensity",value:.3},{name:"Emissive R",value:.7528171913638779},{name:"Emissive G",value:.36422624829379013},{name:"Emissive B",value:.3103095732889889},{name:"Shininess",value:4},{name:"Specular Amount",value:.5},{name:"Specular Model index",value:0},{name:"Specular Model",value:"Blinn"},{name:"Energy Conservation",value:false},{name:"Double Sided Material",value:false},{name:"Falloff Mode index",value:0},{name:"Falloff Mode",value:"A"},{name:"Diffuse Texture",value:0},{name:"Specular Texture",value:0},{name:"Normal Map",value:0},{name:"AO Texture",value:0},{name:"Emissive Texture",value:0},{name:"Emissive Mask",value:0},{name:"Opacity Texture",value:0},{name:"Environment Map",value:0},{name:"Env Map Mask",value:0},{name:"Colorize Texture",value:true},{name:"Diffuse Repeat X",value:1},{name:"Diffuse Repeat Y",value:1},{name:"Texture Offset X",value:0},{name:"Texture Offset Y",value:0},{name:"Specular Intensity",value:1},{name:"Normal Map Intensity",value:.5},{name:"AO Intensity",value:1},{name:"Emissive Intensity",value:1},{name:"Emissive Mask Intensity",value:1},{name:"Env Map Intensity",value:1},{name:"Env Map Blend index",value:0},{name:"Env Map Blend",value:"Add"},{name:"Env Mask Intensity",value:1},{name:"Alpha Mask Source index",value:0},{name:"Alpha Mask Source",value:"Luminance"},{name:"Discard Transparent Pixels",value:false}],portsOut:[{name:"Trigger Out",links:[{portIn:"exe",portOut:"Trigger Out",objIn:"114",objOut:"106"}]},{name:"Shader"}]},{objName:"Ops.Gl.ShaderEffects.UseVertexColor",id:"107",uiAttribs:{subPatch:"4a591837-f958-49a8-ba17-a9aaddffe4aa"},portsIn:[{name:"Render"}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"103",objOut:"107"}]}]},{objName:"Ops.Ui.PatchInput",id:"108",uiAttribs:{subPatch:"4a591837-f958-49a8-ba17-a9aaddffe4aa"},portsIn:[],portsOut:[{name:"create port",value:0},{name:"in0 Ops.Gl.Matrix.Transform trigger",links:[{portIn:"Execute",portOut:"in0 Ops.Gl.Matrix.Transform trigger",objIn:"104",objOut:"108"},{portIn:"Exec",portOut:"in0 Ops.Gl.Matrix.Transform trigger",objIn:"121",objOut:"108"}]},{name:"in1 Ops.String.SwitchString Result",links:[{portIn:"PLY File",portOut:"in1 Ops.String.SwitchString Result",objIn:"112",objOut:"108"}]}]},{objName:"Ops.Ui.PatchOutput",id:"109",uiAttribs:{subPatch:"4a591837-f958-49a8-ba17-a9aaddffe4aa"},portsIn:[{name:"create port",value:0},{name:"out0 Ops.Gl.GLTF.GltfNode_v2 Render"}],portsOut:[]},{objName:"Ops.Ui.SubPatch",id:"110",uiAttribs:{subPatch:0},portsIn:[{name:"create port",value:null},{name:"dataStr",value:'{"ports":[{"name":"in0 Ops.Gl.Matrix.Transform trigger","type":1,"title":"Render"},{"name":"in1 Ops.String.SwitchString Result","type":5,"title":"URL"}],"portsOut":[{"name":"out0 Ops.Gl.GLTF.GltfNode_v2 Render","type":1}]}'},{name:"patchId",value:"4a591837-f958-49a8-ba17-a9aaddffe4aa"},{name:"in0 Ops.Gl.Matrix.Transform trigger"},{name:"in1 Ops.String.SwitchString Result"}],portsOut:[{name:"create port out",value:0},{name:"out0 Ops.Gl.GLTF.GltfNode_v2 Render"}]},{objName:"Ops.Gl.Geometry.GeometryInfo",id:"111",uiAttribs:{subPatch:"4a591837-f958-49a8-ba17-a9aaddffe4aa"},portsIn:[{name:"Geometry"}],portsOut:[{name:"Indexed",value:null},{name:"Faces",value:null},{name:"Vertices",value:null},{name:"Normals",value:null},{name:"TexCoords",value:null},{name:"Tangents",value:null},{name:"BiTangents",value:null},{name:"VertexColors",links:[{portIn:"number1",portOut:"VertexColors",objIn:"113",objOut:"111"}]},{name:"Other Attributes",value:null}]},{objName:"Ops.User.kikohs.PLYLoader",id:"112",uiAttribs:{subPatch:"4a591837-f958-49a8-ba17-a9aaddffe4aa"},portsIn:[{name:"PLY File",display:"file"},{name:"Auto-load",value:false},{name:"Custom Property map",value:0},{name:"Reload"}],portsOut:[{name:"Loaded",value:0},{name:"Geometry",links:[{portIn:"Geometry",portOut:"Geometry",objIn:"103",objOut:"112"},{portIn:"Geometry",portOut:"Geometry",objIn:"111",objOut:"112"}]},{name:"Loading",value:false},{name:"Is Point Cloud?",links:[{portIn:"Switch Value",portOut:"Is Point Cloud?",objIn:"104",objOut:"112"}]},{name:"Error",value:null}]},{objName:"Ops.Math.Compare.GreaterThan",id:"113",uiAttribs:{subPatch:"4a591837-f958-49a8-ba17-a9aaddffe4aa"},portsIn:[{name:"number1"},{name:"number2",value:0}],portsOut:[{name:"result",links:[{portIn:"boolean",portOut:"result",objIn:"114",objOut:"113"}]}]},{objName:"Ops.Boolean.IfTrueThen_v2",id:"114",uiAttribs:{subPatch:"4a591837-f958-49a8-ba17-a9aaddffe4aa"},portsIn:[{name:"exe"},{name:"boolean"}],portsOut:[{name:"then",links:[{portIn:"Render",portOut:"then",objIn:"107",objOut:"114"}]},{name:"else",links:[{portIn:"render",portOut:"else",objIn:"103",objOut:"114"}]}]},{objName:"Ops.Cables.AssetPathURL",id:"115",uiAttribs:{subPatch:0},portsIn:[{name:"Filename",value:"part_4_obj_2.ply"}],portsOut:[{name:"Path",links:[{portIn:"in1 Ops.String.SwitchString Result",portOut:"Path",objIn:"110",objOut:"115"}]}]},{objName:"Ops.Gl.Matrix.Transform",id:"116",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"posX",value:0},{name:"posY",value:0},{name:"posZ",value:.25},{name:"scale",value:1},{name:"rotX",value:0},{name:"rotY",value:0},{name:"rotZ",value:0}],portsOut:[{name:"trigger",links:[{portIn:"in0 Ops.Gl.Matrix.Transform trigger",portOut:"trigger",objIn:"110",objOut:"116"}]}]},{objName:"Ops.Gl.Pbr.PbrMaterial",id:"117",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"R",value:.4236666580786308},{name:"G",value:.3579135090176349},{name:"B",value:.33599579266396956},{name:"A",value:1},{name:"Roughness",value:0},{name:"Metalness",value:.444},{name:"Alpha Mode index",value:3},{name:"Alpha Mode",value:"Blend"},{name:"Tonemapping index",value:0},{name:"Tonemapping",value:"sRGB"},{name:"Exposure",value:1},{name:"Disable geometric roughness",value:false},{name:"Use roughness from normal map",value:false},{name:"Use Vertex Colours",value:false},{name:"Vertex Colour Mode index",value:0},{name:"Vertex Colour Mode",value:"colour"},{name:"Height Intensity",value:1},{name:"Faster heightmapping",value:false},{name:"Use Clear Coat",value:false},{name:"Clear Coat Roughness",value:.5},{name:"IBL LUT"},{name:"Diffuse Irradiance"},{name:"Pre-filtered envmap"},{name:"Num mip levels",value:0},{name:"Albedo",value:0},{name:"AORM",value:0},{name:"Normal map",value:0},{name:"Height",value:0},{name:"Lightmap",value:0},{name:"Diffuse Intensity",value:1},{name:"Specular Intensity",value:1},{name:"Lightmap is RGBE",value:false},{name:"Lightmap Intensity",value:1}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"47",objOut:"117"}]},{name:"Shader"}]},{objName:"Ops.Trigger.TriggerOnce",id:"118",uiAttribs:{subPatch:"e88c760e-6c22-407a-8194-54c9884b404e"},portsIn:[{name:"Exec"},{name:"Reset",value:0}],portsOut:[{name:"Next",links:[{portIn:"Reload",portOut:"Next",objIn:"65",objOut:"118"}]},{name:"Was Triggered",value:true}]},{objName:"Ops.Trigger.TriggerOnce",id:"119",uiAttribs:{subPatch:"e3e9c579-084f-4560-896f-5af6e84c4210"},portsIn:[{name:"Exec"},{name:"Reset",value:0}],portsOut:[{name:"Next",links:[{portIn:"Reload",portOut:"Next",objIn:"82",objOut:"119"}]},{name:"Was Triggered",value:true}]},{objName:"Ops.Trigger.TriggerOnce",id:"120",uiAttribs:{subPatch:"9f4fb244-de1f-490a-8dba-69a6dc8069fa"},portsIn:[{name:"Exec"},{name:"Reset",value:0}],portsOut:[{name:"Next",links:[{portIn:"Reload",portOut:"Next",objIn:"99",objOut:"120"}]},{name:"Was Triggered",value:true}]},{objName:"Ops.Trigger.TriggerOnce",id:"121",uiAttribs:{subPatch:"4a591837-f958-49a8-ba17-a9aaddffe4aa"},portsIn:[{name:"Exec"},{name:"Reset",value:0}],portsOut:[{name:"Next",links:[{portIn:"Reload",portOut:"Next",objIn:"112",objOut:"121"}]},{name:"Was Triggered",value:true}]},{objName:"Ops.Vars.VarGetNumber_v2",id:"122",uiAttribs:{subPatch:0},portsIn:[{name:"Variable",value:"partId"}],portsOut:[{name:"Value",links:[{portIn:"Switch Value",portOut:"Value",objIn:"18",objOut:"122"}]}]},{objName:"Ops.Gl.Matrix.Transform",id:"123",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"posX",value:0},{name:"posY",value:0},{name:"posZ",value:-.6},{name:"scale",value:1},{name:"rotX",value:0},{name:"rotY",value:0},{name:"rotZ",value:0}],portsOut:[{name:"trigger",links:[{portIn:"Render",portOut:"trigger",objIn:"57",objOut:"123"}]}]},{objName:"Ops.Gl.Matrix.Transform",id:"124",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"posX",value:0},{name:"posY",value:0},{name:"posZ",value:.6},{name:"scale",value:1},{name:"rotX",value:0},{name:"rotY",value:0},{name:"rotZ",value:0}],portsOut:[{name:"trigger",links:[{portIn:"Render",portOut:"trigger",objIn:"62",objOut:"124"}]}]},{objName:"Ops.String.ParseInt_v2",id:"125",uiAttribs:{subPatch:0},portsIn:[{name:"String"}],portsOut:[{name:"Number",links:[{portIn:"Number 0",portOut:"Number",objIn:"130",objOut:"125"}]}]},{objName:"Ops.Gl.ClearColor",id:"126",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"r",value:1},{name:"g",value:1},{name:"b",value:1},{name:"a",value:0}],portsOut:[{name:"trigger",value:0}]},{objName:"Ops.String.FilterValidString",id:"127",uiAttribs:{subPatch:0},portsIn:[{name:"String"},{name:"Invalid if null",value:true},{name:"Invalid if undefined",value:true},{name:"Invalid if empty",value:true},{name:"Invalid if 0",value:true}],portsOut:[{name:"Last Valid String",links:[{portIn:"String",portOut:"Last Valid String",objIn:"125",objOut:"127"}]},{name:"Is Valid",value:true}]},{objName:"Ops.Vars.VarSetNumber_v2",id:"128",uiAttribs:{subPatch:0},portsIn:[{name:"Value"},{name:"Variable",value:"partId"},{name:"Create new variable",value:0},{name:"",value:["Rename"]}],portsOut:[]},{objName:"Ops.Vars.VarSetNumber_v2",id:"129",uiAttribs:{subPatch:0},portsIn:[{name:"Value"},{name:"Variable",value:"objId"},{name:"Create new variable",value:0},{name:"",value:["Rename"]}],portsOut:[]},{objName:"Ops.Values.SequenceNumbers",id:"130",uiAttribs:{subPatch:0},portsIn:[{name:"Number 0"},{name:"Number 1",value:0},{name:"Number 2",value:0},{name:"Number 3",value:0},{name:"Number 4",value:0},{name:"Number 5",value:0},{name:"Number 6",value:0},{name:"Number 7",value:0},{name:"Number 8",value:0},{name:"Number 9",value:0},{name:"Number 10",value:0},{name:"Number 11",value:0},{name:"Number 12",value:0},{name:"Number 13",value:0},{name:"Number 14",value:0},{name:"Number 15",value:0}],portsOut:[{name:"Output 0",links:[{portIn:"Value",portOut:"Output 0",objIn:"128",objOut:"130"}]},{name:"Output 1",links:[{portIn:"Value",portOut:"Output 1",objIn:"131",objOut:"130"}]},{name:"Output 2",value:4},{name:"Output 3",value:4},{name:"Output 4",value:4},{name:"Output 5",value:4},{name:"Output 6",value:4},{name:"Output 7",value:4},{name:"Output 8",value:4},{name:"Output 9",value:4},{name:"Output 10",value:4},{name:"Output 11",value:4},{name:"Output 12",value:4},{name:"Output 13",value:4},{name:"Output 14",value:4},{name:"Output 15",value:4}]},{objName:"Ops.Value.TriggerOnChangeNumber",id:"131",uiAttribs:{subPatch:0},portsIn:[{name:"Value"}],portsOut:[{name:"Next",links:[{portIn:"Trigger",portOut:"Next",objIn:"132",objOut:"131"}]},{name:"Number",value:4}]},{objName:"Ops.Vars.VarTriggerNumber",id:"132",uiAttribs:{subPatch:0},portsIn:[{name:"Value",value:1},{name:"Trigger"},{name:"Variable",value:"objId"},{name:"Create new variable",value:0},{name:"",value:["Rename"]}],portsOut:[{name:"Next",links:[{portIn:"Reset",portOut:"Next",objIn:"67",objOut:"132"},{portIn:"Reset",portOut:"Next",objIn:"68",objOut:"132"}]}]},{objName:"Ops.Sidebar.Slider_v3",id:"133",uiAttribs:{subPatch:0},portsIn:[{name:"link"},{name:"Text",value:"Move to build the wall"},{name:"Min",value:1},{name:"Max"},{name:"Step",value:1},{name:"Suffix",value:""},{name:"Grey Out",value:false},{name:"Visible"},{name:"Input",value:1},{name:"Set Default",value:0},{name:"Reset",value:0},{name:"Default",value:1}],portsOut:[{name:"childs",links:[{portIn:"link",portOut:"childs",objIn:"191",objOut:"133"}]},{name:"Result",links:[{portIn:"Value",portOut:"Result",objIn:"141",objOut:"133"}]}]},{objName:"Ops.Vars.VarGetNumber_v2",id:"134",uiAttribs:{subPatch:0},portsIn:[{name:"Variable",value:"objId"}],portsOut:[{name:"Value",links:[{portIn:"number1",portOut:"Value",objIn:"138",objOut:"134"}]}]},{objName:"Ops.Vars.VarGetNumber_v2",id:"135",uiAttribs:{subPatch:0},portsIn:[{name:"Variable",value:"partId"}],portsOut:[{name:"Value",links:[{portIn:"number1",portOut:"Value",objIn:"136",objOut:"135"}]}]},{objName:"Ops.Math.Compare.Equals",id:"136",uiAttribs:{subPatch:0},portsIn:[{name:"number1"},{name:"number2",value:5}],portsOut:[{name:"result",links:[{portIn:"bool 1",portOut:"result",objIn:"137",objOut:"136"}]}]},{objName:"Ops.Boolean.And",id:"137",uiAttribs:{subPatch:0},portsIn:[{name:"bool 1"},{name:"bool 2"}],portsOut:[{name:"result",links:[{portIn:"Visible",portOut:"result",objIn:"133",objOut:"137"},{portIn:"Visible",portOut:"result",objIn:"191",objOut:"137"}]}]},{objName:"Ops.Math.Compare.Equals",id:"138",uiAttribs:{subPatch:0},portsIn:[{name:"number1"},{name:"number2",value:1}],portsOut:[{name:"result",links:[{portIn:"bool 2",portOut:"result",objIn:"137",objOut:"138"}]}]},{objName:"Ops.Vars.VarSetNumber_v2",id:"139",uiAttribs:{subPatch:0},portsIn:[{name:"Value"},{name:"Variable",value:"numSceneObjects"},{name:"Create new variable",value:0},{name:"",value:["Rename"]}],portsOut:[]},{objName:"Ops.Vars.VarGetNumber_v2",id:"140",uiAttribs:{subPatch:0},portsIn:[{name:"Variable",value:"numSceneObjects"}],portsOut:[{name:"Value",links:[{portIn:"Max",portOut:"Value",objIn:"133",objOut:"140"}]}]},{objName:"Ops.Vars.VarSetNumber_v2",id:"141",uiAttribs:{subPatch:0},portsIn:[{name:"Value"},{name:"Variable",value:"sliderConstructionValue"},{name:"Create new variable",value:0},{name:"",value:["Rename"]}],portsOut:[]},{objName:"Ops.Vars.VarGetNumber_v2",id:"142",uiAttribs:{subPatch:0},portsIn:[{name:"Variable",value:"sliderConstructionValue"}],portsOut:[{name:"Value",links:[{portIn:"Remove from Start",portOut:"Value",objIn:"147",objOut:"142"},{portIn:"Input Number",portOut:"Value",objIn:"158",objOut:"142"}]}]},{objName:"Ops.Json.ObjectGetArrayValuesByPath",id:"143",uiAttribs:{subPatch:0},portsIn:[{name:"Object"},{name:"Path",value:"nodes.0.name"}],portsOut:[{name:"Output",links:[{portIn:"Source Array",portOut:"Output",objIn:"157",objOut:"143"}]},{name:"Found",value:true}]},{objName:"Ops.Vars.VarSetArray_v2",id:"144",uiAttribs:{subPatch:0},portsIn:[{name:"Value"},{name:"Variable",value:"sceneMeshNames"},{name:"Create new variable",value:0},{name:"",value:["Rename"]}],portsOut:[]},{objName:"Ops.Vars.VarGetArray_v2",id:"145",uiAttribs:{subPatch:0},portsIn:[{name:"Variable",value:"sceneMeshNames"}],portsOut:[{name:"Value",links:[{portIn:"Array",portOut:"Value",objIn:"146",objOut:"145"}]}]},{objName:"Ops.Array.FilterValidArray",id:"146",uiAttribs:{subPatch:0},portsIn:[{name:"Array"},{name:"Invalid when length is 0",value:true}],portsOut:[{name:"Last Valid Array",links:[{portIn:"Source Array",portOut:"Last Valid Array",objIn:"147",objOut:"146"}]},{name:"Is Valid",value:true}]},{objName:"Ops.Array.CutArray",id:"147",uiAttribs:{subPatch:0},portsIn:[{name:"Source Array"},{name:"Remove from Start"},{name:"Remove From End",value:0}],portsOut:[{name:"Cut Array",links:[{portIn:"Hide Nodes",portOut:"Cut Array",objIn:"22",objOut:"147"}]},{name:"Array Length",value:25}]},{objName:"Ops.Vars.VarGetArray_v2",id:"148",uiAttribs:{subPatch:0},portsIn:[{name:"Variable",value:"part4_labels"}],portsOut:[{name:"Value",links:[{portIn:"Values",portOut:"Value",objIn:"67",objOut:"148"}]}]},{objName:"Ops.Array.ParseArray_v2",id:"149",uiAttribs:{subPatch:0},portsIn:[{name:"text",value:"Wall, Tower, Stones"},{name:"separator",value:","},{name:"Numbers",value:false},{name:"Trim",value:true}],portsOut:[{name:"Parsed",value:0},{name:"array",links:[{portIn:"Value",portOut:"array",objIn:"150",objOut:"149"}]},{name:"length",value:3}]},{objName:"Ops.Vars.VarSetArray_v2",id:"150",uiAttribs:{subPatch:0},portsIn:[{name:"Value"},{name:"Variable",value:"part5_labels"},{name:"Create new variable",value:0},{name:"",value:["Rename"]}],portsOut:[]},{objName:"Ops.Vars.VarGetArray_v2",id:"151",uiAttribs:{subPatch:0},portsIn:[{name:"Variable",value:"part5_labels"}],portsOut:[{name:"Value",links:[{portIn:"Values",portOut:"Value",objIn:"68",objOut:"151"}]}]},{objName:"Ops.Gl.GLTF.GltfNode_v2",id:"152",uiAttribs:{subPatch:0},portsIn:[{name:"Render"},{name:"Node Name"},{name:"Transformation",value:false},{name:"Draw Mesh",value:false},{name:"Draw Childs",value:false},{name:"Ignore Material",value:false},{name:"Use Scene Time",value:true},{name:"Time",value:0}],portsOut:[{name:"Next",value:0},{name:"Geometry",links:[{portIn:"Geometry",portOut:"Geometry",objIn:"153",objOut:"152"}]},{name:"Found",value:false}]},{objName:"Ops.Gl.Geometry.GeometryBoundingBox",id:"153",uiAttribs:{subPatch:0},portsIn:[{name:"Geometry"}],portsOut:[{name:"Boundings",links:[{portIn:"Object",portOut:"Boundings",objIn:"162",objOut:"153"}]},{name:"Min X",value:17976931348623157e292},{name:"Min Y",value:17976931348623157e292},{name:"Min Z",value:17976931348623157e292},{name:"Max X",value:-17976931348623157e292},{name:"Max Y",value:-17976931348623157e292},{name:"Max Z",value:-17976931348623157e292},{name:"MaxMin Points"}]},{objName:"Ops.Vars.VarGetNumber_v2",id:"154",uiAttribs:{subPatch:0},portsIn:[{name:"Variable",value:"showSidebar"}],portsOut:[{name:"Value",links:[{portIn:"Visible",portOut:"Value",objIn:"17",objOut:"154"}]}]},{objName:"Ops.String.Concat_v2",id:"155",uiAttribs:{subPatch:0},portsIn:[{name:"string1",value:"mesh_"},{name:"string2"},{name:"New Line",value:false}],portsOut:[{name:"result",links:[{portIn:"Node Name",portOut:"result",objIn:"152",objOut:"155"}]}]},{objName:"Ops.String.FilterValidString",id:"156",uiAttribs:{subPatch:0},portsIn:[{name:"String"},{name:"Invalid if null",value:true},{name:"Invalid if undefined",value:true},{name:"Invalid if empty",value:true},{name:"Invalid if 0",value:true}],portsOut:[{name:"Last Valid String",links:[{portIn:"string2",portOut:"Last Valid String",objIn:"155",objOut:"156"}]},{name:"Is Valid",value:true}]},{objName:"Ops.Array.CutArray",id:"157",uiAttribs:{subPatch:0},portsIn:[{name:"Source Array"},{name:"Remove from Start",value:1},{name:"Remove From End",value:0}],portsOut:[{name:"Cut Array",links:[{portIn:"Value",portOut:"Cut Array",objIn:"144",objOut:"157"},{portIn:"Array",portOut:"Cut Array",objIn:"165",objOut:"157"}]},{name:"Array Length",links:[{portIn:"Value",portOut:"Array Length",objIn:"139",objOut:"157"},{portIn:"Array length",portOut:"Array Length",objIn:"171",objOut:"157"}]}]},{objName:"Ops.User.kikohs.NumberFormatter",id:"158",uiAttribs:{subPatch:0},portsIn:[{name:"Input Number"},{name:"Locale index",value:0},{name:"Locale",value:"custom"},{name:"Locale string",value:"us-US"},{name:"Style index",value:0},{name:"Style",value:"decimal"},{name:"Maximum Fraction Digits",value:0},{name:"Maximum Significant Digits",value:2},{name:"Minimum Fraction Digits",value:0},{name:"Minimum Integer Digits",value:2},{name:"Minimum Significant Digits",value:1},{name:"Use Grouping",value:true},{name:"Currency Name",value:"USD"},{name:"Currency Display index",value:0},{name:"Currency Display",value:"symbol"}],portsOut:[{name:"Formatted Number",links:[{portIn:"String",portOut:"Formatted Number",objIn:"156",objOut:"158"}]},{name:"Has error",value:false}]},{objName:"Ops.Vars.VarSetNumber_v2",id:"159",uiAttribs:{subPatch:0},portsIn:[{name:"Value"},{name:"Variable",value:"showSidebar"},{name:"Create new variable",value:0},{name:"",value:["Rename"]}],portsOut:[]},{objName:"Ops.Cables.UIMode",id:"160",uiAttribs:{subPatch:0},portsIn:[],portsOut:[{name:"UI",links:[{portIn:"Value",portOut:"UI",objIn:"159",objOut:"160"}]},{name:"Remote Viewer",value:0}]},{objName:"Ops.Html.CSS_v2",id:"161",uiAttribs:{subPatch:0},portsIn:[{name:"css code",value:".sidebar-cables {\n    z-index: 100;\n}"}],portsOut:[]},{objName:"Ops.Json.ObjectGetArrayByPath",id:"162",uiAttribs:{subPatch:0},portsIn:[{name:"Object"},{name:"Path",value:"_size"}],portsOut:[{name:"Output",links:[{portIn:"In numbers",portOut:"Output",objIn:"163",objOut:"162"}]},{name:"Found",value:true}]},{objName:"Ops.User.kikohs.ArraySelfMultiply",id:"163",uiAttribs:{subPatch:0},portsIn:[{name:"In numbers"}],portsOut:[{name:"Result",links:[{portIn:"number1",portOut:"Result",objIn:"188",objOut:"163"}]}]},{objName:"Ops.Trigger.TriggerOnce",id:"164",uiAttribs:{subPatch:0},portsIn:[{name:"Exec"},{name:"Reset",value:0}],portsOut:[{name:"Next",links:[{portIn:"Exe",portOut:"Next",objIn:"165",objOut:"164"}]},{name:"Was Triggered",value:true}]},{objName:"Ops.Array.ArrayIteratorStrings",id:"165",uiAttribs:{subPatch:0},portsIn:[{name:"Exe"},{name:"Array"}],portsOut:[{name:"Trigger",links:[{portIn:"Render",portOut:"Trigger",objIn:"169",objOut:"165"}]},{name:"Index",links:[{portIn:"Index",portOut:"Index",objIn:"170",objOut:"165"}]},{name:"Value",links:[{portIn:"Node Name",portOut:"Value",objIn:"169",objOut:"165"}]}]},{objName:"Ops.Gl.Geometry.GeometryBoundingBox",id:"166",uiAttribs:{subPatch:0},portsIn:[{name:"Geometry"}],portsOut:[{name:"Boundings",links:[{portIn:"Object",portOut:"Boundings",objIn:"167",objOut:"166"}]},{name:"Min X",value:17976931348623157e292},{name:"Min Y",value:17976931348623157e292},{name:"Min Z",value:17976931348623157e292},{name:"Max X",value:-17976931348623157e292},{name:"Max Y",value:-17976931348623157e292},{name:"Max Z",value:-17976931348623157e292},{name:"MaxMin Points"}]},{objName:"Ops.Json.ObjectGetArrayByPath",id:"167",uiAttribs:{subPatch:0},portsIn:[{name:"Object"},{name:"Path",value:"_size"}],portsOut:[{name:"Output",links:[{portIn:"In numbers",portOut:"Output",objIn:"168",objOut:"167"}]},{name:"Found",value:true}]},{objName:"Ops.User.kikohs.ArraySelfMultiply",id:"168",uiAttribs:{subPatch:0},portsIn:[{name:"In numbers"}],portsOut:[{name:"Result",links:[{portIn:"Number",portOut:"Result",objIn:"170",objOut:"168"}]}]},{objName:"Ops.Gl.GLTF.GltfNode_v2",id:"169",uiAttribs:{subPatch:0},portsIn:[{name:"Render"},{name:"Node Name"},{name:"Transformation",value:false},{name:"Draw Mesh",value:false},{name:"Draw Childs",value:false},{name:"Ignore Material",value:false},{name:"Use Scene Time",value:true},{name:"Time",value:0}],portsOut:[{name:"Next",links:[{portIn:"Execute",portOut:"Next",objIn:"170",objOut:"169"}]},{name:"Geometry",links:[{portIn:"Geometry",portOut:"Geometry",objIn:"166",objOut:"169"}]},{name:"Found",value:true}]},{objName:"Ops.Array.ArraySetNumber_v2",id:"170",uiAttribs:{subPatch:0},portsIn:[{name:"Execute"},{name:"Array"},{name:"Index"},{name:"Number"}],portsOut:[{name:"Next",value:0},{name:"Result",links:[{portIn:"Value",portOut:"Result",objIn:"172",objOut:"170"}]}]},{objName:"Ops.Array.Array_v2",id:"171",uiAttribs:{subPatch:0},portsIn:[{name:"Array length"},{name:"Mode select index",value:0},{name:"Mode select",value:"Number"},{name:"Default Value",value:0}],portsOut:[{name:"Array",links:[{portIn:"Array",portOut:"Array",objIn:"170",objOut:"171"}]},{name:"Array length out",value:26}]},{objName:"Ops.Vars.VarSetArray_v2",id:"172",uiAttribs:{subPatch:0},portsIn:[{name:"Value"},{name:"Variable",value:"sceneVolumes"},{name:"Create new variable",value:0},{name:"",value:["Rename"]}],portsOut:[]},{objName:"Ops.Vars.VarGetArray_v2",id:"173",uiAttribs:{subPatch:0},portsIn:[{name:"Variable",value:"sceneVolumes"}],portsOut:[{name:"Value",links:[{portIn:"Array",portOut:"Value",objIn:"175",objOut:"173"}]}]},{objName:"Ops.Math.MapRange",id:"174",uiAttribs:{subPatch:0},portsIn:[{name:"value"},{name:"old min"},{name:"old max"},{name:"new min",value:500},{name:"new max",value:50},{name:"Easing index",value:0},{name:"Easing",value:"Linear"}],portsOut:[{name:"result",links:[{portIn:"Number",portOut:"result",objIn:"190",objOut:"174"}]}]},{objName:"Ops.Array.InfoArray",id:"175",uiAttribs:{subPatch:0},portsIn:[{name:"Array"}],portsOut:[{name:"Min",links:[{portIn:"number1",portOut:"Min",objIn:"184",objOut:"175"}]},{name:"Max",links:[{portIn:"number1",portOut:"Max",objIn:"186",objOut:"175"}]},{name:"Average",value:null}]},{objName:"Ops.WebAudio.Mixer",id:"176",uiAttribs:{subPatch:0},portsIn:[{name:"Audio In 0",value:null},{name:"Audio In 1",value:null},{name:"Audio In 2",value:null},{name:"Audio In 3"},{name:"Audio In 4",value:null},{name:"Audio In 5",value:null},{name:"Audio In 6",value:null},{name:"Audio In 7",value:null},{name:"In 0 Gain",value:1},{name:"In 1 Gain",value:1},{name:"In 2 Gain",value:1},{name:"In 3 Gain"},{name:"In 4 Gain",value:1},{name:"In 5 Gain",value:1},{name:"In 6 Gain",value:1},{name:"In 7 Gain",value:1},{name:"In 0 Pan",value:0},{name:"In 1 Pan",value:0},{name:"In 2 Pan",value:0},{name:"In 3 Pan",value:0},{name:"In 4 Pan",value:0},{name:"In 5 Pan",value:0},{name:"In 6 Pan",value:0},{name:"In 7 Pan",value:0},{name:"Output Gain",value:1}],portsOut:[{name:"Audio Out",links:[{portIn:"Audio In",portOut:"Audio Out",objIn:"177",objOut:"176"}]}]},{objName:"Ops.WebAudio.Output_v2",id:"177",uiAttribs:{subPatch:0},portsIn:[{name:"Audio In"},{name:"Volume",value:.202},{name:"Mute"},{name:"Show Audio Suspended Button",value:true}],portsOut:[{name:"Current Volume",value:.202},{name:"Context State",value:"running"}]},{objName:"Ops.Vars.VarGetNumber_v2",id:"178",uiAttribs:{subPatch:0},portsIn:[{name:"Variable",value:"sliderConstructionValue"}],portsOut:[{name:"Value",links:[{portIn:"Value",portOut:"Value",objIn:"179",objOut:"178"}]}]},{objName:"Ops.Value.TriggerOnChangeNumber",id:"179",uiAttribs:{subPatch:0},portsIn:[{name:"Value"}],portsOut:[{name:"Next",links:[{portIn:"Bang",portOut:"Next",objIn:"183",objOut:"179"}]},{name:"Number",value:1}]},{objName:"Ops.Trigger.TriggerSend",id:"180",uiAttribs:{subPatch:0},portsIn:[{name:"Trigger"},{name:"Named Trigger",value:"t0"}],portsOut:[]},{objName:"Ops.User.kikohs.Oscillator",id:"181",uiAttribs:{subPatch:0},portsIn:[{name:"Play",value:true},{name:"Frequency"},{name:"Wave type index",value:0},{name:"Wave type",value:"sine"}],portsOut:[{name:"Audio Out",links:[{portIn:"Audio In 3",portOut:"Audio Out",objIn:"176",objOut:"181"}]}]},{objName:"Ops.Trigger.TriggerReceive",id:"182",uiAttribs:{subPatch:0},portsIn:[{name:"Named Trigger",value:"t0"}],portsOut:[{name:"Triggered",links:[{portIn:"update",portOut:"Triggered",objIn:"183",objOut:"182"}]}]},{objName:"Ops.Anim.Bang",id:"183",uiAttribs:{subPatch:0},portsIn:[{name:"update"},{name:"Bang"},{name:"Duration",value:.4},{name:"Invert",value:false}],portsOut:[{name:"Trigger Out",value:0},{name:"Value",links:[{portIn:"In 3 Gain",portOut:"Value",objIn:"176",objOut:"183"}]}]},{objName:"Ops.Math.Multiply",id:"184",uiAttribs:{subPatch:0},portsIn:[{name:"number1"},{name:"number2",value:1e3}],portsOut:[{name:"result",links:[{portIn:"Number",portOut:"result",objIn:"185",objOut:"184"}]}]},{objName:"Ops.Math.Floor",id:"185",uiAttribs:{subPatch:0},portsIn:[{name:"Number"}],portsOut:[{name:"Result",links:[{portIn:"old min",portOut:"Result",objIn:"174",objOut:"185"}]}]},{objName:"Ops.Math.Multiply",id:"186",uiAttribs:{subPatch:0},portsIn:[{name:"number1"},{name:"number2",value:1e3}],portsOut:[{name:"result",links:[{portIn:"Number",portOut:"result",objIn:"187",objOut:"186"}]}]},{objName:"Ops.Math.Floor",id:"187",uiAttribs:{subPatch:0},portsIn:[{name:"Number"}],portsOut:[{name:"Result",links:[{portIn:"old max",portOut:"Result",objIn:"174",objOut:"187"}]}]},{objName:"Ops.Math.Multiply",id:"188",uiAttribs:{subPatch:0},portsIn:[{name:"number1"},{name:"number2",value:1e3}],portsOut:[{name:"result",links:[{portIn:"Number",portOut:"result",objIn:"189",objOut:"188"}]}]},{objName:"Ops.Math.Floor",id:"189",uiAttribs:{subPatch:0},portsIn:[{name:"Number"}],portsOut:[{name:"Result",links:[{portIn:"value",portOut:"Result",objIn:"174",objOut:"189"}]}]},{objName:"Ops.Math.Floor",id:"190",uiAttribs:{subPatch:0},portsIn:[{name:"Number"}],portsOut:[{name:"Result",links:[{portIn:"Frequency",portOut:"Result",objIn:"181",objOut:"190"}]}]},{objName:"Ops.Sidebar.Toggle_v3",id:"191",uiAttribs:{subPatch:0},portsIn:[{name:"link"},{name:"Text",value:"Mute"},{name:"Input",value:false},{name:"Set Default",value:0},{name:"Default",value:false},{name:"Grey Out",value:false},{name:"Visible"}],portsOut:[{name:"childs"},{name:"Value",links:[{portIn:"Value",portOut:"Value",objIn:"192",objOut:"191"}]}]},{objName:"Ops.Vars.VarSetNumber_v2",id:"192",uiAttribs:{subPatch:0},portsIn:[{name:"Value"},{name:"Variable",value:"muteSound"},{name:"Create new variable",value:0},{name:"",value:["Rename"]}],portsOut:[]},{objName:"Ops.Vars.VarGetNumber_v2",id:"193",uiAttribs:{subPatch:0},portsIn:[{name:"Variable",value:"muteSound"}],portsOut:[{name:"Value",links:[{portIn:"Mute",portOut:"Value",objIn:"177",objOut:"193"}]}]},{objName:"Ops.Ui.Comment_v2",id:"194",uiAttribs:{subPatch:0},portsIn:[{name:"title",value:"Sidebar"},{name:"text",value:""}],portsOut:[]},{objName:"Ops.Gl.RenderGeometry",id:"195",uiAttribs:{subPatch:"d2246db6-d127-410a-a97f-b635ea65501f"},portsIn:[{name:"render"},{name:"Geometry"},{name:"Update All",value:true},{name:"Update Face Indices",value:false},{name:"Update Vertices",value:false},{name:"Update Texcoords",value:false},{name:"Vertex Numbers",value:false}],portsOut:[{name:"trigger",links:[{portIn:"out0 Ops.Gl.GLTF.GltfNode_v2 Render",portOut:"trigger",objIn:"201",objOut:"195"}]}]},{objName:"Ops.Trigger.RouteTrigger",id:"196",uiAttribs:{subPatch:"d2246db6-d127-410a-a97f-b635ea65501f"},portsIn:[{name:"Execute"},{name:"Switch Value"}],portsOut:[{name:"Next Trigger",value:0},{name:"Switched Value",value:1},{name:"Trigger 0",links:[{portIn:"Trigger In",portOut:"Trigger 0",objIn:"198",objOut:"196"}]},{name:"Trigger 1",links:[{portIn:"render",portOut:"Trigger 1",objIn:"197",objOut:"196"}]},{name:"Trigger 2",value:0},{name:"Trigger 3",value:0},{name:"Trigger 4",value:0},{name:"Trigger 5",value:0},{name:"Trigger 6",value:0},{name:"Trigger 7",value:0},{name:"Trigger 8",value:0},{name:"Trigger 9",value:0},{name:"Trigger 10",value:0},{name:"Trigger 11",value:0},{name:"Trigger 12",value:0},{name:"Trigger 13",value:0},{name:"Trigger 14",value:0},{name:"Trigger 15",value:0},{name:"Trigger 16",value:0},{name:"Trigger 17",value:0},{name:"Trigger 18",value:0},{name:"Trigger 19",value:0},{name:"Trigger 20",value:0},{name:"Trigger 21",value:0},{name:"Trigger 22",value:0},{name:"Trigger 23",value:0},{name:"Default Trigger",value:0}]},{objName:"Ops.Gl.Shader.PointMaterial_v4",id:"197",uiAttribs:{subPatch:"d2246db6-d127-410a-a97f-b635ea65501f"},portsIn:[{name:"render"},{name:"PointSize",value:1.47},{name:"Size in Pixels",value:false},{name:"Random Size",value:0},{name:"Round",value:true},{name:"Round Antialias",value:false},{name:"Scale by Distance",value:false},{name:"r",value:1},{name:"g",value:1},{name:"b",value:1},{name:"a",value:1},{name:"Vertex Colors",value:true},{name:"texture",value:0},{name:"Colorize Texture",value:false},{name:"Texture Mask",value:0},{name:"Mask Channel index",value:0},{name:"Mask Channel",value:"R"},{name:"Texture Colorize",value:0},{name:"Colorize Randomize",value:true},{name:"Texture Opacity",value:0},{name:"Texture Point Size",value:0},{name:"Point Size Channel index",value:0},{name:"Point Size Channel",value:"R"},{name:"Texture Point Size Mul",value:1},{name:"Map Size 0 index",value:0},{name:"Map Size 0",value:"Black"},{name:"Flip Texture",value:false}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"195",objOut:"197"}]},{name:"shader"}]},{objName:"Ops.Gl.Phong.PhongMaterial_v6",id:"198",uiAttribs:{subPatch:"d2246db6-d127-410a-a97f-b635ea65501f"},portsIn:[{name:"Trigger In"},{name:"R",value:.8506666644414266},{name:"G",value:.5094861914999278},{name:"B",value:.5094861914999278},{name:"A",value:1},{name:"Enable",value:false},{name:"Albedo",value:.707},{name:"Roughness",value:.835},{name:"Active",value:false},{name:"Fresnel Intensity",value:.7},{name:"Fresnel Width",value:1},{name:"Fresnel Exponent",value:6},{name:"Fresnel R",value:1},{name:"Fresnel G",value:1},{name:"Fresnel B",value:1},{name:"Emissive Active",value:false},{name:"Color Intensity",value:.3},{name:"Emissive R",value:.7528171913638779},{name:"Emissive G",value:.36422624829379013},{name:"Emissive B",value:.3103095732889889},{name:"Shininess",value:4},{name:"Specular Amount",value:.5},{name:"Specular Model index",value:0},{name:"Specular Model",value:"Blinn"},{name:"Energy Conservation",value:false},{name:"Double Sided Material",value:false},{name:"Falloff Mode index",value:0},{name:"Falloff Mode",value:"A"},{name:"Diffuse Texture",value:0},{name:"Specular Texture",value:0},{name:"Normal Map",value:0},{name:"AO Texture",value:0},{name:"Emissive Texture",value:0},{name:"Emissive Mask",value:0},{name:"Opacity Texture",value:0},{name:"Environment Map",value:0},{name:"Env Map Mask",value:0},{name:"Colorize Texture",value:true},{name:"Diffuse Repeat X",value:1},{name:"Diffuse Repeat Y",value:1},{name:"Texture Offset X",value:0},{name:"Texture Offset Y",value:0},{name:"Specular Intensity",value:1},{name:"Normal Map Intensity",value:.5},{name:"AO Intensity",value:1},{name:"Emissive Intensity",value:1},{name:"Emissive Mask Intensity",value:1},{name:"Env Map Intensity",value:1},{name:"Env Map Blend index",value:0},{name:"Env Map Blend",value:"Add"},{name:"Env Mask Intensity",value:1},{name:"Alpha Mask Source index",value:0},{name:"Alpha Mask Source",value:"Luminance"},{name:"Discard Transparent Pixels",value:false}],portsOut:[{name:"Trigger Out",links:[{portIn:"exe",portOut:"Trigger Out",objIn:"206",objOut:"198"}]},{name:"Shader"}]},{objName:"Ops.Gl.ShaderEffects.UseVertexColor",id:"199",uiAttribs:{subPatch:"d2246db6-d127-410a-a97f-b635ea65501f"},portsIn:[{name:"Render"}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"195",objOut:"199"}]}]},{objName:"Ops.Ui.PatchInput",id:"200",uiAttribs:{subPatch:"d2246db6-d127-410a-a97f-b635ea65501f"},portsIn:[],portsOut:[{name:"create port",value:0},{name:"in0 Ops.Gl.Matrix.Transform trigger",links:[{portIn:"Execute",portOut:"in0 Ops.Gl.Matrix.Transform trigger",objIn:"196",objOut:"200"},{portIn:"Exec",portOut:"in0 Ops.Gl.Matrix.Transform trigger",objIn:"207",objOut:"200"}]},{name:"in1 Ops.String.SwitchString Result",links:[{portIn:"PLY File",portOut:"in1 Ops.String.SwitchString Result",objIn:"204",objOut:"200"}]}]},{objName:"Ops.Ui.PatchOutput",id:"201",uiAttribs:{subPatch:"d2246db6-d127-410a-a97f-b635ea65501f"},portsIn:[{name:"create port",value:0},{name:"out0 Ops.Gl.GLTF.GltfNode_v2 Render"}],portsOut:[]},{objName:"Ops.Ui.SubPatch",id:"202",uiAttribs:{subPatch:0},portsIn:[{name:"create port",value:null},{name:"dataStr",value:'{"ports":[{"name":"in0 Ops.Gl.Matrix.Transform trigger","type":1,"title":"Render"},{"name":"in1 Ops.String.SwitchString Result","type":5,"title":"URL"}],"portsOut":[{"name":"out0 Ops.Gl.GLTF.GltfNode_v2 Render","type":1}]}'},{name:"patchId",value:"d2246db6-d127-410a-a97f-b635ea65501f"},{name:"in0 Ops.Gl.Matrix.Transform trigger"},{name:"in1 Ops.String.SwitchString Result"}],portsOut:[{name:"create port out",value:0},{name:"out0 Ops.Gl.GLTF.GltfNode_v2 Render"}]},{objName:"Ops.Gl.Geometry.GeometryInfo",id:"203",uiAttribs:{subPatch:"d2246db6-d127-410a-a97f-b635ea65501f"},portsIn:[{name:"Geometry"}],portsOut:[{name:"Indexed",value:false},{name:"Faces",value:null},{name:"Vertices",value:192808},{name:"Normals",value:192810},{name:"TexCoords",value:0},{name:"Tangents",value:0},{name:"BiTangents",value:0},{name:"VertexColors",links:[{portIn:"number1",portOut:"VertexColors",objIn:"205",objOut:"203"}]},{name:"Other Attributes",value:0}]},{objName:"Ops.User.kikohs.PLYLoader",id:"204",uiAttribs:{subPatch:"d2246db6-d127-410a-a97f-b635ea65501f"},portsIn:[{name:"PLY File",display:"file"},{name:"Auto-load",value:false},{name:"Custom Property map",value:0},{name:"Reload"}],portsOut:[{name:"Loaded",value:0},{name:"Geometry",links:[{portIn:"Geometry",portOut:"Geometry",objIn:"195",objOut:"204"},{portIn:"Geometry",portOut:"Geometry",objIn:"203",objOut:"204"}]},{name:"Loading",value:false},{name:"Is Point Cloud?",links:[{portIn:"Switch Value",portOut:"Is Point Cloud?",objIn:"196",objOut:"204"}]},{name:"Error",value:null}]},{objName:"Ops.Math.Compare.GreaterThan",id:"205",uiAttribs:{subPatch:"d2246db6-d127-410a-a97f-b635ea65501f"},portsIn:[{name:"number1"},{name:"number2",value:0}],portsOut:[{name:"result",links:[{portIn:"boolean",portOut:"result",objIn:"206",objOut:"205"}]}]},{objName:"Ops.Boolean.IfTrueThen_v2",id:"206",uiAttribs:{subPatch:"d2246db6-d127-410a-a97f-b635ea65501f"},portsIn:[{name:"exe"},{name:"boolean"}],portsOut:[{name:"then",links:[{portIn:"Render",portOut:"then",objIn:"199",objOut:"206"}]},{name:"else",links:[{portIn:"render",portOut:"else",objIn:"195",objOut:"206"}]}]},{objName:"Ops.Trigger.TriggerOnce",id:"207",uiAttribs:{subPatch:"d2246db6-d127-410a-a97f-b635ea65501f"},portsIn:[{name:"Exec"},{name:"Reset",value:0}],portsOut:[{name:"Next",links:[{portIn:"Reload",portOut:"Next",objIn:"204",objOut:"207"}]},{name:"Was Triggered",value:true}]},{objName:"Ops.Gl.RenderGeometry",id:"208",uiAttribs:{subPatch:"84011ea8-0171-48b4-8da1-6590d949826b"},portsIn:[{name:"render"},{name:"Geometry"},{name:"Update All",value:true},{name:"Update Face Indices",value:false},{name:"Update Vertices",value:false},{name:"Update Texcoords",value:false},{name:"Vertex Numbers",value:false}],portsOut:[{name:"trigger",links:[{portIn:"out0 Ops.Gl.GLTF.GltfNode_v2 Render",portOut:"trigger",objIn:"214",objOut:"208"}]}]},{objName:"Ops.Trigger.RouteTrigger",id:"209",uiAttribs:{subPatch:"84011ea8-0171-48b4-8da1-6590d949826b"},portsIn:[{name:"Execute"},{name:"Switch Value"}],portsOut:[{name:"Next Trigger",value:0},{name:"Switched Value",value:1},{name:"Trigger 0",links:[{portIn:"Trigger In",portOut:"Trigger 0",objIn:"211",objOut:"209"}]},{name:"Trigger 1",links:[{portIn:"render",portOut:"Trigger 1",objIn:"210",objOut:"209"}]},{name:"Trigger 2",value:0},{name:"Trigger 3",value:0},{name:"Trigger 4",value:0},{name:"Trigger 5",value:0},{name:"Trigger 6",value:0},{name:"Trigger 7",value:0},{name:"Trigger 8",value:0},{name:"Trigger 9",value:0},{name:"Trigger 10",value:0},{name:"Trigger 11",value:0},{name:"Trigger 12",value:0},{name:"Trigger 13",value:0},{name:"Trigger 14",value:0},{name:"Trigger 15",value:0},{name:"Trigger 16",value:0},{name:"Trigger 17",value:0},{name:"Trigger 18",value:0},{name:"Trigger 19",value:0},{name:"Trigger 20",value:0},{name:"Trigger 21",value:0},{name:"Trigger 22",value:0},{name:"Trigger 23",value:0},{name:"Default Trigger",value:0}]},{objName:"Ops.Gl.Shader.PointMaterial_v4",id:"210",uiAttribs:{subPatch:"84011ea8-0171-48b4-8da1-6590d949826b"},portsIn:[{name:"render"},{name:"PointSize",value:1.47},{name:"Size in Pixels",value:false},{name:"Random Size",value:0},{name:"Round",value:true},{name:"Round Antialias",value:false},{name:"Scale by Distance",value:false},{name:"r",value:1},{name:"g",value:1},{name:"b",value:1},{name:"a",value:1},{name:"Vertex Colors",value:true},{name:"texture",value:0},{name:"Colorize Texture",value:false},{name:"Texture Mask",value:0},{name:"Mask Channel index",value:0},{name:"Mask Channel",value:"R"},{name:"Texture Colorize",value:0},{name:"Colorize Randomize",value:true},{name:"Texture Opacity",value:0},{name:"Texture Point Size",value:0},{name:"Point Size Channel index",value:0},{name:"Point Size Channel",value:"R"},{name:"Texture Point Size Mul",value:1},{name:"Map Size 0 index",value:0},{name:"Map Size 0",value:"Black"},{name:"Flip Texture",value:false}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"208",objOut:"210"}]},{name:"shader"}]},{objName:"Ops.Gl.Phong.PhongMaterial_v6",id:"211",uiAttribs:{subPatch:"84011ea8-0171-48b4-8da1-6590d949826b"},portsIn:[{name:"Trigger In"},{name:"R",value:.8506666644414266},{name:"G",value:.5094861914999278},{name:"B",value:.5094861914999278},{name:"A",value:1},{name:"Enable",value:false},{name:"Albedo",value:.707},{name:"Roughness",value:.835},{name:"Active",value:false},{name:"Fresnel Intensity",value:.7},{name:"Fresnel Width",value:1},{name:"Fresnel Exponent",value:6},{name:"Fresnel R",value:1},{name:"Fresnel G",value:1},{name:"Fresnel B",value:1},{name:"Emissive Active",value:false},{name:"Color Intensity",value:.3},{name:"Emissive R",value:.7528171913638779},{name:"Emissive G",value:.36422624829379013},{name:"Emissive B",value:.3103095732889889},{name:"Shininess",value:4},{name:"Specular Amount",value:.5},{name:"Specular Model index",value:0},{name:"Specular Model",value:"Blinn"},{name:"Energy Conservation",value:false},{name:"Double Sided Material",value:false},{name:"Falloff Mode index",value:0},{name:"Falloff Mode",value:"A"},{name:"Diffuse Texture",value:0},{name:"Specular Texture",value:0},{name:"Normal Map",value:0},{name:"AO Texture",value:0},{name:"Emissive Texture",value:0},{name:"Emissive Mask",value:0},{name:"Opacity Texture",value:0},{name:"Environment Map",value:0},{name:"Env Map Mask",value:0},{name:"Colorize Texture",value:true},{name:"Diffuse Repeat X",value:1},{name:"Diffuse Repeat Y",value:1},{name:"Texture Offset X",value:0},{name:"Texture Offset Y",value:0},{name:"Specular Intensity",value:1},{name:"Normal Map Intensity",value:.5},{name:"AO Intensity",value:1},{name:"Emissive Intensity",value:1},{name:"Emissive Mask Intensity",value:1},{name:"Env Map Intensity",value:1},{name:"Env Map Blend index",value:0},{name:"Env Map Blend",value:"Add"},{name:"Env Mask Intensity",value:1},{name:"Alpha Mask Source index",value:0},{name:"Alpha Mask Source",value:"Luminance"},{name:"Discard Transparent Pixels",value:false}],portsOut:[{name:"Trigger Out",links:[{portIn:"exe",portOut:"Trigger Out",objIn:"219",objOut:"211"}]},{name:"Shader"}]},{objName:"Ops.Gl.ShaderEffects.UseVertexColor",id:"212",uiAttribs:{subPatch:"84011ea8-0171-48b4-8da1-6590d949826b"},portsIn:[{name:"Render"}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"208",objOut:"212"}]}]},{objName:"Ops.Ui.PatchInput",id:"213",uiAttribs:{subPatch:"84011ea8-0171-48b4-8da1-6590d949826b"},portsIn:[],portsOut:[{name:"create port",value:0},{name:"in0 Ops.Gl.Matrix.Transform trigger",links:[{portIn:"Execute",portOut:"in0 Ops.Gl.Matrix.Transform trigger",objIn:"209",objOut:"213"},{portIn:"Exec",portOut:"in0 Ops.Gl.Matrix.Transform trigger",objIn:"220",objOut:"213"}]},{name:"in1 Ops.String.SwitchString Result",links:[{portIn:"PLY File",portOut:"in1 Ops.String.SwitchString Result",objIn:"217",objOut:"213"}]}]},{objName:"Ops.Ui.PatchOutput",id:"214",uiAttribs:{subPatch:"84011ea8-0171-48b4-8da1-6590d949826b"},portsIn:[{name:"create port",value:0},{name:"out0 Ops.Gl.GLTF.GltfNode_v2 Render"}],portsOut:[]},{objName:"Ops.Ui.SubPatch",id:"215",uiAttribs:{subPatch:0},portsIn:[{name:"create port",value:null},{name:"dataStr",value:'{"ports":[{"name":"in0 Ops.Gl.Matrix.Transform trigger","type":1,"title":"Render"},{"name":"in1 Ops.String.SwitchString Result","type":5,"title":"URL"}],"portsOut":[{"name":"out0 Ops.Gl.GLTF.GltfNode_v2 Render","type":1}]}'},{name:"patchId",value:"84011ea8-0171-48b4-8da1-6590d949826b"},{name:"in0 Ops.Gl.Matrix.Transform trigger"},{name:"in1 Ops.String.SwitchString Result"}],portsOut:[{name:"create port out",value:0},{name:"out0 Ops.Gl.GLTF.GltfNode_v2 Render"}]},{objName:"Ops.Gl.Geometry.GeometryInfo",id:"216",uiAttribs:{subPatch:"84011ea8-0171-48b4-8da1-6590d949826b"},portsIn:[{name:"Geometry"}],portsOut:[{name:"Indexed",value:null},{name:"Faces",value:null},{name:"Vertices",value:null},{name:"Normals",value:null},{name:"TexCoords",value:null},{name:"Tangents",value:null},{name:"BiTangents",value:null},{name:"VertexColors",links:[{portIn:"number1",portOut:"VertexColors",objIn:"218",objOut:"216"}]},{name:"Other Attributes",value:null}]},{objName:"Ops.User.kikohs.PLYLoader",id:"217",uiAttribs:{subPatch:"84011ea8-0171-48b4-8da1-6590d949826b"},portsIn:[{name:"PLY File",display:"file"},{name:"Auto-load",value:false},{name:"Custom Property map",value:0},{name:"Reload"}],portsOut:[{name:"Loaded",value:0},{name:"Geometry",links:[{portIn:"Geometry",portOut:"Geometry",objIn:"208",objOut:"217"},{portIn:"Geometry",portOut:"Geometry",objIn:"216",objOut:"217"}]},{name:"Loading",value:false},{name:"Is Point Cloud?",links:[{portIn:"Switch Value",portOut:"Is Point Cloud?",objIn:"209",objOut:"217"}]},{name:"Error",value:null}]},{objName:"Ops.Math.Compare.GreaterThan",id:"218",uiAttribs:{subPatch:"84011ea8-0171-48b4-8da1-6590d949826b"},portsIn:[{name:"number1"},{name:"number2",value:0}],portsOut:[{name:"result",links:[{portIn:"boolean",portOut:"result",objIn:"219",objOut:"218"}]}]},{objName:"Ops.Boolean.IfTrueThen_v2",id:"219",uiAttribs:{subPatch:"84011ea8-0171-48b4-8da1-6590d949826b"},portsIn:[{name:"exe"},{name:"boolean"}],portsOut:[{name:"then",links:[{portIn:"Render",portOut:"then",objIn:"212",objOut:"219"}]},{name:"else",links:[{portIn:"render",portOut:"else",objIn:"208",objOut:"219"}]}]},{objName:"Ops.Trigger.TriggerOnce",id:"220",uiAttribs:{subPatch:"84011ea8-0171-48b4-8da1-6590d949826b"},portsIn:[{name:"Exec"},{name:"Reset",value:0}],portsOut:[{name:"Next",links:[{portIn:"Reload",portOut:"Next",objIn:"217",objOut:"220"}]},{name:"Was Triggered",value:true}]},{objName:"Ops.Gl.RenderGeometry",id:"221",uiAttribs:{subPatch:"2c11b322-b45a-49f8-86aa-29437cd3f29a"},portsIn:[{name:"render"},{name:"Geometry"},{name:"Update All",value:true},{name:"Update Face Indices",value:false},{name:"Update Vertices",value:false},{name:"Update Texcoords",value:false},{name:"Vertex Numbers",value:false}],portsOut:[{name:"trigger",links:[{portIn:"out0 Ops.Gl.GLTF.GltfNode_v2 Render",portOut:"trigger",objIn:"227",objOut:"221"}]}]},{objName:"Ops.Trigger.RouteTrigger",id:"222",uiAttribs:{subPatch:"2c11b322-b45a-49f8-86aa-29437cd3f29a"},portsIn:[{name:"Execute"},{name:"Switch Value"}],portsOut:[{name:"Next Trigger",value:0},{name:"Switched Value",value:1},{name:"Trigger 0",links:[{portIn:"Trigger In",portOut:"Trigger 0",objIn:"224",objOut:"222"}]},{name:"Trigger 1",links:[{portIn:"render",portOut:"Trigger 1",objIn:"223",objOut:"222"}]},{name:"Trigger 2",value:0},{name:"Trigger 3",value:0},{name:"Trigger 4",value:0},{name:"Trigger 5",value:0},{name:"Trigger 6",value:0},{name:"Trigger 7",value:0},{name:"Trigger 8",value:0},{name:"Trigger 9",value:0},{name:"Trigger 10",value:0},{name:"Trigger 11",value:0},{name:"Trigger 12",value:0},{name:"Trigger 13",value:0},{name:"Trigger 14",value:0},{name:"Trigger 15",value:0},{name:"Trigger 16",value:0},{name:"Trigger 17",value:0},{name:"Trigger 18",value:0},{name:"Trigger 19",value:0},{name:"Trigger 20",value:0},{name:"Trigger 21",value:0},{name:"Trigger 22",value:0},{name:"Trigger 23",value:0},{name:"Default Trigger",value:0}]},{objName:"Ops.Gl.Shader.PointMaterial_v4",id:"223",uiAttribs:{subPatch:"2c11b322-b45a-49f8-86aa-29437cd3f29a"},portsIn:[{name:"render"},{name:"PointSize",value:1.47},{name:"Size in Pixels",value:false},{name:"Random Size",value:0},{name:"Round",value:true},{name:"Round Antialias",value:false},{name:"Scale by Distance",value:false},{name:"r",value:1},{name:"g",value:1},{name:"b",value:1},{name:"a",value:1},{name:"Vertex Colors",value:true},{name:"texture",value:0},{name:"Colorize Texture",value:false},{name:"Texture Mask",value:0},{name:"Mask Channel index",value:0},{name:"Mask Channel",value:"R"},{name:"Texture Colorize",value:0},{name:"Colorize Randomize",value:true},{name:"Texture Opacity",value:0},{name:"Texture Point Size",value:0},{name:"Point Size Channel index",value:0},{name:"Point Size Channel",value:"R"},{name:"Texture Point Size Mul",value:1},{name:"Map Size 0 index",value:0},{name:"Map Size 0",value:"Black"},{name:"Flip Texture",value:false}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"221",objOut:"223"}]},{name:"shader"}]},{objName:"Ops.Gl.Phong.PhongMaterial_v6",id:"224",uiAttribs:{subPatch:"2c11b322-b45a-49f8-86aa-29437cd3f29a"},portsIn:[{name:"Trigger In"},{name:"R",value:.8506666644414266},{name:"G",value:.5094861914999278},{name:"B",value:.5094861914999278},{name:"A",value:1},{name:"Enable",value:false},{name:"Albedo",value:.707},{name:"Roughness",value:.835},{name:"Active",value:false},{name:"Fresnel Intensity",value:.7},{name:"Fresnel Width",value:1},{name:"Fresnel Exponent",value:6},{name:"Fresnel R",value:1},{name:"Fresnel G",value:1},{name:"Fresnel B",value:1},{name:"Emissive Active",value:false},{name:"Color Intensity",value:.3},{name:"Emissive R",value:.7528171913638779},{name:"Emissive G",value:.36422624829379013},{name:"Emissive B",value:.3103095732889889},{name:"Shininess",value:4},{name:"Specular Amount",value:.5},{name:"Specular Model index",value:0},{name:"Specular Model",value:"Blinn"},{name:"Energy Conservation",value:false},{name:"Double Sided Material",value:false},{name:"Falloff Mode index",value:0},{name:"Falloff Mode",value:"A"},{name:"Diffuse Texture",value:0},{name:"Specular Texture",value:0},{name:"Normal Map",value:0},{name:"AO Texture",value:0},{name:"Emissive Texture",value:0},{name:"Emissive Mask",value:0},{name:"Opacity Texture",value:0},{name:"Environment Map",value:0},{name:"Env Map Mask",value:0},{name:"Colorize Texture",value:true},{name:"Diffuse Repeat X",value:1},{name:"Diffuse Repeat Y",value:1},{name:"Texture Offset X",value:0},{name:"Texture Offset Y",value:0},{name:"Specular Intensity",value:1},{name:"Normal Map Intensity",value:.5},{name:"AO Intensity",value:1},{name:"Emissive Intensity",value:1},{name:"Emissive Mask Intensity",value:1},{name:"Env Map Intensity",value:1},{name:"Env Map Blend index",value:0},{name:"Env Map Blend",value:"Add"},{name:"Env Mask Intensity",value:1},{name:"Alpha Mask Source index",value:0},{name:"Alpha Mask Source",value:"Luminance"},{name:"Discard Transparent Pixels",value:false}],portsOut:[{name:"Trigger Out",links:[{portIn:"exe",portOut:"Trigger Out",objIn:"232",objOut:"224"}]},{name:"Shader"}]},{objName:"Ops.Gl.ShaderEffects.UseVertexColor",id:"225",uiAttribs:{subPatch:"2c11b322-b45a-49f8-86aa-29437cd3f29a"},portsIn:[{name:"Render"}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"221",objOut:"225"}]}]},{objName:"Ops.Ui.PatchInput",id:"226",uiAttribs:{subPatch:"2c11b322-b45a-49f8-86aa-29437cd3f29a"},portsIn:[],portsOut:[{name:"create port",value:0},{name:"in0 Ops.Gl.Matrix.Transform trigger",links:[{portIn:"Execute",portOut:"in0 Ops.Gl.Matrix.Transform trigger",objIn:"222",objOut:"226"},{portIn:"Exec",portOut:"in0 Ops.Gl.Matrix.Transform trigger",objIn:"233",objOut:"226"}]},{name:"in1 Ops.String.SwitchString Result",links:[{portIn:"PLY File",portOut:"in1 Ops.String.SwitchString Result",objIn:"230",objOut:"226"}]}]},{objName:"Ops.Ui.PatchOutput",id:"227",uiAttribs:{subPatch:"2c11b322-b45a-49f8-86aa-29437cd3f29a"},portsIn:[{name:"create port",value:0},{name:"out0 Ops.Gl.GLTF.GltfNode_v2 Render"}],portsOut:[]},{objName:"Ops.Ui.SubPatch",id:"228",uiAttribs:{subPatch:0},portsIn:[{name:"create port",value:null},{name:"dataStr",value:'{"ports":[{"name":"in0 Ops.Gl.Matrix.Transform trigger","type":1,"title":"Render"},{"name":"in1 Ops.String.SwitchString Result","type":5,"title":"URL"}],"portsOut":[{"name":"out0 Ops.Gl.GLTF.GltfNode_v2 Render","type":1}]}'},{name:"patchId",value:"2c11b322-b45a-49f8-86aa-29437cd3f29a"},{name:"in0 Ops.Gl.Matrix.Transform trigger"},{name:"in1 Ops.String.SwitchString Result"}],portsOut:[{name:"create port out",value:0},{name:"out0 Ops.Gl.GLTF.GltfNode_v2 Render"}]},{objName:"Ops.Gl.Geometry.GeometryInfo",id:"229",uiAttribs:{subPatch:"2c11b322-b45a-49f8-86aa-29437cd3f29a"},portsIn:[{name:"Geometry"}],portsOut:[{name:"Indexed",value:null},{name:"Faces",value:null},{name:"Vertices",value:null},{name:"Normals",value:null},{name:"TexCoords",value:null},{name:"Tangents",value:null},{name:"BiTangents",value:null},{name:"VertexColors",links:[{portIn:"number1",portOut:"VertexColors",objIn:"231",objOut:"229"}]},{name:"Other Attributes",value:null}]},{objName:"Ops.User.kikohs.PLYLoader",id:"230",uiAttribs:{subPatch:"2c11b322-b45a-49f8-86aa-29437cd3f29a"},portsIn:[{name:"PLY File",display:"file"},{name:"Auto-load",value:false},{name:"Custom Property map",value:0},{name:"Reload"}],portsOut:[{name:"Loaded",value:0},{name:"Geometry",links:[{portIn:"Geometry",portOut:"Geometry",objIn:"221",objOut:"230"},{portIn:"Geometry",portOut:"Geometry",objIn:"229",objOut:"230"}]},{name:"Loading",value:false},{name:"Is Point Cloud?",links:[{portIn:"Switch Value",portOut:"Is Point Cloud?",objIn:"222",objOut:"230"}]},{name:"Error",value:null}]},{objName:"Ops.Math.Compare.GreaterThan",id:"231",uiAttribs:{subPatch:"2c11b322-b45a-49f8-86aa-29437cd3f29a"},portsIn:[{name:"number1"},{name:"number2",value:0}],portsOut:[{name:"result",links:[{portIn:"boolean",portOut:"result",objIn:"232",objOut:"231"}]}]},{objName:"Ops.Boolean.IfTrueThen_v2",id:"232",uiAttribs:{subPatch:"2c11b322-b45a-49f8-86aa-29437cd3f29a"},portsIn:[{name:"exe"},{name:"boolean"}],portsOut:[{name:"then",links:[{portIn:"Render",portOut:"then",objIn:"225",objOut:"232"}]},{name:"else",links:[{portIn:"render",portOut:"else",objIn:"221",objOut:"232"}]}]},{objName:"Ops.Trigger.TriggerOnce",id:"233",uiAttribs:{subPatch:"2c11b322-b45a-49f8-86aa-29437cd3f29a"},portsIn:[{name:"Exec"},{name:"Reset",value:0}],portsOut:[{name:"Next",links:[{portIn:"Reload",portOut:"Next",objIn:"230",objOut:"233"}]},{name:"Was Triggered",value:true}]},{objName:"Ops.Gl.RenderGeometry",id:"234",uiAttribs:{subPatch:"f3d60b32-2847-4daa-aab6-1c9da37a8c13"},portsIn:[{name:"render"},{name:"Geometry"},{name:"Update All",value:true},{name:"Update Face Indices",value:false},{name:"Update Vertices",value:false},{name:"Update Texcoords",value:false},{name:"Vertex Numbers",value:false}],portsOut:[{name:"trigger",links:[{portIn:"out0 Ops.Gl.GLTF.GltfNode_v2 Render",portOut:"trigger",objIn:"240",objOut:"234"}]}]},{objName:"Ops.Trigger.RouteTrigger",id:"235",uiAttribs:{subPatch:"f3d60b32-2847-4daa-aab6-1c9da37a8c13"},portsIn:[{name:"Execute"},{name:"Switch Value"}],portsOut:[{name:"Next Trigger",value:0},{name:"Switched Value",value:1},{name:"Trigger 0",links:[{portIn:"Trigger In",portOut:"Trigger 0",objIn:"237",objOut:"235"}]},{name:"Trigger 1",links:[{portIn:"render",portOut:"Trigger 1",objIn:"236",objOut:"235"}]},{name:"Trigger 2",value:0},{name:"Trigger 3",value:0},{name:"Trigger 4",value:0},{name:"Trigger 5",value:0},{name:"Trigger 6",value:0},{name:"Trigger 7",value:0},{name:"Trigger 8",value:0},{name:"Trigger 9",value:0},{name:"Trigger 10",value:0},{name:"Trigger 11",value:0},{name:"Trigger 12",value:0},{name:"Trigger 13",value:0},{name:"Trigger 14",value:0},{name:"Trigger 15",value:0},{name:"Trigger 16",value:0},{name:"Trigger 17",value:0},{name:"Trigger 18",value:0},{name:"Trigger 19",value:0},{name:"Trigger 20",value:0},{name:"Trigger 21",value:0},{name:"Trigger 22",value:0},{name:"Trigger 23",value:0},{name:"Default Trigger",value:0}]},{objName:"Ops.Gl.Shader.PointMaterial_v4",id:"236",uiAttribs:{subPatch:"f3d60b32-2847-4daa-aab6-1c9da37a8c13"},portsIn:[{name:"render"},{name:"PointSize",value:1.47},{name:"Size in Pixels",value:false},{name:"Random Size",value:0},{name:"Round",value:true},{name:"Round Antialias",value:false},{name:"Scale by Distance",value:false},{name:"r",value:1},{name:"g",value:1},{name:"b",value:1},{name:"a",value:1},{name:"Vertex Colors",value:true},{name:"texture",value:0},{name:"Colorize Texture",value:false},{name:"Texture Mask",value:0},{name:"Mask Channel index",value:0},{name:"Mask Channel",value:"R"},{name:"Texture Colorize",value:0},{name:"Colorize Randomize",value:true},{name:"Texture Opacity",value:0},{name:"Texture Point Size",value:0},{name:"Point Size Channel index",value:0},{name:"Point Size Channel",value:"R"},{name:"Texture Point Size Mul",value:1},{name:"Map Size 0 index",value:0},{name:"Map Size 0",value:"Black"},{name:"Flip Texture",value:false}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"234",objOut:"236"}]},{name:"shader"}]},{objName:"Ops.Gl.Phong.PhongMaterial_v6",id:"237",uiAttribs:{subPatch:"f3d60b32-2847-4daa-aab6-1c9da37a8c13"},portsIn:[{name:"Trigger In"},{name:"R",value:.8506666644414266},{name:"G",value:.5094861914999278},{name:"B",value:.5094861914999278},{name:"A",value:1},{name:"Enable",value:false},{name:"Albedo",value:.707},{name:"Roughness",value:.835},{name:"Active",value:false},{name:"Fresnel Intensity",value:.7},{name:"Fresnel Width",value:1},{name:"Fresnel Exponent",value:6},{name:"Fresnel R",value:1},{name:"Fresnel G",value:1},{name:"Fresnel B",value:1},{name:"Emissive Active",value:false},{name:"Color Intensity",value:.3},{name:"Emissive R",value:.7528171913638779},{name:"Emissive G",value:.36422624829379013},{name:"Emissive B",value:.3103095732889889},{name:"Shininess",value:4},{name:"Specular Amount",value:.5},{name:"Specular Model index",value:0},{name:"Specular Model",value:"Blinn"},{name:"Energy Conservation",value:false},{name:"Double Sided Material",value:false},{name:"Falloff Mode index",value:0},{name:"Falloff Mode",value:"A"},{name:"Diffuse Texture",value:0},{name:"Specular Texture",value:0},{name:"Normal Map",value:0},{name:"AO Texture",value:0},{name:"Emissive Texture",value:0},{name:"Emissive Mask",value:0},{name:"Opacity Texture",value:0},{name:"Environment Map",value:0},{name:"Env Map Mask",value:0},{name:"Colorize Texture",value:true},{name:"Diffuse Repeat X",value:1},{name:"Diffuse Repeat Y",value:1},{name:"Texture Offset X",value:0},{name:"Texture Offset Y",value:0},{name:"Specular Intensity",value:1},{name:"Normal Map Intensity",value:.5},{name:"AO Intensity",value:1},{name:"Emissive Intensity",value:1},{name:"Emissive Mask Intensity",value:1},{name:"Env Map Intensity",value:1},{name:"Env Map Blend index",value:0},{name:"Env Map Blend",value:"Add"},{name:"Env Mask Intensity",value:1},{name:"Alpha Mask Source index",value:0},{name:"Alpha Mask Source",value:"Luminance"},{name:"Discard Transparent Pixels",value:false}],portsOut:[{name:"Trigger Out",links:[{portIn:"exe",portOut:"Trigger Out",objIn:"245",objOut:"237"}]},{name:"Shader"}]},{objName:"Ops.Gl.ShaderEffects.UseVertexColor",id:"238",uiAttribs:{subPatch:"f3d60b32-2847-4daa-aab6-1c9da37a8c13"},portsIn:[{name:"Render"}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"234",objOut:"238"}]}]},{objName:"Ops.Ui.PatchInput",id:"239",uiAttribs:{subPatch:"f3d60b32-2847-4daa-aab6-1c9da37a8c13"},portsIn:[],portsOut:[{name:"create port",value:0},{name:"in0 Ops.Gl.Matrix.Transform trigger",links:[{portIn:"Execute",portOut:"in0 Ops.Gl.Matrix.Transform trigger",objIn:"235",objOut:"239"},{portIn:"Exec",portOut:"in0 Ops.Gl.Matrix.Transform trigger",objIn:"246",objOut:"239"}]},{name:"in1 Ops.String.SwitchString Result",links:[{portIn:"PLY File",portOut:"in1 Ops.String.SwitchString Result",objIn:"243",objOut:"239"}]}]},{objName:"Ops.Ui.PatchOutput",id:"240",uiAttribs:{subPatch:"f3d60b32-2847-4daa-aab6-1c9da37a8c13"},portsIn:[{name:"create port",value:0},{name:"out0 Ops.Gl.GLTF.GltfNode_v2 Render"}],portsOut:[]},{objName:"Ops.Ui.SubPatch",id:"241",uiAttribs:{subPatch:0},portsIn:[{name:"create port",value:null},{name:"dataStr",value:'{"ports":[{"name":"in0 Ops.Gl.Matrix.Transform trigger","type":1,"title":"Render"},{"name":"in1 Ops.String.SwitchString Result","type":5,"title":"URL"}],"portsOut":[{"name":"out0 Ops.Gl.GLTF.GltfNode_v2 Render","type":1}]}'},{name:"patchId",value:"f3d60b32-2847-4daa-aab6-1c9da37a8c13"},{name:"in0 Ops.Gl.Matrix.Transform trigger"},{name:"in1 Ops.String.SwitchString Result"}],portsOut:[{name:"create port out",value:0},{name:"out0 Ops.Gl.GLTF.GltfNode_v2 Render"}]},{objName:"Ops.Gl.Geometry.GeometryInfo",id:"242",uiAttribs:{subPatch:"f3d60b32-2847-4daa-aab6-1c9da37a8c13"},portsIn:[{name:"Geometry"}],portsOut:[{name:"Indexed",value:null},{name:"Faces",value:null},{name:"Vertices",value:null},{name:"Normals",value:null},{name:"TexCoords",value:null},{name:"Tangents",value:null},{name:"BiTangents",value:null},{name:"VertexColors",links:[{portIn:"number1",portOut:"VertexColors",objIn:"244",objOut:"242"}]},{name:"Other Attributes",value:null}]},{objName:"Ops.User.kikohs.PLYLoader",id:"243",uiAttribs:{subPatch:"f3d60b32-2847-4daa-aab6-1c9da37a8c13"},portsIn:[{name:"PLY File",display:"file"},{name:"Auto-load",value:false},{name:"Custom Property map",value:0},{name:"Reload"}],portsOut:[{name:"Loaded",value:0},{name:"Geometry",links:[{portIn:"Geometry",portOut:"Geometry",objIn:"234",objOut:"243"},{portIn:"Geometry",portOut:"Geometry",objIn:"242",objOut:"243"}]},{name:"Loading",value:false},{name:"Is Point Cloud?",links:[{portIn:"Switch Value",portOut:"Is Point Cloud?",objIn:"235",objOut:"243"}]},{name:"Error",value:null}]},{objName:"Ops.Math.Compare.GreaterThan",id:"244",uiAttribs:{subPatch:"f3d60b32-2847-4daa-aab6-1c9da37a8c13"},portsIn:[{name:"number1"},{name:"number2",value:0}],portsOut:[{name:"result",links:[{portIn:"boolean",portOut:"result",objIn:"245",objOut:"244"}]}]},{objName:"Ops.Boolean.IfTrueThen_v2",id:"245",uiAttribs:{subPatch:"f3d60b32-2847-4daa-aab6-1c9da37a8c13"},portsIn:[{name:"exe"},{name:"boolean"}],portsOut:[{name:"then",links:[{portIn:"Render",portOut:"then",objIn:"238",objOut:"245"}]},{name:"else",links:[{portIn:"render",portOut:"else",objIn:"234",objOut:"245"}]}]},{objName:"Ops.Trigger.TriggerOnce",id:"246",uiAttribs:{subPatch:"f3d60b32-2847-4daa-aab6-1c9da37a8c13"},portsIn:[{name:"Exec"},{name:"Reset",value:0}],portsOut:[{name:"Next",links:[{portIn:"Reload",portOut:"Next",objIn:"243",objOut:"246"}]},{name:"Was Triggered",value:true}]},{objName:"Ops.Gl.RenderGeometry",id:"247",uiAttribs:{subPatch:"29b2e4f2-a6c6-437a-9d08-6aa6a02917eb"},portsIn:[{name:"render"},{name:"Geometry"},{name:"Update All",value:true},{name:"Update Face Indices",value:false},{name:"Update Vertices",value:false},{name:"Update Texcoords",value:false},{name:"Vertex Numbers",value:false}],portsOut:[{name:"trigger",links:[{portIn:"out0 Ops.Gl.GLTF.GltfNode_v2 Render",portOut:"trigger",objIn:"253",objOut:"247"}]}]},{objName:"Ops.Trigger.RouteTrigger",id:"248",uiAttribs:{subPatch:"29b2e4f2-a6c6-437a-9d08-6aa6a02917eb"},portsIn:[{name:"Execute"},{name:"Switch Value"}],portsOut:[{name:"Next Trigger",value:0},{name:"Switched Value",value:1},{name:"Trigger 0",links:[{portIn:"Trigger In",portOut:"Trigger 0",objIn:"250",objOut:"248"}]},{name:"Trigger 1",links:[{portIn:"render",portOut:"Trigger 1",objIn:"249",objOut:"248"}]},{name:"Trigger 2",value:0},{name:"Trigger 3",value:0},{name:"Trigger 4",value:0},{name:"Trigger 5",value:0},{name:"Trigger 6",value:0},{name:"Trigger 7",value:0},{name:"Trigger 8",value:0},{name:"Trigger 9",value:0},{name:"Trigger 10",value:0},{name:"Trigger 11",value:0},{name:"Trigger 12",value:0},{name:"Trigger 13",value:0},{name:"Trigger 14",value:0},{name:"Trigger 15",value:0},{name:"Trigger 16",value:0},{name:"Trigger 17",value:0},{name:"Trigger 18",value:0},{name:"Trigger 19",value:0},{name:"Trigger 20",value:0},{name:"Trigger 21",value:0},{name:"Trigger 22",value:0},{name:"Trigger 23",value:0},{name:"Default Trigger",value:0}]},{objName:"Ops.Gl.Shader.PointMaterial_v4",id:"249",uiAttribs:{subPatch:"29b2e4f2-a6c6-437a-9d08-6aa6a02917eb"},portsIn:[{name:"render"},{name:"PointSize",value:1.47},{name:"Size in Pixels",value:false},{name:"Random Size",value:0},{name:"Round",value:true},{name:"Round Antialias",value:false},{name:"Scale by Distance",value:false},{name:"r",value:1},{name:"g",value:1},{name:"b",value:1},{name:"a",value:1},{name:"Vertex Colors",value:true},{name:"texture",value:0},{name:"Colorize Texture",value:false},{name:"Texture Mask",value:0},{name:"Mask Channel index",value:0},{name:"Mask Channel",value:"R"},{name:"Texture Colorize",value:0},{name:"Colorize Randomize",value:true},{name:"Texture Opacity",value:0},{name:"Texture Point Size",value:0},{name:"Point Size Channel index",value:0},{name:"Point Size Channel",value:"R"},{name:"Texture Point Size Mul",value:1},{name:"Map Size 0 index",value:0},{name:"Map Size 0",value:"Black"},{name:"Flip Texture",value:false}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"247",objOut:"249"}]},{name:"shader"}]},{objName:"Ops.Gl.Phong.PhongMaterial_v6",id:"250",uiAttribs:{subPatch:"29b2e4f2-a6c6-437a-9d08-6aa6a02917eb"},portsIn:[{name:"Trigger In"},{name:"R",value:.8506666644414266},{name:"G",value:.5094861914999278},{name:"B",value:.5094861914999278},{name:"A",value:1},{name:"Enable",value:false},{name:"Albedo",value:.707},{name:"Roughness",value:.835},{name:"Active",value:false},{name:"Fresnel Intensity",value:.7},{name:"Fresnel Width",value:1},{name:"Fresnel Exponent",value:6},{name:"Fresnel R",value:1},{name:"Fresnel G",value:1},{name:"Fresnel B",value:1},{name:"Emissive Active",value:false},{name:"Color Intensity",value:.3},{name:"Emissive R",value:.7528171913638779},{name:"Emissive G",value:.36422624829379013},{name:"Emissive B",value:.3103095732889889},{name:"Shininess",value:4},{name:"Specular Amount",value:.5},{name:"Specular Model index",value:0},{name:"Specular Model",value:"Blinn"},{name:"Energy Conservation",value:false},{name:"Double Sided Material",value:false},{name:"Falloff Mode index",value:0},{name:"Falloff Mode",value:"A"},{name:"Diffuse Texture",value:0},{name:"Specular Texture",value:0},{name:"Normal Map",value:0},{name:"AO Texture",value:0},{name:"Emissive Texture",value:0},{name:"Emissive Mask",value:0},{name:"Opacity Texture",value:0},{name:"Environment Map",value:0},{name:"Env Map Mask",value:0},{name:"Colorize Texture",value:true},{name:"Diffuse Repeat X",value:1},{name:"Diffuse Repeat Y",value:1},{name:"Texture Offset X",value:0},{name:"Texture Offset Y",value:0},{name:"Specular Intensity",value:1},{name:"Normal Map Intensity",value:.5},{name:"AO Intensity",value:1},{name:"Emissive Intensity",value:1},{name:"Emissive Mask Intensity",value:1},{name:"Env Map Intensity",value:1},{name:"Env Map Blend index",value:0},{name:"Env Map Blend",value:"Add"},{name:"Env Mask Intensity",value:1},{name:"Alpha Mask Source index",value:0},{name:"Alpha Mask Source",value:"Luminance"},{name:"Discard Transparent Pixels",value:false}],portsOut:[{name:"Trigger Out",links:[{portIn:"exe",portOut:"Trigger Out",objIn:"258",objOut:"250"}]},{name:"Shader"}]},{objName:"Ops.Gl.ShaderEffects.UseVertexColor",id:"251",uiAttribs:{subPatch:"29b2e4f2-a6c6-437a-9d08-6aa6a02917eb"},portsIn:[{name:"Render"}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"247",objOut:"251"}]}]},{objName:"Ops.Ui.PatchInput",id:"252",uiAttribs:{subPatch:"29b2e4f2-a6c6-437a-9d08-6aa6a02917eb"},portsIn:[],portsOut:[{name:"create port",value:0},{name:"in0 Ops.Gl.Matrix.Transform trigger",links:[{portIn:"Execute",portOut:"in0 Ops.Gl.Matrix.Transform trigger",objIn:"248",objOut:"252"},{portIn:"Exec",portOut:"in0 Ops.Gl.Matrix.Transform trigger",objIn:"259",objOut:"252"}]},{name:"in1 Ops.String.SwitchString Result",links:[{portIn:"PLY File",portOut:"in1 Ops.String.SwitchString Result",objIn:"256",objOut:"252"}]}]},{objName:"Ops.Ui.PatchOutput",id:"253",uiAttribs:{subPatch:"29b2e4f2-a6c6-437a-9d08-6aa6a02917eb"},portsIn:[{name:"create port",value:0},{name:"out0 Ops.Gl.GLTF.GltfNode_v2 Render"}],portsOut:[]},{objName:"Ops.Ui.SubPatch",id:"254",uiAttribs:{subPatch:0},portsIn:[{name:"create port",value:null},{name:"dataStr",value:'{"ports":[{"name":"in0 Ops.Gl.Matrix.Transform trigger","type":1,"title":"Render"},{"name":"in1 Ops.String.SwitchString Result","type":5,"title":"URL"}],"portsOut":[{"name":"out0 Ops.Gl.GLTF.GltfNode_v2 Render","type":1}]}'},{name:"patchId",value:"29b2e4f2-a6c6-437a-9d08-6aa6a02917eb"},{name:"in0 Ops.Gl.Matrix.Transform trigger"},{name:"in1 Ops.String.SwitchString Result"}],portsOut:[{name:"create port out",value:0},{name:"out0 Ops.Gl.GLTF.GltfNode_v2 Render"}]},{objName:"Ops.Gl.Geometry.GeometryInfo",id:"255",uiAttribs:{subPatch:"29b2e4f2-a6c6-437a-9d08-6aa6a02917eb"},portsIn:[{name:"Geometry"}],portsOut:[{name:"Indexed",value:null},{name:"Faces",value:null},{name:"Vertices",value:null},{name:"Normals",value:null},{name:"TexCoords",value:null},{name:"Tangents",value:null},{name:"BiTangents",value:null},{name:"VertexColors",links:[{portIn:"number1",portOut:"VertexColors",objIn:"257",objOut:"255"}]},{name:"Other Attributes",value:null}]},{objName:"Ops.User.kikohs.PLYLoader",id:"256",uiAttribs:{subPatch:"29b2e4f2-a6c6-437a-9d08-6aa6a02917eb"},portsIn:[{name:"PLY File",display:"file"},{name:"Auto-load",value:false},{name:"Custom Property map",value:0},{name:"Reload"}],portsOut:[{name:"Loaded",value:0},{name:"Geometry",links:[{portIn:"Geometry",portOut:"Geometry",objIn:"247",objOut:"256"},{portIn:"Geometry",portOut:"Geometry",objIn:"255",objOut:"256"}]},{name:"Loading",value:false},{name:"Is Point Cloud?",links:[{portIn:"Switch Value",portOut:"Is Point Cloud?",objIn:"248",objOut:"256"}]},{name:"Error",value:null}]},{objName:"Ops.Math.Compare.GreaterThan",id:"257",uiAttribs:{subPatch:"29b2e4f2-a6c6-437a-9d08-6aa6a02917eb"},portsIn:[{name:"number1"},{name:"number2",value:0}],portsOut:[{name:"result",links:[{portIn:"boolean",portOut:"result",objIn:"258",objOut:"257"}]}]},{objName:"Ops.Boolean.IfTrueThen_v2",id:"258",uiAttribs:{subPatch:"29b2e4f2-a6c6-437a-9d08-6aa6a02917eb"},portsIn:[{name:"exe"},{name:"boolean"}],portsOut:[{name:"then",links:[{portIn:"Render",portOut:"then",objIn:"251",objOut:"258"}]},{name:"else",links:[{portIn:"render",portOut:"else",objIn:"247",objOut:"258"}]}]},{objName:"Ops.Trigger.TriggerOnce",id:"259",uiAttribs:{subPatch:"29b2e4f2-a6c6-437a-9d08-6aa6a02917eb"},portsIn:[{name:"Exec"},{name:"Reset",value:0}],portsOut:[{name:"Next",links:[{portIn:"Reload",portOut:"Next",objIn:"256",objOut:"259"}]},{name:"Was Triggered",value:true}]},{objName:"Ops.Gl.RenderGeometry",id:"260",uiAttribs:{subPatch:"c7e820ad-cc28-4236-9f69-760c1fefa19f"},portsIn:[{name:"render"},{name:"Geometry"},{name:"Update All",value:true},{name:"Update Face Indices",value:false},{name:"Update Vertices",value:false},{name:"Update Texcoords",value:false},{name:"Vertex Numbers",value:false}],portsOut:[{name:"trigger",links:[{portIn:"out0 Ops.Gl.GLTF.GltfNode_v2 Render",portOut:"trigger",objIn:"266",objOut:"260"}]}]},{objName:"Ops.Trigger.RouteTrigger",id:"261",uiAttribs:{subPatch:"c7e820ad-cc28-4236-9f69-760c1fefa19f"},portsIn:[{name:"Execute"},{name:"Switch Value"}],portsOut:[{name:"Next Trigger",value:0},{name:"Switched Value",value:1},{name:"Trigger 0",links:[{portIn:"Trigger In",portOut:"Trigger 0",objIn:"263",objOut:"261"}]},{name:"Trigger 1",links:[{portIn:"render",portOut:"Trigger 1",objIn:"262",objOut:"261"}]},{name:"Trigger 2",value:0},{name:"Trigger 3",value:0},{name:"Trigger 4",value:0},{name:"Trigger 5",value:0},{name:"Trigger 6",value:0},{name:"Trigger 7",value:0},{name:"Trigger 8",value:0},{name:"Trigger 9",value:0},{name:"Trigger 10",value:0},{name:"Trigger 11",value:0},{name:"Trigger 12",value:0},{name:"Trigger 13",value:0},{name:"Trigger 14",value:0},{name:"Trigger 15",value:0},{name:"Trigger 16",value:0},{name:"Trigger 17",value:0},{name:"Trigger 18",value:0},{name:"Trigger 19",value:0},{name:"Trigger 20",value:0},{name:"Trigger 21",value:0},{name:"Trigger 22",value:0},{name:"Trigger 23",value:0},{name:"Default Trigger",value:0}]},{objName:"Ops.Gl.Shader.PointMaterial_v4",id:"262",uiAttribs:{subPatch:"c7e820ad-cc28-4236-9f69-760c1fefa19f"},portsIn:[{name:"render"},{name:"PointSize",value:1.47},{name:"Size in Pixels",value:false},{name:"Random Size",value:0},{name:"Round",value:true},{name:"Round Antialias",value:false},{name:"Scale by Distance",value:false},{name:"r",value:1},{name:"g",value:1},{name:"b",value:1},{name:"a",value:1},{name:"Vertex Colors",value:true},{name:"texture",value:0},{name:"Colorize Texture",value:false},{name:"Texture Mask",value:0},{name:"Mask Channel index",value:0},{name:"Mask Channel",value:"R"},{name:"Texture Colorize",value:0},{name:"Colorize Randomize",value:true},{name:"Texture Opacity",value:0},{name:"Texture Point Size",value:0},{name:"Point Size Channel index",value:0},{name:"Point Size Channel",value:"R"},{name:"Texture Point Size Mul",value:1},{name:"Map Size 0 index",value:0},{name:"Map Size 0",value:"Black"},{name:"Flip Texture",value:false}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"260",objOut:"262"}]},{name:"shader"}]},{objName:"Ops.Gl.Phong.PhongMaterial_v6",id:"263",uiAttribs:{subPatch:"c7e820ad-cc28-4236-9f69-760c1fefa19f"},portsIn:[{name:"Trigger In"},{name:"R",value:.8506666644414266},{name:"G",value:.5094861914999278},{name:"B",value:.5094861914999278},{name:"A",value:1},{name:"Enable",value:false},{name:"Albedo",value:.707},{name:"Roughness",value:.835},{name:"Active",value:false},{name:"Fresnel Intensity",value:.7},{name:"Fresnel Width",value:1},{name:"Fresnel Exponent",value:6},{name:"Fresnel R",value:1},{name:"Fresnel G",value:1},{name:"Fresnel B",value:1},{name:"Emissive Active",value:false},{name:"Color Intensity",value:.3},{name:"Emissive R",value:.7528171913638779},{name:"Emissive G",value:.36422624829379013},{name:"Emissive B",value:.3103095732889889},{name:"Shininess",value:4},{name:"Specular Amount",value:.5},{name:"Specular Model index",value:0},{name:"Specular Model",value:"Blinn"},{name:"Energy Conservation",value:false},{name:"Double Sided Material",value:false},{name:"Falloff Mode index",value:0},{name:"Falloff Mode",value:"A"},{name:"Diffuse Texture",value:0},{name:"Specular Texture",value:0},{name:"Normal Map",value:0},{name:"AO Texture",value:0},{name:"Emissive Texture",value:0},{name:"Emissive Mask",value:0},{name:"Opacity Texture",value:0},{name:"Environment Map",value:0},{name:"Env Map Mask",value:0},{name:"Colorize Texture",value:true},{name:"Diffuse Repeat X",value:1},{name:"Diffuse Repeat Y",value:1},{name:"Texture Offset X",value:0},{name:"Texture Offset Y",value:0},{name:"Specular Intensity",value:1},{name:"Normal Map Intensity",value:.5},{name:"AO Intensity",value:1},{name:"Emissive Intensity",value:1},{name:"Emissive Mask Intensity",value:1},{name:"Env Map Intensity",value:1},{name:"Env Map Blend index",value:0},{name:"Env Map Blend",value:"Add"},{name:"Env Mask Intensity",value:1},{name:"Alpha Mask Source index",value:0},{name:"Alpha Mask Source",value:"Luminance"},{name:"Discard Transparent Pixels",value:false}],portsOut:[{name:"Trigger Out",links:[{portIn:"exe",portOut:"Trigger Out",objIn:"271",objOut:"263"}]},{name:"Shader"}]},{objName:"Ops.Gl.ShaderEffects.UseVertexColor",id:"264",uiAttribs:{subPatch:"c7e820ad-cc28-4236-9f69-760c1fefa19f"},portsIn:[{name:"Render"}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"260",objOut:"264"}]}]},{objName:"Ops.Ui.PatchInput",id:"265",uiAttribs:{subPatch:"c7e820ad-cc28-4236-9f69-760c1fefa19f"},portsIn:[],portsOut:[{name:"create port",value:0},{name:"in0 Ops.Gl.Matrix.Transform trigger",links:[{portIn:"Execute",portOut:"in0 Ops.Gl.Matrix.Transform trigger",objIn:"261",objOut:"265"},{portIn:"Exec",portOut:"in0 Ops.Gl.Matrix.Transform trigger",objIn:"272",objOut:"265"}]},{name:"in1 Ops.String.SwitchString Result",links:[{portIn:"PLY File",portOut:"in1 Ops.String.SwitchString Result",objIn:"269",objOut:"265"}]}]},{objName:"Ops.Ui.PatchOutput",id:"266",uiAttribs:{subPatch:"c7e820ad-cc28-4236-9f69-760c1fefa19f"},portsIn:[{name:"create port",value:0},{name:"out0 Ops.Gl.GLTF.GltfNode_v2 Render"}],portsOut:[]},{objName:"Ops.Ui.SubPatch",id:"267",uiAttribs:{subPatch:0},portsIn:[{name:"create port",value:null},{name:"dataStr",value:'{"ports":[{"name":"in0 Ops.Gl.Matrix.Transform trigger","type":1,"title":"Render"},{"name":"in1 Ops.String.SwitchString Result","type":5,"title":"URL"}],"portsOut":[{"name":"out0 Ops.Gl.GLTF.GltfNode_v2 Render","type":1}]}'},{name:"patchId",value:"c7e820ad-cc28-4236-9f69-760c1fefa19f"},{name:"in0 Ops.Gl.Matrix.Transform trigger"},{name:"in1 Ops.String.SwitchString Result"}],portsOut:[{name:"create port out",value:0},{name:"out0 Ops.Gl.GLTF.GltfNode_v2 Render"}]},{objName:"Ops.Gl.Geometry.GeometryInfo",id:"268",uiAttribs:{subPatch:"c7e820ad-cc28-4236-9f69-760c1fefa19f"},portsIn:[{name:"Geometry"}],portsOut:[{name:"Indexed",value:null},{name:"Faces",value:null},{name:"Vertices",value:null},{name:"Normals",value:null},{name:"TexCoords",value:null},{name:"Tangents",value:null},{name:"BiTangents",value:null},{name:"VertexColors",links:[{portIn:"number1",portOut:"VertexColors",objIn:"270",objOut:"268"}]},{name:"Other Attributes",value:null}]},{objName:"Ops.User.kikohs.PLYLoader",id:"269",uiAttribs:{subPatch:"c7e820ad-cc28-4236-9f69-760c1fefa19f"},portsIn:[{name:"PLY File",display:"file"},{name:"Auto-load",value:false},{name:"Custom Property map",value:0},{name:"Reload"}],portsOut:[{name:"Loaded",value:0},{name:"Geometry",links:[{portIn:"Geometry",portOut:"Geometry",objIn:"260",objOut:"269"},{portIn:"Geometry",portOut:"Geometry",objIn:"268",objOut:"269"}]},{name:"Loading",value:false},{name:"Is Point Cloud?",links:[{portIn:"Switch Value",portOut:"Is Point Cloud?",objIn:"261",objOut:"269"}]},{name:"Error",value:null}]},{objName:"Ops.Math.Compare.GreaterThan",id:"270",uiAttribs:{subPatch:"c7e820ad-cc28-4236-9f69-760c1fefa19f"},portsIn:[{name:"number1"},{name:"number2",value:0}],portsOut:[{name:"result",links:[{portIn:"boolean",portOut:"result",objIn:"271",objOut:"270"}]}]},{objName:"Ops.Boolean.IfTrueThen_v2",id:"271",uiAttribs:{subPatch:"c7e820ad-cc28-4236-9f69-760c1fefa19f"},portsIn:[{name:"exe"},{name:"boolean"}],portsOut:[{name:"then",links:[{portIn:"Render",portOut:"then",objIn:"264",objOut:"271"}]},{name:"else",links:[{portIn:"render",portOut:"else",objIn:"260",objOut:"271"}]}]},{objName:"Ops.Trigger.TriggerOnce",id:"272",uiAttribs:{subPatch:"c7e820ad-cc28-4236-9f69-760c1fefa19f"},portsIn:[{name:"Exec"},{name:"Reset",value:0}],portsOut:[{name:"Next",links:[{portIn:"Reload",portOut:"Next",objIn:"269",objOut:"272"}]},{name:"Was Triggered",value:true}]},{objName:"Ops.Gl.RenderGeometry",id:"273",uiAttribs:{subPatch:"8c7f3916-335e-4898-b37b-90baebc75a6e"},portsIn:[{name:"render"},{name:"Geometry"},{name:"Update All",value:true},{name:"Update Face Indices",value:false},{name:"Update Vertices",value:false},{name:"Update Texcoords",value:false},{name:"Vertex Numbers",value:false}],portsOut:[{name:"trigger",links:[{portIn:"out0 Ops.Gl.GLTF.GltfNode_v2 Render",portOut:"trigger",objIn:"279",objOut:"273"}]}]},{objName:"Ops.Trigger.RouteTrigger",id:"274",uiAttribs:{subPatch:"8c7f3916-335e-4898-b37b-90baebc75a6e"},portsIn:[{name:"Execute"},{name:"Switch Value"}],portsOut:[{name:"Next Trigger",value:0},{name:"Switched Value",value:1},{name:"Trigger 0",links:[{portIn:"Trigger In",portOut:"Trigger 0",objIn:"276",objOut:"274"}]},{name:"Trigger 1",links:[{portIn:"render",portOut:"Trigger 1",objIn:"275",objOut:"274"}]},{name:"Trigger 2",value:0},{name:"Trigger 3",value:0},{name:"Trigger 4",value:0},{name:"Trigger 5",value:0},{name:"Trigger 6",value:0},{name:"Trigger 7",value:0},{name:"Trigger 8",value:0},{name:"Trigger 9",value:0},{name:"Trigger 10",value:0},{name:"Trigger 11",value:0},{name:"Trigger 12",value:0},{name:"Trigger 13",value:0},{name:"Trigger 14",value:0},{name:"Trigger 15",value:0},{name:"Trigger 16",value:0},{name:"Trigger 17",value:0},{name:"Trigger 18",value:0},{name:"Trigger 19",value:0},{name:"Trigger 20",value:0},{name:"Trigger 21",value:0},{name:"Trigger 22",value:0},{name:"Trigger 23",value:0},{name:"Default Trigger",value:0}]},{objName:"Ops.Gl.Shader.PointMaterial_v4",id:"275",uiAttribs:{subPatch:"8c7f3916-335e-4898-b37b-90baebc75a6e"},portsIn:[{name:"render"},{name:"PointSize",value:1.47},{name:"Size in Pixels",value:false},{name:"Random Size",value:0},{name:"Round",value:true},{name:"Round Antialias",value:false},{name:"Scale by Distance",value:false},{name:"r",value:1},{name:"g",value:1},{name:"b",value:1},{name:"a",value:1},{name:"Vertex Colors",value:true},{name:"texture",value:0},{name:"Colorize Texture",value:false},{name:"Texture Mask",value:0},{name:"Mask Channel index",value:0},{name:"Mask Channel",value:"R"},{name:"Texture Colorize",value:0},{name:"Colorize Randomize",value:true},{name:"Texture Opacity",value:0},{name:"Texture Point Size",value:0},{name:"Point Size Channel index",value:0},{name:"Point Size Channel",value:"R"},{name:"Texture Point Size Mul",value:1},{name:"Map Size 0 index",value:0},{name:"Map Size 0",value:"Black"},{name:"Flip Texture",value:false}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"273",objOut:"275"}]},{name:"shader"}]},{objName:"Ops.Gl.Phong.PhongMaterial_v6",id:"276",uiAttribs:{subPatch:"8c7f3916-335e-4898-b37b-90baebc75a6e"},portsIn:[{name:"Trigger In"},{name:"R",value:.8506666644414266},{name:"G",value:.5094861914999278},{name:"B",value:.5094861914999278},{name:"A",value:1},{name:"Enable",value:false},{name:"Albedo",value:.707},{name:"Roughness",value:.835},{name:"Active",value:false},{name:"Fresnel Intensity",value:.7},{name:"Fresnel Width",value:1},{name:"Fresnel Exponent",value:6},{name:"Fresnel R",value:1},{name:"Fresnel G",value:1},{name:"Fresnel B",value:1},{name:"Emissive Active",value:false},{name:"Color Intensity",value:.3},{name:"Emissive R",value:.7528171913638779},{name:"Emissive G",value:.36422624829379013},{name:"Emissive B",value:.3103095732889889},{name:"Shininess",value:4},{name:"Specular Amount",value:.5},{name:"Specular Model index",value:0},{name:"Specular Model",value:"Blinn"},{name:"Energy Conservation",value:false},{name:"Double Sided Material",value:false},{name:"Falloff Mode index",value:0},{name:"Falloff Mode",value:"A"},{name:"Diffuse Texture",value:0},{name:"Specular Texture",value:0},{name:"Normal Map",value:0},{name:"AO Texture",value:0},{name:"Emissive Texture",value:0},{name:"Emissive Mask",value:0},{name:"Opacity Texture",value:0},{name:"Environment Map",value:0},{name:"Env Map Mask",value:0},{name:"Colorize Texture",value:true},{name:"Diffuse Repeat X",value:1},{name:"Diffuse Repeat Y",value:1},{name:"Texture Offset X",value:0},{name:"Texture Offset Y",value:0},{name:"Specular Intensity",value:1},{name:"Normal Map Intensity",value:.5},{name:"AO Intensity",value:1},{name:"Emissive Intensity",value:1},{name:"Emissive Mask Intensity",value:1},{name:"Env Map Intensity",value:1},{name:"Env Map Blend index",value:0},{name:"Env Map Blend",value:"Add"},{name:"Env Mask Intensity",value:1},{name:"Alpha Mask Source index",value:0},{name:"Alpha Mask Source",value:"Luminance"},{name:"Discard Transparent Pixels",value:false}],portsOut:[{name:"Trigger Out",links:[{portIn:"exe",portOut:"Trigger Out",objIn:"284",objOut:"276"}]},{name:"Shader"}]},{objName:"Ops.Gl.ShaderEffects.UseVertexColor",id:"277",uiAttribs:{subPatch:"8c7f3916-335e-4898-b37b-90baebc75a6e"},portsIn:[{name:"Render"}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"273",objOut:"277"}]}]},{objName:"Ops.Ui.PatchInput",id:"278",uiAttribs:{subPatch:"8c7f3916-335e-4898-b37b-90baebc75a6e"},portsIn:[],portsOut:[{name:"create port",value:0},{name:"in0 Ops.Gl.Matrix.Transform trigger",links:[{portIn:"Execute",portOut:"in0 Ops.Gl.Matrix.Transform trigger",objIn:"274",objOut:"278"},{portIn:"Exec",portOut:"in0 Ops.Gl.Matrix.Transform trigger",objIn:"285",objOut:"278"}]},{name:"in1 Ops.String.SwitchString Result",links:[{portIn:"PLY File",portOut:"in1 Ops.String.SwitchString Result",objIn:"282",objOut:"278"}]}]},{objName:"Ops.Ui.PatchOutput",id:"279",uiAttribs:{subPatch:"8c7f3916-335e-4898-b37b-90baebc75a6e"},portsIn:[{name:"create port",value:0},{name:"out0 Ops.Gl.GLTF.GltfNode_v2 Render"}],portsOut:[]},{objName:"Ops.Ui.SubPatch",id:"280",uiAttribs:{subPatch:0},portsIn:[{name:"create port",value:null},{name:"dataStr",value:'{"ports":[{"name":"in0 Ops.Gl.Matrix.Transform trigger","type":1,"title":"Render"},{"name":"in1 Ops.String.SwitchString Result","type":5,"title":"URL"}],"portsOut":[{"name":"out0 Ops.Gl.GLTF.GltfNode_v2 Render","type":1}]}'},{name:"patchId",value:"8c7f3916-335e-4898-b37b-90baebc75a6e"},{name:"in0 Ops.Gl.Matrix.Transform trigger"},{name:"in1 Ops.String.SwitchString Result"}],portsOut:[{name:"create port out",value:0},{name:"out0 Ops.Gl.GLTF.GltfNode_v2 Render"}]},{objName:"Ops.Gl.Geometry.GeometryInfo",id:"281",uiAttribs:{subPatch:"8c7f3916-335e-4898-b37b-90baebc75a6e"},portsIn:[{name:"Geometry"}],portsOut:[{name:"Indexed",value:null},{name:"Faces",value:null},{name:"Vertices",value:null},{name:"Normals",value:null},{name:"TexCoords",value:null},{name:"Tangents",value:null},{name:"BiTangents",value:null},{name:"VertexColors",links:[{portIn:"number1",portOut:"VertexColors",objIn:"283",objOut:"281"}]},{name:"Other Attributes",value:null}]},{objName:"Ops.User.kikohs.PLYLoader",id:"282",uiAttribs:{subPatch:"8c7f3916-335e-4898-b37b-90baebc75a6e"},portsIn:[{name:"PLY File",display:"file"},{name:"Auto-load",value:false},{name:"Custom Property map",value:0},{name:"Reload"}],portsOut:[{name:"Loaded",value:0},{name:"Geometry",links:[{portIn:"Geometry",portOut:"Geometry",objIn:"273",objOut:"282"},{portIn:"Geometry",portOut:"Geometry",objIn:"281",objOut:"282"}]},{name:"Loading",value:false},{name:"Is Point Cloud?",links:[{portIn:"Switch Value",portOut:"Is Point Cloud?",objIn:"274",objOut:"282"}]},{name:"Error",value:null}]},{objName:"Ops.Math.Compare.GreaterThan",id:"283",uiAttribs:{subPatch:"8c7f3916-335e-4898-b37b-90baebc75a6e"},portsIn:[{name:"number1"},{name:"number2",value:0}],portsOut:[{name:"result",links:[{portIn:"boolean",portOut:"result",objIn:"284",objOut:"283"}]}]},{objName:"Ops.Boolean.IfTrueThen_v2",id:"284",uiAttribs:{subPatch:"8c7f3916-335e-4898-b37b-90baebc75a6e"},portsIn:[{name:"exe"},{name:"boolean"}],portsOut:[{name:"then",links:[{portIn:"Render",portOut:"then",objIn:"277",objOut:"284"}]},{name:"else",links:[{portIn:"render",portOut:"else",objIn:"273",objOut:"284"}]}]},{objName:"Ops.Trigger.TriggerOnce",id:"285",uiAttribs:{subPatch:"8c7f3916-335e-4898-b37b-90baebc75a6e"},portsIn:[{name:"Exec"},{name:"Reset",value:0}],portsOut:[{name:"Next",links:[{portIn:"Reload",portOut:"Next",objIn:"282",objOut:"285"}]},{name:"Was Triggered",value:true}]},{objName:"Ops.Sequence",id:"286",uiAttribs:{subPatch:0},portsIn:[{name:"exe"},{name:"Clean up connections",value:0},{name:"exe 0",value:0},{name:"exe 1",value:0},{name:"exe 2",value:0},{name:"exe 3",value:0},{name:"exe 4",value:0},{name:"exe 5",value:0},{name:"exe 6",value:0},{name:"exe 7",value:0},{name:"exe 8",value:0},{name:"exe 9",value:0},{name:"exe 10",value:0},{name:"exe 11",value:0},{name:"exe 12",value:0},{name:"exe 13",value:0},{name:"exe 14",value:0}],portsOut:[{name:"trigger 0",links:[{portIn:"render",portOut:"trigger 0",objIn:"397",objOut:"286"}]},{name:"trigger 1",links:[{portIn:"render",portOut:"trigger 1",objIn:"398",objOut:"286"}]},{name:"trigger 2",value:0},{name:"trigger 3",value:0},{name:"trigger 4",value:0},{name:"trigger 5",value:0},{name:"trigger 6",value:0},{name:"trigger 7",value:0},{name:"trigger 8",value:0},{name:"trigger 9",value:0},{name:"trigger 10",value:0},{name:"trigger 11",value:0},{name:"trigger 12",value:0},{name:"trigger 13",value:0},{name:"trigger 14",value:0},{name:"trigger 15",value:0}]},{objName:"Ops.Ui.PatchOutput",id:"287",uiAttribs:{subPatch:"388c108a-ff19-488c-a933-d8ec50d891e0"},portsIn:[{name:"create port",value:0}],portsOut:[]},{objName:"Ops.Ui.PatchInput",id:"288",uiAttribs:{subPatch:"388c108a-ff19-488c-a933-d8ec50d891e0"},portsIn:[],portsOut:[{name:"create port",value:0}]},{objName:"Ops.Gl.RenderGeometry",id:"289",uiAttribs:{subPatch:"fb620462-5feb-441b-9f67-c3cd8482ce75"},portsIn:[{name:"render"},{name:"Geometry"},{name:"Update All",value:true},{name:"Update Face Indices",value:false},{name:"Update Vertices",value:false},{name:"Update Texcoords",value:false},{name:"Vertex Numbers",value:false}],portsOut:[{name:"trigger",links:[{portIn:"out0 Ops.Gl.GLTF.GltfNode_v2 Render",portOut:"trigger",objIn:"295",objOut:"289"}]}]},{objName:"Ops.Trigger.RouteTrigger",id:"290",uiAttribs:{subPatch:"fb620462-5feb-441b-9f67-c3cd8482ce75"},portsIn:[{name:"Execute"},{name:"Switch Value"}],portsOut:[{name:"Next Trigger",value:0},{name:"Switched Value",value:1},{name:"Trigger 0",links:[{portIn:"Trigger In",portOut:"Trigger 0",objIn:"292",objOut:"290"}]},{name:"Trigger 1",links:[{portIn:"render",portOut:"Trigger 1",objIn:"291",objOut:"290"}]},{name:"Trigger 2",value:0},{name:"Trigger 3",value:0},{name:"Trigger 4",value:0},{name:"Trigger 5",value:0},{name:"Trigger 6",value:0},{name:"Trigger 7",value:0},{name:"Trigger 8",value:0},{name:"Trigger 9",value:0},{name:"Trigger 10",value:0},{name:"Trigger 11",value:0},{name:"Trigger 12",value:0},{name:"Trigger 13",value:0},{name:"Trigger 14",value:0},{name:"Trigger 15",value:0},{name:"Trigger 16",value:0},{name:"Trigger 17",value:0},{name:"Trigger 18",value:0},{name:"Trigger 19",value:0},{name:"Trigger 20",value:0},{name:"Trigger 21",value:0},{name:"Trigger 22",value:0},{name:"Trigger 23",value:0},{name:"Default Trigger",value:0}]},{objName:"Ops.Gl.Shader.PointMaterial_v4",id:"291",uiAttribs:{subPatch:"fb620462-5feb-441b-9f67-c3cd8482ce75"},portsIn:[{name:"render"},{name:"PointSize",value:1.47},{name:"Size in Pixels",value:false},{name:"Random Size",value:0},{name:"Round",value:true},{name:"Round Antialias",value:false},{name:"Scale by Distance",value:false},{name:"r",value:1},{name:"g",value:1},{name:"b",value:1},{name:"a",value:1},{name:"Vertex Colors",value:true},{name:"texture",value:0},{name:"Colorize Texture",value:false},{name:"Texture Mask",value:0},{name:"Mask Channel index",value:0},{name:"Mask Channel",value:"R"},{name:"Texture Colorize",value:0},{name:"Colorize Randomize",value:true},{name:"Texture Opacity",value:0},{name:"Texture Point Size",value:0},{name:"Point Size Channel index",value:0},{name:"Point Size Channel",value:"R"},{name:"Texture Point Size Mul",value:1},{name:"Map Size 0 index",value:0},{name:"Map Size 0",value:"Black"},{name:"Flip Texture",value:false}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"289",objOut:"291"}]},{name:"shader"}]},{objName:"Ops.Gl.Phong.PhongMaterial_v6",id:"292",uiAttribs:{subPatch:"fb620462-5feb-441b-9f67-c3cd8482ce75"},portsIn:[{name:"Trigger In"},{name:"R",value:.8506666644414266},{name:"G",value:.5094861914999278},{name:"B",value:.5094861914999278},{name:"A",value:1},{name:"Enable",value:false},{name:"Albedo",value:.707},{name:"Roughness",value:.835},{name:"Active",value:false},{name:"Fresnel Intensity",value:.7},{name:"Fresnel Width",value:1},{name:"Fresnel Exponent",value:6},{name:"Fresnel R",value:1},{name:"Fresnel G",value:1},{name:"Fresnel B",value:1},{name:"Emissive Active",value:false},{name:"Color Intensity",value:.3},{name:"Emissive R",value:.7528171913638779},{name:"Emissive G",value:.36422624829379013},{name:"Emissive B",value:.3103095732889889},{name:"Shininess",value:4},{name:"Specular Amount",value:.5},{name:"Specular Model index",value:0},{name:"Specular Model",value:"Blinn"},{name:"Energy Conservation",value:false},{name:"Double Sided Material",value:false},{name:"Falloff Mode index",value:0},{name:"Falloff Mode",value:"A"},{name:"Diffuse Texture",value:0},{name:"Specular Texture",value:0},{name:"Normal Map",value:0},{name:"AO Texture",value:0},{name:"Emissive Texture",value:0},{name:"Emissive Mask",value:0},{name:"Opacity Texture",value:0},{name:"Environment Map",value:0},{name:"Env Map Mask",value:0},{name:"Colorize Texture",value:true},{name:"Diffuse Repeat X",value:1},{name:"Diffuse Repeat Y",value:1},{name:"Texture Offset X",value:0},{name:"Texture Offset Y",value:0},{name:"Specular Intensity",value:1},{name:"Normal Map Intensity",value:.5},{name:"AO Intensity",value:1},{name:"Emissive Intensity",value:1},{name:"Emissive Mask Intensity",value:1},{name:"Env Map Intensity",value:1},{name:"Env Map Blend index",value:0},{name:"Env Map Blend",value:"Add"},{name:"Env Mask Intensity",value:1},{name:"Alpha Mask Source index",value:0},{name:"Alpha Mask Source",value:"Luminance"},{name:"Discard Transparent Pixels",value:false}],portsOut:[{name:"Trigger Out",links:[{portIn:"exe",portOut:"Trigger Out",objIn:"300",objOut:"292"}]},{name:"Shader"}]},{objName:"Ops.Gl.ShaderEffects.UseVertexColor",id:"293",uiAttribs:{subPatch:"fb620462-5feb-441b-9f67-c3cd8482ce75"},portsIn:[{name:"Render"}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"289",objOut:"293"}]}]},{objName:"Ops.Ui.PatchInput",id:"294",uiAttribs:{subPatch:"fb620462-5feb-441b-9f67-c3cd8482ce75"},portsIn:[],portsOut:[{name:"create port",value:0},{name:"in0 Ops.Gl.Matrix.Transform trigger",links:[{portIn:"Execute",portOut:"in0 Ops.Gl.Matrix.Transform trigger",objIn:"290",objOut:"294"},{portIn:"Exec",portOut:"in0 Ops.Gl.Matrix.Transform trigger",objIn:"301",objOut:"294"}]},{name:"in1 Ops.String.SwitchString Result",links:[{portIn:"PLY File",portOut:"in1 Ops.String.SwitchString Result",objIn:"298",objOut:"294"}]}]},{objName:"Ops.Ui.PatchOutput",id:"295",uiAttribs:{subPatch:"fb620462-5feb-441b-9f67-c3cd8482ce75"},portsIn:[{name:"create port",value:0},{name:"out0 Ops.Gl.GLTF.GltfNode_v2 Render"}],portsOut:[]},{objName:"Ops.Ui.SubPatch",id:"296",uiAttribs:{subPatch:0},portsIn:[{name:"create port",value:null},{name:"dataStr",value:'{"ports":[{"name":"in0 Ops.Gl.Matrix.Transform trigger","type":1,"title":"Render"},{"name":"in1 Ops.String.SwitchString Result","type":5,"title":"URL"}],"portsOut":[{"name":"out0 Ops.Gl.GLTF.GltfNode_v2 Render","type":1}]}'},{name:"patchId",value:"fb620462-5feb-441b-9f67-c3cd8482ce75"},{name:"in0 Ops.Gl.Matrix.Transform trigger"},{name:"in1 Ops.String.SwitchString Result"}],portsOut:[{name:"create port out",value:0},{name:"out0 Ops.Gl.GLTF.GltfNode_v2 Render"}]},{objName:"Ops.Gl.Geometry.GeometryInfo",id:"297",uiAttribs:{subPatch:"fb620462-5feb-441b-9f67-c3cd8482ce75"},portsIn:[{name:"Geometry"}],portsOut:[{name:"Indexed",value:null},{name:"Faces",value:null},{name:"Vertices",value:null},{name:"Normals",value:null},{name:"TexCoords",value:null},{name:"Tangents",value:null},{name:"BiTangents",value:null},{name:"VertexColors",links:[{portIn:"number1",portOut:"VertexColors",objIn:"299",objOut:"297"}]},{name:"Other Attributes",value:null}]},{objName:"Ops.User.kikohs.PLYLoader",id:"298",uiAttribs:{subPatch:"fb620462-5feb-441b-9f67-c3cd8482ce75"},portsIn:[{name:"PLY File",display:"file"},{name:"Auto-load",value:false},{name:"Custom Property map",value:0},{name:"Reload"}],portsOut:[{name:"Loaded",value:0},{name:"Geometry",links:[{portIn:"Geometry",portOut:"Geometry",objIn:"289",objOut:"298"},{portIn:"Geometry",portOut:"Geometry",objIn:"297",objOut:"298"}]},{name:"Loading",value:false},{name:"Is Point Cloud?",links:[{portIn:"Switch Value",portOut:"Is Point Cloud?",objIn:"290",objOut:"298"}]},{name:"Error",value:null}]},{objName:"Ops.Math.Compare.GreaterThan",id:"299",uiAttribs:{subPatch:"fb620462-5feb-441b-9f67-c3cd8482ce75"},portsIn:[{name:"number1"},{name:"number2",value:0}],portsOut:[{name:"result",links:[{portIn:"boolean",portOut:"result",objIn:"300",objOut:"299"}]}]},{objName:"Ops.Boolean.IfTrueThen_v2",id:"300",uiAttribs:{subPatch:"fb620462-5feb-441b-9f67-c3cd8482ce75"},portsIn:[{name:"exe"},{name:"boolean"}],portsOut:[{name:"then",links:[{portIn:"Render",portOut:"then",objIn:"293",objOut:"300"}]},{name:"else",links:[{portIn:"render",portOut:"else",objIn:"289",objOut:"300"}]}]},{objName:"Ops.Trigger.TriggerOnce",id:"301",uiAttribs:{subPatch:"fb620462-5feb-441b-9f67-c3cd8482ce75"},portsIn:[{name:"Exec"},{name:"Reset",value:0}],portsOut:[{name:"Next",links:[{portIn:"Reload",portOut:"Next",objIn:"298",objOut:"301"}]},{name:"Was Triggered",value:true}]},{objName:"Ops.Cables.AssetPathURL",id:"302",uiAttribs:{subPatch:0},portsIn:[{name:"Filename",value:"part_4_obj_3.ply"}],portsOut:[{name:"Path",links:[{portIn:"in1 Ops.String.SwitchString Result",portOut:"Path",objIn:"296",objOut:"302"}]}]},{objName:"Ops.Gl.Matrix.Transform",id:"303",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"posX",value:0},{name:"posY",value:0},{name:"posZ",value:.25},{name:"scale",value:.44},{name:"rotX",value:0},{name:"rotY",value:0},{name:"rotZ",value:0}],portsOut:[{name:"trigger",links:[{portIn:"in0 Ops.Gl.Matrix.Transform trigger",portOut:"trigger",objIn:"296",objOut:"303"}]}]},{objName:"Ops.Ui.PatchOutput",id:"304",uiAttribs:{subPatch:"53040633-a125-4fd1-a1b7-95c4a7c634b9"},portsIn:[{name:"create port",value:0}],portsOut:[]},{objName:"Ops.Ui.PatchInput",id:"305",uiAttribs:{subPatch:"53040633-a125-4fd1-a1b7-95c4a7c634b9"},portsIn:[],portsOut:[{name:"create port",value:0}]},{objName:"Ops.Gl.RenderGeometry",id:"306",uiAttribs:{subPatch:"5838b769-8991-4f44-a962-dd31d555e7be"},portsIn:[{name:"render"},{name:"Geometry"},{name:"Update All",value:true},{name:"Update Face Indices",value:false},{name:"Update Vertices",value:false},{name:"Update Texcoords",value:false},{name:"Vertex Numbers",value:false}],portsOut:[{name:"trigger",links:[{portIn:"out0 Ops.Gl.GLTF.GltfNode_v2 Render",portOut:"trigger",objIn:"312",objOut:"306"}]}]},{objName:"Ops.Trigger.RouteTrigger",id:"307",uiAttribs:{subPatch:"5838b769-8991-4f44-a962-dd31d555e7be"},portsIn:[{name:"Execute"},{name:"Switch Value"}],portsOut:[{name:"Next Trigger",value:0},{name:"Switched Value",value:0},{name:"Trigger 0",links:[{portIn:"Trigger In",portOut:"Trigger 0",objIn:"309",objOut:"307"}]},{name:"Trigger 1",links:[{portIn:"render",portOut:"Trigger 1",objIn:"308",objOut:"307"}]},{name:"Trigger 2",value:0},{name:"Trigger 3",value:0},{name:"Trigger 4",value:0},{name:"Trigger 5",value:0},{name:"Trigger 6",value:0},{name:"Trigger 7",value:0},{name:"Trigger 8",value:0},{name:"Trigger 9",value:0},{name:"Trigger 10",value:0},{name:"Trigger 11",value:0},{name:"Trigger 12",value:0},{name:"Trigger 13",value:0},{name:"Trigger 14",value:0},{name:"Trigger 15",value:0},{name:"Trigger 16",value:0},{name:"Trigger 17",value:0},{name:"Trigger 18",value:0},{name:"Trigger 19",value:0},{name:"Trigger 20",value:0},{name:"Trigger 21",value:0},{name:"Trigger 22",value:0},{name:"Trigger 23",value:0},{name:"Default Trigger",value:0}]},{objName:"Ops.Gl.Shader.PointMaterial_v4",id:"308",uiAttribs:{subPatch:"5838b769-8991-4f44-a962-dd31d555e7be"},portsIn:[{name:"render"},{name:"PointSize",value:1.47},{name:"Size in Pixels",value:false},{name:"Random Size",value:0},{name:"Round",value:true},{name:"Round Antialias",value:false},{name:"Scale by Distance",value:false},{name:"r",value:1},{name:"g",value:1},{name:"b",value:1},{name:"a",value:1},{name:"Vertex Colors",value:true},{name:"texture",value:0},{name:"Colorize Texture",value:false},{name:"Texture Mask",value:0},{name:"Mask Channel index",value:0},{name:"Mask Channel",value:"R"},{name:"Texture Colorize",value:0},{name:"Colorize Randomize",value:true},{name:"Texture Opacity",value:0},{name:"Texture Point Size",value:0},{name:"Point Size Channel index",value:0},{name:"Point Size Channel",value:"R"},{name:"Texture Point Size Mul",value:1},{name:"Map Size 0 index",value:0},{name:"Map Size 0",value:"Black"},{name:"Flip Texture",value:false}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"306",objOut:"308"}]},{name:"shader"}]},{objName:"Ops.Gl.Phong.PhongMaterial_v6",id:"309",uiAttribs:{subPatch:"5838b769-8991-4f44-a962-dd31d555e7be"},portsIn:[{name:"Trigger In"},{name:"R",value:.3098958333333333},{name:"G",value:.6590208333333337},{name:"B",value:.9333333333333333},{name:"A",value:1},{name:"Enable",value:false},{name:"Albedo",value:.707},{name:"Roughness",value:.835},{name:"Active",value:false},{name:"Fresnel Intensity",value:.7},{name:"Fresnel Width",value:1},{name:"Fresnel Exponent",value:6},{name:"Fresnel R",value:1},{name:"Fresnel G",value:1},{name:"Fresnel B",value:1},{name:"Emissive Active",value:false},{name:"Color Intensity",value:.3},{name:"Emissive R",value:.7528171913638779},{name:"Emissive G",value:.36422624829379013},{name:"Emissive B",value:.3103095732889889},{name:"Shininess",value:4},{name:"Specular Amount",value:.5},{name:"Specular Model index",value:0},{name:"Specular Model",value:"Blinn"},{name:"Energy Conservation",value:false},{name:"Double Sided Material",value:false},{name:"Falloff Mode index",value:0},{name:"Falloff Mode",value:"A"},{name:"Diffuse Texture",value:0},{name:"Specular Texture",value:0},{name:"Normal Map",value:0},{name:"AO Texture",value:0},{name:"Emissive Texture",value:0},{name:"Emissive Mask",value:0},{name:"Opacity Texture",value:0},{name:"Environment Map",value:0},{name:"Env Map Mask",value:0},{name:"Colorize Texture",value:true},{name:"Diffuse Repeat X",value:1},{name:"Diffuse Repeat Y",value:1},{name:"Texture Offset X",value:0},{name:"Texture Offset Y",value:0},{name:"Specular Intensity",value:1},{name:"Normal Map Intensity",value:.5},{name:"AO Intensity",value:1},{name:"Emissive Intensity",value:1},{name:"Emissive Mask Intensity",value:1},{name:"Env Map Intensity",value:1},{name:"Env Map Blend index",value:0},{name:"Env Map Blend",value:"Add"},{name:"Env Mask Intensity",value:1},{name:"Alpha Mask Source index",value:0},{name:"Alpha Mask Source",value:"Luminance"},{name:"Discard Transparent Pixels",value:false}],portsOut:[{name:"Trigger Out",links:[{portIn:"render",portOut:"Trigger Out",objIn:"306",objOut:"309"}]},{name:"Shader"}]},{objName:"Ops.Gl.ShaderEffects.UseVertexColor",id:"310",uiAttribs:{subPatch:"5838b769-8991-4f44-a962-dd31d555e7be"},portsIn:[{name:"Render"}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"306",objOut:"310"}]}]},{objName:"Ops.Ui.PatchInput",id:"311",uiAttribs:{subPatch:"5838b769-8991-4f44-a962-dd31d555e7be"},portsIn:[],portsOut:[{name:"create port",value:0},{name:"in0 Ops.Gl.Matrix.Transform trigger",links:[{portIn:"Execute",portOut:"in0 Ops.Gl.Matrix.Transform trigger",objIn:"307",objOut:"311"},{portIn:"Exec",portOut:"in0 Ops.Gl.Matrix.Transform trigger",objIn:"318",objOut:"311"}]},{name:"in1 Ops.String.SwitchString Result",links:[{portIn:"PLY File",portOut:"in1 Ops.String.SwitchString Result",objIn:"315",objOut:"311"}]}]},{objName:"Ops.Ui.PatchOutput",id:"312",uiAttribs:{subPatch:"5838b769-8991-4f44-a962-dd31d555e7be"},portsIn:[{name:"create port",value:0},{name:"out0 Ops.Gl.GLTF.GltfNode_v2 Render"}],portsOut:[]},{objName:"Ops.Ui.SubPatch",id:"313",uiAttribs:{subPatch:0},portsIn:[{name:"create port",value:null},{name:"dataStr",value:'{"ports":[{"name":"in0 Ops.Gl.Matrix.Transform trigger","type":1,"title":"Render"},{"name":"in1 Ops.String.SwitchString Result","type":5,"title":"URL"}],"portsOut":[{"name":"out0 Ops.Gl.GLTF.GltfNode_v2 Render","type":1}]}'},{name:"patchId",value:"5838b769-8991-4f44-a962-dd31d555e7be"},{name:"in0 Ops.Gl.Matrix.Transform trigger"},{name:"in1 Ops.String.SwitchString Result"}],portsOut:[{name:"create port out",value:0},{name:"out0 Ops.Gl.GLTF.GltfNode_v2 Render"}]},{objName:"Ops.Gl.Geometry.GeometryInfo",id:"314",uiAttribs:{subPatch:"5838b769-8991-4f44-a962-dd31d555e7be"},portsIn:[{name:"Geometry"}],portsOut:[{name:"Indexed",value:null},{name:"Faces",value:null},{name:"Vertices",value:null},{name:"Normals",value:null},{name:"TexCoords",value:null},{name:"Tangents",value:null},{name:"BiTangents",value:null},{name:"VertexColors",links:[{portIn:"number1",portOut:"VertexColors",objIn:"316",objOut:"314"}]},{name:"Other Attributes",value:null}]},{objName:"Ops.User.kikohs.PLYLoader",id:"315",uiAttribs:{subPatch:"5838b769-8991-4f44-a962-dd31d555e7be"},portsIn:[{name:"PLY File",display:"file"},{name:"Auto-load",value:false},{name:"Custom Property map",value:0},{name:"Reload"}],portsOut:[{name:"Loaded",value:0},{name:"Geometry",links:[{portIn:"Geometry",portOut:"Geometry",objIn:"306",objOut:"315"},{portIn:"Geometry",portOut:"Geometry",objIn:"314",objOut:"315"}]},{name:"Loading",value:false},{name:"Is Point Cloud?",links:[{portIn:"Switch Value",portOut:"Is Point Cloud?",objIn:"307",objOut:"315"}]},{name:"Error",value:null}]},{objName:"Ops.Math.Compare.GreaterThan",id:"316",uiAttribs:{subPatch:"5838b769-8991-4f44-a962-dd31d555e7be"},portsIn:[{name:"number1"},{name:"number2",value:0}],portsOut:[{name:"result",links:[{portIn:"boolean",portOut:"result",objIn:"317",objOut:"316"}]}]},{objName:"Ops.Boolean.IfTrueThen_v2",id:"317",uiAttribs:{subPatch:"5838b769-8991-4f44-a962-dd31d555e7be"},portsIn:[{name:"exe",value:null},{name:"boolean"}],portsOut:[{name:"then",links:[{portIn:"Render",portOut:"then",objIn:"310",objOut:"317"}]},{name:"else",links:[{portIn:"render",portOut:"else",objIn:"306",objOut:"317"}]}]},{objName:"Ops.Trigger.TriggerOnce",id:"318",uiAttribs:{subPatch:"5838b769-8991-4f44-a962-dd31d555e7be"},portsIn:[{name:"Exec"},{name:"Reset",value:0}],portsOut:[{name:"Next",links:[{portIn:"Reload",portOut:"Next",objIn:"315",objOut:"318"}]},{name:"Was Triggered",value:true}]},{objName:"Ops.Gl.RenderGeometry",id:"319",uiAttribs:{subPatch:"9608f5a8-1166-4d26-abc2-d41b212b4519"},portsIn:[{name:"render"},{name:"Geometry"},{name:"Update All",value:true},{name:"Update Face Indices",value:false},{name:"Update Vertices",value:false},{name:"Update Texcoords",value:false},{name:"Vertex Numbers",value:false}],portsOut:[{name:"trigger",links:[{portIn:"out0 Ops.Gl.GLTF.GltfNode_v2 Render",portOut:"trigger",objIn:"325",objOut:"319"}]}]},{objName:"Ops.Trigger.RouteTrigger",id:"320",uiAttribs:{subPatch:"9608f5a8-1166-4d26-abc2-d41b212b4519"},portsIn:[{name:"Execute"},{name:"Switch Value"}],portsOut:[{name:"Next Trigger",value:0},{name:"Switched Value",value:0},{name:"Trigger 0",links:[{portIn:"Trigger In",portOut:"Trigger 0",objIn:"322",objOut:"320"}]},{name:"Trigger 1",links:[{portIn:"render",portOut:"Trigger 1",objIn:"321",objOut:"320"}]},{name:"Trigger 2",value:0},{name:"Trigger 3",value:0},{name:"Trigger 4",value:0},{name:"Trigger 5",value:0},{name:"Trigger 6",value:0},{name:"Trigger 7",value:0},{name:"Trigger 8",value:0},{name:"Trigger 9",value:0},{name:"Trigger 10",value:0},{name:"Trigger 11",value:0},{name:"Trigger 12",value:0},{name:"Trigger 13",value:0},{name:"Trigger 14",value:0},{name:"Trigger 15",value:0},{name:"Trigger 16",value:0},{name:"Trigger 17",value:0},{name:"Trigger 18",value:0},{name:"Trigger 19",value:0},{name:"Trigger 20",value:0},{name:"Trigger 21",value:0},{name:"Trigger 22",value:0},{name:"Trigger 23",value:0},{name:"Default Trigger",value:0}]},{objName:"Ops.Gl.Shader.PointMaterial_v4",id:"321",uiAttribs:{subPatch:"9608f5a8-1166-4d26-abc2-d41b212b4519"},portsIn:[{name:"render"},{name:"PointSize",value:1.47},{name:"Size in Pixels",value:false},{name:"Random Size",value:0},{name:"Round",value:true},{name:"Round Antialias",value:false},{name:"Scale by Distance",value:false},{name:"r",value:1},{name:"g",value:1},{name:"b",value:1},{name:"a",value:1},{name:"Vertex Colors",value:true},{name:"texture",value:0},{name:"Colorize Texture",value:false},{name:"Texture Mask",value:0},{name:"Mask Channel index",value:0},{name:"Mask Channel",value:"R"},{name:"Texture Colorize",value:0},{name:"Colorize Randomize",value:true},{name:"Texture Opacity",value:0},{name:"Texture Point Size",value:0},{name:"Point Size Channel index",value:0},{name:"Point Size Channel",value:"R"},{name:"Texture Point Size Mul",value:1},{name:"Map Size 0 index",value:0},{name:"Map Size 0",value:"Black"},{name:"Flip Texture",value:false}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"319",objOut:"321"}]},{name:"shader"}]},{objName:"Ops.Gl.Phong.PhongMaterial_v6",id:"322",uiAttribs:{subPatch:"9608f5a8-1166-4d26-abc2-d41b212b4519"},portsIn:[{name:"Trigger In"},{name:"R",value:.3098958333333333},{name:"G",value:.6590208333333337},{name:"B",value:.9333333333333333},{name:"A",value:1},{name:"Enable",value:false},{name:"Albedo",value:.707},{name:"Roughness",value:.835},{name:"Active",value:false},{name:"Fresnel Intensity",value:.7},{name:"Fresnel Width",value:1},{name:"Fresnel Exponent",value:6},{name:"Fresnel R",value:1},{name:"Fresnel G",value:1},{name:"Fresnel B",value:1},{name:"Emissive Active",value:false},{name:"Color Intensity",value:.3},{name:"Emissive R",value:.7528171913638779},{name:"Emissive G",value:.36422624829379013},{name:"Emissive B",value:.3103095732889889},{name:"Shininess",value:4},{name:"Specular Amount",value:.5},{name:"Specular Model index",value:0},{name:"Specular Model",value:"Blinn"},{name:"Energy Conservation",value:false},{name:"Double Sided Material",value:false},{name:"Falloff Mode index",value:0},{name:"Falloff Mode",value:"A"},{name:"Diffuse Texture",value:0},{name:"Specular Texture",value:0},{name:"Normal Map",value:0},{name:"AO Texture",value:0},{name:"Emissive Texture",value:0},{name:"Emissive Mask",value:0},{name:"Opacity Texture",value:0},{name:"Environment Map",value:0},{name:"Env Map Mask",value:0},{name:"Colorize Texture",value:true},{name:"Diffuse Repeat X",value:1},{name:"Diffuse Repeat Y",value:1},{name:"Texture Offset X",value:0},{name:"Texture Offset Y",value:0},{name:"Specular Intensity",value:1},{name:"Normal Map Intensity",value:.5},{name:"AO Intensity",value:1},{name:"Emissive Intensity",value:1},{name:"Emissive Mask Intensity",value:1},{name:"Env Map Intensity",value:1},{name:"Env Map Blend index",value:0},{name:"Env Map Blend",value:"Add"},{name:"Env Mask Intensity",value:1},{name:"Alpha Mask Source index",value:0},{name:"Alpha Mask Source",value:"Luminance"},{name:"Discard Transparent Pixels",value:false}],portsOut:[{name:"Trigger Out",links:[{portIn:"render",portOut:"Trigger Out",objIn:"319",objOut:"322"}]},{name:"Shader"}]},{objName:"Ops.Gl.ShaderEffects.UseVertexColor",id:"323",uiAttribs:{subPatch:"9608f5a8-1166-4d26-abc2-d41b212b4519"},portsIn:[{name:"Render"}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"319",objOut:"323"}]}]},{objName:"Ops.Ui.PatchInput",id:"324",uiAttribs:{subPatch:"9608f5a8-1166-4d26-abc2-d41b212b4519"},portsIn:[],portsOut:[{name:"create port",value:0},{name:"in0 Ops.Gl.Matrix.Transform trigger",links:[{portIn:"Execute",portOut:"in0 Ops.Gl.Matrix.Transform trigger",objIn:"320",objOut:"324"},{portIn:"Exec",portOut:"in0 Ops.Gl.Matrix.Transform trigger",objIn:"331",objOut:"324"}]},{name:"in1 Ops.String.SwitchString Result",links:[{portIn:"PLY File",portOut:"in1 Ops.String.SwitchString Result",objIn:"328",objOut:"324"}]}]},{objName:"Ops.Ui.PatchOutput",id:"325",uiAttribs:{subPatch:"9608f5a8-1166-4d26-abc2-d41b212b4519"},portsIn:[{name:"create port",value:0},{name:"out0 Ops.Gl.GLTF.GltfNode_v2 Render"}],portsOut:[]},{objName:"Ops.Ui.SubPatch",id:"326",uiAttribs:{subPatch:0},portsIn:[{name:"create port",value:null},{name:"dataStr",value:'{"ports":[{"name":"in0 Ops.Gl.Matrix.Transform trigger","type":1,"title":"Render"},{"name":"in1 Ops.String.SwitchString Result","type":5,"title":"URL"}],"portsOut":[{"name":"out0 Ops.Gl.GLTF.GltfNode_v2 Render","type":1}]}'},{name:"patchId",value:"9608f5a8-1166-4d26-abc2-d41b212b4519"},{name:"in0 Ops.Gl.Matrix.Transform trigger"},{name:"in1 Ops.String.SwitchString Result"}],portsOut:[{name:"create port out",value:0},{name:"out0 Ops.Gl.GLTF.GltfNode_v2 Render"}]},{objName:"Ops.Gl.Geometry.GeometryInfo",id:"327",uiAttribs:{subPatch:"9608f5a8-1166-4d26-abc2-d41b212b4519"},portsIn:[{name:"Geometry"}],portsOut:[{name:"Indexed",value:null},{name:"Faces",value:null},{name:"Vertices",value:null},{name:"Normals",value:null},{name:"TexCoords",value:null},{name:"Tangents",value:null},{name:"BiTangents",value:null},{name:"VertexColors",links:[{portIn:"number1",portOut:"VertexColors",objIn:"329",objOut:"327"}]},{name:"Other Attributes",value:null}]},{objName:"Ops.User.kikohs.PLYLoader",id:"328",uiAttribs:{subPatch:"9608f5a8-1166-4d26-abc2-d41b212b4519"},portsIn:[{name:"PLY File",display:"file"},{name:"Auto-load",value:false},{name:"Custom Property map",value:0},{name:"Reload"}],portsOut:[{name:"Loaded",value:0},{name:"Geometry",links:[{portIn:"Geometry",portOut:"Geometry",objIn:"319",objOut:"328"},{portIn:"Geometry",portOut:"Geometry",objIn:"327",objOut:"328"}]},{name:"Loading",value:false},{name:"Is Point Cloud?",links:[{portIn:"Switch Value",portOut:"Is Point Cloud?",objIn:"320",objOut:"328"}]},{name:"Error",value:null}]},{objName:"Ops.Math.Compare.GreaterThan",id:"329",uiAttribs:{subPatch:"9608f5a8-1166-4d26-abc2-d41b212b4519"},portsIn:[{name:"number1"},{name:"number2",value:0}],portsOut:[{name:"result",links:[{portIn:"boolean",portOut:"result",objIn:"330",objOut:"329"}]}]},{objName:"Ops.Boolean.IfTrueThen_v2",id:"330",uiAttribs:{subPatch:"9608f5a8-1166-4d26-abc2-d41b212b4519"},portsIn:[{name:"exe",value:null},{name:"boolean"}],portsOut:[{name:"then",links:[{portIn:"Render",portOut:"then",objIn:"323",objOut:"330"}]},{name:"else",links:[{portIn:"render",portOut:"else",objIn:"319",objOut:"330"}]}]},{objName:"Ops.Trigger.TriggerOnce",id:"331",uiAttribs:{subPatch:"9608f5a8-1166-4d26-abc2-d41b212b4519"},portsIn:[{name:"Exec"},{name:"Reset",value:0}],portsOut:[{name:"Next",links:[{portIn:"Reload",portOut:"Next",objIn:"328",objOut:"331"}]},{name:"Was Triggered",value:true}]},{objName:"Ops.Gl.RenderGeometry",id:"332",uiAttribs:{subPatch:"63c234a7-f467-4a81-8c07-9d0d4fa9b854"},portsIn:[{name:"render"},{name:"Geometry"},{name:"Update All",value:true},{name:"Update Face Indices",value:false},{name:"Update Vertices",value:false},{name:"Update Texcoords",value:false},{name:"Vertex Numbers",value:false}],portsOut:[{name:"trigger",links:[{portIn:"out0 Ops.Gl.GLTF.GltfNode_v2 Render",portOut:"trigger",objIn:"338",objOut:"332"}]}]},{objName:"Ops.Trigger.RouteTrigger",id:"333",uiAttribs:{subPatch:"63c234a7-f467-4a81-8c07-9d0d4fa9b854"},portsIn:[{name:"Execute"},{name:"Switch Value"}],portsOut:[{name:"Next Trigger",value:0},{name:"Switched Value",value:0},{name:"Trigger 0",links:[{portIn:"Trigger In",portOut:"Trigger 0",objIn:"335",objOut:"333"}]},{name:"Trigger 1",links:[{portIn:"render",portOut:"Trigger 1",objIn:"334",objOut:"333"}]},{name:"Trigger 2",value:0},{name:"Trigger 3",value:0},{name:"Trigger 4",value:0},{name:"Trigger 5",value:0},{name:"Trigger 6",value:0},{name:"Trigger 7",value:0},{name:"Trigger 8",value:0},{name:"Trigger 9",value:0},{name:"Trigger 10",value:0},{name:"Trigger 11",value:0},{name:"Trigger 12",value:0},{name:"Trigger 13",value:0},{name:"Trigger 14",value:0},{name:"Trigger 15",value:0},{name:"Trigger 16",value:0},{name:"Trigger 17",value:0},{name:"Trigger 18",value:0},{name:"Trigger 19",value:0},{name:"Trigger 20",value:0},{name:"Trigger 21",value:0},{name:"Trigger 22",value:0},{name:"Trigger 23",value:0},{name:"Default Trigger",value:0}]},{objName:"Ops.Gl.Shader.PointMaterial_v4",id:"334",uiAttribs:{subPatch:"63c234a7-f467-4a81-8c07-9d0d4fa9b854"},portsIn:[{name:"render"},{name:"PointSize",value:1.47},{name:"Size in Pixels",value:false},{name:"Random Size",value:0},{name:"Round",value:true},{name:"Round Antialias",value:false},{name:"Scale by Distance",value:false},{name:"r",value:1},{name:"g",value:1},{name:"b",value:1},{name:"a",value:1},{name:"Vertex Colors",value:true},{name:"texture",value:0},{name:"Colorize Texture",value:false},{name:"Texture Mask",value:0},{name:"Mask Channel index",value:0},{name:"Mask Channel",value:"R"},{name:"Texture Colorize",value:0},{name:"Colorize Randomize",value:true},{name:"Texture Opacity",value:0},{name:"Texture Point Size",value:0},{name:"Point Size Channel index",value:0},{name:"Point Size Channel",value:"R"},{name:"Texture Point Size Mul",value:1},{name:"Map Size 0 index",value:0},{name:"Map Size 0",value:"Black"},{name:"Flip Texture",value:false}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"332",objOut:"334"}]},{name:"shader"}]},{objName:"Ops.Gl.Phong.PhongMaterial_v6",id:"335",uiAttribs:{subPatch:"63c234a7-f467-4a81-8c07-9d0d4fa9b854"},portsIn:[{name:"Trigger In"},{name:"R",value:.3098958333333333},{name:"G",value:.6590208333333337},{name:"B",value:.9333333333333333},{name:"A",value:1},{name:"Enable",value:false},{name:"Albedo",value:.707},{name:"Roughness",value:.835},{name:"Active",value:false},{name:"Fresnel Intensity",value:.7},{name:"Fresnel Width",value:1},{name:"Fresnel Exponent",value:6},{name:"Fresnel R",value:1},{name:"Fresnel G",value:1},{name:"Fresnel B",value:1},{name:"Emissive Active",value:false},{name:"Color Intensity",value:.3},{name:"Emissive R",value:.7528171913638779},{name:"Emissive G",value:.36422624829379013},{name:"Emissive B",value:.3103095732889889},{name:"Shininess",value:4},{name:"Specular Amount",value:.5},{name:"Specular Model index",value:0},{name:"Specular Model",value:"Blinn"},{name:"Energy Conservation",value:false},{name:"Double Sided Material",value:false},{name:"Falloff Mode index",value:0},{name:"Falloff Mode",value:"A"},{name:"Diffuse Texture",value:0},{name:"Specular Texture",value:0},{name:"Normal Map",value:0},{name:"AO Texture",value:0},{name:"Emissive Texture",value:0},{name:"Emissive Mask",value:0},{name:"Opacity Texture",value:0},{name:"Environment Map",value:0},{name:"Env Map Mask",value:0},{name:"Colorize Texture",value:true},{name:"Diffuse Repeat X",value:1},{name:"Diffuse Repeat Y",value:1},{name:"Texture Offset X",value:0},{name:"Texture Offset Y",value:0},{name:"Specular Intensity",value:1},{name:"Normal Map Intensity",value:.5},{name:"AO Intensity",value:1},{name:"Emissive Intensity",value:1},{name:"Emissive Mask Intensity",value:1},{name:"Env Map Intensity",value:1},{name:"Env Map Blend index",value:0},{name:"Env Map Blend",value:"Add"},{name:"Env Mask Intensity",value:1},{name:"Alpha Mask Source index",value:0},{name:"Alpha Mask Source",value:"Luminance"},{name:"Discard Transparent Pixels",value:false}],portsOut:[{name:"Trigger Out",links:[{portIn:"render",portOut:"Trigger Out",objIn:"332",objOut:"335"}]},{name:"Shader"}]},{objName:"Ops.Gl.ShaderEffects.UseVertexColor",id:"336",uiAttribs:{subPatch:"63c234a7-f467-4a81-8c07-9d0d4fa9b854"},portsIn:[{name:"Render"}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"332",objOut:"336"}]}]},{objName:"Ops.Ui.PatchInput",id:"337",uiAttribs:{subPatch:"63c234a7-f467-4a81-8c07-9d0d4fa9b854"},portsIn:[],portsOut:[{name:"create port",value:0},{name:"in0 Ops.Gl.Matrix.Transform trigger",links:[{portIn:"Execute",portOut:"in0 Ops.Gl.Matrix.Transform trigger",objIn:"333",objOut:"337"},{portIn:"Exec",portOut:"in0 Ops.Gl.Matrix.Transform trigger",objIn:"344",objOut:"337"}]},{name:"in1 Ops.String.SwitchString Result",links:[{portIn:"PLY File",portOut:"in1 Ops.String.SwitchString Result",objIn:"341",objOut:"337"}]}]},{objName:"Ops.Ui.PatchOutput",id:"338",uiAttribs:{subPatch:"63c234a7-f467-4a81-8c07-9d0d4fa9b854"},portsIn:[{name:"create port",value:0},{name:"out0 Ops.Gl.GLTF.GltfNode_v2 Render"}],portsOut:[]},{objName:"Ops.Ui.SubPatch",id:"339",uiAttribs:{subPatch:0},portsIn:[{name:"create port",value:null},{name:"dataStr",value:'{"ports":[{"name":"in0 Ops.Gl.Matrix.Transform trigger","type":1,"title":"Render"},{"name":"in1 Ops.String.SwitchString Result","type":5,"title":"URL"}],"portsOut":[{"name":"out0 Ops.Gl.GLTF.GltfNode_v2 Render","type":1}]}'},{name:"patchId",value:"63c234a7-f467-4a81-8c07-9d0d4fa9b854"},{name:"in0 Ops.Gl.Matrix.Transform trigger"},{name:"in1 Ops.String.SwitchString Result"}],portsOut:[{name:"create port out",value:0},{name:"out0 Ops.Gl.GLTF.GltfNode_v2 Render"}]},{objName:"Ops.Gl.Geometry.GeometryInfo",id:"340",uiAttribs:{subPatch:"63c234a7-f467-4a81-8c07-9d0d4fa9b854"},portsIn:[{name:"Geometry"}],portsOut:[{name:"Indexed",value:null},{name:"Faces",value:null},{name:"Vertices",value:null},{name:"Normals",value:null},{name:"TexCoords",value:null},{name:"Tangents",value:null},{name:"BiTangents",value:null},{name:"VertexColors",links:[{portIn:"number1",portOut:"VertexColors",objIn:"342",objOut:"340"}]},{name:"Other Attributes",value:null}]},{objName:"Ops.User.kikohs.PLYLoader",id:"341",uiAttribs:{subPatch:"63c234a7-f467-4a81-8c07-9d0d4fa9b854"},portsIn:[{name:"PLY File",display:"file"},{name:"Auto-load",value:false},{name:"Custom Property map",value:0},{name:"Reload"}],portsOut:[{name:"Loaded",value:0},{name:"Geometry",links:[{portIn:"Geometry",portOut:"Geometry",objIn:"332",objOut:"341"},{portIn:"Geometry",portOut:"Geometry",objIn:"340",objOut:"341"}]},{name:"Loading",value:false},{name:"Is Point Cloud?",links:[{portIn:"Switch Value",portOut:"Is Point Cloud?",objIn:"333",objOut:"341"}]},{name:"Error",value:null}]},{objName:"Ops.Math.Compare.GreaterThan",id:"342",uiAttribs:{subPatch:"63c234a7-f467-4a81-8c07-9d0d4fa9b854"},portsIn:[{name:"number1"},{name:"number2",value:0}],portsOut:[{name:"result",links:[{portIn:"boolean",portOut:"result",objIn:"343",objOut:"342"}]}]},{objName:"Ops.Boolean.IfTrueThen_v2",id:"343",uiAttribs:{subPatch:"63c234a7-f467-4a81-8c07-9d0d4fa9b854"},portsIn:[{name:"exe",value:null},{name:"boolean"}],portsOut:[{name:"then",links:[{portIn:"Render",portOut:"then",objIn:"336",objOut:"343"}]},{name:"else",links:[{portIn:"render",portOut:"else",objIn:"332",objOut:"343"}]}]},{objName:"Ops.Trigger.TriggerOnce",id:"344",uiAttribs:{subPatch:"63c234a7-f467-4a81-8c07-9d0d4fa9b854"},portsIn:[{name:"Exec"},{name:"Reset",value:0}],portsOut:[{name:"Next",links:[{portIn:"Reload",portOut:"Next",objIn:"341",objOut:"344"}]},{name:"Was Triggered",value:true}]},{objName:"Ops.Gl.RenderGeometry",id:"345",uiAttribs:{subPatch:"c6f84304-8118-4595-ae20-3364f87ff5bd"},portsIn:[{name:"render"},{name:"Geometry"},{name:"Update All",value:true},{name:"Update Face Indices",value:false},{name:"Update Vertices",value:false},{name:"Update Texcoords",value:false},{name:"Vertex Numbers",value:false}],portsOut:[{name:"trigger",links:[{portIn:"out0 Ops.Gl.GLTF.GltfNode_v2 Render",portOut:"trigger",objIn:"351",objOut:"345"}]}]},{objName:"Ops.Trigger.RouteTrigger",id:"346",uiAttribs:{subPatch:"c6f84304-8118-4595-ae20-3364f87ff5bd"},portsIn:[{name:"Execute"},{name:"Switch Value"}],portsOut:[{name:"Next Trigger",value:0},{name:"Switched Value",value:0},{name:"Trigger 0",links:[{portIn:"Trigger In",portOut:"Trigger 0",objIn:"348",objOut:"346"}]},{name:"Trigger 1",links:[{portIn:"render",portOut:"Trigger 1",objIn:"347",objOut:"346"}]},{name:"Trigger 2",value:0},{name:"Trigger 3",value:0},{name:"Trigger 4",value:0},{name:"Trigger 5",value:0},{name:"Trigger 6",value:0},{name:"Trigger 7",value:0},{name:"Trigger 8",value:0},{name:"Trigger 9",value:0},{name:"Trigger 10",value:0},{name:"Trigger 11",value:0},{name:"Trigger 12",value:0},{name:"Trigger 13",value:0},{name:"Trigger 14",value:0},{name:"Trigger 15",value:0},{name:"Trigger 16",value:0},{name:"Trigger 17",value:0},{name:"Trigger 18",value:0},{name:"Trigger 19",value:0},{name:"Trigger 20",value:0},{name:"Trigger 21",value:0},{name:"Trigger 22",value:0},{name:"Trigger 23",value:0},{name:"Default Trigger",value:0}]},{objName:"Ops.Gl.Shader.PointMaterial_v4",id:"347",uiAttribs:{subPatch:"c6f84304-8118-4595-ae20-3364f87ff5bd"},portsIn:[{name:"render"},{name:"PointSize",value:1.47},{name:"Size in Pixels",value:false},{name:"Random Size",value:0},{name:"Round",value:true},{name:"Round Antialias",value:false},{name:"Scale by Distance",value:false},{name:"r",value:1},{name:"g",value:1},{name:"b",value:1},{name:"a",value:1},{name:"Vertex Colors",value:true},{name:"texture",value:0},{name:"Colorize Texture",value:false},{name:"Texture Mask",value:0},{name:"Mask Channel index",value:0},{name:"Mask Channel",value:"R"},{name:"Texture Colorize",value:0},{name:"Colorize Randomize",value:true},{name:"Texture Opacity",value:0},{name:"Texture Point Size",value:0},{name:"Point Size Channel index",value:0},{name:"Point Size Channel",value:"R"},{name:"Texture Point Size Mul",value:1},{name:"Map Size 0 index",value:0},{name:"Map Size 0",value:"Black"},{name:"Flip Texture",value:false}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"345",objOut:"347"}]},{name:"shader"}]},{objName:"Ops.Gl.Phong.PhongMaterial_v6",id:"348",uiAttribs:{subPatch:"c6f84304-8118-4595-ae20-3364f87ff5bd"},portsIn:[{name:"Trigger In"},{name:"R",value:.3098958333333333},{name:"G",value:.6590208333333337},{name:"B",value:.9333333333333333},{name:"A",value:1},{name:"Enable",value:false},{name:"Albedo",value:.707},{name:"Roughness",value:.835},{name:"Active",value:false},{name:"Fresnel Intensity",value:.7},{name:"Fresnel Width",value:1},{name:"Fresnel Exponent",value:6},{name:"Fresnel R",value:1},{name:"Fresnel G",value:1},{name:"Fresnel B",value:1},{name:"Emissive Active",value:false},{name:"Color Intensity",value:.3},{name:"Emissive R",value:.7528171913638779},{name:"Emissive G",value:.36422624829379013},{name:"Emissive B",value:.3103095732889889},{name:"Shininess",value:4},{name:"Specular Amount",value:.5},{name:"Specular Model index",value:0},{name:"Specular Model",value:"Blinn"},{name:"Energy Conservation",value:false},{name:"Double Sided Material",value:false},{name:"Falloff Mode index",value:0},{name:"Falloff Mode",value:"A"},{name:"Diffuse Texture",value:0},{name:"Specular Texture",value:0},{name:"Normal Map",value:0},{name:"AO Texture",value:0},{name:"Emissive Texture",value:0},{name:"Emissive Mask",value:0},{name:"Opacity Texture",value:0},{name:"Environment Map",value:0},{name:"Env Map Mask",value:0},{name:"Colorize Texture",value:true},{name:"Diffuse Repeat X",value:1},{name:"Diffuse Repeat Y",value:1},{name:"Texture Offset X",value:0},{name:"Texture Offset Y",value:0},{name:"Specular Intensity",value:1},{name:"Normal Map Intensity",value:.5},{name:"AO Intensity",value:1},{name:"Emissive Intensity",value:1},{name:"Emissive Mask Intensity",value:1},{name:"Env Map Intensity",value:1},{name:"Env Map Blend index",value:0},{name:"Env Map Blend",value:"Add"},{name:"Env Mask Intensity",value:1},{name:"Alpha Mask Source index",value:0},{name:"Alpha Mask Source",value:"Luminance"},{name:"Discard Transparent Pixels",value:false}],portsOut:[{name:"Trigger Out",links:[{portIn:"render",portOut:"Trigger Out",objIn:"345",objOut:"348"}]},{name:"Shader"}]},{objName:"Ops.Gl.ShaderEffects.UseVertexColor",id:"349",uiAttribs:{subPatch:"c6f84304-8118-4595-ae20-3364f87ff5bd"},portsIn:[{name:"Render"}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"345",objOut:"349"}]}]},{objName:"Ops.Ui.PatchInput",id:"350",uiAttribs:{subPatch:"c6f84304-8118-4595-ae20-3364f87ff5bd"},portsIn:[],portsOut:[{name:"create port",value:0},{name:"in0 Ops.Gl.Matrix.Transform trigger",links:[{portIn:"Execute",portOut:"in0 Ops.Gl.Matrix.Transform trigger",objIn:"346",objOut:"350"},{portIn:"Exec",portOut:"in0 Ops.Gl.Matrix.Transform trigger",objIn:"357",objOut:"350"}]},{name:"in1 Ops.String.SwitchString Result",links:[{portIn:"PLY File",portOut:"in1 Ops.String.SwitchString Result",objIn:"354",objOut:"350"}]}]},{objName:"Ops.Ui.PatchOutput",id:"351",uiAttribs:{subPatch:"c6f84304-8118-4595-ae20-3364f87ff5bd"},portsIn:[{name:"create port",value:0},{name:"out0 Ops.Gl.GLTF.GltfNode_v2 Render"}],portsOut:[]},{objName:"Ops.Ui.SubPatch",id:"352",uiAttribs:{subPatch:0},portsIn:[{name:"create port",value:null},{name:"dataStr",value:'{"ports":[{"name":"in0 Ops.Gl.Matrix.Transform trigger","type":1,"title":"Render"},{"name":"in1 Ops.String.SwitchString Result","type":5,"title":"URL"}],"portsOut":[{"name":"out0 Ops.Gl.GLTF.GltfNode_v2 Render","type":1}]}'},{name:"patchId",value:"c6f84304-8118-4595-ae20-3364f87ff5bd"},{name:"in0 Ops.Gl.Matrix.Transform trigger"},{name:"in1 Ops.String.SwitchString Result"}],portsOut:[{name:"create port out",value:0},{name:"out0 Ops.Gl.GLTF.GltfNode_v2 Render"}]},{objName:"Ops.Gl.Geometry.GeometryInfo",id:"353",uiAttribs:{subPatch:"c6f84304-8118-4595-ae20-3364f87ff5bd"},portsIn:[{name:"Geometry"}],portsOut:[{name:"Indexed",value:null},{name:"Faces",value:null},{name:"Vertices",value:null},{name:"Normals",value:null},{name:"TexCoords",value:null},{name:"Tangents",value:null},{name:"BiTangents",value:null},{name:"VertexColors",links:[{portIn:"number1",portOut:"VertexColors",objIn:"355",objOut:"353"}]},{name:"Other Attributes",value:null}]},{objName:"Ops.User.kikohs.PLYLoader",id:"354",uiAttribs:{subPatch:"c6f84304-8118-4595-ae20-3364f87ff5bd"},portsIn:[{name:"PLY File",display:"file"},{name:"Auto-load",value:false},{name:"Custom Property map",value:0},{name:"Reload"}],portsOut:[{name:"Loaded",value:0},{name:"Geometry",links:[{portIn:"Geometry",portOut:"Geometry",objIn:"345",objOut:"354"},{portIn:"Geometry",portOut:"Geometry",objIn:"353",objOut:"354"}]},{name:"Loading",value:false},{name:"Is Point Cloud?",links:[{portIn:"Switch Value",portOut:"Is Point Cloud?",objIn:"346",objOut:"354"}]},{name:"Error",value:null}]},{objName:"Ops.Math.Compare.GreaterThan",id:"355",uiAttribs:{subPatch:"c6f84304-8118-4595-ae20-3364f87ff5bd"},portsIn:[{name:"number1"},{name:"number2",value:0}],portsOut:[{name:"result",links:[{portIn:"boolean",portOut:"result",objIn:"356",objOut:"355"}]}]},{objName:"Ops.Boolean.IfTrueThen_v2",id:"356",uiAttribs:{subPatch:"c6f84304-8118-4595-ae20-3364f87ff5bd"},portsIn:[{name:"exe",value:null},{name:"boolean"}],portsOut:[{name:"then",links:[{portIn:"Render",portOut:"then",objIn:"349",objOut:"356"}]},{name:"else",links:[{portIn:"render",portOut:"else",objIn:"345",objOut:"356"}]}]},{objName:"Ops.Trigger.TriggerOnce",id:"357",uiAttribs:{subPatch:"c6f84304-8118-4595-ae20-3364f87ff5bd"},portsIn:[{name:"Exec"},{name:"Reset",value:0}],portsOut:[{name:"Next",links:[{portIn:"Reload",portOut:"Next",objIn:"354",objOut:"357"}]},{name:"Was Triggered",value:true}]},{objName:"Ops.Gl.RenderGeometry",id:"358",uiAttribs:{subPatch:"f6aa2f67-88fb-405a-8459-57efde4666d4"},portsIn:[{name:"render"},{name:"Geometry"},{name:"Update All",value:true},{name:"Update Face Indices",value:false},{name:"Update Vertices",value:false},{name:"Update Texcoords",value:false},{name:"Vertex Numbers",value:false}],portsOut:[{name:"trigger",links:[{portIn:"out0 Ops.Gl.GLTF.GltfNode_v2 Render",portOut:"trigger",objIn:"364",objOut:"358"}]}]},{objName:"Ops.Trigger.RouteTrigger",id:"359",uiAttribs:{subPatch:"f6aa2f67-88fb-405a-8459-57efde4666d4"},portsIn:[{name:"Execute"},{name:"Switch Value"}],portsOut:[{name:"Next Trigger",value:0},{name:"Switched Value",value:0},{name:"Trigger 0",links:[{portIn:"Trigger In",portOut:"Trigger 0",objIn:"361",objOut:"359"}]},{name:"Trigger 1",links:[{portIn:"render",portOut:"Trigger 1",objIn:"360",objOut:"359"}]},{name:"Trigger 2",value:0},{name:"Trigger 3",value:0},{name:"Trigger 4",value:0},{name:"Trigger 5",value:0},{name:"Trigger 6",value:0},{name:"Trigger 7",value:0},{name:"Trigger 8",value:0},{name:"Trigger 9",value:0},{name:"Trigger 10",value:0},{name:"Trigger 11",value:0},{name:"Trigger 12",value:0},{name:"Trigger 13",value:0},{name:"Trigger 14",value:0},{name:"Trigger 15",value:0},{name:"Trigger 16",value:0},{name:"Trigger 17",value:0},{name:"Trigger 18",value:0},{name:"Trigger 19",value:0},{name:"Trigger 20",value:0},{name:"Trigger 21",value:0},{name:"Trigger 22",value:0},{name:"Trigger 23",value:0},{name:"Default Trigger",value:0}]},{objName:"Ops.Gl.Shader.PointMaterial_v4",id:"360",uiAttribs:{subPatch:"f6aa2f67-88fb-405a-8459-57efde4666d4"},portsIn:[{name:"render"},{name:"PointSize",value:1.47},{name:"Size in Pixels",value:false},{name:"Random Size",value:0},{name:"Round",value:true},{name:"Round Antialias",value:false},{name:"Scale by Distance",value:false},{name:"r",value:1},{name:"g",value:1},{name:"b",value:1},{name:"a",value:1},{name:"Vertex Colors",value:true},{name:"texture",value:0},{name:"Colorize Texture",value:false},{name:"Texture Mask",value:0},{name:"Mask Channel index",value:0},{name:"Mask Channel",value:"R"},{name:"Texture Colorize",value:0},{name:"Colorize Randomize",value:true},{name:"Texture Opacity",value:0},{name:"Texture Point Size",value:0},{name:"Point Size Channel index",value:0},{name:"Point Size Channel",value:"R"},{name:"Texture Point Size Mul",value:1},{name:"Map Size 0 index",value:0},{name:"Map Size 0",value:"Black"},{name:"Flip Texture",value:false}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"358",objOut:"360"}]},{name:"shader"}]},{objName:"Ops.Gl.Phong.PhongMaterial_v6",id:"361",uiAttribs:{subPatch:"f6aa2f67-88fb-405a-8459-57efde4666d4"},portsIn:[{name:"Trigger In"},{name:"R",value:.3098958333333333},{name:"G",value:.6590208333333337},{name:"B",value:.9333333333333333},{name:"A",value:1},{name:"Enable",value:false},{name:"Albedo",value:.707},{name:"Roughness",value:.835},{name:"Active",value:false},{name:"Fresnel Intensity",value:.7},{name:"Fresnel Width",value:1},{name:"Fresnel Exponent",value:6},{name:"Fresnel R",value:1},{name:"Fresnel G",value:1},{name:"Fresnel B",value:1},{name:"Emissive Active",value:false},{name:"Color Intensity",value:.3},{name:"Emissive R",value:.7528171913638779},{name:"Emissive G",value:.36422624829379013},{name:"Emissive B",value:.3103095732889889},{name:"Shininess",value:4},{name:"Specular Amount",value:.5},{name:"Specular Model index",value:0},{name:"Specular Model",value:"Blinn"},{name:"Energy Conservation",value:false},{name:"Double Sided Material",value:false},{name:"Falloff Mode index",value:0},{name:"Falloff Mode",value:"A"},{name:"Diffuse Texture",value:0},{name:"Specular Texture",value:0},{name:"Normal Map",value:0},{name:"AO Texture",value:0},{name:"Emissive Texture",value:0},{name:"Emissive Mask",value:0},{name:"Opacity Texture",value:0},{name:"Environment Map",value:0},{name:"Env Map Mask",value:0},{name:"Colorize Texture",value:true},{name:"Diffuse Repeat X",value:1},{name:"Diffuse Repeat Y",value:1},{name:"Texture Offset X",value:0},{name:"Texture Offset Y",value:0},{name:"Specular Intensity",value:1},{name:"Normal Map Intensity",value:.5},{name:"AO Intensity",value:1},{name:"Emissive Intensity",value:1},{name:"Emissive Mask Intensity",value:1},{name:"Env Map Intensity",value:1},{name:"Env Map Blend index",value:0},{name:"Env Map Blend",value:"Add"},{name:"Env Mask Intensity",value:1},{name:"Alpha Mask Source index",value:0},{name:"Alpha Mask Source",value:"Luminance"},{name:"Discard Transparent Pixels",value:false}],portsOut:[{name:"Trigger Out",links:[{portIn:"render",portOut:"Trigger Out",objIn:"358",objOut:"361"}]},{name:"Shader"}]},{objName:"Ops.Gl.ShaderEffects.UseVertexColor",id:"362",uiAttribs:{subPatch:"f6aa2f67-88fb-405a-8459-57efde4666d4"},portsIn:[{name:"Render"}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"358",objOut:"362"}]}]},{objName:"Ops.Ui.PatchInput",id:"363",uiAttribs:{subPatch:"f6aa2f67-88fb-405a-8459-57efde4666d4"},portsIn:[],portsOut:[{name:"create port",value:0},{name:"in0 Ops.Gl.Matrix.Transform trigger",links:[{portIn:"Execute",portOut:"in0 Ops.Gl.Matrix.Transform trigger",objIn:"359",objOut:"363"},{portIn:"Exec",portOut:"in0 Ops.Gl.Matrix.Transform trigger",objIn:"370",objOut:"363"}]},{name:"in1 Ops.String.SwitchString Result",links:[{portIn:"PLY File",portOut:"in1 Ops.String.SwitchString Result",objIn:"367",objOut:"363"}]}]},{objName:"Ops.Ui.PatchOutput",id:"364",uiAttribs:{subPatch:"f6aa2f67-88fb-405a-8459-57efde4666d4"},portsIn:[{name:"create port",value:0},{name:"out0 Ops.Gl.GLTF.GltfNode_v2 Render"}],portsOut:[]},{objName:"Ops.Ui.SubPatch",id:"365",uiAttribs:{subPatch:0},portsIn:[{name:"create port",value:null},{name:"dataStr",value:'{"ports":[{"name":"in0 Ops.Gl.Matrix.Transform trigger","type":1,"title":"Render"},{"name":"in1 Ops.String.SwitchString Result","type":5,"title":"URL"}],"portsOut":[{"name":"out0 Ops.Gl.GLTF.GltfNode_v2 Render","type":1}]}'},{name:"patchId",value:"f6aa2f67-88fb-405a-8459-57efde4666d4"},{name:"in0 Ops.Gl.Matrix.Transform trigger"},{name:"in1 Ops.String.SwitchString Result"}],portsOut:[{name:"create port out",value:0},{name:"out0 Ops.Gl.GLTF.GltfNode_v2 Render"}]},{objName:"Ops.Gl.Geometry.GeometryInfo",id:"366",uiAttribs:{subPatch:"f6aa2f67-88fb-405a-8459-57efde4666d4"},portsIn:[{name:"Geometry"}],portsOut:[{name:"Indexed",value:null},{name:"Faces",value:null},{name:"Vertices",value:null},{name:"Normals",value:null},{name:"TexCoords",value:null},{name:"Tangents",value:null},{name:"BiTangents",value:null},{name:"VertexColors",links:[{portIn:"number1",portOut:"VertexColors",objIn:"368",objOut:"366"}]},{name:"Other Attributes",value:null}]},{objName:"Ops.User.kikohs.PLYLoader",id:"367",uiAttribs:{subPatch:"f6aa2f67-88fb-405a-8459-57efde4666d4"},portsIn:[{name:"PLY File",display:"file"},{name:"Auto-load",value:false},{name:"Custom Property map",value:0},{name:"Reload"}],portsOut:[{name:"Loaded",value:0},{name:"Geometry",links:[{portIn:"Geometry",portOut:"Geometry",objIn:"358",objOut:"367"},{portIn:"Geometry",portOut:"Geometry",objIn:"366",objOut:"367"}]},{name:"Loading",value:false},{name:"Is Point Cloud?",links:[{portIn:"Switch Value",portOut:"Is Point Cloud?",objIn:"359",objOut:"367"}]},{name:"Error",value:null}]},{objName:"Ops.Math.Compare.GreaterThan",id:"368",uiAttribs:{subPatch:"f6aa2f67-88fb-405a-8459-57efde4666d4"},portsIn:[{name:"number1"},{name:"number2",value:0}],portsOut:[{name:"result",links:[{portIn:"boolean",portOut:"result",objIn:"369",objOut:"368"}]}]},{objName:"Ops.Boolean.IfTrueThen_v2",id:"369",uiAttribs:{subPatch:"f6aa2f67-88fb-405a-8459-57efde4666d4"},portsIn:[{name:"exe",value:null},{name:"boolean"}],portsOut:[{name:"then",links:[{portIn:"Render",portOut:"then",objIn:"362",objOut:"369"}]},{name:"else",links:[{portIn:"render",portOut:"else",objIn:"358",objOut:"369"}]}]},{objName:"Ops.Trigger.TriggerOnce",id:"370",uiAttribs:{subPatch:"f6aa2f67-88fb-405a-8459-57efde4666d4"},portsIn:[{name:"Exec"},{name:"Reset",value:0}],portsOut:[{name:"Next",links:[{portIn:"Reload",portOut:"Next",objIn:"367",objOut:"370"}]},{name:"Was Triggered",value:true}]},{objName:"Ops.Gl.RenderGeometry",id:"371",uiAttribs:{subPatch:"48ebfd52-27a1-473d-88fb-cd2a8956b234"},portsIn:[{name:"render"},{name:"Geometry"},{name:"Update All",value:true},{name:"Update Face Indices",value:false},{name:"Update Vertices",value:false},{name:"Update Texcoords",value:false},{name:"Vertex Numbers",value:false}],portsOut:[{name:"trigger",links:[{portIn:"out0 Ops.Gl.GLTF.GltfNode_v2 Render",portOut:"trigger",objIn:"377",objOut:"371"}]}]},{objName:"Ops.Trigger.RouteTrigger",id:"372",uiAttribs:{subPatch:"48ebfd52-27a1-473d-88fb-cd2a8956b234"},portsIn:[{name:"Execute"},{name:"Switch Value"}],portsOut:[{name:"Next Trigger",value:0},{name:"Switched Value",value:0},{name:"Trigger 0",links:[{portIn:"Trigger In",portOut:"Trigger 0",objIn:"374",objOut:"372"}]},{name:"Trigger 1",links:[{portIn:"render",portOut:"Trigger 1",objIn:"373",objOut:"372"}]},{name:"Trigger 2",value:0},{name:"Trigger 3",value:0},{name:"Trigger 4",value:0},{name:"Trigger 5",value:0},{name:"Trigger 6",value:0},{name:"Trigger 7",value:0},{name:"Trigger 8",value:0},{name:"Trigger 9",value:0},{name:"Trigger 10",value:0},{name:"Trigger 11",value:0},{name:"Trigger 12",value:0},{name:"Trigger 13",value:0},{name:"Trigger 14",value:0},{name:"Trigger 15",value:0},{name:"Trigger 16",value:0},{name:"Trigger 17",value:0},{name:"Trigger 18",value:0},{name:"Trigger 19",value:0},{name:"Trigger 20",value:0},{name:"Trigger 21",value:0},{name:"Trigger 22",value:0},{name:"Trigger 23",value:0},{name:"Default Trigger",value:0}]},{objName:"Ops.Gl.Shader.PointMaterial_v4",id:"373",uiAttribs:{subPatch:"48ebfd52-27a1-473d-88fb-cd2a8956b234"},portsIn:[{name:"render"},{name:"PointSize",value:1.47},{name:"Size in Pixels",value:false},{name:"Random Size",value:0},{name:"Round",value:true},{name:"Round Antialias",value:false},{name:"Scale by Distance",value:false},{name:"r",value:1},{name:"g",value:1},{name:"b",value:1},{name:"a",value:1},{name:"Vertex Colors",value:true},{name:"texture",value:0},{name:"Colorize Texture",value:false},{name:"Texture Mask",value:0},{name:"Mask Channel index",value:0},{name:"Mask Channel",value:"R"},{name:"Texture Colorize",value:0},{name:"Colorize Randomize",value:true},{name:"Texture Opacity",value:0},{name:"Texture Point Size",value:0},{name:"Point Size Channel index",value:0},{name:"Point Size Channel",value:"R"},{name:"Texture Point Size Mul",value:1},{name:"Map Size 0 index",value:0},{name:"Map Size 0",value:"Black"},{name:"Flip Texture",value:false}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"371",objOut:"373"}]},{name:"shader"}]},{objName:"Ops.Gl.Phong.PhongMaterial_v6",id:"374",uiAttribs:{subPatch:"48ebfd52-27a1-473d-88fb-cd2a8956b234"},portsIn:[{name:"Trigger In"},{name:"R",value:.3098958333333333},{name:"G",value:.6590208333333337},{name:"B",value:.9333333333333333},{name:"A",value:1},{name:"Enable",value:false},{name:"Albedo",value:.707},{name:"Roughness",value:.835},{name:"Active",value:false},{name:"Fresnel Intensity",value:.7},{name:"Fresnel Width",value:1},{name:"Fresnel Exponent",value:6},{name:"Fresnel R",value:1},{name:"Fresnel G",value:1},{name:"Fresnel B",value:1},{name:"Emissive Active",value:false},{name:"Color Intensity",value:.3},{name:"Emissive R",value:.7528171913638779},{name:"Emissive G",value:.36422624829379013},{name:"Emissive B",value:.3103095732889889},{name:"Shininess",value:4},{name:"Specular Amount",value:.5},{name:"Specular Model index",value:0},{name:"Specular Model",value:"Blinn"},{name:"Energy Conservation",value:false},{name:"Double Sided Material",value:false},{name:"Falloff Mode index",value:0},{name:"Falloff Mode",value:"A"},{name:"Diffuse Texture",value:0},{name:"Specular Texture",value:0},{name:"Normal Map",value:0},{name:"AO Texture",value:0},{name:"Emissive Texture",value:0},{name:"Emissive Mask",value:0},{name:"Opacity Texture",value:0},{name:"Environment Map",value:0},{name:"Env Map Mask",value:0},{name:"Colorize Texture",value:true},{name:"Diffuse Repeat X",value:1},{name:"Diffuse Repeat Y",value:1},{name:"Texture Offset X",value:0},{name:"Texture Offset Y",value:0},{name:"Specular Intensity",value:1},{name:"Normal Map Intensity",value:.5},{name:"AO Intensity",value:1},{name:"Emissive Intensity",value:1},{name:"Emissive Mask Intensity",value:1},{name:"Env Map Intensity",value:1},{name:"Env Map Blend index",value:0},{name:"Env Map Blend",value:"Add"},{name:"Env Mask Intensity",value:1},{name:"Alpha Mask Source index",value:0},{name:"Alpha Mask Source",value:"Luminance"},{name:"Discard Transparent Pixels",value:false}],portsOut:[{name:"Trigger Out",links:[{portIn:"render",portOut:"Trigger Out",objIn:"371",objOut:"374"}]},{name:"Shader"}]},{objName:"Ops.Gl.ShaderEffects.UseVertexColor",id:"375",uiAttribs:{subPatch:"48ebfd52-27a1-473d-88fb-cd2a8956b234"},portsIn:[{name:"Render"}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"371",objOut:"375"}]}]},{objName:"Ops.Ui.PatchInput",id:"376",uiAttribs:{subPatch:"48ebfd52-27a1-473d-88fb-cd2a8956b234"},portsIn:[],portsOut:[{name:"create port",value:0},{name:"in0 Ops.Gl.Matrix.Transform trigger",links:[{portIn:"Execute",portOut:"in0 Ops.Gl.Matrix.Transform trigger",objIn:"372",objOut:"376"},{portIn:"Exec",portOut:"in0 Ops.Gl.Matrix.Transform trigger",objIn:"383",objOut:"376"}]},{name:"in1 Ops.String.SwitchString Result",links:[{portIn:"PLY File",portOut:"in1 Ops.String.SwitchString Result",objIn:"380",objOut:"376"}]}]},{objName:"Ops.Ui.PatchOutput",id:"377",uiAttribs:{subPatch:"48ebfd52-27a1-473d-88fb-cd2a8956b234"},portsIn:[{name:"create port",value:0},{name:"out0 Ops.Gl.GLTF.GltfNode_v2 Render"}],portsOut:[]},{objName:"Ops.Ui.SubPatch",id:"378",uiAttribs:{subPatch:0},portsIn:[{name:"create port",value:null},{name:"dataStr",value:'{"ports":[{"name":"in0 Ops.Gl.Matrix.Transform trigger","type":1,"title":"Render"},{"name":"in1 Ops.String.SwitchString Result","type":5,"title":"URL"}],"portsOut":[{"name":"out0 Ops.Gl.GLTF.GltfNode_v2 Render","type":1}]}'},{name:"patchId",value:"48ebfd52-27a1-473d-88fb-cd2a8956b234"},{name:"in0 Ops.Gl.Matrix.Transform trigger"},{name:"in1 Ops.String.SwitchString Result"}],portsOut:[{name:"create port out",value:0},{name:"out0 Ops.Gl.GLTF.GltfNode_v2 Render"}]},{objName:"Ops.Gl.Geometry.GeometryInfo",id:"379",uiAttribs:{subPatch:"48ebfd52-27a1-473d-88fb-cd2a8956b234"},portsIn:[{name:"Geometry"}],portsOut:[{name:"Indexed",value:null},{name:"Faces",value:null},{name:"Vertices",value:null},{name:"Normals",value:null},{name:"TexCoords",value:null},{name:"Tangents",value:null},{name:"BiTangents",value:null},{name:"VertexColors",links:[{portIn:"number1",portOut:"VertexColors",objIn:"381",objOut:"379"}]},{name:"Other Attributes",value:null}]},{objName:"Ops.User.kikohs.PLYLoader",id:"380",uiAttribs:{subPatch:"48ebfd52-27a1-473d-88fb-cd2a8956b234"},portsIn:[{name:"PLY File",display:"file"},{name:"Auto-load",value:false},{name:"Custom Property map",value:0},{name:"Reload"}],portsOut:[{name:"Loaded",value:0},{name:"Geometry",links:[{portIn:"Geometry",portOut:"Geometry",objIn:"371",objOut:"380"},{portIn:"Geometry",portOut:"Geometry",objIn:"379",objOut:"380"}]},{name:"Loading",value:false},{name:"Is Point Cloud?",links:[{portIn:"Switch Value",portOut:"Is Point Cloud?",objIn:"372",objOut:"380"}]},{name:"Error",value:null}]},{objName:"Ops.Math.Compare.GreaterThan",id:"381",uiAttribs:{subPatch:"48ebfd52-27a1-473d-88fb-cd2a8956b234"},portsIn:[{name:"number1"},{name:"number2",value:0}],portsOut:[{name:"result",links:[{portIn:"boolean",portOut:"result",objIn:"382",objOut:"381"}]}]},{objName:"Ops.Boolean.IfTrueThen_v2",id:"382",uiAttribs:{subPatch:"48ebfd52-27a1-473d-88fb-cd2a8956b234"},portsIn:[{name:"exe",value:null},{name:"boolean"}],portsOut:[{name:"then",links:[{portIn:"Render",portOut:"then",objIn:"375",objOut:"382"}]},{name:"else",links:[{portIn:"render",portOut:"else",objIn:"371",objOut:"382"}]}]},{objName:"Ops.Trigger.TriggerOnce",id:"383",uiAttribs:{subPatch:"48ebfd52-27a1-473d-88fb-cd2a8956b234"},portsIn:[{name:"Exec"},{name:"Reset",value:0}],portsOut:[{name:"Next",links:[{portIn:"Reload",portOut:"Next",objIn:"380",objOut:"383"}]},{name:"Was Triggered",value:true}]},{objName:"Ops.Gl.RenderGeometry",id:"384",uiAttribs:{subPatch:"be24bb3a-3c7d-452a-9c45-5d8e5cb0bc79"},portsIn:[{name:"render"},{name:"Geometry"},{name:"Update All",value:true},{name:"Update Face Indices",value:false},{name:"Update Vertices",value:false},{name:"Update Texcoords",value:false},{name:"Vertex Numbers",value:false}],portsOut:[{name:"trigger",links:[{portIn:"out0 Ops.Gl.GLTF.GltfNode_v2 Render",portOut:"trigger",objIn:"390",objOut:"384"}]}]},{objName:"Ops.Trigger.RouteTrigger",id:"385",uiAttribs:{subPatch:"be24bb3a-3c7d-452a-9c45-5d8e5cb0bc79"},portsIn:[{name:"Execute"},{name:"Switch Value"}],portsOut:[{name:"Next Trigger",value:0},{name:"Switched Value",value:0},{name:"Trigger 0",links:[{portIn:"Trigger In",portOut:"Trigger 0",objIn:"387",objOut:"385"}]},{name:"Trigger 1",links:[{portIn:"render",portOut:"Trigger 1",objIn:"386",objOut:"385"}]},{name:"Trigger 2",value:0},{name:"Trigger 3",value:0},{name:"Trigger 4",value:0},{name:"Trigger 5",value:0},{name:"Trigger 6",value:0},{name:"Trigger 7",value:0},{name:"Trigger 8",value:0},{name:"Trigger 9",value:0},{name:"Trigger 10",value:0},{name:"Trigger 11",value:0},{name:"Trigger 12",value:0},{name:"Trigger 13",value:0},{name:"Trigger 14",value:0},{name:"Trigger 15",value:0},{name:"Trigger 16",value:0},{name:"Trigger 17",value:0},{name:"Trigger 18",value:0},{name:"Trigger 19",value:0},{name:"Trigger 20",value:0},{name:"Trigger 21",value:0},{name:"Trigger 22",value:0},{name:"Trigger 23",value:0},{name:"Default Trigger",value:0}]},{objName:"Ops.Gl.Shader.PointMaterial_v4",id:"386",uiAttribs:{subPatch:"be24bb3a-3c7d-452a-9c45-5d8e5cb0bc79"},portsIn:[{name:"render"},{name:"PointSize",value:1.47},{name:"Size in Pixels",value:false},{name:"Random Size",value:0},{name:"Round",value:true},{name:"Round Antialias",value:false},{name:"Scale by Distance",value:false},{name:"r",value:1},{name:"g",value:1},{name:"b",value:1},{name:"a",value:1},{name:"Vertex Colors",value:true},{name:"texture",value:0},{name:"Colorize Texture",value:false},{name:"Texture Mask",value:0},{name:"Mask Channel index",value:0},{name:"Mask Channel",value:"R"},{name:"Texture Colorize",value:0},{name:"Colorize Randomize",value:true},{name:"Texture Opacity",value:0},{name:"Texture Point Size",value:0},{name:"Point Size Channel index",value:0},{name:"Point Size Channel",value:"R"},{name:"Texture Point Size Mul",value:1},{name:"Map Size 0 index",value:0},{name:"Map Size 0",value:"Black"},{name:"Flip Texture",value:false}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"384",objOut:"386"}]},{name:"shader"}]},{objName:"Ops.Gl.Phong.PhongMaterial_v6",id:"387",uiAttribs:{subPatch:"be24bb3a-3c7d-452a-9c45-5d8e5cb0bc79"},portsIn:[{name:"Trigger In"},{name:"R",value:.3098958333333333},{name:"G",value:.6590208333333337},{name:"B",value:.9333333333333333},{name:"A",value:1},{name:"Enable",value:false},{name:"Albedo",value:.707},{name:"Roughness",value:.835},{name:"Active",value:false},{name:"Fresnel Intensity",value:.7},{name:"Fresnel Width",value:1},{name:"Fresnel Exponent",value:6},{name:"Fresnel R",value:1},{name:"Fresnel G",value:1},{name:"Fresnel B",value:1},{name:"Emissive Active",value:false},{name:"Color Intensity",value:.3},{name:"Emissive R",value:.7528171913638779},{name:"Emissive G",value:.36422624829379013},{name:"Emissive B",value:.3103095732889889},{name:"Shininess",value:4},{name:"Specular Amount",value:.5},{name:"Specular Model index",value:0},{name:"Specular Model",value:"Blinn"},{name:"Energy Conservation",value:false},{name:"Double Sided Material",value:false},{name:"Falloff Mode index",value:0},{name:"Falloff Mode",value:"A"},{name:"Diffuse Texture",value:0},{name:"Specular Texture",value:0},{name:"Normal Map",value:0},{name:"AO Texture",value:0},{name:"Emissive Texture",value:0},{name:"Emissive Mask",value:0},{name:"Opacity Texture",value:0},{name:"Environment Map",value:0},{name:"Env Map Mask",value:0},{name:"Colorize Texture",value:true},{name:"Diffuse Repeat X",value:1},{name:"Diffuse Repeat Y",value:1},{name:"Texture Offset X",value:0},{name:"Texture Offset Y",value:0},{name:"Specular Intensity",value:1},{name:"Normal Map Intensity",value:.5},{name:"AO Intensity",value:1},{name:"Emissive Intensity",value:1},{name:"Emissive Mask Intensity",value:1},{name:"Env Map Intensity",value:1},{name:"Env Map Blend index",value:0},{name:"Env Map Blend",value:"Add"},{name:"Env Mask Intensity",value:1},{name:"Alpha Mask Source index",value:0},{name:"Alpha Mask Source",value:"Luminance"},{name:"Discard Transparent Pixels",value:false}],portsOut:[{name:"Trigger Out",links:[{portIn:"render",portOut:"Trigger Out",objIn:"384",objOut:"387"}]},{name:"Shader"}]},{objName:"Ops.Gl.ShaderEffects.UseVertexColor",id:"388",uiAttribs:{subPatch:"be24bb3a-3c7d-452a-9c45-5d8e5cb0bc79"},portsIn:[{name:"Render"}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"384",objOut:"388"}]}]},{objName:"Ops.Ui.PatchInput",id:"389",uiAttribs:{subPatch:"be24bb3a-3c7d-452a-9c45-5d8e5cb0bc79"},portsIn:[],portsOut:[{name:"create port",value:0},{name:"in0 Ops.Gl.Matrix.Transform trigger",links:[{portIn:"Execute",portOut:"in0 Ops.Gl.Matrix.Transform trigger",objIn:"385",objOut:"389"},{portIn:"Exec",portOut:"in0 Ops.Gl.Matrix.Transform trigger",objIn:"396",objOut:"389"}]},{name:"in1 Ops.String.SwitchString Result",links:[{portIn:"PLY File",portOut:"in1 Ops.String.SwitchString Result",objIn:"393",objOut:"389"}]}]},{objName:"Ops.Ui.PatchOutput",id:"390",uiAttribs:{subPatch:"be24bb3a-3c7d-452a-9c45-5d8e5cb0bc79"},portsIn:[{name:"create port",value:0},{name:"out0 Ops.Gl.GLTF.GltfNode_v2 Render"}],portsOut:[]},{objName:"Ops.Ui.SubPatch",id:"391",uiAttribs:{subPatch:0},portsIn:[{name:"create port",value:null},{name:"dataStr",value:'{"ports":[{"name":"in0 Ops.Gl.Matrix.Transform trigger","type":1,"title":"Render"},{"name":"in1 Ops.String.SwitchString Result","type":5,"title":"URL"}],"portsOut":[{"name":"out0 Ops.Gl.GLTF.GltfNode_v2 Render","type":1}]}'},{name:"patchId",value:"be24bb3a-3c7d-452a-9c45-5d8e5cb0bc79"},{name:"in0 Ops.Gl.Matrix.Transform trigger"},{name:"in1 Ops.String.SwitchString Result"}],portsOut:[{name:"create port out",value:0},{name:"out0 Ops.Gl.GLTF.GltfNode_v2 Render"}]},{objName:"Ops.Gl.Geometry.GeometryInfo",id:"392",uiAttribs:{subPatch:"be24bb3a-3c7d-452a-9c45-5d8e5cb0bc79"},portsIn:[{name:"Geometry"}],portsOut:[{name:"Indexed",value:null},{name:"Faces",value:null},{name:"Vertices",value:null},{name:"Normals",value:null},{name:"TexCoords",value:null},{name:"Tangents",value:null},{name:"BiTangents",value:null},{name:"VertexColors",links:[{portIn:"number1",portOut:"VertexColors",objIn:"394",objOut:"392"}]},{name:"Other Attributes",value:null}]},{objName:"Ops.User.kikohs.PLYLoader",id:"393",uiAttribs:{subPatch:"be24bb3a-3c7d-452a-9c45-5d8e5cb0bc79"},portsIn:[{name:"PLY File",display:"file"},{name:"Auto-load",value:false},{name:"Custom Property map",value:0},{name:"Reload"}],portsOut:[{name:"Loaded",value:0},{name:"Geometry",links:[{portIn:"Geometry",portOut:"Geometry",objIn:"384",objOut:"393"},{portIn:"Geometry",portOut:"Geometry",objIn:"392",objOut:"393"}]},{name:"Loading",value:false},{name:"Is Point Cloud?",links:[{portIn:"Switch Value",portOut:"Is Point Cloud?",objIn:"385",objOut:"393"}]},{name:"Error",value:null}]},{objName:"Ops.Math.Compare.GreaterThan",id:"394",uiAttribs:{subPatch:"be24bb3a-3c7d-452a-9c45-5d8e5cb0bc79"},portsIn:[{name:"number1"},{name:"number2",value:0}],portsOut:[{name:"result",links:[{portIn:"boolean",portOut:"result",objIn:"395",objOut:"394"}]}]},{objName:"Ops.Boolean.IfTrueThen_v2",id:"395",uiAttribs:{subPatch:"be24bb3a-3c7d-452a-9c45-5d8e5cb0bc79"},portsIn:[{name:"exe",value:null},{name:"boolean"}],portsOut:[{name:"then",links:[{portIn:"Render",portOut:"then",objIn:"388",objOut:"395"}]},{name:"else",links:[{portIn:"render",portOut:"else",objIn:"384",objOut:"395"}]}]},{objName:"Ops.Trigger.TriggerOnce",id:"396",uiAttribs:{subPatch:"be24bb3a-3c7d-452a-9c45-5d8e5cb0bc79"},portsIn:[{name:"Exec"},{name:"Reset",value:0}],portsOut:[{name:"Next",links:[{portIn:"Reload",portOut:"Next",objIn:"393",objOut:"396"}]},{name:"Was Triggered",value:true}]},{objName:"Ops.Gl.Matrix.Transform",id:"397",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"posX",value:0},{name:"posY",value:0},{name:"posZ",value:.25},{name:"scale",value:.55},{name:"rotX",value:0},{name:"rotY",value:-.37},{name:"rotZ",value:90}],portsOut:[{name:"trigger",links:[{portIn:"in0 Ops.Gl.Matrix.Transform trigger",portOut:"trigger",objIn:"267",objOut:"397"}]}]},{objName:"Ops.Gl.Matrix.Transform",id:"398",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"posX",value:0},{name:"posY",value:0},{name:"posZ",value:.25},{name:"scale",value:.56},{name:"rotX",value:0},{name:"rotY",value:-.37},{name:"rotZ",value:90}],portsOut:[{name:"trigger",links:[{portIn:"in0 Ops.Gl.Matrix.Transform trigger",portOut:"trigger",objIn:"339",objOut:"398"},{portIn:"in0 Ops.Gl.Matrix.Transform trigger",portOut:"trigger",objIn:"326",objOut:"398"},{portIn:"in0 Ops.Gl.Matrix.Transform trigger",portOut:"trigger",objIn:"352",objOut:"398"},{portIn:"in0 Ops.Gl.Matrix.Transform trigger",portOut:"trigger",objIn:"365",objOut:"398"},{portIn:"in0 Ops.Gl.Matrix.Transform trigger",portOut:"trigger",objIn:"378",objOut:"398"},{portIn:"in0 Ops.Gl.Matrix.Transform trigger",portOut:"trigger",objIn:"391",objOut:"398"},{portIn:"in0 Ops.Gl.Matrix.Transform trigger",portOut:"trigger",objIn:"313",objOut:"398"},{portIn:"in0 Ops.Gl.Matrix.Transform trigger",portOut:"trigger",objIn:"412",objOut:"398"},{portIn:"in0 Ops.Gl.Matrix.Transform trigger",portOut:"trigger",objIn:"425",objOut:"398"}]}]},{objName:"Ops.Gl.Matrix.Transform",id:"399",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"posX",value:0},{name:"posY",value:0},{name:"posZ",value:.25},{name:"scale",value:.55},{name:"rotX",value:0},{name:"rotY",value:-.37},{name:"rotZ",value:90}],portsOut:[{name:"trigger",links:[{portIn:"in0 Ops.Gl.Matrix.Transform trigger",portOut:"trigger",objIn:"202",objOut:"399"}]}]},{objName:"Ops.Gl.Matrix.Transform",id:"400",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"posX",value:0},{name:"posY",value:0},{name:"posZ",value:.25},{name:"scale",value:.55},{name:"rotX",value:0},{name:"rotY",value:-.37},{name:"rotZ",value:90}],portsOut:[{name:"trigger",links:[{portIn:"in0 Ops.Gl.Matrix.Transform trigger",portOut:"trigger",objIn:"215",objOut:"400"}]}]},{objName:"Ops.Gl.Matrix.Transform",id:"401",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"posX",value:0},{name:"posY",value:0},{name:"posZ",value:.25},{name:"scale",value:.55},{name:"rotX",value:0},{name:"rotY",value:-.37},{name:"rotZ",value:90}],portsOut:[{name:"trigger",links:[{portIn:"in0 Ops.Gl.Matrix.Transform trigger",portOut:"trigger",objIn:"280",objOut:"401"}]}]},{objName:"Ops.Gl.Matrix.Transform",id:"402",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"posX",value:0},{name:"posY",value:0},{name:"posZ",value:.25},{name:"scale",value:.55},{name:"rotX",value:0},{name:"rotY",value:-.37},{name:"rotZ",value:90}],portsOut:[{name:"trigger",links:[{portIn:"in0 Ops.Gl.Matrix.Transform trigger",portOut:"trigger",objIn:"228",objOut:"402"}]}]},{objName:"Ops.Gl.Matrix.Transform",id:"403",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"posX",value:0},{name:"posY",value:0},{name:"posZ",value:.25},{name:"scale",value:.55},{name:"rotX",value:0},{name:"rotY",value:-.37},{name:"rotZ",value:90}],portsOut:[{name:"trigger",links:[{portIn:"in0 Ops.Gl.Matrix.Transform trigger",portOut:"trigger",objIn:"241",objOut:"403"}]}]},{objName:"Ops.Gl.Matrix.Transform",id:"404",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"posX",value:0},{name:"posY",value:0},{name:"posZ",value:.25},{name:"scale",value:.55},{name:"rotX",value:0},{name:"rotY",value:-.37},{name:"rotZ",value:90}],portsOut:[{name:"trigger",links:[{portIn:"in0 Ops.Gl.Matrix.Transform trigger",portOut:"trigger",objIn:"254",objOut:"404"}]}]},{objName:"Ops.Gl.RenderGeometry",id:"405",uiAttribs:{subPatch:"7fcdb6a0-9ee2-483a-9ecc-7df7b3e28759"},portsIn:[{name:"render"},{name:"Geometry"},{name:"Update All",value:true},{name:"Update Face Indices",value:false},{name:"Update Vertices",value:false},{name:"Update Texcoords",value:false},{name:"Vertex Numbers",value:false}],portsOut:[{name:"trigger",links:[{portIn:"out0 Ops.Gl.GLTF.GltfNode_v2 Render",portOut:"trigger",objIn:"411",objOut:"405"}]}]},{objName:"Ops.Trigger.RouteTrigger",id:"406",uiAttribs:{subPatch:"7fcdb6a0-9ee2-483a-9ecc-7df7b3e28759"},portsIn:[{name:"Execute"},{name:"Switch Value"}],portsOut:[{name:"Next Trigger",value:0},{name:"Switched Value",value:0},{name:"Trigger 0",links:[{portIn:"Trigger In",portOut:"Trigger 0",objIn:"408",objOut:"406"}]},{name:"Trigger 1",links:[{portIn:"render",portOut:"Trigger 1",objIn:"407",objOut:"406"}]},{name:"Trigger 2",value:0},{name:"Trigger 3",value:0},{name:"Trigger 4",value:0},{name:"Trigger 5",value:0},{name:"Trigger 6",value:0},{name:"Trigger 7",value:0},{name:"Trigger 8",value:0},{name:"Trigger 9",value:0},{name:"Trigger 10",value:0},{name:"Trigger 11",value:0},{name:"Trigger 12",value:0},{name:"Trigger 13",value:0},{name:"Trigger 14",value:0},{name:"Trigger 15",value:0},{name:"Trigger 16",value:0},{name:"Trigger 17",value:0},{name:"Trigger 18",value:0},{name:"Trigger 19",value:0},{name:"Trigger 20",value:0},{name:"Trigger 21",value:0},{name:"Trigger 22",value:0},{name:"Trigger 23",value:0},{name:"Default Trigger",value:0}]},{objName:"Ops.Gl.Shader.PointMaterial_v4",id:"407",uiAttribs:{subPatch:"7fcdb6a0-9ee2-483a-9ecc-7df7b3e28759"},portsIn:[{name:"render"},{name:"PointSize",value:1.47},{name:"Size in Pixels",value:false},{name:"Random Size",value:0},{name:"Round",value:true},{name:"Round Antialias",value:false},{name:"Scale by Distance",value:false},{name:"r",value:1},{name:"g",value:1},{name:"b",value:1},{name:"a",value:1},{name:"Vertex Colors",value:true},{name:"texture",value:0},{name:"Colorize Texture",value:false},{name:"Texture Mask",value:0},{name:"Mask Channel index",value:0},{name:"Mask Channel",value:"R"},{name:"Texture Colorize",value:0},{name:"Colorize Randomize",value:true},{name:"Texture Opacity",value:0},{name:"Texture Point Size",value:0},{name:"Point Size Channel index",value:0},{name:"Point Size Channel",value:"R"},{name:"Texture Point Size Mul",value:1},{name:"Map Size 0 index",value:0},{name:"Map Size 0",value:"Black"},{name:"Flip Texture",value:false}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"405",objOut:"407"}]},{name:"shader"}]},{objName:"Ops.Gl.Phong.PhongMaterial_v6",id:"408",uiAttribs:{subPatch:"7fcdb6a0-9ee2-483a-9ecc-7df7b3e28759"},portsIn:[{name:"Trigger In"},{name:"R",value:.3098958333333333},{name:"G",value:.6590208333333337},{name:"B",value:.9333333333333333},{name:"A",value:1},{name:"Enable",value:false},{name:"Albedo",value:.707},{name:"Roughness",value:.835},{name:"Active",value:false},{name:"Fresnel Intensity",value:.7},{name:"Fresnel Width",value:1},{name:"Fresnel Exponent",value:6},{name:"Fresnel R",value:1},{name:"Fresnel G",value:1},{name:"Fresnel B",value:1},{name:"Emissive Active",value:false},{name:"Color Intensity",value:.3},{name:"Emissive R",value:.7528171913638779},{name:"Emissive G",value:.36422624829379013},{name:"Emissive B",value:.3103095732889889},{name:"Shininess",value:4},{name:"Specular Amount",value:.5},{name:"Specular Model index",value:0},{name:"Specular Model",value:"Blinn"},{name:"Energy Conservation",value:false},{name:"Double Sided Material",value:false},{name:"Falloff Mode index",value:0},{name:"Falloff Mode",value:"A"},{name:"Diffuse Texture",value:0},{name:"Specular Texture",value:0},{name:"Normal Map",value:0},{name:"AO Texture",value:0},{name:"Emissive Texture",value:0},{name:"Emissive Mask",value:0},{name:"Opacity Texture",value:0},{name:"Environment Map",value:0},{name:"Env Map Mask",value:0},{name:"Colorize Texture",value:true},{name:"Diffuse Repeat X",value:1},{name:"Diffuse Repeat Y",value:1},{name:"Texture Offset X",value:0},{name:"Texture Offset Y",value:0},{name:"Specular Intensity",value:1},{name:"Normal Map Intensity",value:.5},{name:"AO Intensity",value:1},{name:"Emissive Intensity",value:1},{name:"Emissive Mask Intensity",value:1},{name:"Env Map Intensity",value:1},{name:"Env Map Blend index",value:0},{name:"Env Map Blend",value:"Add"},{name:"Env Mask Intensity",value:1},{name:"Alpha Mask Source index",value:0},{name:"Alpha Mask Source",value:"Luminance"},{name:"Discard Transparent Pixels",value:false}],portsOut:[{name:"Trigger Out",links:[{portIn:"render",portOut:"Trigger Out",objIn:"405",objOut:"408"}]},{name:"Shader"}]},{objName:"Ops.Gl.ShaderEffects.UseVertexColor",id:"409",uiAttribs:{subPatch:"7fcdb6a0-9ee2-483a-9ecc-7df7b3e28759"},portsIn:[{name:"Render"}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"405",objOut:"409"}]}]},{objName:"Ops.Ui.PatchInput",id:"410",uiAttribs:{subPatch:"7fcdb6a0-9ee2-483a-9ecc-7df7b3e28759"},portsIn:[],portsOut:[{name:"create port",value:0},{name:"in0 Ops.Gl.Matrix.Transform trigger",links:[{portIn:"Execute",portOut:"in0 Ops.Gl.Matrix.Transform trigger",objIn:"406",objOut:"410"},{portIn:"Exec",portOut:"in0 Ops.Gl.Matrix.Transform trigger",objIn:"417",objOut:"410"}]},{name:"in1 Ops.String.SwitchString Result",links:[{portIn:"PLY File",portOut:"in1 Ops.String.SwitchString Result",objIn:"414",objOut:"410"}]}]},{objName:"Ops.Ui.PatchOutput",id:"411",uiAttribs:{subPatch:"7fcdb6a0-9ee2-483a-9ecc-7df7b3e28759"},portsIn:[{name:"create port",value:0},{name:"out0 Ops.Gl.GLTF.GltfNode_v2 Render"}],portsOut:[]},{objName:"Ops.Ui.SubPatch",id:"412",uiAttribs:{subPatch:0},portsIn:[{name:"create port",value:null},{name:"dataStr",value:'{"ports":[{"name":"in0 Ops.Gl.Matrix.Transform trigger","type":1,"title":"Render"},{"name":"in1 Ops.String.SwitchString Result","type":5,"title":"URL"}],"portsOut":[{"name":"out0 Ops.Gl.GLTF.GltfNode_v2 Render","type":1}]}'},{name:"patchId",value:"7fcdb6a0-9ee2-483a-9ecc-7df7b3e28759"},{name:"in0 Ops.Gl.Matrix.Transform trigger"},{name:"in1 Ops.String.SwitchString Result"}],portsOut:[{name:"create port out",value:0},{name:"out0 Ops.Gl.GLTF.GltfNode_v2 Render"}]},{objName:"Ops.Gl.Geometry.GeometryInfo",id:"413",uiAttribs:{subPatch:"7fcdb6a0-9ee2-483a-9ecc-7df7b3e28759"},portsIn:[{name:"Geometry"}],portsOut:[{name:"Indexed",value:null},{name:"Faces",value:null},{name:"Vertices",value:null},{name:"Normals",value:null},{name:"TexCoords",value:null},{name:"Tangents",value:null},{name:"BiTangents",value:null},{name:"VertexColors",links:[{portIn:"number1",portOut:"VertexColors",objIn:"415",objOut:"413"}]},{name:"Other Attributes",value:null}]},{objName:"Ops.User.kikohs.PLYLoader",id:"414",uiAttribs:{subPatch:"7fcdb6a0-9ee2-483a-9ecc-7df7b3e28759"},portsIn:[{name:"PLY File",display:"file"},{name:"Auto-load",value:false},{name:"Custom Property map",value:0},{name:"Reload"}],portsOut:[{name:"Loaded",value:0},{name:"Geometry",links:[{portIn:"Geometry",portOut:"Geometry",objIn:"405",objOut:"414"},{portIn:"Geometry",portOut:"Geometry",objIn:"413",objOut:"414"}]},{name:"Loading",value:false},{name:"Is Point Cloud?",links:[{portIn:"Switch Value",portOut:"Is Point Cloud?",objIn:"406",objOut:"414"}]},{name:"Error",value:null}]},{objName:"Ops.Math.Compare.GreaterThan",id:"415",uiAttribs:{subPatch:"7fcdb6a0-9ee2-483a-9ecc-7df7b3e28759"},portsIn:[{name:"number1"},{name:"number2",value:0}],portsOut:[{name:"result",links:[{portIn:"boolean",portOut:"result",objIn:"416",objOut:"415"}]}]},{objName:"Ops.Boolean.IfTrueThen_v2",id:"416",uiAttribs:{subPatch:"7fcdb6a0-9ee2-483a-9ecc-7df7b3e28759"},portsIn:[{name:"exe",value:null},{name:"boolean"}],portsOut:[{name:"then",links:[{portIn:"Render",portOut:"then",objIn:"409",objOut:"416"}]},{name:"else",links:[{portIn:"render",portOut:"else",objIn:"405",objOut:"416"}]}]},{objName:"Ops.Trigger.TriggerOnce",id:"417",uiAttribs:{subPatch:"7fcdb6a0-9ee2-483a-9ecc-7df7b3e28759"},portsIn:[{name:"Exec"},{name:"Reset",value:0}],portsOut:[{name:"Next",links:[{portIn:"Reload",portOut:"Next",objIn:"414",objOut:"417"}]},{name:"Was Triggered",value:true}]},{objName:"Ops.Gl.RenderGeometry",id:"418",uiAttribs:{subPatch:"c873d32b-c68e-464b-93d3-37ff7802107b"},portsIn:[{name:"render"},{name:"Geometry"},{name:"Update All",value:true},{name:"Update Face Indices",value:false},{name:"Update Vertices",value:false},{name:"Update Texcoords",value:false},{name:"Vertex Numbers",value:false}],portsOut:[{name:"trigger",links:[{portIn:"out0 Ops.Gl.GLTF.GltfNode_v2 Render",portOut:"trigger",objIn:"424",objOut:"418"}]}]},{objName:"Ops.Trigger.RouteTrigger",id:"419",uiAttribs:{subPatch:"c873d32b-c68e-464b-93d3-37ff7802107b"},portsIn:[{name:"Execute"},{name:"Switch Value"}],portsOut:[{name:"Next Trigger",value:0},{name:"Switched Value",value:0},{name:"Trigger 0",links:[{portIn:"Trigger In",portOut:"Trigger 0",objIn:"421",objOut:"419"}]},{name:"Trigger 1",links:[{portIn:"render",portOut:"Trigger 1",objIn:"420",objOut:"419"}]},{name:"Trigger 2",value:0},{name:"Trigger 3",value:0},{name:"Trigger 4",value:0},{name:"Trigger 5",value:0},{name:"Trigger 6",value:0},{name:"Trigger 7",value:0},{name:"Trigger 8",value:0},{name:"Trigger 9",value:0},{name:"Trigger 10",value:0},{name:"Trigger 11",value:0},{name:"Trigger 12",value:0},{name:"Trigger 13",value:0},{name:"Trigger 14",value:0},{name:"Trigger 15",value:0},{name:"Trigger 16",value:0},{name:"Trigger 17",value:0},{name:"Trigger 18",value:0},{name:"Trigger 19",value:0},{name:"Trigger 20",value:0},{name:"Trigger 21",value:0},{name:"Trigger 22",value:0},{name:"Trigger 23",value:0},{name:"Default Trigger",value:0}]},{objName:"Ops.Gl.Shader.PointMaterial_v4",id:"420",uiAttribs:{subPatch:"c873d32b-c68e-464b-93d3-37ff7802107b"},portsIn:[{name:"render"},{name:"PointSize",value:1.47},{name:"Size in Pixels",value:false},{name:"Random Size",value:0},{name:"Round",value:true},{name:"Round Antialias",value:false},{name:"Scale by Distance",value:false},{name:"r",value:1},{name:"g",value:1},{name:"b",value:1},{name:"a",value:1},{name:"Vertex Colors",value:true},{name:"texture",value:0},{name:"Colorize Texture",value:false},{name:"Texture Mask",value:0},{name:"Mask Channel index",value:0},{name:"Mask Channel",value:"R"},{name:"Texture Colorize",value:0},{name:"Colorize Randomize",value:true},{name:"Texture Opacity",value:0},{name:"Texture Point Size",value:0},{name:"Point Size Channel index",value:0},{name:"Point Size Channel",value:"R"},{name:"Texture Point Size Mul",value:1},{name:"Map Size 0 index",value:0},{name:"Map Size 0",value:"Black"},{name:"Flip Texture",value:false}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"418",objOut:"420"}]},{name:"shader"}]},{objName:"Ops.Gl.Phong.PhongMaterial_v6",id:"421",uiAttribs:{subPatch:"c873d32b-c68e-464b-93d3-37ff7802107b"},portsIn:[{name:"Trigger In"},{name:"R",value:.3098958333333333},{name:"G",value:.6590208333333337},{name:"B",value:.9333333333333333},{name:"A",value:1},{name:"Enable",value:false},{name:"Albedo",value:.707},{name:"Roughness",value:.835},{name:"Active",value:false},{name:"Fresnel Intensity",value:.7},{name:"Fresnel Width",value:1},{name:"Fresnel Exponent",value:6},{name:"Fresnel R",value:1},{name:"Fresnel G",value:1},{name:"Fresnel B",value:1},{name:"Emissive Active",value:false},{name:"Color Intensity",value:.3},{name:"Emissive R",value:.7528171913638779},{name:"Emissive G",value:.36422624829379013},{name:"Emissive B",value:.3103095732889889},{name:"Shininess",value:4},{name:"Specular Amount",value:.5},{name:"Specular Model index",value:0},{name:"Specular Model",value:"Blinn"},{name:"Energy Conservation",value:false},{name:"Double Sided Material",value:false},{name:"Falloff Mode index",value:0},{name:"Falloff Mode",value:"A"},{name:"Diffuse Texture",value:0},{name:"Specular Texture",value:0},{name:"Normal Map",value:0},{name:"AO Texture",value:0},{name:"Emissive Texture",value:0},{name:"Emissive Mask",value:0},{name:"Opacity Texture",value:0},{name:"Environment Map",value:0},{name:"Env Map Mask",value:0},{name:"Colorize Texture",value:true},{name:"Diffuse Repeat X",value:1},{name:"Diffuse Repeat Y",value:1},{name:"Texture Offset X",value:0},{name:"Texture Offset Y",value:0},{name:"Specular Intensity",value:1},{name:"Normal Map Intensity",value:.5},{name:"AO Intensity",value:1},{name:"Emissive Intensity",value:1},{name:"Emissive Mask Intensity",value:1},{name:"Env Map Intensity",value:1},{name:"Env Map Blend index",value:0},{name:"Env Map Blend",value:"Add"},{name:"Env Mask Intensity",value:1},{name:"Alpha Mask Source index",value:0},{name:"Alpha Mask Source",value:"Luminance"},{name:"Discard Transparent Pixels",value:false}],portsOut:[{name:"Trigger Out",links:[{portIn:"render",portOut:"Trigger Out",objIn:"418",objOut:"421"}]},{name:"Shader"}]},{objName:"Ops.Gl.ShaderEffects.UseVertexColor",id:"422",uiAttribs:{subPatch:"c873d32b-c68e-464b-93d3-37ff7802107b"},portsIn:[{name:"Render"}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"418",objOut:"422"}]}]},{objName:"Ops.Ui.PatchInput",id:"423",uiAttribs:{subPatch:"c873d32b-c68e-464b-93d3-37ff7802107b"},portsIn:[],portsOut:[{name:"create port",value:0},{name:"in0 Ops.Gl.Matrix.Transform trigger",links:[{portIn:"Execute",portOut:"in0 Ops.Gl.Matrix.Transform trigger",objIn:"419",objOut:"423"},{portIn:"Exec",portOut:"in0 Ops.Gl.Matrix.Transform trigger",objIn:"430",objOut:"423"}]},{name:"in1 Ops.String.SwitchString Result",links:[{portIn:"PLY File",portOut:"in1 Ops.String.SwitchString Result",objIn:"427",objOut:"423"}]}]},{objName:"Ops.Ui.PatchOutput",id:"424",uiAttribs:{subPatch:"c873d32b-c68e-464b-93d3-37ff7802107b"},portsIn:[{name:"create port",value:0},{name:"out0 Ops.Gl.GLTF.GltfNode_v2 Render"}],portsOut:[]},{objName:"Ops.Ui.SubPatch",id:"425",uiAttribs:{subPatch:0},portsIn:[{name:"create port",value:null},{name:"dataStr",value:'{"ports":[{"name":"in0 Ops.Gl.Matrix.Transform trigger","type":1,"title":"Render"},{"name":"in1 Ops.String.SwitchString Result","type":5,"title":"URL"}],"portsOut":[{"name":"out0 Ops.Gl.GLTF.GltfNode_v2 Render","type":1}]}'},{name:"patchId",value:"c873d32b-c68e-464b-93d3-37ff7802107b"},{name:"in0 Ops.Gl.Matrix.Transform trigger"},{name:"in1 Ops.String.SwitchString Result"}],portsOut:[{name:"create port out",value:0},{name:"out0 Ops.Gl.GLTF.GltfNode_v2 Render"}]},{objName:"Ops.Gl.Geometry.GeometryInfo",id:"426",uiAttribs:{subPatch:"c873d32b-c68e-464b-93d3-37ff7802107b"},portsIn:[{name:"Geometry"}],portsOut:[{name:"Indexed",value:null},{name:"Faces",value:null},{name:"Vertices",value:null},{name:"Normals",value:null},{name:"TexCoords",value:null},{name:"Tangents",value:null},{name:"BiTangents",value:null},{name:"VertexColors",links:[{portIn:"number1",portOut:"VertexColors",objIn:"428",objOut:"426"}]},{name:"Other Attributes",value:null}]},{objName:"Ops.User.kikohs.PLYLoader",id:"427",uiAttribs:{subPatch:"c873d32b-c68e-464b-93d3-37ff7802107b"},portsIn:[{name:"PLY File",display:"file"},{name:"Auto-load",value:false},{name:"Custom Property map",value:0},{name:"Reload"}],portsOut:[{name:"Loaded",value:0},{name:"Geometry",links:[{portIn:"Geometry",portOut:"Geometry",objIn:"418",objOut:"427"},{portIn:"Geometry",portOut:"Geometry",objIn:"426",objOut:"427"}]},{name:"Loading",value:false},{name:"Is Point Cloud?",links:[{portIn:"Switch Value",portOut:"Is Point Cloud?",objIn:"419",objOut:"427"}]},{name:"Error",value:null}]},{objName:"Ops.Math.Compare.GreaterThan",id:"428",uiAttribs:{subPatch:"c873d32b-c68e-464b-93d3-37ff7802107b"},portsIn:[{name:"number1"},{name:"number2",value:0}],portsOut:[{name:"result",links:[{portIn:"boolean",portOut:"result",objIn:"429",objOut:"428"}]}]},{objName:"Ops.Boolean.IfTrueThen_v2",id:"429",uiAttribs:{subPatch:"c873d32b-c68e-464b-93d3-37ff7802107b"},portsIn:[{name:"exe",value:null},{name:"boolean"}],portsOut:[{name:"then",links:[{portIn:"Render",portOut:"then",objIn:"422",objOut:"429"}]},{name:"else",links:[{portIn:"render",portOut:"else",objIn:"418",objOut:"429"}]}]},{objName:"Ops.Trigger.TriggerOnce",id:"430",uiAttribs:{subPatch:"c873d32b-c68e-464b-93d3-37ff7802107b"},portsIn:[{name:"Exec"},{name:"Reset",value:0}],portsOut:[{name:"Next",links:[{portIn:"Reload",portOut:"Next",objIn:"427",objOut:"430"}]},{name:"Was Triggered",value:true}]},{objName:"Ops.String.String_v2",id:"431",uiAttribs:{subPatch:0},portsIn:[{name:"value",value:"https://enacit4r-cdn.epfl.ch/Timberstone/V01/assets/stone2.ply"}],portsOut:[{name:"String",links:[{portIn:"in1 Ops.String.SwitchString Result",portOut:"String",objIn:"97",objOut:"431"}]}]},{objName:"Ops.String.String_v2",id:"432",uiAttribs:{subPatch:0},portsIn:[{name:"value",value:"https://enacit4r-cdn.epfl.ch/Timberstone/V01/assets/part_4_obj_7.ply"}],portsOut:[{name:"String",links:[{portIn:"in1 Ops.String.SwitchString Result",portOut:"String",objIn:"254",objOut:"432"}]}]},{objName:"Ops.Gl.RenderGeometry",id:"433",uiAttribs:{subPatch:"e2c0d398-6ea1-4b62-8371-4822999ca1e8"},portsIn:[{name:"render"},{name:"Geometry"},{name:"Update All",value:true},{name:"Update Face Indices",value:false},{name:"Update Vertices",value:false},{name:"Update Texcoords",value:false},{name:"Vertex Numbers",value:false}],portsOut:[{name:"trigger",links:[{portIn:"out0 Ops.Gl.GLTF.GltfNode_v2 Render",portOut:"trigger",objIn:"439",objOut:"433"}]}]},{objName:"Ops.Trigger.RouteTrigger",id:"434",uiAttribs:{subPatch:"e2c0d398-6ea1-4b62-8371-4822999ca1e8"},portsIn:[{name:"Execute"},{name:"Switch Value"}],portsOut:[{name:"Next Trigger",value:0},{name:"Switched Value",value:1},{name:"Trigger 0",links:[{portIn:"Trigger In",portOut:"Trigger 0",objIn:"436",objOut:"434"}]},{name:"Trigger 1",links:[{portIn:"render",portOut:"Trigger 1",objIn:"435",objOut:"434"}]},{name:"Trigger 2",value:0},{name:"Trigger 3",value:0},{name:"Trigger 4",value:0},{name:"Trigger 5",value:0},{name:"Trigger 6",value:0},{name:"Trigger 7",value:0},{name:"Trigger 8",value:0},{name:"Trigger 9",value:0},{name:"Trigger 10",value:0},{name:"Trigger 11",value:0},{name:"Trigger 12",value:0},{name:"Trigger 13",value:0},{name:"Trigger 14",value:0},{name:"Trigger 15",value:0},{name:"Trigger 16",value:0},{name:"Trigger 17",value:0},{name:"Trigger 18",value:0},{name:"Trigger 19",value:0},{name:"Trigger 20",value:0},{name:"Trigger 21",value:0},{name:"Trigger 22",value:0},{name:"Trigger 23",value:0},{name:"Default Trigger",value:0}]},{objName:"Ops.Gl.Shader.PointMaterial_v4",id:"435",uiAttribs:{subPatch:"e2c0d398-6ea1-4b62-8371-4822999ca1e8"},portsIn:[{name:"render"},{name:"PointSize",value:1.47},{name:"Size in Pixels",value:false},{name:"Random Size",value:0},{name:"Round",value:true},{name:"Round Antialias",value:false},{name:"Scale by Distance",value:false},{name:"r",value:1},{name:"g",value:1},{name:"b",value:1},{name:"a",value:1},{name:"Vertex Colors",value:true},{name:"texture",value:0},{name:"Colorize Texture",value:false},{name:"Texture Mask",value:0},{name:"Mask Channel index",value:0},{name:"Mask Channel",value:"R"},{name:"Texture Colorize",value:0},{name:"Colorize Randomize",value:true},{name:"Texture Opacity",value:0},{name:"Texture Point Size",value:0},{name:"Point Size Channel index",value:0},{name:"Point Size Channel",value:"R"},{name:"Texture Point Size Mul",value:1},{name:"Map Size 0 index",value:0},{name:"Map Size 0",value:"Black"},{name:"Flip Texture",value:false}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"433",objOut:"435"}]},{name:"shader"}]},{objName:"Ops.Gl.Phong.PhongMaterial_v6",id:"436",uiAttribs:{subPatch:"e2c0d398-6ea1-4b62-8371-4822999ca1e8"},portsIn:[{name:"Trigger In"},{name:"R",value:.8506666644414266},{name:"G",value:.5094861914999278},{name:"B",value:.5094861914999278},{name:"A",value:1},{name:"Enable",value:false},{name:"Albedo",value:.707},{name:"Roughness",value:.835},{name:"Active",value:false},{name:"Fresnel Intensity",value:.7},{name:"Fresnel Width",value:1},{name:"Fresnel Exponent",value:6},{name:"Fresnel R",value:1},{name:"Fresnel G",value:1},{name:"Fresnel B",value:1},{name:"Emissive Active",value:false},{name:"Color Intensity",value:.3},{name:"Emissive R",value:.7528171913638779},{name:"Emissive G",value:.36422624829379013},{name:"Emissive B",value:.3103095732889889},{name:"Shininess",value:4},{name:"Specular Amount",value:.5},{name:"Specular Model index",value:0},{name:"Specular Model",value:"Blinn"},{name:"Energy Conservation",value:false},{name:"Double Sided Material",value:false},{name:"Falloff Mode index",value:0},{name:"Falloff Mode",value:"A"},{name:"Diffuse Texture",value:0},{name:"Specular Texture",value:0},{name:"Normal Map",value:0},{name:"AO Texture",value:0},{name:"Emissive Texture",value:0},{name:"Emissive Mask",value:0},{name:"Opacity Texture",value:0},{name:"Environment Map",value:0},{name:"Env Map Mask",value:0},{name:"Colorize Texture",value:true},{name:"Diffuse Repeat X",value:1},{name:"Diffuse Repeat Y",value:1},{name:"Texture Offset X",value:0},{name:"Texture Offset Y",value:0},{name:"Specular Intensity",value:1},{name:"Normal Map Intensity",value:.5},{name:"AO Intensity",value:1},{name:"Emissive Intensity",value:1},{name:"Emissive Mask Intensity",value:1},{name:"Env Map Intensity",value:1},{name:"Env Map Blend index",value:0},{name:"Env Map Blend",value:"Add"},{name:"Env Mask Intensity",value:1},{name:"Alpha Mask Source index",value:0},{name:"Alpha Mask Source",value:"Luminance"},{name:"Discard Transparent Pixels",value:false}],portsOut:[{name:"Trigger Out",links:[{portIn:"exe",portOut:"Trigger Out",objIn:"444",objOut:"436"}]},{name:"Shader"}]},{objName:"Ops.Gl.ShaderEffects.UseVertexColor",id:"437",uiAttribs:{subPatch:"e2c0d398-6ea1-4b62-8371-4822999ca1e8"},portsIn:[{name:"Render"}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"433",objOut:"437"}]}]},{objName:"Ops.Ui.PatchInput",id:"438",uiAttribs:{subPatch:"e2c0d398-6ea1-4b62-8371-4822999ca1e8"},portsIn:[],portsOut:[{name:"create port",value:0},{name:"in0 Ops.Gl.Matrix.Transform trigger",links:[{portIn:"Execute",portOut:"in0 Ops.Gl.Matrix.Transform trigger",objIn:"434",objOut:"438"},{portIn:"Exec",portOut:"in0 Ops.Gl.Matrix.Transform trigger",objIn:"445",objOut:"438"}]},{name:"in1 Ops.String.SwitchString Result",links:[{portIn:"PLY File",portOut:"in1 Ops.String.SwitchString Result",objIn:"442",objOut:"438"}]}]},{objName:"Ops.Ui.PatchOutput",id:"439",uiAttribs:{subPatch:"e2c0d398-6ea1-4b62-8371-4822999ca1e8"},portsIn:[{name:"create port",value:0},{name:"out0 Ops.Gl.GLTF.GltfNode_v2 Render"}],portsOut:[]},{objName:"Ops.Ui.SubPatch",id:"440",uiAttribs:{subPatch:0},portsIn:[{name:"create port",value:null},{name:"dataStr",value:'{"ports":[{"name":"in0 Ops.Gl.Matrix.Transform trigger","type":1,"title":"Render"},{"name":"in1 Ops.String.SwitchString Result","type":5,"title":"URL"}],"portsOut":[{"name":"out0 Ops.Gl.GLTF.GltfNode_v2 Render","type":1}]}'},{name:"patchId",value:"e2c0d398-6ea1-4b62-8371-4822999ca1e8"},{name:"in0 Ops.Gl.Matrix.Transform trigger"},{name:"in1 Ops.String.SwitchString Result"}],portsOut:[{name:"create port out",value:0},{name:"out0 Ops.Gl.GLTF.GltfNode_v2 Render"}]},{objName:"Ops.Gl.Geometry.GeometryInfo",id:"441",uiAttribs:{subPatch:"e2c0d398-6ea1-4b62-8371-4822999ca1e8"},portsIn:[{name:"Geometry"}],portsOut:[{name:"Indexed",value:null},{name:"Faces",value:null},{name:"Vertices",value:null},{name:"Normals",value:null},{name:"TexCoords",value:null},{name:"Tangents",value:null},{name:"BiTangents",value:null},{name:"VertexColors",links:[{portIn:"number1",portOut:"VertexColors",objIn:"443",objOut:"441"}]},{name:"Other Attributes",value:null}]},{objName:"Ops.User.kikohs.PLYLoader",id:"442",uiAttribs:{subPatch:"e2c0d398-6ea1-4b62-8371-4822999ca1e8"},portsIn:[{name:"PLY File",display:"file"},{name:"Auto-load",value:false},{name:"Custom Property map",value:0},{name:"Reload"}],portsOut:[{name:"Loaded",value:0},{name:"Geometry",links:[{portIn:"Geometry",portOut:"Geometry",objIn:"433",objOut:"442"},{portIn:"Geometry",portOut:"Geometry",objIn:"441",objOut:"442"}]},{name:"Loading",value:false},{name:"Is Point Cloud?",links:[{portIn:"Switch Value",portOut:"Is Point Cloud?",objIn:"434",objOut:"442"}]},{name:"Error",value:null}]},{objName:"Ops.Math.Compare.GreaterThan",id:"443",uiAttribs:{subPatch:"e2c0d398-6ea1-4b62-8371-4822999ca1e8"},portsIn:[{name:"number1"},{name:"number2",value:0}],portsOut:[{name:"result",links:[{portIn:"boolean",portOut:"result",objIn:"444",objOut:"443"}]}]},{objName:"Ops.Boolean.IfTrueThen_v2",id:"444",uiAttribs:{subPatch:"e2c0d398-6ea1-4b62-8371-4822999ca1e8"},portsIn:[{name:"exe"},{name:"boolean"}],portsOut:[{name:"then",links:[{portIn:"Render",portOut:"then",objIn:"437",objOut:"444"}]},{name:"else",links:[{portIn:"render",portOut:"else",objIn:"433",objOut:"444"}]}]},{objName:"Ops.Trigger.TriggerOnce",id:"445",uiAttribs:{subPatch:"e2c0d398-6ea1-4b62-8371-4822999ca1e8"},portsIn:[{name:"Exec"},{name:"Reset",value:0}],portsOut:[{name:"Next",links:[{portIn:"Reload",portOut:"Next",objIn:"442",objOut:"445"}]},{name:"Was Triggered",value:true}]},{objName:"Ops.Gl.Matrix.Transform",id:"446",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"posX",value:0},{name:"posY",value:0},{name:"posZ",value:.25},{name:"scale",value:.55},{name:"rotX",value:0},{name:"rotY",value:-.37},{name:"rotZ",value:90}],portsOut:[{name:"trigger",links:[{portIn:"in0 Ops.Gl.Matrix.Transform trigger",portOut:"trigger",objIn:"440",objOut:"446"}]}]},{objName:"Ops.String.String_v2",id:"447",uiAttribs:{subPatch:0},portsIn:[{name:"value",value:"https://enacit4r-cdn.epfl.ch/Timberstone/V01/assets/part_4_obj_5.ply"}],portsOut:[{name:"String",links:[{portIn:"in1 Ops.String.SwitchString Result",portOut:"String",objIn:"228",objOut:"447"}]}]},{objName:"Ops.String.String_v2",id:"448",uiAttribs:{subPatch:0},portsIn:[{name:"value",value:"https://enacit4r-cdn.epfl.ch/Timberstone/V01/assets/part_4_obj_6.ply"}],portsOut:[{name:"String",links:[{portIn:"in1 Ops.String.SwitchString Result",portOut:"String",objIn:"241",objOut:"448"}]}]},{objName:"Ops.String.String_v2",id:"449",uiAttribs:{subPatch:0},portsIn:[{name:"value",value:"https://enacit4r-cdn.epfl.ch/Timberstone/V01/assets/part_4_obj_8.ply"}],portsOut:[{name:"String",links:[{portIn:"in1 Ops.String.SwitchString Result",portOut:"String",objIn:"267",objOut:"449"}]}]},{objName:"Ops.String.String_v2",id:"450",uiAttribs:{subPatch:0},portsIn:[{name:"value",value:"https://enacit4r-cdn.epfl.ch/Timberstone/V01/assets/stone3.ply"}],portsOut:[{name:"String",links:[{portIn:"in1 Ops.String.SwitchString Result",portOut:"String",objIn:"313",objOut:"450"}]}]},{objName:"Ops.String.String_v2",id:"451",uiAttribs:{subPatch:0},portsIn:[{name:"value",value:"https://enacit4r-cdn.epfl.ch/Timberstone/V01/assets/stone4.ply"}],portsOut:[{name:"String",links:[{portIn:"in1 Ops.String.SwitchString Result",portOut:"String",objIn:"412",objOut:"451"}]}]},{objName:"Ops.String.String_v2",id:"452",uiAttribs:{subPatch:0},portsIn:[{name:"value",value:"https://enacit4r-cdn.epfl.ch/Timberstone/V01/assets/stone5.ply"}],portsOut:[{name:"String",links:[{portIn:"in1 Ops.String.SwitchString Result",portOut:"String",objIn:"425",objOut:"452"}]}]},{objName:"Ops.String.String_v2",id:"453",uiAttribs:{subPatch:0},portsIn:[{name:"value",value:"https://enacit4r-cdn.epfl.ch/Timberstone/V01/assets/stone6.ply"}],portsOut:[{name:"String",links:[{portIn:"in1 Ops.String.SwitchString Result",portOut:"String",objIn:"326",objOut:"453"}]}]},{objName:"Ops.String.String_v2",id:"454",uiAttribs:{subPatch:0},portsIn:[{name:"value",value:"https://enacit4r-cdn.epfl.ch/Timberstone/V01/assets/stone7.ply"}],portsOut:[{name:"String",links:[{portIn:"in1 Ops.String.SwitchString Result",portOut:"String",objIn:"352",objOut:"454"}]}]},{objName:"Ops.String.String_v2",id:"455",uiAttribs:{subPatch:0},portsIn:[{name:"value",value:"https://enacit4r-cdn.epfl.ch/Timberstone/V01/assets/stone8.ply"}],portsOut:[{name:"String",links:[{portIn:"in1 Ops.String.SwitchString Result",portOut:"String",objIn:"339",objOut:"455"}]}]},{objName:"Ops.String.String_v2",id:"456",uiAttribs:{subPatch:0},portsIn:[{name:"value",value:"https://enacit4r-cdn.epfl.ch/Timberstone/V01/assets/stone9.ply"}],portsOut:[{name:"String",links:[{portIn:"in1 Ops.String.SwitchString Result",portOut:"String",objIn:"365",objOut:"456"}]}]},{objName:"Ops.String.String_v2",id:"457",uiAttribs:{subPatch:0},portsIn:[{name:"value",value:"https://enacit4r-cdn.epfl.ch/Timberstone/V01/assets/stone10.ply"}],portsOut:[{name:"String",links:[{portIn:"in1 Ops.String.SwitchString Result",portOut:"String",objIn:"378",objOut:"457"}]}]},{objName:"Ops.String.String_v2",id:"458",uiAttribs:{subPatch:0},portsIn:[{name:"value",value:"https://enacit4r-cdn.epfl.ch/Timberstone/V01/assets/stone11.ply"}],portsOut:[{name:"String",links:[{portIn:"in1 Ops.String.SwitchString Result",portOut:"String",objIn:"391",objOut:"458"}]}]},{objName:"Ops.String.String_v2",id:"459",uiAttribs:{subPatch:0},portsIn:[{name:"value",value:"https://enacit4r-cdn.epfl.ch/Timberstone/V01/assets/part_4_obj_9.ply"}],portsOut:[{name:"String",links:[{portIn:"in1 Ops.String.SwitchString Result",portOut:"String",objIn:"280",objOut:"459"}]}]},{objName:"Ops.String.String_v2",id:"460",uiAttribs:{subPatch:0},portsIn:[{name:"value",value:"https://enacit4r-cdn.epfl.ch/Timberstone/V01/assets/part_4_obj_10.ply"}],portsOut:[{name:"String",links:[{portIn:"in1 Ops.String.SwitchString Result",portOut:"String",objIn:"440",objOut:"460"}]}]},{objName:"Ops.Gl.Meshes.TextMesh_v2",id:"461",uiAttribs:{subPatch:0},portsIn:[{name:"Render"},{name:"Text",value:"loading...."},{name:"Scale",value:.2},{name:"Font",value:"Arial"},{name:"align index",value:1},{name:"align",value:"center"},{name:"vertical align index",value:1},{name:"vertical align",value:"Middle"},{name:"Line Height",value:1},{name:"Letter Spacing",value:0},{name:"filter index",value:2},{name:"filter",value:"mipmap"},{name:"Anisotropic index",value:0},{name:"Anisotropic",value:0},{name:"Texture Color",value:0},{name:"Texture Mask",value:0},{name:"r",value:.15531250000000002},{name:"g",value:.56},{name:"b",value:.398125},{name:"a",value:1}],portsOut:[{name:"Next",value:0},{name:"texture"},{name:"Total Lines",value:1},{name:"Width",value:.3097453647189671},{name:"Font Available",value:0}]},{objName:"Ops.Patch.LoadingStatus_v2",id:"462",uiAttribs:{subPatch:0},portsIn:[{name:"exe"},{name:"PreRender Ops",value:false},{name:"Play Timeline",value:true}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"5",objOut:"462"}]},{name:"Finished Initial Loading",value:true},{name:"Loading",links:[{portIn:"Pass Through",portOut:"Loading",objIn:"463",objOut:"462"}]},{name:"Progress",value:1},{name:"Jobs"},{name:"Trigger Loading Finished ",value:0}]},{objName:"Ops.Trigger.GateTrigger",id:"463",uiAttribs:{subPatch:0},portsIn:[{name:"Execute"},{name:"Pass Through"}],portsOut:[{name:"Trigger out",links:[{portIn:"render",portOut:"Trigger out",objIn:"464",objOut:"463"}]}]},{objName:"Ops.Gl.Matrix.Transform",id:"464",uiAttribs:{subPatch:0},portsIn:[{name:"render"},{name:"posX",value:.09},{name:"posY",value:.24},{name:"posZ",value:-.29},{name:"scale",value:1.07},{name:"rotX",value:-89.91},{name:"rotY",value:-.17},{name:"rotZ",value:-.01}],portsOut:[{name:"trigger",links:[{portIn:"Render",portOut:"trigger",objIn:"461",objOut:"464"}]}]},{objName:"Ops.String.String_v2",id:"465",uiAttribs:{subPatch:0},portsIn:[{name:"value",value:"https://enacit4r-cdn.epfl.ch/Timberstone/V01/assets/part_4_obj_4.ply"}],portsOut:[{name:"String",links:[{portIn:"in1 Ops.String.SwitchString Result",portOut:"String",objIn:"215",objOut:"465"}]}]},{objName:"Ops.String.String_v2",id:"466",uiAttribs:{subPatch:0},portsIn:[{name:"value",value:"https://enacit4r-cdn.epfl.ch/Timberstone/V01/assets/part_4_obj_3.ply"}],portsOut:[{name:"String",links:[{portIn:"in1 Ops.String.SwitchString Result",portOut:"String",objIn:"202",objOut:"466"}]}]}],users:["6229eb71fbc77d6e00a1ffc0","6156c2b7f4eab662bf8803e6","6156c2b0e5bbce6aa7fbab96","5d3c3577aa66862da9a155d2","62ab3d371e2153e04f9a76ad"],userOps:[],tags:[],_id:"62b9b74a588537d8f95453bf",name:"copy of Timberstone-Prod Version",userId:"6229eb71fbc77d6e00a1ffc0",created:"2022-06-27T13:57:30.940Z",cloneOf:"628b7976fb577e98bc6948b7",updated:"2022-06-30T06:54:38.883Z",log:[{_id:"62b9b74a588537d8f95453c1",key:"collabsatcreate",text:"initial list of collaborators:6229eb71fbc77d6e00a1ffc0,6156c2b7f4eab662bf8803e6,6156c2b0e5bbce6aa7fbab96,5d3c3577aa66862da9a155d2,62ab3d371e2153e04f9a76ad"}],__v:16,shortId:"vH-sB6",buildInfo:{core:{timestamp:1655965375354,created:"2022-06-23T06:22:55.354Z",git:{branch:"master",commit:"a017e1124e10993e96f805145f3c42b3aa81351e",date:"2022-06-23T06:11:00.000Z",message:"Merge remote-tracking branch 'origin/master' into develop"}},ui:{timestamp:1655965430981,created:"2022-06-23T06:23:50.981Z",git:{branch:"master",commit:"445ffa28d1319d63569fb17b32a8eb9fe4fd7525",date:null,message:null}},host:"cables.gl"},opsHash:"59393298a9553f59efdc2b66420737c6216b1096",ui:{timeLineLength:20,bookmarks:[],viewBoxesGl:{0:{x:2810.8260786220676,y:1151.4797064728523,z:1339.6119492800658},"e88c760e-6c22-407a-8194-54c9884b404e":{x:756.687801757496,y:684.2955180442842,z:299.123307020499},"e3e9c579-084f-4560-896f-5af6e84c4210":{x:-1089.4930172413794,y:-951.2758620689655,z:420.5521721216428},"9f4fb244-de1f-490a-8dba-69a6dc8069fa":{x:2315,y:1752.1724137931035,z:414.6097844117387},"4a591837-f958-49a8-ba17-a9aaddffe4aa":{x:2626.7799999999997,y:1624.8505687693898,z:400},"5838b769-8991-4f44-a962-dd31d555e7be":{x:5605.91953125,y:1966.8101851851854,z:418.8936177613307},"c0ba0882-a536-4746-b495-ba7cbca8367e":{x:5485.91953125,y:1182.550925925926,z:418.6709767565525},"e1253e8a-1954-4633-9388-90408f3154e2":{x:5437.91953125,y:1272.1805555555557,z:418.26616886447437},"f6aa2f67-88fb-405a-8459-57efde4666d4":{x:5632.174628146453,y:4021.3101505479954,z:919.2136203652927}},renderer:{w:859,h:648,s:1}},updatedByUser:"sylvaintauxe",deployments:{lastDeployment:{date:1656570379043,service:"download"}},exports:10,cachedUsername:"sylvaintauxe"};if(!CABLES.exportedPatch){CABLES.exportedPatch=CABLES.exportedPatches["vH-sB6"]}"use strict";var CABLES=CABLES||{};CABLES.OPS=CABLES.OPS||{};var Ops=Ops||{};Ops.Gl=Ops.Gl||{};Ops.Ui=Ops.Ui||{};Ops.Anim=Ops.Anim||{};Ops.Html=Ops.Html||{};Ops.Json=Ops.Json||{};Ops.Math=Ops.Math||{};Ops.User=Ops.User||{};Ops.Vars=Ops.Vars||{};Ops.Array=Ops.Array||{};Ops.Patch=Ops.Patch||{};Ops.Value=Ops.Value||{};Ops.Cables=Ops.Cables||{};Ops.Gl.Pbr=Ops.Gl.Pbr||{};Ops.String=Ops.String||{};Ops.Values=Ops.Values||{};Ops.Boolean=Ops.Boolean||{};Ops.Gl.GLTF=Ops.Gl.GLTF||{};Ops.Sidebar=Ops.Sidebar||{};Ops.Trigger=Ops.Trigger||{};Ops.Gl.Phong=Ops.Gl.Phong||{};Ops.WebAudio=Ops.WebAudio||{};Ops.Gl.Matrix=Ops.Gl.Matrix||{};Ops.Gl.Meshes=Ops.Gl.Meshes||{};Ops.Gl.Shader=Ops.Gl.Shader||{};Ops.Gl.Geometry=Ops.Gl.Geometry||{};Ops.User.kikohs=Ops.User.kikohs||{};Ops.Math.Compare=Ops.Math.Compare||{};Ops.Gl.ShaderEffects=Ops.Gl.ShaderEffects||{};Ops.Gl.MainLoop=function(){CABLES.Op.apply(this,arguments);const a=this;const e={};const t=a.inValue("FPS Limit",0),n=a.outTrigger("trigger"),r=a.outNumber("width"),i=a.outNumber("height"),o=a.inValueBool("Reduce FPS not focussed",true),s=a.inValueBool("Reduce FPS loading"),l=a.inValueBool("Clear",true),u=a.inValueBool("ClearAlpha",true),m=a.inValueBool("Fullscreen Button",false),c=a.inValueBool("Active",true),g=a.inValueBool("Hires Displays",false),p=a.inSwitch("Pixel Unit",["Display","CSS"],"Display");a.onAnimFrame=E;g.onChange=function(){if(g.get())a.patch.cgl.pixelDensity=window.devicePixelRatio;else a.patch.cgl.pixelDensity=1;a.patch.cgl.updateSize();if(CABLES.UI)gui.setLayout();p.setUiAttribs({greyout:!g.get()})};c.onChange=function(){a.patch.removeOnAnimFrame(a);if(c.get()){a.setUiAttrib({extendTitle:""});a.onAnimFrame=E;a.patch.addOnAnimFrame(a);a.log("adding again!")}else{a.setUiAttrib({extendTitle:"Inactive"})}};const d=a.patch.cgl;let f=0;let h=0;if(!a.patch.cgl)a.uiAttr({error:"No webgl cgl context"});const b=vec3.create();vec3.set(b,0,0,0);const v=vec3.create();vec3.set(v,0,0,-2);m.onChange=x;setTimeout(x,100);let O=null;let T=true;let I=true;window.addEventListener("blur",()=>{T=false});window.addEventListener("focus",()=>{T=true});document.addEventListener("visibilitychange",()=>{I=!document.hidden});p.onChange=()=>{r.set(0);i.set(0)};function _(){if(s.get()&&a.patch.loading.getProgress()<1)return 5;if(o.get()){if(!I)return 10;if(!T)return 30}return t.get()}function x(){function e(){if(O)O.style.display="block"}function t(){if(O)O.style.display="none"}a.patch.cgl.canvas.addEventListener("mouseleave",t);a.patch.cgl.canvas.addEventListener("mouseenter",e);if(m.get()){if(!O){O=document.createElement("div");const n=a.patch.cgl.canvas.parentElement;if(n)n.appendChild(O);O.addEventListener("mouseenter",e);O.addEventListener("click",function(e){if(CABLES.UI&&!e.shiftKey)gui.cycleFullscreen();else d.fullScreen()})}O.style.padding="10px";O.style.position="absolute";O.style.right="5px";O.style.top="5px";O.style.width="20px";O.style.height="20px";O.style.cursor="pointer";O.style["border-radius"]="40px";O.style.background="#444";O.style["z-index"]="9999";O.style.display="none";O.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Capa_1" x="0px" y="0px" viewBox="0 0 490 490" style="width:20px;height:20px;" xml:space="preserve" width="512px" height="512px"><g><path d="M173.792,301.792L21.333,454.251v-80.917c0-5.891-4.776-10.667-10.667-10.667C4.776,362.667,0,367.442,0,373.333V480     c0,5.891,4.776,10.667,10.667,10.667h106.667c5.891,0,10.667-4.776,10.667-10.667s-4.776-10.667-10.667-10.667H36.416     l152.459-152.459c4.093-4.237,3.975-10.99-0.262-15.083C184.479,297.799,177.926,297.799,173.792,301.792z" fill="#FFFFFF"/><path d="M480,0H373.333c-5.891,0-10.667,4.776-10.667,10.667c0,5.891,4.776,10.667,10.667,10.667h80.917L301.792,173.792     c-4.237,4.093-4.354,10.845-0.262,15.083c4.093,4.237,10.845,4.354,15.083,0.262c0.089-0.086,0.176-0.173,0.262-0.262     L469.333,36.416v80.917c0,5.891,4.776,10.667,10.667,10.667s10.667-4.776,10.667-10.667V10.667C490.667,4.776,485.891,0,480,0z" fill="#FFFFFF"/><path d="M36.416,21.333h80.917c5.891,0,10.667-4.776,10.667-10.667C128,4.776,123.224,0,117.333,0H10.667     C4.776,0,0,4.776,0,10.667v106.667C0,123.224,4.776,128,10.667,128c5.891,0,10.667-4.776,10.667-10.667V36.416l152.459,152.459     c4.237,4.093,10.99,3.975,15.083-0.262c3.992-4.134,3.992-10.687,0-14.82L36.416,21.333z" fill="#FFFFFF"/><path d="M480,362.667c-5.891,0-10.667,4.776-10.667,10.667v80.917L316.875,301.792c-4.237-4.093-10.99-3.976-15.083,0.261     c-3.993,4.134-3.993,10.688,0,14.821l152.459,152.459h-80.917c-5.891,0-10.667,4.776-10.667,10.667s4.776,10.667,10.667,10.667     H480c5.891,0,10.667-4.776,10.667-10.667V373.333C490.667,367.442,485.891,362.667,480,362.667z" fill="#FFFFFF"/></g></svg>'}else{if(O){O.style.display="none";O.remove();O=null}}}a.onDelete=function(){d.gl.clearColor(0,0,0,0);d.gl.clear(d.gl.COLOR_BUFFER_BIT|d.gl.DEPTH_BUFFER_BIT)};function E(e){if(!c.get())return;if(d.aborted||d.canvas.clientWidth===0||d.canvas.clientHeight===0)return;const t=performance.now();a.patch.config.fpsLimit=_();if(d.canvasWidth==-1){d.setCanvas(a.patch.config.glCanvasId);return}if(d.canvasWidth!=r.get()||d.canvasHeight!=i.get()){let e=1;if(p.get()=="CSS")e=a.patch.cgl.pixelDensity;r.set(d.canvasWidth/e);i.set(d.canvasHeight/e)}if(CABLES.now()-h>1e3){CGL.fpsReport=CGL.fpsReport||[];if(a.patch.loading.getProgress()>=1&&h!==0)CGL.fpsReport.push(f);f=0;h=CABLES.now()}CGL.MESH.lastShader=null;CGL.MESH.lastMesh=null;d.renderStart(d,b,v);if(l.get()){d.gl.clearColor(0,0,0,1);d.gl.clear(d.gl.COLOR_BUFFER_BIT|d.gl.DEPTH_BUFFER_BIT)}n.trigger();if(CGL.MESH.lastMesh)CGL.MESH.lastMesh.unBind();if(CGL.Texture.previewTexture){if(!CGL.Texture.texturePreviewer)CGL.Texture.texturePreviewer=new CGL.Texture.texturePreview(d);CGL.Texture.texturePreviewer.render(CGL.Texture.previewTexture)}d.renderEnd(d);if(u.get()){d.gl.clearColor(1,1,1,1);d.gl.colorMask(false,false,false,true);d.gl.clear(d.gl.COLOR_BUFFER_BIT);d.gl.colorMask(true,true,true,true)}if(!d.frameStore.phong)d.frameStore.phong={};f++;a.patch.cgl.profileData.profileMainloopMs=performance.now()-t}};Ops.Gl.MainLoop.prototype=new CABLES.Op;CABLES.OPS["b0472a1d-db16-4ba6-8787-f300fbdc77bb"]={f:Ops.Gl.MainLoop,objName:"Ops.Gl.MainLoop"};Ops.Gl.RenderGeometry=function(){CABLES.Op.apply(this,arguments);const t=this;const e={};const n=t.inTrigger("render"),a=t.inObject("Geometry",null,"geometry"),r=t.inValueBool("Update All",true),i=t.inValueBool("Update Face Indices",false),o=t.inValueBool("Update Vertices",false),s=t.inValueBool("Update Texcoords",false),l=t.inValueBool("Vertex Numbers",true),u=t.outTrigger("trigger");a.ignoreValueSerialize=true;l.onChange=a.onChange=c;let m=null;n.onTriggered=function(){if(m)m.render(t.patch.cgl.getShader());u.trigger()};function c(){const e=a.get();if(e&&e instanceof CGL.Geometry){if(m){m.dispose();m=null}if(!m){m=new CGL.Mesh(t.patch.cgl,e);m.addVertexNumbers=l.get();m.setGeom(e)}if(i.get()||r.get())m.setVertexIndices(e.verticesIndices);if(s.get()||r.get())m.updateTexCoords(e);if(o.get()||r.get())m.updateVertices(e);m.addVertexNumbers=l.get();if(r.get()){if(e.hasOwnProperty("tangents")&&e.tangents&&e.tangents.length>0)m.setAttribute("attrTangent",e.tangents,3);if(e.hasOwnProperty("biTangents")&&e.biTangents&&e.biTangents.length>0)m.setAttribute("attrBiTangent",e.biTangents,3)}}else{m=null}}};Ops.Gl.RenderGeometry.prototype=new CABLES.Op;CABLES.OPS["40fa6f13-ee0e-4386-a86b-711e1fbcf1bc"]={f:Ops.Gl.RenderGeometry,objName:"Ops.Gl.RenderGeometry"};Ops.Sequence=function(){CABLES.Op.apply(this,arguments);const i=this;const e={};const t=i.inTrigger("exe"),n=i.inTriggerButton("Clean up connections");const a=[],o=[],r=16;let s=null;t.onTriggered=u;n.onTriggered=m;n.setUiAttribs({hidePort:true});n.setUiAttribs({hideParam:true});for(let t=0;t<r;t++){const c=i.outTrigger("trigger "+t);o.push(c);c.onLinkChanged=l;if(t<r-1){let e=i.inTrigger("exe "+t);e.onTriggered=u;a.push(e)}}function l(){clearTimeout(s);s=setTimeout(()=>{let t=false;for(let e=0;e<o.length;e++)if(o[e].links.length>1)t=true;n.setUiAttribs({hideParam:!t});if(i.isCurrentUiOp())i.refreshParams()},60)}function u(){for(let e=0;e<o.length;e++)o[e].trigger()}function m(){let a=0;for(let n=0;n<o.length;n++){let t=[];if(o[n].links.length>1)for(let e=1;e<o[n].links.length;e++){while(o[a].links.length>0)a++;t.push(o[n].links[e]);const r=o[n].links[e].getOtherPort(o[n]);i.patch.link(i,"trigger "+a,r.parent,r.name);a++}for(let e=0;e<t.length;e++)t[e].remove()}l()}};Ops.Sequence.prototype=new CABLES.Op;CABLES.OPS["a466bc1f-06e9-4595-8849-bffb9fe22f99"]={f:Ops.Sequence,objName:"Ops.Sequence"};Ops.Gl.Matrix.OrbitControls=function(){CABLES.Op.apply(this,arguments);const t=this;const e={};const n=t.inTrigger("render"),i=t.inValueFloat("min distance"),o=t.inValueFloat("max distance"),a=t.inValue("min rot y",0),r=t.inValue("max rot y",0),s=t.inValue("initial radius",0),l=t.inValueSlider("initial axis y"),u=t.inValueSlider("initial axis x"),m=t.inValueFloat("mul"),c=t.inValueSlider("Smoothness",1),g=t.inValue("Speed X",1),p=t.inValue("Speed Y",1),d=t.inValueBool("Active",true),f=t.inValueBool("Allow Panning",true),h=t.inValueBool("Allow Zooming",true),b=t.inValueBool("Allow Rotation",true),v=t.inValueBool("restricted",true),O=t.outTrigger("trigger"),T=t.outValue("radius"),I=t.outValue("Rot X"),_=t.outValue("Rot Y"),x=t.inTriggerButton("Reset");t.setPortGroup("Initial Values",[l,u,s]);t.setPortGroup("Interaction",[m,c,g,p]);t.setPortGroup("Boundaries",[a,r,i,o]);m.set(1);i.set(.05);o.set(99999);x.onTriggered=Z;const E=t.patch.cgl;let S=vec3.create();const A=vec3.create();const C=vec3.create();const L=mat4.create();const N=mat4.create();const P=vec3.create();const M=vec3.create();l.set(.5);let y=false;let j=5;T.set(j);let G=0,R=0;let w=0,U=0;vec3.set(C,0,0,0);vec3.set(A,0,1,0);const B=vec3.create();const D=vec3.create();const k=vec3.create();const V=vec3.create();let F=0;let z=0;let X=1;let H=null;J();t.onDelete=pe;const Y=Math.PI;const W=Math.PI*2;function Z(){let e=0;if(F%W<-Y){e=-W;F%=-W}else if(F%W>Y){e=W;F%=W}else F%=W;z%=Math.PI;vec3.set(P,0,0,0);vec3.set(C,0,0,0);vec3.set(A,0,1,0);w=u.get()*Math.PI*2+e;U=l.get()-.5;j=s.get();S=te(U)}function J(){X=c.get()*10+1}c.onChange=J;let K=true;function q(e,t){if(K)return t;return e+(t-e)/X}let Q=0;const $=0;n.onTriggered=function(){E.pushViewMatrix();F=q(F,w);z=q(z,U);let e=(z+.5)*180;if(a.get()!==0&&e<a.get()){e=a.get();z=Q}else if(r.get()!==0&&e>r.get()){e=r.get();z=Q}else{Q=z}const t=F*CGL.RAD2DEG;_.set(e);I.set(t);ee(S,z);vec3.add(B,S,P);vec3.add(k,C,P);D[0]=q(D[0],B[0]);D[1]=q(D[1],B[1]);D[2]=q(D[2],B[2]);V[0]=q(V[0],k[0]);V[1]=q(V[1],k[1]);V[2]=q(V[2],k[2]);const n=vec3.create();mat4.lookAt(L,D,V,A);mat4.rotate(L,L,F,A);mat4.multiply(E.vMatrix,E.vMatrix,L);O.trigger();E.popViewMatrix();K=false};function ee(e,t){const n=m.get();if(j<i.get()*n)j=i.get()*n;if(j>o.get()*n)j=o.get()*n;T.set(j*n);let a=0,r=0;r=360*t/2*CGL.DEG2RAD;vec3.set(e,Math.cos(r)*j*n,Math.sin(r)*j*n,0);return e}function te(e){const t=m.get();if(j<i.get()*t)j=i.get()*t;if(j>o.get()*t)j=o.get()*t;T.set(j*t);let n=0,a=0;const r=vec3.create();a=360*e/2*CGL.DEG2RAD;vec3.set(r,Math.cos(a)*j*t,Math.sin(a)*j*t,0);return r}function ne(e){if(!y)return;const t=e.clientX;const n=e.clientY;let a=t-G;let r=n-R;a*=g.get();r*=p.get();if(e.buttons==2&&f.get()){P[2]+=a*.01*m.get();P[1]+=r*.01*m.get()}else if(e.buttons==4&&h.get()){j+=r*.05;S=te(U)}else{if(b.get()){w+=a*.003;U+=r*.002;if(v.get()){if(U>.5)U=.5;if(U<-.5)U=-.5}}}G=t;R=n}function ae(e){G=e.clientX;R=e.clientY;y=true;try{H.setPointerCapture(e.pointerId)}catch(e){}}function re(e){y=false;try{H.releasePointerCapture(e.pointerId)}catch(e){}}function ie(){const e=t.patch.cgl.canvas;if(document.pointerLockElement===e||document.mozPointerLockElement===e||document.webkitPointerLockElement===e){document.addEventListener("mousemove",ne,false)}}function oe(e){}s.onChange=function(){j=s.get();Z()};u.onChange=function(){F=w=u.get()*Math.PI*2};l.onChange=function(){z=U=l.get()-.5;S=te(U)};const se=function(e){if(h.get()){const t=CGL.getWheelSpeed(e)*.06;j+=parseFloat(t)*1.2;S=te(U)}};const le=function(e){if(e.touches&&e.touches.length>0)ae(e.touches[0])};const ue=function(e){re()};const me=function(e){if(e.touches&&e.touches.length>0)ne(e.touches[0])};d.onChange=function(){if(d.get())ge();else pe()};function ce(e){pe();H=e;ge()}function ge(){H.addEventListener("pointermove",ne);H.addEventListener("pointerdown",ae);H.addEventListener("pointerup",re);H.addEventListener("pointerleave",re);H.addEventListener("pointerenter",oe);H.addEventListener("contextmenu",function(e){e.preventDefault()});H.addEventListener("wheel",se,{passive:true})}function pe(){if(!H)return;H.removeEventListener("pointermove",ne);H.removeEventListener("pointerdown",ae);H.removeEventListener("pointerup",re);H.removeEventListener("pointerleave",re);H.removeEventListener("pointerenter",re);H.removeEventListener("wheel",se)}S=te(0);ce(E.canvas);ge();u.set(.25);s.set(.05)};Ops.Gl.Matrix.OrbitControls.prototype=new CABLES.Op;CABLES.OPS["eaf4f7ce-08a3-4d1b-b9f4-ebc0b7b1cde1"]={f:Ops.Gl.Matrix.OrbitControls,objName:"Ops.Gl.Matrix.OrbitControls"};Ops.Gl.ClearColor=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};const n=e.inTrigger("render"),a=e.outTrigger("trigger"),r=e.inFloatSlider("r",.1),i=e.inFloatSlider("g",.1),o=e.inFloatSlider("b",.1),s=e.inFloatSlider("a",1);r.setUiAttribs({colorPick:true});const l=e.patch.cgl;n.onTriggered=function(){l.gl.clearColor(r.get(),i.get(),o.get(),s.get());l.gl.clear(l.gl.COLOR_BUFFER_BIT|l.gl.DEPTH_BUFFER_BIT);a.trigger()}};Ops.Gl.ClearColor.prototype=new CABLES.Op;CABLES.OPS["19b441eb-9f63-4f35-ba08-b87841517c4d"]={f:Ops.Gl.ClearColor,objName:"Ops.Gl.ClearColor"};Ops.Gl.Matrix.Transform=function(){CABLES.Op.apply(this,arguments);const t=this;const e={};const n=t.inTrigger("render"),a=t.inValue("posX",0),r=t.inValue("posY",0),i=t.inValue("posZ",0),o=t.inValue("scale",1),s=t.inValue("rotX",0),l=t.inValue("rotY",0),u=t.inValue("rotZ",0),m=t.outTrigger("trigger");t.setPortGroup("Rotation",[s,l,u]);t.setPortGroup("Position",[a,r,i]);t.setPortGroup("Scale",[o]);t.setUiAxisPorts(a,r,i);const c=t.patch.cgl;const g=vec3.create();const p=vec3.create();const d=mat4.create();mat4.identity(d);let f=false,h=false,b=true,v=true,O=true;s.onChange=l.onChange=u.onChange=S;a.onChange=r.onChange=i.onChange=x;o.onChange=E;n.onTriggered=function(){let e=false;if(b){I();e=true}if(v){_();e=true}if(O)e=true;if(e)T();c.pushModelMatrix();mat4.multiply(c.mMatrix,c.mMatrix,d);m.trigger();c.popModelMatrix();if(CABLES.UI&&CABLES.UI.showCanvasTransforms)gui.setTransform(t.id,a.get(),r.get(),i.get());if(t.isCurrentUiOp())gui.setTransformGizmo({posX:a,posY:r,posZ:i})};t.transform3d=function(){return{pos:[a,r,i]}};function T(){mat4.identity(d);if(h)mat4.translate(d,d,g);if(s.get()!==0)mat4.rotateX(d,d,s.get()*CGL.DEG2RAD);if(l.get()!==0)mat4.rotateY(d,d,l.get()*CGL.DEG2RAD);if(u.get()!==0)mat4.rotateZ(d,d,u.get()*CGL.DEG2RAD);if(f)mat4.scale(d,d,p);O=false}function I(){h=false;if(a.get()!==0||r.get()!==0||i.get()!==0)h=true;vec3.set(g,a.get(),r.get(),i.get());b=false}function _(){f=true;vec3.set(p,o.get(),o.get(),o.get());v=false}function x(){b=true}function E(){v=true}function S(){O=true}T()};Ops.Gl.Matrix.Transform.prototype=new CABLES.Op;CABLES.OPS["650baeb1-db2d-4781-9af6-ab4e9d4277be"]={f:Ops.Gl.Matrix.Transform,objName:"Ops.Gl.Matrix.Transform"};Ops.Trigger.RouteTrigger=function(){CABLES.Op.apply(this,arguments);const t=this;const e={};const n=24;const a=t.inTriggerButton("Execute");const r=t.inValueInt("Switch Value");const i=t.outTrigger("Next Trigger");const o=t.outValue("Switched Value");const s=[];for(let e=0;e<n;e++){s[e]=t.outTrigger("Trigger "+e)}const l=t.outTrigger("Default Trigger");function u(){const e=Math.round(r.get());if(e>=0&&e<n){o.set(e);s[e].trigger()}else{o.set(-1);l.trigger()}i.trigger()}a.onTriggered=u};Ops.Trigger.RouteTrigger.prototype=new CABLES.Op;CABLES.OPS["44ceb5d8-b040-4722-b189-a6fb8172517d"]={f:Ops.Trigger.RouteTrigger,objName:"Ops.Trigger.RouteTrigger"};Ops.Gl.Matrix.TransformView=function(){CABLES.Op.apply(this,arguments);const t=this;const e={};const n=t.inTrigger("render"),a=t.inValueFloat("posX"),r=t.inValueFloat("posY"),i=t.inValueFloat("posZ"),o=t.inValueFloat("scale"),s=t.inValueFloat("rotX"),l=t.inValueFloat("rotY"),u=t.inValueFloat("rotZ"),m=t.outTrigger("trigger");t.setPortGroup("Position",[a,r,i]);t.setPortGroup("Scale",[o]);t.setPortGroup("Rotation",[s,u,l]);const c=t.patch.cgl;const g=vec3.create();const p=vec3.create();const d=mat4.create();mat4.identity(d);let f=false;let h=false;let b=true;var v=true;var O=true;n.onTriggered=function(){let e=false;if(b){I();e=true}if(v){_();e=true}if(O){e=true}if(e)T();c.pushViewMatrix();mat4.multiply(c.vMatrix,c.vMatrix,d);m.trigger();c.popViewMatrix();if(t.isCurrentUiOp())gui.setTransformGizmo({posX:a,posY:r,posZ:i})};t.transform3d=function(){return{pos:[a,r,i]}};var T=function(){mat4.identity(d);if(h)mat4.translate(d,d,g);if(s.get()!==0)mat4.rotateX(d,d,s.get()*CGL.DEG2RAD);if(l.get()!==0)mat4.rotateY(d,d,l.get()*CGL.DEG2RAD);if(u.get()!==0)mat4.rotateZ(d,d,u.get()*CGL.DEG2RAD);if(f)mat4.scale(d,d,p);O=false};function I(){h=false;if(a.get()!==0||r.get()!==0||i.get()!==0)h=true;vec3.set(g,a.get(),r.get(),i.get());b=false}function _(){f=false;if(o.get()!==0)f=true;vec3.set(p,o.get(),o.get(),o.get());v=false}const x=function(){b=true};var v=function(){v=true};var O=function(){O=true};s.onChange=O;l.onChange=O;u.onChange=O;o.onChange=v;a.onChange=x;r.onChange=x;i.onChange=x;s.set(0);l.set(0);u.set(0);o.set(1);a.set(0);r.set(0);i.set(0);T()};Ops.Gl.Matrix.TransformView.prototype=new CABLES.Op;CABLES.OPS["0b3e04f7-323e-4ac8-8a22-a21e2f36e0e9"]={f:Ops.Gl.Matrix.TransformView,objName:"Ops.Gl.Matrix.TransformView"};Ops.Gl.Meshes.Grid=function(){CABLES.Op.apply(this,arguments);const l=this;const e={};const t=l.inTrigger("Render"),u=l.inValue("Num",10),m=l.inValue("Spacing",1),c=l.inBool("Center",true),n=l.outTrigger("Next");const g=l.patch.cgl;let p=null;c.onChange=u.onChange=m.onChange=function(){if(p)p.dispose();p=null};function a(){const t=new CGL.Geometry(l.name);const e=new CGL.Geometry(l.name);const n=m.get();const a=Math.floor(u.get());const r=n*a/2;const i=[];let o=-a/2;let s=a/2+1;for(let e=o;e<s;e++){t.vertices.push(-r);t.vertices.push(e*n);t.vertices.push(0);t.vertices.push(r);t.vertices.push(e*n);t.vertices.push(0);t.vertices.push(e*n);t.vertices.push(-r);t.vertices.push(0);t.vertices.push(e*n);t.vertices.push(r);t.vertices.push(0);i.push(0,0);i.push(0,0);i.push(0,0);i.push(0,0)}if(!c.get()){for(let e=0;e<t.vertices.length;e+=3){t.vertices[e+0]+=r;t.vertices[e+1]+=r}}t.setTexCoords(i);t.calculateNormals();if(!p)p=new CGL.Mesh(g,t);else p.setGeom(t)}t.onTriggered=function(){if(!p)a();let e=g.getShader();if(!e)return;let t=e.glPrimitive;e.glPrimitive=g.gl.LINES;p.render(e);e.glPrimitive=t;n.trigger()}};Ops.Gl.Meshes.Grid.prototype=new CABLES.Op;CABLES.OPS["677a7c03-6885-46b4-8a64-e4ea54ee5d7f"]={f:Ops.Gl.Meshes.Grid,objName:"Ops.Gl.Meshes.Grid"};Ops.Gl.Shader.PointMaterial_v4=function(){CABLES.Op.apply(this,arguments);const e=this;const t={pointmat_frag:"\n{{MODULES_HEAD}}\n\nUNI vec4 color;\n// IN vec2 pointCoord;\nIN float ps;\n\n#ifdef HAS_TEXTURE_DIFFUSE\n    UNI sampler2D diffTex;\n#endif\n#ifdef HAS_TEXTURE_MASK\n    UNI sampler2D texMask;\n#endif\n#ifdef HAS_TEXTURE_COLORIZE\n    IN vec4 colorize;\n#endif\n#ifdef HAS_TEXTURE_OPACITY\n    IN float opacity;\n#endif\n#ifdef VERTEX_COLORS\n    IN vec4 vertexColor;\n#endif\n\nvoid main()\n{\n    #ifdef FLIP_TEX\n        vec2 pointCoord=vec2(gl_PointCoord.x,(1.0-gl_PointCoord.y));\n    #endif\n    #ifndef FLIP_TEX\n        vec2 pointCoord=gl_PointCoord;\n    #endif\n    {{MODULE_BEGIN_FRAG}}\n\n    if(ps<1.0)discard;\n\n    vec4 col=color;\n\n    #ifdef HAS_TEXTURE_MASK\n        float mask;\n        #ifdef TEXTURE_MASK_R\n            mask=texture(texMask,pointCoord).r;\n        #endif\n        #ifdef TEXTURE_MASK_A\n            mask=texture(texMask,pointCoord).a;\n        #endif\n        #ifdef TEXTURE_MASK_LUMI\n        \tvec3 lumcoeff = vec3(0.299,0.587,0.114);\n        \tmask = dot(texture(texMask,pointCoord).rgb, lumcoeff);\n        #endif\n\n    #endif\n\n    #ifdef HAS_TEXTURE_DIFFUSE\n        col=texture(diffTex,pointCoord);\n        #ifdef COLORIZE_TEXTURE\n          col.rgb*=color.rgb;\n        #endif\n    #endif\n    col.a*=color.a;\n\n    {{MODULE_COLOR}}\n\n    #ifdef MAKE_ROUND\n\n        #ifndef MAKE_ROUNDAA\n            if ((gl_PointCoord.x-0.5)*(gl_PointCoord.x-0.5) + (gl_PointCoord.y-0.5)*(gl_PointCoord.y-0.5) > 0.25) discard; //col.a=0.0;\n        #endif\n\n        #ifdef MAKE_ROUNDAA\n            float circ=(gl_PointCoord.x-0.5)*(gl_PointCoord.x-0.5) + (gl_PointCoord.y-0.5)*(gl_PointCoord.y-0.5);\n\n            float a=smoothstep(0.25,0.25-fwidth(gl_PointCoord.x),circ);\n            if(a==0.0)discard;\n            col.a=a*color.a;\n        #endif\n    #endif\n\n    #ifdef HAS_TEXTURE_COLORIZE\n        col*=colorize;\n    #endif\n\n    #ifdef TEXTURE_COLORIZE_MUL\n        col*=color;\n    #endif\n\n    #ifdef HAS_TEXTURE_MASK\n        col.a*=mask;\n    #endif\n\n    #ifdef HAS_TEXTURE_OPACITY\n        col.a*=opacity;\n    #endif\n\n    #ifdef VERTEX_COLORS\n        col.rgb = vertexColor.rgb;\n        col.a *= vertexColor.a;\n    #endif\n\n    if (col.a <= 0.0) discard;\n\n    #ifdef HAS_TEXTURE_COLORIZE\n        col*=colorize;\n    #endif\n\n    outColor = col;\n}\n",pointmat_vert:"{{MODULES_HEAD}}\nIN vec3 vPosition;\nIN vec2 attrTexCoord;\nIN vec3 attrVertNormal;\nIN vec3 attrTangent;\nIN vec3 attrBiTangent;\n\n#ifdef VERTEX_COLORS\n    IN vec4 attrVertColor;\n    OUT vec4 vertexColor;\n#endif\n\nOUT vec3 norm;\nOUT float ps;\n\nOUT vec2 texCoord;\n\n\n#ifdef HAS_TEXTURES\n#endif\n\n#ifdef HAS_TEXTURE_COLORIZE\n   UNI sampler2D texColorize;\n   OUT vec4 colorize;\n#endif\n#ifdef HAS_TEXTURE_OPACITY\n    UNI sampler2D texOpacity;\n    OUT float opacity;\n#endif\n\n#ifdef HAS_TEXTURE_POINTSIZE\n   UNI sampler2D texPointSize;\n   UNI float texPointSizeMul;\n#endif\n\nUNI mat4 projMatrix;\nUNI mat4 modelMatrix;\nUNI mat4 viewMatrix;\n\nUNI float pointSize;\nUNI vec3 camPos;\n\nUNI float canvasWidth;\nUNI float canvasHeight;\nUNI float camDistMul;\nUNI float randomSize;\n\nIN float attrVertIndex;\n\n\n\nfloat rand(float n){return fract(sin(n) * 5711.5711123);}\n\n#define POINTMATERIAL\n\nvoid main()\n{\n    norm=attrVertNormal;\n    #ifdef PIXELSIZE\n        float psMul=1.0;\n    #endif\n\n    #ifndef PIXELSIZE\n        float psMul=sqrt(canvasWidth/canvasHeight)+0.00000000001;\n    #endif\n\n    // float sizeMultiply=1.0;\n\n    vec3 tangent=attrTangent;\n    vec3 bitangent=attrBiTangent;\n\n\n    #ifdef VERTEX_COLORS\n        vertexColor=attrVertColor;\n    #endif\n\n    // #ifdef HAS_TEXTURES\n        texCoord=attrTexCoord;\n    // #endif\n\n    #ifdef HAS_TEXTURE_OPACITY\n        // opacity=texture(texOpacity,vec2(rand(attrVertIndex+texCoord.x*texCoord.y+texCoord.y+texCoord.x),rand(texCoord.y*texCoord.x-texCoord.x-texCoord.y-attrVertIndex))).r;\n        opacity=texture(texOpacity,texCoord).r;\n    #endif\n\n\n    #ifdef HAS_TEXTURE_COLORIZE\n        #ifdef RANDOM_COLORIZE\n            colorize=texture(texColorize,vec2(rand(attrVertIndex+texCoord.x*texCoord.y+texCoord.y+texCoord.x),rand(texCoord.y*texCoord.x-texCoord.x-texCoord.y-attrVertIndex)));\n        #endif\n        #ifndef RANDOM_COLORIZE\n            colorize=texture(texColorize,texCoord);\n        #endif\n    #endif\n\n\n\n\n\n    mat4 mMatrix=modelMatrix;\n    vec4 pos = vec4( vPosition, 1. );\n\n    gl_PointSize=0.0;\n\n    {{MODULE_VERTEX_POSITION}}\n\n    vec4 model=mMatrix * pos;\n\n    psMul+=rand(texCoord.x*texCoord.y+texCoord.y*3.0+texCoord.x*2.0+attrVertIndex)*randomSize;\n    // psMul*=sizeMultiply;\n\n    float addPointSize=0.0;\n    #ifdef HAS_TEXTURE_POINTSIZE\n\n        #ifdef POINTSIZE_CHAN_R\n            addPointSize=texture(texPointSize,texCoord).r;\n        #endif\n        #ifdef POINTSIZE_CHAN_G\n            addPointSize=texture(texPointSize,texCoord).g;\n        #endif\n        #ifdef POINTSIZE_CHAN_B\n            addPointSize=texture(texPointSize,texCoord).b;\n        #endif\n\n\n        #ifdef DOTSIZEREMAPABS\n            // addPointSize=(( (texture(texPointSize,texCoord).r) * texPointSizeMul)-0.5)*2.0;\n\n            addPointSize=1.0-(distance(addPointSize,0.5)*2.0);\n            // addPointSize=abs(1.0-(distance(addPointSize,0.5)*2.0));\n            addPointSize=addPointSize*addPointSize*addPointSize*2.0;\n\n            // addPointSize=(( (texture(texPointSize,texCoord).r) * texPointSizeMul)-0.5)*2.0;\n        #endif\n\n        addPointSize*=texPointSizeMul;\n\n    #endif\n\n    ps=0.0;\n    #ifndef SCALE_BY_DISTANCE\n        ps = (pointSize+addPointSize) * psMul;\n    #endif\n    #ifdef SCALE_BY_DISTANCE\n        float cameraDist = distance(model.xyz, camPos);\n        ps = ( (pointSize+addPointSize) / cameraDist) * psMul;\n    #endif\n\n    gl_PointSize += ps;\n\n\n    gl_Position = projMatrix * viewMatrix * model;\n}\n"};const n=e.patch.cgl;const a=e.inTrigger("render"),r=e.inValueFloat("PointSize",3),i=e.inBool("Size in Pixels",false),o=e.inValue("Random Size",0),s=e.inValueBool("Round",true),l=e.inValueBool("Round Antialias",false),u=e.inValueBool("Scale by Distance",false),m=e.inValueSlider("r",Math.random()),c=e.inValueSlider("g",Math.random()),g=e.inValueSlider("b",Math.random()),p=e.inValueSlider("a",1),d=e.inBool("Vertex Colors",false),f=e.inTexture("texture"),h=e.inBool("Colorize Texture"),b=e.inTexture("Texture Mask"),v=e.inSwitch("Mask Channel",["R","A","Luminance"],"R"),O=e.inTexture("Texture Colorize"),T=e.inValueBool("Colorize Randomize",true),I=e.inTexture("Texture Opacity"),_=e.inTexture("Texture Point Size"),x=e.inSwitch("Point Size Channel",["R","G","B"],"R"),E=e.inFloat("Texture Point Size Mul",1),S=e.inSwitch("Map Size 0",["Black","Grey"],"Black"),A=e.inValueBool("Flip Texture",false),C=e.outTrigger("trigger"),L=e.outObject("shader",null,"shader");e.setPortGroup("Texture",[f,h,b,v,O,I,T]);e.setPortGroup("Color",[m,c,g,p,d]);e.setPortGroup("Size",[r,o,s,l,u,i,_,E,x,S]);m.setUiAttribs({colorPick:true});const N=new CGL.Shader(n,"PointMaterial");N.setModules(["MODULE_VERTEX_POSITION","MODULE_COLOR","MODULE_BEGIN_FRAG"]);N.define("MAKE_ROUND");const P=new CGL.Uniform(N,"f","pointSize",r),M=new CGL.Uniform(N,"f","texPointSizeMul",E),y=new CGL.Uniform(N,"f","randomSize",o),j=new CGL.Uniform(N,"4f","color",m,c,g,p),G=new CGL.Uniform(N,"f","canvasWidth",n.canvasWidth),R=new CGL.Uniform(N,"f","canvasHeight",n.canvasHeight),w=new CGL.Uniform(N,"t","diffTex"),U=new CGL.Uniform(N,"t","texColorize"),B=new CGL.Uniform(N,"t","texOpacity"),D=new CGL.Uniform(N,"t","texPointSize"),k=new CGL.Uniform(N,"t","texPointSize"),V=new CGL.Uniform(N,"t","texMask");N.setSource(t.pointmat_vert,t.pointmat_frag);N.glPrimitive=n.gl.POINTS;L.set(N);L.ignoreValueSerialize=true;a.onTriggered=F;u.onChange=s.onChange=l.onChange=f.onChange=O.onChange=b.onChange=T.onChange=A.onChange=v.onChange=i.onChange=I.onChange=_.onChange=S.onChange=x.onChange=h.onChange=d.onChange=X;z();e.preRender=function(){if(N)N.bind();F()};function F(){G.setValue(n.canvasWidth);R.setValue(n.canvasHeight);n.pushShader(N);N.popTextures();if(f.get()&&!f.get().deleted)N.pushTexture(w,f.get());if(b.get())N.pushTexture(V,b.get());if(O.get())N.pushTexture(U,O.get());if(I.get())N.pushTexture(B,I.get());if(_.get())N.pushTexture(k,_.get());C.trigger();n.popShader()}function z(){v.setUiAttribs({greyout:!b.isLinked()});x.setUiAttribs({greyout:!_.isLinked()});E.setUiAttribs({greyout:!_.isLinked()});S.setUiAttribs({greyout:!_.isLinked()})}function X(){N.toggleDefine("SCALE_BY_DISTANCE",u.get());N.toggleDefine("MAKE_ROUND",s.get());N.toggleDefine("MAKE_ROUNDAA",l.get());N.toggleDefine("VERTEX_COLORS",d.get());N.toggleDefine("RANDOM_COLORIZE",T.get());N.toggleDefine("HAS_TEXTURE_DIFFUSE",f.get());N.toggleDefine("HAS_TEXTURE_MASK",b.get());N.toggleDefine("HAS_TEXTURE_COLORIZE",O.get());N.toggleDefine("HAS_TEXTURE_OPACITY",I.get());N.toggleDefine("HAS_TEXTURE_POINTSIZE",_.get());N.toggleDefine("TEXTURE_COLORIZE_MUL",h.get());N.toggleDefine("FLIP_TEX",A.get());N.toggleDefine("TEXTURE_MASK_R",v.get()=="R");N.toggleDefine("TEXTURE_MASK_A",v.get()=="A");N.toggleDefine("TEXTURE_MASK_LUMI",v.get()=="Luminance");N.toggleDefine("PIXELSIZE",i.get());N.toggleDefine("POINTSIZE_CHAN_R",x.get()=="R");N.toggleDefine("POINTSIZE_CHAN_G",x.get()=="G");N.toggleDefine("POINTSIZE_CHAN_B",x.get()=="B");N.toggleDefine("DOTSIZEREMAPABS",S.get()=="Grey");z()}};Ops.Gl.Shader.PointMaterial_v4.prototype=new CABLES.Op;CABLES.OPS["a7cb5d1c-cd4a-4c28-bb13-7bb9bda187ed"]={f:Ops.Gl.Shader.PointMaterial_v4,objName:"Ops.Gl.Shader.PointMaterial_v4"};Ops.Gl.Phong.PhongMaterial_v6=function(){CABLES.Op.apply(this,arguments);const e=this;const s={phong_frag:'IN vec3 viewDirection;\nIN vec3 normInterpolated;\nIN vec2 texCoord;\n\n#ifdef ENABLE_FRESNEL\n    IN vec4 cameraSpace_pos;\n#endif\n\n// IN mat3 normalMatrix; // when instancing...\n\n#ifdef HAS_TEXTURE_NORMAL\n    IN mat3 TBN_Matrix; // tangent bitangent normal space transform matrix\n#endif\n\nIN vec3 fragPos;\nIN vec3 v_viewDirection;\n\nUNI vec4 inDiffuseColor;\nUNI vec4 inMaterialProperties;\n\n#ifdef ADD_EMISSIVE_COLOR\n    UNI vec4 inEmissiveColor; // .w = intensity\n#endif\n\n#ifdef ENABLE_FRESNEL\n    UNI mat4 viewMatrix;\n    UNI vec4 inFresnel;\n    UNI vec2 inFresnelWidthExponent;\n#endif\n\n#ifdef ENVMAP_MATCAP\n    IN vec3 viewSpaceNormal;\n    IN vec3 viewSpacePosition;\n#endif\n\nstruct Light {\n    vec3 color;\n    vec3 position;\n    vec3 specular;\n\n\n    // * SPOT LIGHT * //\n    #ifdef HAS_SPOT\n        vec3 conePointAt;\n        #define COSCONEANGLE x\n        #define COSCONEANGLEINNER y\n        #define SPOTEXPONENT z\n        vec3 spotProperties;\n    #endif\n\n    #define INTENSITY x\n    #define ATTENUATION y\n    #define FALLOFF z\n    #define RADIUS w\n    vec4 lightProperties;\n\n    int castLight;\n};\n\n/* CONSTANTS */\n#define NONE -1\n#define ALBEDO x\n#define ROUGHNESS y\n#define SHININESS z\n#define SPECULAR_AMT w\n#define NORMAL x\n#define AO y\n#define SPECULAR z\n#define EMISSIVE w\nconst float PI = 3.1415926535897932384626433832795;\nconst float TWO_PI = (2. * PI);\nconst float EIGHT_PI = (8. * PI);\n\n#define RECIPROCAL_PI 1./PI\n#define RECIPROCAL_PI2 RECIPROCAL_PI/2.\n\n// TEXTURES\n// #ifdef HAS_TEXTURES\n    UNI vec4 inTextureIntensities;\n\n    #ifdef HAS_TEXTURE_ENV\n        #ifdef TEX_FORMAT_CUBEMAP\n            UNI samplerCube texEnv;\n            #ifndef WEBGL1\n                #define SAMPLETEX textureLod\n            #endif\n            #ifdef WEBGL1\n                #define SAMPLETEX textureCubeLodEXT\n            #endif\n        #endif\n\n        #ifdef TEX_FORMAT_EQUIRECT\n            UNI sampler2D texEnv;\n            #ifdef WEBGL1\n                // #extension GL_EXT_shader_texture_lod : enable\n                #ifdef GL_EXT_shader_texture_lod\n                    #define textureLod texture2DLodEXT\n                #endif\n                // #define textureLod texture2D\n            #endif\n\n            #define SAMPLETEX sampleEquirect\n\n            const vec2 invAtan = vec2(0.1591, 0.3183);\n            vec4 sampleEquirect(sampler2D tex,vec3 direction,float lod)\n            {\n                #ifndef WEBGL1\n                    vec3 newDirection = normalize(direction);\n            \t\tvec2 sampleUV;\n            \t\tsampleUV.x = -1. * (atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.75);\n            \t\tsampleUV.y = asin( clamp(direction.y, -1., 1.) ) * RECIPROCAL_PI + 0.5;\n                #endif\n\n                #ifdef WEBGL1\n                    vec3 newDirection = normalize(direction);\n                \t\tvec2 sampleUV = vec2(atan(newDirection.z, newDirection.x), asin(newDirection.y+1e-6));\n                        sampleUV *= vec2(0.1591, 0.3183);\n                        sampleUV += 0.5;\n                #endif\n                return textureLod(tex, sampleUV, lod);\n            }\n        #endif\n        #ifdef ENVMAP_MATCAP\n            UNI sampler2D texEnv;\n            #ifdef WEBGL1\n                // #extension GL_EXT_shader_texture_lod : enable\n                #ifdef GL_EXT_shader_texture_lod\n                    #define textureLod texture2DLodEXT\n                #endif\n                // #define textureLod texture2D\n            #endif\n\n\n            // * taken & modified from https://github.com/mrdoob/three.js/blob/dev/src/renderers/shaders/ShaderLib/meshmatcap_frag.glsl.js\n            vec2 getMatCapUV(vec3 viewSpacePosition, vec3 viewSpaceNormal) {\n                vec3 viewDir = normalize(-viewSpacePosition);\n            \tvec3 x = normalize(vec3(viewDir.z, 0.0, - viewDir.x));\n            \tvec3 y = normalize(cross(viewDir, x));\n            \tvec2 uv = vec2(dot(x, viewSpaceNormal), dot(y, viewSpaceNormal)) * 0.495 + 0.5; // 0.495 to remove artifacts caused by undersized matcap disks\n            \treturn uv;\n            }\n        #endif\n\n        UNI float inEnvMapIntensity;\n        UNI float inEnvMapWidth;\n    #endif\n\n    #ifdef HAS_TEXTURE_LUMINANCE_MASK\n        UNI sampler2D texLuminance;\n        UNI float inLuminanceMaskIntensity;\n    #endif\n\n    #ifdef HAS_TEXTURE_DIFFUSE\n        UNI sampler2D texDiffuse;\n    #endif\n\n    #ifdef HAS_TEXTURE_SPECULAR\n        UNI sampler2D texSpecular;\n    #endif\n\n    #ifdef HAS_TEXTURE_NORMAL\n        UNI sampler2D texNormal;\n    #endif\n\n    #ifdef HAS_TEXTURE_AO\n        UNI sampler2D texAO;\n    #endif\n\n    #ifdef HAS_TEXTURE_EMISSIVE\n        UNI sampler2D texEmissive;\n    #endif\n\n    #ifdef HAS_TEXTURE_EMISSIVE_MASK\n        UNI sampler2D texMaskEmissive;\n        UNI float inEmissiveMaskIntensity;\n    #endif\n    #ifdef HAS_TEXTURE_ALPHA\n        UNI sampler2D texAlpha;\n    #endif\n// #endif\n\n{{MODULES_HEAD}}\n\nfloat when_gt(float x, float y) { return max(sign(x - y), 0.0); } // comparator function\nfloat when_lt(float x, float y) { return max(sign(y - x), 0.0); }\nfloat when_eq(float x, float y) { return 1. - abs(sign(x - y)); } // comparator function\nfloat when_neq(float x, float y) { return abs(sign(x - y)); } // comparator function\nfloat when_ge(float x, float y) { return 1.0 - when_lt(x, y); }\nfloat when_le(float x, float y) { return 1.0 - when_gt(x, y); }\n\n#ifdef FALLOFF_MODE_A\n    float CalculateFalloff(float distance, vec3 lightDirection, float falloff, float radius) {\n        // * original falloff\n        float denom = distance / radius + 1.0;\n        float attenuation = 1.0 / (denom*denom);\n        float t = (attenuation - falloff) / (1.0 - falloff);\n        return max(t, 0.0);\n    }\n#endif\n\n#ifdef FALLOFF_MODE_B\n    float CalculateFalloff(float distance, vec3 lightDirection, float falloff, float radius) {\n        float distanceSquared = dot(lightDirection, lightDirection);\n        float factor = distanceSquared * falloff;\n        float smoothFactor = clamp(1. - factor * factor, 0., 1.);\n        float attenuation = smoothFactor * smoothFactor;\n\n        return attenuation * 1. / max(distanceSquared, 0.00001);\n    }\n#endif\n\n#ifdef FALLOFF_MODE_C\n    float CalculateFalloff(float distance, vec3 lightDirection, float falloff, float radius) {\n        // https://blog.selfshadow.com/publications/s2013-shading-course/karis/s2013_pbs_epic_notes_v2.pdf\n        float falloffNumerator = 1. - pow(distance/radius, 4.);\n        falloffNumerator = clamp(falloffNumerator, 0., 1.);\n        falloffNumerator *= falloffNumerator;\n\n        float denominator = distance*distance + falloff;\n\n        return falloffNumerator/denominator;\n    }\n#endif\n\n#ifdef FALLOFF_MODE_D\n    float CalculateFalloff(float distance, vec3 lightDirection, float falloff, float radius) {\n        // inverse square falloff, "physically correct"\n        return 1.0 / max(distance * distance, 0.0001);\n    }\n#endif\n\n#ifdef ENABLE_FRESNEL\n    float CalculateFresnel(vec3 direction, vec3 normal)\n    {\n        vec3 nDirection = normalize( direction );\n        vec3 nNormal = normalize( mat3(viewMatrix) * normal );\n        vec3 halfDirection = normalize( nNormal + nDirection );\n\n        float cosine = dot( halfDirection, nDirection );\n        float product = max( cosine, 0.0 );\n        float factor = pow(product, inFresnelWidthExponent.y);\n\n        return 5. * factor;\n    }\n#endif\n\n#ifdef CONSERVE_ENERGY\n    // http://www.rorydriscoll.com/2009/01/25/energy-conservation-in-games/\n    // http://www.farbrausch.de/~fg/articles/phong.pdf\n    float EnergyConservation(float shininess) {\n        #ifdef SPECULAR_PHONG\n            return (shininess + 2.)/TWO_PI;\n        #endif\n        #ifdef SPECULAR_BLINN\n            return (shininess + 8.)/EIGHT_PI;\n        #endif\n\n        #ifdef SPECULAR_SCHLICK\n            return (shininess + 8.)/EIGHT_PI;\n        #endif\n\n        #ifdef SPECULAR_GAUSS\n            return (shininess + 8.)/EIGHT_PI;\n        #endif\n    }\n#endif\n\n#ifdef ENABLE_OREN_NAYAR_DIFFUSE\n    float CalculateOrenNayar(vec3 lightDirection, vec3 viewDirection, vec3 normal) {\n        float LdotV = dot(lightDirection, viewDirection);\n        float NdotL = dot(lightDirection, normal);\n        float NdotV = dot(normal, viewDirection);\n\n        float albedo = inMaterialProperties.ALBEDO;\n        albedo *= 1.8;\n        float s = LdotV - NdotL * NdotV;\n        float t = mix(1., max(NdotL, NdotV), step(0., s));\n\n        float roughness = inMaterialProperties.ROUGHNESS;\n        float sigma2 = roughness * roughness;\n        float A = 1. + sigma2 * (albedo / (sigma2 + 0.13) + 0.5 / (sigma2 + 0.33));\n        float B = 0.45 * sigma2 / (sigma2 + 0.09);\n\n        float factor = albedo * max(0., NdotL) * (A + B * s / t) / PI;\n\n        return factor;\n\n    }\n#endif\n\nvec3 CalculateDiffuseColor(\n    vec3 lightDirection,\n    vec3 viewDirection,\n    vec3 normal,\n    vec3 lightColor,\n    vec3 materialColor,\n    inout float lambert\n) {\n    #ifndef ENABLE_OREN_NAYAR_DIFFUSE\n        lambert = clamp(dot(lightDirection, normal), 0., 1.);\n    #endif\n\n    #ifdef ENABLE_OREN_NAYAR_DIFFUSE\n        lambert = CalculateOrenNayar(lightDirection, viewDirection, normal);\n    #endif\n\n    vec3 diffuseColor = lambert * lightColor * materialColor;\n    return diffuseColor;\n}\n\nvec3 CalculateSpecularColor(\n    vec3 specularColor,\n    float specularCoefficient,\n    float shininess,\n    vec3 lightDirection,\n    vec3 viewDirection,\n    vec3 normal,\n    float lambertian\n) {\n    vec3 resultColor = vec3(0.);\n\n    #ifdef SPECULAR_PHONG\n        vec3 reflectDirection = reflect(-lightDirection, normal);\n        float specularAngle = max(dot(reflectDirection, viewDirection), 0.);\n        float specularFactor = pow(specularAngle, max(0., shininess));\n    resultColor = lambertian * specularFactor * specularCoefficient * specularColor;\n    #endif\n\n    #ifdef SPECULAR_BLINN\n        vec3 halfDirection = normalize(lightDirection + viewDirection);\n        float specularAngle = max(dot(halfDirection, normal), 0.);\n        float specularFactor = pow(specularAngle, max(0., shininess));\n        resultColor = lambertian * specularFactor * specularCoefficient * specularColor;\n    #endif\n\n    #ifdef SPECULAR_SCHLICK\n        vec3 halfDirection = normalize(lightDirection + viewDirection);\n        float specularAngle = dot(halfDirection, normal);\n        float schlickShininess = max(0., shininess);\n        float specularFactor = specularAngle / (schlickShininess - schlickShininess*specularAngle + specularAngle);\n        resultColor = lambertian * specularFactor * specularCoefficient * specularColor;\n    #endif\n\n    #ifdef SPECULAR_GAUSS\n        vec3 halfDirection = normalize(lightDirection + viewDirection);\n        float specularAngle = acos(max(dot(halfDirection, normal), 0.));\n        float exponent = specularAngle * shininess * 0.17;\n        exponent = -(exponent*exponent);\n        float specularFactor = exp(exponent);\n\n        resultColor = lambertian * specularFactor * specularCoefficient * specularColor;\n    #endif\n\n    #ifdef CONSERVE_ENERGY\n        float conserveEnergyFactor = EnergyConservation(shininess);\n        resultColor = conserveEnergyFactor * resultColor;\n    #endif\n\n    return resultColor;\n}\n\n#ifdef HAS_SPOT\n    float CalculateSpotLightEffect(vec3 lightPosition, vec3 conePointAt, float cosConeAngle, float cosConeAngleInner, float spotExponent, vec3 lightDirection) {\n        vec3 spotLightDirection = normalize(lightPosition-conePointAt);\n        float spotAngle = dot(-lightDirection, spotLightDirection);\n        float epsilon = cosConeAngle - cosConeAngleInner;\n\n        float spotIntensity = clamp((spotAngle - cosConeAngle)/epsilon, 0.0, 1.0);\n        spotIntensity = pow(spotIntensity, max(0.01, spotExponent));\n\n        return max(0., spotIntensity);\n    }\n#endif\n\n\n\n{{PHONG_FRAGMENT_HEAD}}\n\n\nvoid main()\n{\n    {{MODULE_BEGIN_FRAG}}\n\n    vec4 col=vec4(0., 0., 0., inDiffuseColor.a);\n    vec3 calculatedColor = vec3(0.);\n    vec3 normal = normalize(normInterpolated);\n    vec3 baseColor = inDiffuseColor.rgb;\n\n    {{MODULE_BASE_COLOR}}\n\n\n    vec3 viewDirection = normalize(v_viewDirection);\n\n    #ifdef DOUBLE_SIDED\n        if(!gl_FrontFacing) normal = normal * -1.0;\n    #endif\n\n    #ifdef HAS_TEXTURES\n        #ifdef HAS_TEXTURE_DIFFUSE\n            baseColor = texture(texDiffuse, texCoord).rgb;\n\n            #ifdef COLORIZE_TEXTURE\n                baseColor *= inDiffuseColor.rgb;\n            #endif\n        #endif\n\n        #ifdef HAS_TEXTURE_NORMAL\n            normal = texture(texNormal, texCoord).rgb;\n            normal = normalize(normal * 2. - 1.);\n            float normalIntensity = inTextureIntensities.NORMAL;\n            normal = normalize(mix(vec3(0., 0., 1.), normal, 2. * normalIntensity));\n            normal = normalize(TBN_Matrix * normal);\n        #endif\n    #endif\n\n    {{PHONG_FRAGMENT_BODY}}\n\n\n\n\n\n\n    #ifdef ENABLE_FRESNEL\n        calculatedColor += inFresnel.rgb * (CalculateFresnel(vec3(cameraSpace_pos), normal) * inFresnel.w * inFresnelWidthExponent.x);\n    #endif\n\n     #ifdef HAS_TEXTURE_ALPHA\n        #ifdef ALPHA_MASK_ALPHA\n            col.a*=texture(texAlpha,texCoord).a;\n        #endif\n        #ifdef ALPHA_MASK_LUMI\n            col.a*= dot(vec3(0.2126,0.7152,0.0722), texture(texAlpha,texCoord).rgb);\n        #endif\n        #ifdef ALPHA_MASK_R\n            col.a*=texture(texAlpha,texCoord).r;\n        #endif\n        #ifdef ALPHA_MASK_G\n            col.a*=texture(texAlpha,texCoord).g;\n        #endif\n        #ifdef ALPHA_MASK_B\n            col.a*=texture(texAlpha,texCoord).b;\n        #endif\n    #endif\n\n    #ifdef DISCARDTRANS\n        if(col.a<0.2) discard;\n    #endif\n\n\n    #ifdef HAS_TEXTURE_ENV\n        vec3 luminanceColor = vec3(0.);\n\n        #ifndef ENVMAP_MATCAP\n            float environmentMapWidth = inEnvMapWidth;\n            float glossyExponent = inMaterialProperties.SHININESS;\n            float glossyCoefficient = inMaterialProperties.SPECULAR_AMT;\n\n            vec3 envMapNormal =  normal;\n            vec3 reflectDirection = reflect(normalize(-viewDirection), normal);\n\n            float lambertianCoefficient = dot(viewDirection, reflectDirection); //0.44; // TODO: need prefiltered map for this\n            // lambertianCoefficient = 1.;\n            float specularAngle = max(dot(reflectDirection, viewDirection), 0.);\n            float specularFactor = pow(specularAngle, max(0., inMaterialProperties.SHININESS));\n\n            glossyExponent = specularFactor;\n\n            float maxMIPLevel = 10.;\n            float MIPlevel = log2(environmentMapWidth / 1024. * sqrt(3.)) - 0.5 * log2(glossyExponent + 1.);\n\n            luminanceColor = inEnvMapIntensity * (\n                inDiffuseColor.rgb *\n                SAMPLETEX(texEnv, envMapNormal, maxMIPLevel).rgb\n                +\n                glossyCoefficient * SAMPLETEX(texEnv, reflectDirection, MIPlevel).rgb\n            );\n        #endif\n        #ifdef ENVMAP_MATCAP\n            luminanceColor = inEnvMapIntensity * (\n                texture(texEnv, getMatCapUV(viewSpacePosition, viewSpaceNormal)).rgb\n                //inDiffuseColor.rgb\n                //* textureLod(texEnv, getMatCapUV(envMapNormal), maxMIPLevel).rgb\n                //+\n                //glossyCoefficient * textureLod(texEnv, getMatCapUV(reflectDirection), MIPlevel).rgb\n            );\n        #endif\n\n\n\n        #ifdef HAS_TEXTURE_LUMINANCE_MASK\n            luminanceColor *= texture(texLuminance, texCoord).r * inLuminanceMaskIntensity;\n        #endif\n\n        #ifdef HAS_TEXTURE_AO\n            // luminanceColor *= mix(vec3(1.), texture(texAO, texCoord).rgb, inTextureIntensities.AO);\n            luminanceColor *= texture(texAO, texCoord).g*inTextureIntensities.AO;\n        #endif\n\n        #ifdef ENV_BLEND_ADD\n            calculatedColor.rgb += luminanceColor;\n        #endif\n        #ifdef ENV_BLEND_MUL\n            calculatedColor.rgb *= luminanceColor;\n        #endif\n\n        #ifdef ENV_BLEND_MIX\n            calculatedColor.rgb=mix(luminanceColor,calculatedColor.rgb,luminanceColor);\n        #endif\n\n\n    #endif\n\n    #ifdef ADD_EMISSIVE_COLOR\n        vec3 emissiveRadiance = mix(calculatedColor, inEmissiveColor.rgb, inEmissiveColor.w); // .w = intensity of color;\n\n        #ifdef HAS_TEXTURE_EMISSIVE\n            float emissiveIntensity = inTextureIntensities.EMISSIVE;\n            emissiveRadiance = mix(calculatedColor, texture(texEmissive, texCoord).rgb, emissiveIntensity);\n        #endif\n\n        #ifdef HAS_TEXTURE_EMISSIVE_MASK\n           float emissiveMixValue = mix(1., texture(texMaskEmissive, texCoord).r, inEmissiveMaskIntensity);\n           calculatedColor = mix(calculatedColor, emissiveRadiance, emissiveMixValue);\n        #endif\n\n        #ifndef HAS_TEXTURE_EMISSIVE_MASK\n            calculatedColor = emissiveRadiance;\n        #endif\n    #endif\n\n    col.rgb = clamp(calculatedColor, 0., 1.);\n\n\n    {{MODULE_COLOR}}\n\n    outColor = col;\n}\n',phong_vert:"\n{{MODULES_HEAD}}\n\n#define NONE -1\n#define AMBIENT 0\n#define POINT 1\n#define DIRECTIONAL 2\n#define SPOT 3\n\n#define TEX_REPEAT_X x;\n#define TEX_REPEAT_Y y;\n#define TEX_OFFSET_X z;\n#define TEX_OFFSET_Y w;\n\nIN vec3 vPosition;\nIN vec2 attrTexCoord;\nIN vec3 attrVertNormal;\nIN float attrVertIndex;\nIN vec3 attrTangent;\nIN vec3 attrBiTangent;\n\nOUT vec2 texCoord;\nOUT vec3 normInterpolated;\nOUT vec3 fragPos;\n\n#ifdef HAS_TEXTURE_NORMAL\n    OUT mat3 TBN_Matrix; // tangent bitangent normal space transform matrix\n#endif\n\n#ifdef ENABLE_FRESNEL\n    OUT vec4 cameraSpace_pos;\n#endif\n\nOUT vec3 v_viewDirection;\nOUT mat3 normalMatrix;\nOUT mat4 mvMatrix;\n\n#ifdef HAS_TEXTURES\n    UNI vec4 inTextureRepeatOffset;\n#endif\n\nUNI vec3 camPos;\nUNI mat4 projMatrix;\nUNI mat4 viewMatrix;\nUNI mat4 modelMatrix;\n\n#ifdef ENVMAP_MATCAP\n    OUT vec3 viewSpaceNormal;\n    OUT vec3 viewSpacePosition;\n#endif\n\n\nmat3 transposeMat3(mat3 m)\n{\n    return mat3(m[0][0], m[1][0], m[2][0],\n        m[0][1], m[1][1], m[2][1],\n        m[0][2], m[1][2], m[2][2]);\n}\n\nmat3 inverseMat3(mat3 m)\n{\n    float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];\n    float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];\n    float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];\n\n    float b01 = a22 * a11 - a12 * a21;\n    float b11 = -a22 * a10 + a12 * a20;\n    float b21 = a21 * a10 - a11 * a20;\n\n    float det = a00 * b01 + a01 * b11 + a02 * b21;\n\n    return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),\n        b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),\n        b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;\n}\n\nvoid main()\n{\n    mat4 mMatrix=modelMatrix;\n    vec4 pos=vec4(vPosition,  1.0);\n\n    texCoord=attrTexCoord;\n    texCoord.y = 1. - texCoord.y;\n    vec3 norm=attrVertNormal;\n\n    vec3 tangent = attrTangent;\n    vec3 bitangent = attrBiTangent;\n\n    {{MODULE_VERTEX_POSITION}}\n\n    normalMatrix = transposeMat3(inverseMat3(mat3(mMatrix)));\n    mvMatrix = (viewMatrix * mMatrix);\n\n\n\n    #ifdef ENABLE_FRESNEL\n        cameraSpace_pos = mvMatrix * pos;\n    #endif\n\n    #ifdef HAS_TEXTURES\n        float repeatX = inTextureRepeatOffset.TEX_REPEAT_X;\n        float offsetX = inTextureRepeatOffset.TEX_OFFSET_X;\n        float repeatY = inTextureRepeatOffset.TEX_REPEAT_Y;\n        float offsetY = inTextureRepeatOffset.TEX_OFFSET_Y;\n\n        texCoord.x *= repeatX;\n        texCoord.x += offsetX;\n        texCoord.y *= repeatY;\n        texCoord.y += offsetY;\n    #endif\n\n   normInterpolated = vec3(normalMatrix*norm);\n\n    #ifdef HAS_TEXTURE_NORMAL\n        vec3 normCameraSpace = normalize((vec4(normInterpolated, 0.0)).xyz);\n        vec3 tangCameraSpace = normalize((mMatrix * vec4(tangent, 0.0)).xyz);\n        vec3 bitangCameraSpace = normalize((mMatrix * vec4(bitangent, 0.0)).xyz);\n\n        // re orthogonalization for smoother normals\n        tangCameraSpace = normalize(tangCameraSpace - dot(tangCameraSpace, normCameraSpace) * normCameraSpace);\n        bitangCameraSpace = cross(normCameraSpace, tangCameraSpace);\n\n        TBN_Matrix = mat3(tangCameraSpace, bitangCameraSpace, normCameraSpace);\n    #endif\n\n    fragPos = vec3((mMatrix) * pos);\n    v_viewDirection = normalize(camPos - fragPos);\n    // modelPos=mMatrix*pos;\n\n    #ifdef ENVMAP_MATCAP\n        mat3 viewSpaceNormalMatrix = normalMatrix = transposeMat3(inverseMat3(mat3(mvMatrix)));\n        viewSpaceNormal = normalize(viewSpaceNormalMatrix * norm);\n        viewSpacePosition = vec3(mvMatrix * pos);\n    #endif\n    gl_Position = projMatrix * mvMatrix * pos;\n}\n",snippet_body_ambient_frag:"    // * AMBIENT LIGHT {{LIGHT_INDEX}} *\n    vec3 diffuseColor{{LIGHT_INDEX}} = phongLight{{LIGHT_INDEX}}.lightProperties.INTENSITY*phongLight{{LIGHT_INDEX}}.color;\n    calculatedColor += diffuseColor{{LIGHT_INDEX}};\n",snippet_body_directional_frag:"    // * DIRECTIONAL LIGHT {{LIGHT_INDEX}} *\n\n    if (phongLight{{LIGHT_INDEX}}.castLight == 1) {\n        vec3 phongLightDirection{{LIGHT_INDEX}} = normalize(phongLight{{LIGHT_INDEX}}.position);\n\n        float phongLambert{{LIGHT_INDEX}} = 1.; // inout variable\n\n        vec3 lightColor{{LIGHT_INDEX}} = phongLight{{LIGHT_INDEX}}.color;\n        vec3 lightSpecular{{LIGHT_INDEX}} = phongLight{{LIGHT_INDEX}}.specular;\n\n        #ifdef HAS_TEXTURES\n            #ifdef HAS_TEXTURE_AO\n                // lightColor{{LIGHT_INDEX}} *= mix(vec3(1.), texture(texAO, texCoord).rgb, inTextureIntensities.AO);\n                lightColor{{LIGHT_INDEX}} *= texture(texAO, texCoord).g, inTextureIntensities.AO;\n\n            #endif\n\n            #ifdef HAS_TEXTURE_SPECULAR\n                lightSpecular{{LIGHT_INDEX}} *= mix(1., texture(texSpecular, texCoord).r, inTextureIntensities.SPECULAR);\n            #endif\n        #endif\n\n        vec3 diffuseColor{{LIGHT_INDEX}} = CalculateDiffuseColor(phongLightDirection{{LIGHT_INDEX}}, viewDirection, normal, lightColor{{LIGHT_INDEX}}, baseColor, phongLambert{{LIGHT_INDEX}});\n        vec3 specularColor{{LIGHT_INDEX}} = CalculateSpecularColor(\n            lightSpecular{{LIGHT_INDEX}},\n            inMaterialProperties.SPECULAR_AMT,\n            inMaterialProperties.SHININESS,\n            phongLightDirection{{LIGHT_INDEX}},\n            viewDirection,\n            normal,\n            phongLambert{{LIGHT_INDEX}}\n        );\n\n        vec3 combinedColor{{LIGHT_INDEX}} = (diffuseColor{{LIGHT_INDEX}} + specularColor{{LIGHT_INDEX}});\n\n        vec3 lightModelDiff{{LIGHT_INDEX}} = phongLight{{LIGHT_INDEX}}.position - fragPos.xyz;\n\n        combinedColor{{LIGHT_INDEX}} *= phongLight{{LIGHT_INDEX}}.lightProperties.INTENSITY;\n        calculatedColor += combinedColor{{LIGHT_INDEX}};\n    }",snippet_body_point_frag:"// * POINT LIGHT {{LIGHT_INDEX}} *\n    if (phongLight{{LIGHT_INDEX}}.castLight == 1) {\n        vec3 phongLightDirection{{LIGHT_INDEX}} = phongLight{{LIGHT_INDEX}}.position - fragPos.xyz;\n        // * get length before normalization for falloff calculation\n        phongLightDirection{{LIGHT_INDEX}} = normalize(phongLightDirection{{LIGHT_INDEX}});\n        float phongLightDistance{{LIGHT_INDEX}} = length(phongLightDirection{{LIGHT_INDEX}});\n\n        float phongLambert{{LIGHT_INDEX}} = 1.; // inout variable\n\n        vec3 lightColor{{LIGHT_INDEX}} = phongLight{{LIGHT_INDEX}}.color;\n        vec3 lightSpecular{{LIGHT_INDEX}} = phongLight{{LIGHT_INDEX}}.specular;\n\n        #ifdef HAS_TEXTURES\n            #ifdef HAS_TEXTURE_AO\n                // lightColor{{LIGHT_INDEX}} *= mix(vec3(1.), texture(texAO, texCoord).rgb, inTextureIntensities.AO);\n                lightColor{{LIGHT_INDEX}} *= texture(texAO, texCoord).g, inTextureIntensities.AO;\n\n            #endif\n\n            #ifdef HAS_TEXTURE_SPECULAR\n                lightSpecular{{LIGHT_INDEX}} *= mix(1., texture(texSpecular, texCoord).r, inTextureIntensities.SPECULAR);\n            #endif\n        #endif\n\n        vec3 diffuseColor{{LIGHT_INDEX}} = CalculateDiffuseColor(phongLightDirection{{LIGHT_INDEX}}, viewDirection, normal, lightColor{{LIGHT_INDEX}}, baseColor, phongLambert{{LIGHT_INDEX}});\n        vec3 specularColor{{LIGHT_INDEX}} = CalculateSpecularColor(\n            lightSpecular{{LIGHT_INDEX}},\n            inMaterialProperties.SPECULAR_AMT,\n            inMaterialProperties.SHININESS,\n            phongLightDirection{{LIGHT_INDEX}},\n            viewDirection,\n            normal,\n            phongLambert{{LIGHT_INDEX}}\n        );\n\n        vec3 combinedColor{{LIGHT_INDEX}} = (diffuseColor{{LIGHT_INDEX}} + specularColor{{LIGHT_INDEX}});\n\n        combinedColor{{LIGHT_INDEX}} *= phongLight{{LIGHT_INDEX}}.lightProperties.INTENSITY;\n\n        float attenuation{{LIGHT_INDEX}} = CalculateFalloff(\n            phongLightDistance{{LIGHT_INDEX}},\n            phongLightDirection{{LIGHT_INDEX}},\n            phongLight{{LIGHT_INDEX}}.lightProperties.FALLOFF,\n            phongLight{{LIGHT_INDEX}}.lightProperties.RADIUS\n        );\n\n        attenuation{{LIGHT_INDEX}} *= when_gt(phongLambert{{LIGHT_INDEX}}, 0.);\n        combinedColor{{LIGHT_INDEX}} *= attenuation{{LIGHT_INDEX}};\n\n        calculatedColor += combinedColor{{LIGHT_INDEX}};\n    }\n",snippet_body_spot_frag:"    // * SPOT LIGHT {{LIGHT_INDEX}} *\n    if (phongLight{{LIGHT_INDEX}}.castLight == 1) {\n        vec3 phongLightDirection{{LIGHT_INDEX}} = phongLight{{LIGHT_INDEX}}.position - fragPos.xyz;\n        phongLightDirection{{LIGHT_INDEX}} = normalize( phongLightDirection{{LIGHT_INDEX}});\n        float phongLightDistance{{LIGHT_INDEX}} = length(phongLightDirection{{LIGHT_INDEX}});\n\n        float phongLambert{{LIGHT_INDEX}} = 1.; // inout variable\n\n        vec3 lightColor{{LIGHT_INDEX}} = phongLight{{LIGHT_INDEX}}.color;\n        vec3 lightSpecular{{LIGHT_INDEX}} = phongLight{{LIGHT_INDEX}}.specular;\n\n        #ifdef HAS_TEXTURES\n            #ifdef HAS_TEXTURE_AO\n                // lightColor{{LIGHT_INDEX}} *= mix(vec3(1.), texture(texAO, texCoord).rgb, inTextureIntensities.AO);\n                lightColor{{LIGHT_INDEX}} *= texture(texAO, texCoord).g, inTextureIntensities.AO;\n\n            #endif\n\n            #ifdef HAS_TEXTURE_SPECULAR\n                lightSpecular{{LIGHT_INDEX}} *= mix(1., texture(texSpecular, texCoord).r, inTextureIntensities.SPECULAR);\n            #endif\n        #endif\n\n        vec3 diffuseColor{{LIGHT_INDEX}} = CalculateDiffuseColor(phongLightDirection{{LIGHT_INDEX}}, viewDirection, normal, lightColor{{LIGHT_INDEX}}, baseColor, phongLambert{{LIGHT_INDEX}});\n        vec3 specularColor{{LIGHT_INDEX}} = CalculateSpecularColor(\n            lightSpecular{{LIGHT_INDEX}},\n            inMaterialProperties.SPECULAR_AMT,\n            inMaterialProperties.SHININESS,\n            phongLightDirection{{LIGHT_INDEX}},\n            viewDirection,\n            normal,\n            phongLambert{{LIGHT_INDEX}}\n        );\n\n        vec3 combinedColor{{LIGHT_INDEX}} = (diffuseColor{{LIGHT_INDEX}} + specularColor{{LIGHT_INDEX}});\n\n        float spotIntensity{{LIGHT_INDEX}} = CalculateSpotLightEffect(\n            phongLight{{LIGHT_INDEX}}.position, phongLight{{LIGHT_INDEX}}.conePointAt, phongLight{{LIGHT_INDEX}}.spotProperties.COSCONEANGLE,\n            phongLight{{LIGHT_INDEX}}.spotProperties.COSCONEANGLEINNER, phongLight{{LIGHT_INDEX}}.spotProperties.SPOTEXPONENT,\n            phongLightDirection{{LIGHT_INDEX}}\n        );\n\n        combinedColor{{LIGHT_INDEX}} *= spotIntensity{{LIGHT_INDEX}};\n\n        vec3 lightModelDiff{{LIGHT_INDEX}} = phongLight{{LIGHT_INDEX}}.position - fragPos.xyz;\n\n        float attenuation{{LIGHT_INDEX}} = CalculateFalloff(\n            phongLightDistance{{LIGHT_INDEX}},\n            phongLightDirection{{LIGHT_INDEX}},\n            phongLight{{LIGHT_INDEX}}.lightProperties.FALLOFF,\n            phongLight{{LIGHT_INDEX}}.lightProperties.RADIUS\n        );\n\n        attenuation{{LIGHT_INDEX}} *= when_gt(phongLambert{{LIGHT_INDEX}}, 0.);\n\n        combinedColor{{LIGHT_INDEX}} *= attenuation{{LIGHT_INDEX}};\n\n        combinedColor{{LIGHT_INDEX}} *= phongLight{{LIGHT_INDEX}}.lightProperties.INTENSITY;\n        calculatedColor += combinedColor{{LIGHT_INDEX}};\n    }",snippet_head_frag:"UNI Light phongLight{{LIGHT_INDEX}};\n"};const t=e.patch.cgl;const n=s.snippet_head_frag;const a={point:s.snippet_body_point_frag,spot:s.snippet_body_spot_frag,ambient:s.snippet_body_ambient_frag,directional:s.snippet_body_directional_frag,area:s.snippet_body_area_frag};const r=new RegExp("{{LIGHT_INDEX}}","g");const l=e=>n.replace("{{LIGHT_INDEX}}",e);const u=(e,t)=>a[t].replace(r,e);function i(){const e=s.phong_vert;let t=s.phong_frag;let n="";let a="";n=n.concat(l(0));a=a.concat(u(0,rt[0].type));t=t.replace(he,n);t=t.replace(be,a);de.setSource(e,t);de.define("HAS_POINT");de.removeDefine("HAS_SPOT");de.removeDefine("HAS_DIRECTIONAL");de.removeDefine("HAS_AMBIENT")}const o=e.inTrigger("Trigger In");const m=e.inFloat("R",Math.random());const c=e.inFloat("G",Math.random());const g=e.inFloat("B",Math.random());const p=e.inFloatSlider("A",1);const d=[m,c,g,p];e.setPortGroup("Diffuse Color",d);const f=e.inBool("Enable",false);const h=e.inFloatSlider("Albedo",.707);const b=e.inFloatSlider("Roughness",.835);f.setUiAttribs({hidePort:true});h.setUiAttribs({greyout:true});b.setUiAttribs({greyout:true});m.setUiAttribs({colorPick:true});e.setPortGroup("Oren-Nayar Diffuse",[f,h,b]);f.onChange=function(){de.toggleDefine("ENABLE_OREN_NAYAR_DIFFUSE",f);h.setUiAttribs({greyout:!f.get()});b.setUiAttribs({greyout:!f.get()})};const v=e.inValueBool("Active",false);v.setUiAttribs({hidePort:true});const O=e.inValueSlider("Fresnel Intensity",.7);const T=e.inFloat("Fresnel Width",1);const I=e.inFloat("Fresnel Exponent",6);const _=e.inFloat("Fresnel R",1);const x=e.inFloat("Fresnel G",1);const E=e.inFloat("Fresnel B",1);_.setUiAttribs({colorPick:true});const S=[O,T,I,_,x,E];S.forEach(function(e){e.setUiAttribs({greyout:true})});e.setPortGroup("Fresnel",S.concat([v]));let A=null;let C=null;v.onChange=function(){de.toggleDefine("ENABLE_FRESNEL",v);if(v.get()){if(!A)A=new CGL.Uniform(de,"4f","inFresnel",_,x,E,O);if(!C)C=new CGL.Uniform(de,"2f","inFresnelWidthExponent",T,I)}else{if(A){de.removeUniform("inFresnel");A=null}if(C){de.removeUniform("inFresnelWidthExponent");C=null}}S.forEach(function(e){e.setUiAttribs({greyout:!v.get()})})};const L=e.inBool("Emissive Active",false);const N=e.inFloatSlider("Color Intensity",.3);const P=e.inFloatSlider("Emissive R",Math.random());const M=e.inFloatSlider("Emissive G",Math.random());const y=e.inFloatSlider("Emissive B",Math.random());P.setUiAttribs({colorPick:true});e.setPortGroup("Emissive Color",[L,N,P,M,y]);N.setUiAttribs({greyout:!L.get()});P.setUiAttribs({greyout:!L.get()});M.setUiAttribs({greyout:!L.get()});y.setUiAttribs({greyout:!L.get()});let j=null;L.onChange=()=>{de.toggleDefine("ADD_EMISSIVE_COLOR",L);if(L.get()){j=new CGL.Uniform(de,"4f","inEmissiveColor",P,M,y,N);Y.setUiAttribs({greyout:false});W.setUiAttribs({greyout:false});if(Y.get())ie.setUiAttribs({greyout:false});if(W.get())oe.setUiAttribs({greyout:false})}else{e.log("ayayay");Y.setUiAttribs({greyout:true});W.setUiAttribs({greyout:true});ie.setUiAttribs({greyout:true});oe.setUiAttribs({greyout:true});de.removeUniform("inEmissiveColor");j=null}if(Y.get()){N.setUiAttribs({greyout:true});P.setUiAttribs({greyout:true});M.setUiAttribs({greyout:true});y.setUiAttribs({greyout:true})}else{if(L.get()){N.setUiAttribs({greyout:false});P.setUiAttribs({greyout:false});M.setUiAttribs({greyout:false});y.setUiAttribs({greyout:false})}else{N.setUiAttribs({greyout:true});P.setUiAttribs({greyout:true});M.setUiAttribs({greyout:true});y.setUiAttribs({greyout:true})}}};const G=e.inFloat("Shininess",4);const R=e.inFloatSlider("Specular Amount",.5);const w=e.inSwitch("Specular Model",["Blinn","Schlick","Phong","Gauss"],"Blinn");w.setUiAttribs({hidePort:true});const U=[G,R,w];e.setPortGroup("Specular",U);const B=e.inValueBool("Energy Conservation",false);const D=e.inBool("Double Sided Material",false);const k=e.inSwitch("Falloff Mode",["A","B","C","D"],"A");B.setUiAttribs({hidePort:true});D.setUiAttribs({hidePort:true});k.setUiAttribs({hidePort:true});k.onChange=()=>{const e=["A","B","C","D"];de.define("FALLOFF_MODE_"+k.get());e.filter(e=>e!==k.get()).forEach(e=>de.removeDefine("FALLOFF_MODE_"+e))};const V=[B,D,k];e.setPortGroup("Light Options",V);const F=e.inTexture("Diffuse Texture");const z=e.inTexture("Specular Texture");const X=e.inTexture("Normal Map");const H=e.inTexture("AO Texture");const Y=e.inTexture("Emissive Texture");const W=e.inTexture("Emissive Mask");const Z=e.inTexture("Opacity Texture");const J=e.inTexture("Environment Map");const K=e.inTexture("Env Map Mask");e.setPortGroup("Textures",[F,z,X,H,Y,W,Z,J,K]);const q=e.inBool("Colorize Texture",false);const Q=e.inFloat("Diffuse Repeat X",1);const $=e.inFloat("Diffuse Repeat Y",1);const ee=e.inFloat("Texture Offset X",0);const te=e.inFloat("Texture Offset Y",0);const ne=e.inFloatSlider("Specular Intensity",1);const ae=e.inFloatSlider("Normal Map Intensity",.5);const re=e.inFloatSlider("AO Intensity",1);const ie=e.inFloatSlider("Emissive Intensity",1);const oe=e.inFloatSlider("Emissive Mask Intensity",1);const se=e.inFloatSlider("Env Map Intensity",1);const le=e.inSwitch("Env Map Blend",["Add","Multiply","Mix"],"Add");const ue=e.inFloatSlider("Env Mask Intensity",1);q.setUiAttribs({hidePort:true});e.setPortGroup("Texture Transforms",[q,$,Q,te,ee]);e.setPortGroup("Texture Intensities",[ae,re,ne,ie,le,oe,se,ue]);const me=e.inSwitch("Alpha Mask Source",["Luminance","R","G","B","A"],"Luminance");me.setUiAttribs({greyout:true});const ce=e.inValueBool("Discard Transparent Pixels");ce.setUiAttribs({hidePort:true});e.setPortGroup("Opacity Texture",[me,ce]);const ge=e.outTrigger("Trigger Out");const pe=e.outObject("Shader",null,"shader");pe.ignoreValueSerialize=true;const de=new CGL.Shader(t,"phongmaterial_"+e.id);de.setModules(["MODULE_VERTEX_POSITION","MODULE_COLOR","MODULE_BEGIN_FRAG","MODULE_BASE_COLOR"]);de.setSource(s.simosphong_vert,s.simosphong_frag);let fe=false;de.define("FALLOFF_MODE_A");if(t.glVersion<2){de.enableExtension("GL_OES_standard_derivatives");if(t.gl.getExtension("OES_texture_float"))de.enableExtension("GL_OES_texture_float");else e.log("error loading extension OES_texture_float");if(t.gl.getExtension("OES_texture_float_linear"))de.enableExtension("GL_OES_texture_float_linear");else e.log("error loading extention OES_texture_float_linear");if(t.gl.getExtension("GL_OES_texture_half_float"))de.enableExtension("GL_OES_texture_half_float");else e.log("error loading extention GL_OES_texture_half_float");if(t.gl.getExtension("GL_OES_texture_half_float_linear"))de.enableExtension("GL_OES_texture_half_float_linear");else e.log("error loading extention GL_OES_texture_half_float_linear")}const he=new RegExp("{{PHONG_FRAGMENT_HEAD}}","g");const be=new RegExp("{{PHONG_FRAGMENT_BODY}}","g");const ve={directional:false,spot:false,ambient:false,point:false};function Oe(t){let e=s.phong_frag;let n="";let a="";ve.directional=false;ve.spot=false;ve.ambient=false;ve.point=false;for(let e=0;e<t.length;e+=1){const r=t[e];const i=r.type;if(!ve[i]){ve[i]=true}n=n.concat(l(e));a=a.concat(u(e,r.type))}e=e.replace(he,n);e=e.replace(be,a);de.setSource(s.phong_vert,e);for(let e=0,t=Object.keys(ve);e<t.length;e+=1){const o=t[e];if(ve[o]){if(!de.hasDefine("HAS_"+o.toUpperCase())){de.define("HAS_"+o.toUpperCase())}}else{if(de.hasDefine("HAS_"+o.toUpperCase())){de.removeDefine("HAS_"+o.toUpperCase())}}}}pe.set(de);let Te=null;let Ie=null;let _e=null;let xe=null;let Ee=null;let Se=null;let Ae=null;let Ce=null;let Le=null;let Ne=null;let Pe=null;let Me=null;let ye=null;q.onChange=function(){de.toggleDefine("COLORIZE_TEXTURE",q.get())};function je(){if(F.get()){if(!de.hasDefine("HAS_TEXTURE_DIFFUSE")){de.define("HAS_TEXTURE_DIFFUSE");if(!Te)Te=new CGL.Uniform(de,"t","texDiffuse",0)}}else{de.removeUniform("texDiffuse");de.removeDefine("HAS_TEXTURE_DIFFUSE");Te=null}}function Ge(){if(z.get()){ne.setUiAttribs({greyout:false});if(!de.hasDefine("HAS_TEXTURE_SPECULAR")){de.define("HAS_TEXTURE_SPECULAR");if(!Ie)Ie=new CGL.Uniform(de,"t","texSpecular",0)}}else{ne.setUiAttribs({greyout:true});de.removeUniform("texSpecular");de.removeDefine("HAS_TEXTURE_SPECULAR");Ie=null}}function Re(){if(X.get()){ae.setUiAttribs({greyout:false});if(!de.hasDefine("HAS_TEXTURE_NORMAL")){de.define("HAS_TEXTURE_NORMAL");if(!_e)_e=new CGL.Uniform(de,"t","texNormal",0)}}else{ae.setUiAttribs({greyout:true});de.removeUniform("texNormal");de.removeDefine("HAS_TEXTURE_NORMAL");_e=null}}xe=new CGL.Uniform(de,"t","texAO");function we(){de.toggleDefine("HAS_TEXTURE_AO",H.get());re.setUiAttribs({greyout:!H.get()})}function Ue(){if(Y.get()){P.setUiAttribs({greyout:true});M.setUiAttribs({greyout:true});y.setUiAttribs({greyout:true});N.setUiAttribs({greyout:true});if(L.get()){ie.setUiAttribs({greyout:false})}if(!de.hasDefine("HAS_TEXTURE_EMISSIVE")){de.define("HAS_TEXTURE_EMISSIVE");if(!Ee)Ee=new CGL.Uniform(de,"t","texEmissive",0)}}else{ie.setUiAttribs({greyout:true});if(L.get()){P.setUiAttribs({greyout:false});M.setUiAttribs({greyout:false});y.setUiAttribs({greyout:false});N.setUiAttribs({greyout:false})}else{Y.setUiAttribs({greyout:true})}de.removeUniform("texEmissive");de.removeDefine("HAS_TEXTURE_EMISSIVE");Ee=null}}function Be(){if(W.get()){if(L.get()){oe.setUiAttribs({greyout:false})}if(!de.hasDefine("HAS_TEXTURE_EMISSIVE_MASK")){de.define("HAS_TEXTURE_EMISSIVE_MASK");if(!Se)Se=new CGL.Uniform(de,"t","texMaskEmissive",0);if(!Ae)Ae=new CGL.Uniform(de,"f","inEmissiveMaskIntensity",oe)}}else{if(!L.get()){W.setUiAttribs({greyout:true})}oe.setUiAttribs({greyout:true});de.removeUniform("texMaskEmissive");de.removeUniform("inEmissiveMaskIntensity");de.removeDefine("HAS_TEXTURE_EMISSIVE_MASK");Se=null;Ae=null}}let De=false;function ke(){de.toggleDefine("HAS_TEXTURE_ENV",J.get());se.setUiAttribs({greyout:!J.get()});if(J.get()){if(!Le)Le=new CGL.Uniform(de,"t","texEnv",0);de.toggleDefine("TEX_FORMAT_CUBEMAP",J.get().cubemap);if(J.get().cubemap){de.removeDefine("TEX_FORMAT_EQUIRECT");de.removeDefine("ENVMAP_MATCAP");if(!Ne)Ne=new CGL.Uniform(de,"f","inEnvMapIntensity",se);if(!Pe)Pe=new CGL.Uniform(de,"f","inEnvMapWidth",J.get().cubemap.width)}else{const e=J.get().width===J.get().height;de.toggleDefine("TEX_FORMAT_EQUIRECT",!e);de.toggleDefine("ENVMAP_MATCAP",e);if(!Ne)Ne=new CGL.Uniform(de,"f","inEnvMapIntensity",se);if(!Pe)Pe=new CGL.Uniform(de,"f","inEnvMapWidth",J.get().width)}}else{de.removeUniform("inEnvMapIntensity");de.removeUniform("inEnvMapWidth");de.removeUniform("texEnv");de.removeDefine("HAS_TEXTURE_ENV");de.removeDefine("ENVMAP_MATCAP");Le=null;Ne=null}De=false}function Ve(){if(K.get()){ue.setUiAttribs({greyout:false});if(!Me){de.define("HAS_TEXTURE_LUMINANCE_MASK");Me=new CGL.Uniform(de,"t","texLuminance",0);ye=new CGL.Uniform(de,"f","inLuminanceMaskIntensity",ue)}}else{ue.setUiAttribs({greyout:true});de.removeDefine("HAS_TEXTURE_LUMINANCE_MASK");de.removeUniform("inLuminanceMaskIntensity");de.removeUniform("texLuminance");Me=null;ye=null}}function Fe(){de.toggleDefine("ENV_BLEND_ADD",le.get()=="Add");de.toggleDefine("ENV_BLEND_MUL",le.get()=="Multiply");de.toggleDefine("ENV_BLEND_MIX",le.get()=="Mix");de.toggleDefine("ALPHA_MASK_ALPHA",me.get()=="Alpha Channel");de.toggleDefine("ALPHA_MASK_LUMI",me.get()=="Luminance");de.toggleDefine("ALPHA_MASK_R",me.get()=="R");de.toggleDefine("ALPHA_MASK_G",me.get()=="G");de.toggleDefine("ALPHA_MASK_B",me.get()=="B")}le.onChange=Fe;me.onChange=Fe;function ze(){if(Z.get()){if(Ce!==null)return;de.removeUniform("texAlpha");de.define("HAS_TEXTURE_ALPHA");if(!Ce)Ce=new CGL.Uniform(de,"t","texAlpha",0);me.setUiAttribs({greyout:false});ce.setUiAttribs({greyout:false})}else{de.removeUniform("texAlpha");de.removeDefine("HAS_TEXTURE_ALPHA");Ce=null;me.setUiAttribs({greyout:true});ce.setUiAttribs({greyout:true})}Fe()}ce.onChange=function(){de.toggleDefine("DISCARDTRANS",ce.get())};F.onChange=je;z.onChange=Ge;X.onChange=Re;H.onChange=we;Y.onChange=Ue;W.onChange=Be;Z.onChange=ze;J.onChange=()=>{De=true};K.onChange=Ve;const Xe=t.maxUniformsFrag;const He=Xe===64?6:16;de.define("MAX_LIGHTS",He.toString());de.define("SPECULAR_PHONG");w.onChange=function(){if(w.get()==="Phong"){de.define("SPECULAR_PHONG");de.removeDefine("SPECULAR_BLINN");de.removeDefine("SPECULAR_GAUSS");de.removeDefine("SPECULAR_SCHLICK")}else if(w.get()==="Blinn"){de.define("SPECULAR_BLINN");de.removeDefine("SPECULAR_PHONG");de.removeDefine("SPECULAR_GAUSS");de.removeDefine("SPECULAR_SCHLICK")}else if(w.get()==="Gauss"){de.define("SPECULAR_GAUSS");de.removeDefine("SPECULAR_BLINN");de.removeDefine("SPECULAR_PHONG");de.removeDefine("SPECULAR_SCHLICK")}else if(w.get()==="Schlick"){de.define("SPECULAR_SCHLICK");de.removeDefine("SPECULAR_BLINN");de.removeDefine("SPECULAR_PHONG");de.removeDefine("SPECULAR_GAUSS")}};B.onChange=function(){de.toggleDefine("CONSERVE_ENERGY",B.get())};D.onChange=function(){de.toggleDefine("DOUBLE_SIDED",D.get())};const Ye=new CGL.Uniform(de,"4f","inMaterialProperties",h,b,G,R);const We=new CGL.Uniform(de,"4f","inDiffuseColor",m,c,g,p);const Ze=new CGL.Uniform(de,"4f","inTextureIntensities",ae,re,ne,ie);const Je=new CGL.Uniform(de,"4f","inTextureRepeatOffset",Q,$,ee,te);de.uniformColorDiffuse=We;const Ke=[];let qe=0;function Qe(t){for(let e=0;e<Ke.length;e+=1){Ke[e]=null}for(let e=0;e<t;e+=1){Ke[e]=null;if(!Ke[e]){Ke[e]={color:new CGL.Uniform(de,"3f","phongLight"+e+".color",[1,1,1]),position:new CGL.Uniform(de,"3f","phongLight"+e+".position",[0,11,0]),specular:new CGL.Uniform(de,"3f","phongLight"+e+".specular",[1,1,1]),lightProperties:new CGL.Uniform(de,"4f","phongLight"+e+".lightProperties",[1,1,1,1]),conePointAt:new CGL.Uniform(de,"3f","phongLight"+e+".conePointAt",vec3.create()),spotProperties:new CGL.Uniform(de,"3f","phongLight"+e+".spotProperties",[0,0,0,0]),castLight:new CGL.Uniform(de,"i","phongLight"+e+".castLight",1)}}}}function $e(e){nt.position.setValue(e.position);nt.color.setValue(e.color);nt.specular.setValue(e.specular);nt.lightProperties.setValue([e.intensity,e.attenuation,e.falloff,e.radius]);nt.conePointAt.setValue(e.conePointAt);nt.spotProperties.setValue([e.cosConeAngle,e.cosConeAngleInner,e.spotExponent])}function et(t){for(let e=0;e<t.length;e+=1){const n=t[e];n.isUsed=true;Ke[e].position.setValue(n.position);Ke[e].color.setValue(n.color);Ke[e].specular.setValue(n.specular);Ke[e].lightProperties.setValue([n.intensity,n.attenuation,n.falloff,n.radius]);Ke[e].conePointAt.setValue(n.conePointAt);Ke[e].spotProperties.setValue([n.cosConeAngle,n.cosConeAngleInner,n.spotExponent]);Ke[e].castLight.setValue(n.castLight)}}function tt(e){if(e.length!==qe){Oe(e);Qe(e.length);qe=e.length;et(e);fe=false}else{if(fe){Oe(e);Qe(e.length);fe=false}et(e)}}let nt=null;function at(){nt={color:new CGL.Uniform(de,"3f","phongLight"+0+".color",[1,1,1]),specular:new CGL.Uniform(de,"3f","phongLight"+0+".specular",[1,1,1]),position:new CGL.Uniform(de,"3f","phongLight"+0+".position",[0,11,0]),lightProperties:new CGL.Uniform(de,"4f","phongLight"+0+".lightProperties",[1,1,1,1]),conePointAt:new CGL.Uniform(de,"3f","phongLight"+0+".conePointAt",vec3.create()),spotProperties:new CGL.Uniform(de,"3f","phongLight"+0+".spotProperties",[0,0,0,0]),castLight:new CGL.Uniform(de,"i","phongLight"+0+".castLight",1)}}const rt=[{type:"point",position:[5,5,5],color:[1,1,1],specular:[1,1,1],intensity:1,attenuation:0,falloff:.5,radius:80,castLight:1}];const it=mat4.create();function ot(){if(t.frameStore.lightStack){if(t.frameStore.lightStack.length===0){e.setUiError("deflight","Default light is enabled. Please add lights to your patch to make this warning disappear.",1)}else e.setUiError("deflight",null)}if(!t.frameStore.lightStack||!t.frameStore.lightStack.length){if(!nt){i();at()}mat4.invert(it,t.vMatrix);rt[0].position=[it[12],it[13],it[14]];$e(rt[0]);qe=-1}else{if(de){if(t.frameStore.lightStack){if(t.frameStore.lightStack.length){nt=null;tt(t.frameStore.lightStack)}}}}}const st=function(){if(!de){e.log("NO SHADER");return}t.pushShader(de);de.popTextures();ge.trigger();t.popShader()};e.preRender=function(){de.bind();st()};const lt=mat4.create();const ut=vec3.create();const mt=vec3.create();o.onTriggered=function(){if(!de){e.log("phong has no shader...");return}if(De)ke();t.setShader(de);de.popTextures();if(F.get())de.pushTexture(Te,F.get());if(z.get())de.pushTexture(Ie,z.get());if(X.get())de.pushTexture(_e,X.get());if(H.get())de.pushTexture(xe,H.get());if(Y.get())de.pushTexture(Ee,Y.get());if(W.get())de.pushTexture(Se,W.get());if(Z.get())de.pushTexture(Ce,Z.get());if(J.get()){if(J.get().cubemap)de.pushTexture(Le,J.get().cubemap,t.gl.TEXTURE_CUBE_MAP);else de.pushTexture(Le,J.get())}if(K.get()){de.pushTexture(Me,K.get())}ot();ge.trigger();t.setPreviousShader()};if(t.glVersion==1){if(!t.gl.getExtension("EXT_shader_texture_lod")){e.log("no EXT_shader_texture_lod texture extension")}else{de.enableExtension("GL_EXT_shader_texture_lod");t.gl.getExtension("OES_texture_float");t.gl.getExtension("OES_texture_float_linear");t.gl.getExtension("OES_texture_half_float");t.gl.getExtension("OES_texture_half_float_linear");de.enableExtension("GL_OES_standard_derivatives");de.enableExtension("GL_OES_texture_float");de.enableExtension("GL_OES_texture_float_linear");de.enableExtension("GL_OES_texture_half_float");de.enableExtension("GL_OES_texture_half_float_linear")}}je();Ge();Re();we();ze();Ue();Be();ke();Ve()};Ops.Gl.Phong.PhongMaterial_v6.prototype=new CABLES.Op;CABLES.OPS["0d83ed06-cdbe-4fe0-87bb-0ccece7fb6e1"]={f:Ops.Gl.Phong.PhongMaterial_v6,objName:"Ops.Gl.Phong.PhongMaterial_v6"};Ops.Gl.ShaderEffects.UseVertexColor=function(){CABLES.Op.apply(this,arguments);const e=this;const t={colorarea_frag:"baseColor.rgb=vertColor.rgb;",colorarea_head_frag:"IN vec4 vertColor;\n"};const n=e.inTrigger("Render"),a=e.outTrigger("Next");const r=e.patch.cgl;const i="".endl()+"IN vec4 attrVertColor;".endl()+"OUT vec4 vertColor;".endl();const o="".endl()+"   vertColor=attrVertColor;".endl();n.onTriggered=u;const s="vert_"+e.name;const l=new CGL.ShaderModifier(r,e.name);l.addModule({title:s,name:"MODULE_VERTEX_POSITION",srcHeadVert:i,srcBodyVert:o});l.addModule({title:e.name,name:"MODULE_BASE_COLOR",srcHeadFrag:t.colorarea_head_frag,srcBodyFrag:t.colorarea_frag});function u(){l.bind();a.trigger();l.unbind()}};Ops.Gl.ShaderEffects.UseVertexColor.prototype=new CABLES.Op;CABLES.OPS["8c3cc332-3bab-4cb7-ad0a-368814eb8282"]={f:Ops.Gl.ShaderEffects.UseVertexColor,objName:"Ops.Gl.ShaderEffects.UseVertexColor"};Ops.Gl.Texture_v2=function(){CABLES.Op.apply(this,arguments);const r=this;const e={};const i=r.inUrl("File",[".jpg",".png",".webp",".jpeg",".avif"]),t=r.inSwitch("Filter",["nearest","linear","mipmap"]),n=r.inValueSelect("Wrap",["repeat","mirrored repeat","clamp to edge"],"clamp to edge"),a=r.inSwitch("Anisotropic",[0,1,2,4,8,16],0),o=r.inValueBool("Flip",false),s=r.inValueBool("Pre Multiplied Alpha",false),l=r.inValueBool("Active",true),u=r.inBool("Save Memory",true),m=r.outTexture("Texture"),c=r.outNumber("Width"),g=r.outNumber("Height"),p=r.outNumber("Aspect Ratio"),d=r.outNumber("Loaded",false),f=r.outNumber("Loading",false);r.setPortGroup("Size",[c,g]);s.setUiAttribs({hidePort:true});r.toWorkPortsNeedToBeLinked(m);const h=r.patch.cgl;let b=null;let v=null;let O=null;let T=CGL.Texture.FILTER_MIPMAP;let I=CGL.Texture.WRAP_REPEAT;let _=0;let x=0;i.onChange=o.onChange=function(){S()};a.onChange=t.onChange=C;n.onChange=L;s.onChange=function(){S()};t.set("mipmap");n.set("repeat");m.set(CGL.Texture.getEmptyTexture(h));l.onChange=function(){if(l.get()){if(b!=i.get()||!O)S();else m.set(O)}else{m.set(CGL.Texture.getEmptyTexture(h));c.set(CGL.Texture.getEmptyTexture(h).width);g.set(CGL.Texture.getEmptyTexture(h).height);if(O)O.delete();O=null}};const E=function(){const e=CGL.Texture.getTempTexture(h);m.set(e)};function S(e){clearTimeout(x);x=setTimeout(function(){A(e)},30)}function A(e){if(!l.get())return;if(!v)v=h.patch.loading.start("textureOp",i.get());let t=r.patch.getFilePath(String(i.get()));if(e)t+="?rnd="+CABLES.uuid();if(String(i.get()).indexOf("data:")==0)t=i.get();let n=false;if(b!=i.get())n=true;b=i.get();if(i.get()&&i.get().length>1){d.set(false);f.set(true);const a=i.get();r.setUiAttrib({extendTitle:CABLES.basename(t)});if(n)r.refreshParams();h.patch.loading.addAssetLoadingTask(()=>{r.setUiError("urlerror",null);CGL.Texture.load(h,t,function(e,t){if(i.get()!=a){h.patch.loading.finished(v);v=null;return}if(e){E();r.setUiError("urlerror",'could not load texture:<br/>"'+i.get()+'"',2);h.patch.loading.finished(v);return}m.set(t);c.set(t.width);g.set(t.height);p.set(t.width/t.height);if(!t.isPowerOfTwo())r.setUiError("npot","Texture dimensions not power of two! - Texture filtering will not work in WebGL 1.",0);else r.setUiError("npot",null);if(O)O.delete();O=t;m.set(null);m.set(O);f.set(false);d.set(true);if(u.get())O.image=null;h.patch.loading.finished(v)},{anisotropic:_,wrap:I,flip:o.get(),unpackAlpha:s.get(),filter:T})})}else{h.patch.loading.finished(v);E()}}function C(){if(t.get()=="nearest")T=CGL.Texture.FILTER_NEAREST;else if(t.get()=="linear")T=CGL.Texture.FILTER_LINEAR;else if(t.get()=="mipmap")T=CGL.Texture.FILTER_MIPMAP;else if(t.get()=="Anisotropic")T=CGL.Texture.FILTER_ANISOTROPIC;_=parseFloat(a.get());S()}function L(){if(n.get()=="repeat")I=CGL.Texture.WRAP_REPEAT;if(n.get()=="mirrored repeat")I=CGL.Texture.WRAP_MIRRORED_REPEAT;if(n.get()=="clamp to edge")I=CGL.Texture.WRAP_CLAMP_TO_EDGE;S()}r.onFileChanged=function(e){if(i.get()&&i.get().indexOf(e)>-1){m.set(CGL.Texture.getEmptyTexture(r.patch.cgl));m.set(CGL.Texture.getTempTexture(h));A(true)}}};Ops.Gl.Texture_v2.prototype=new CABLES.Op;CABLES.OPS["790f3702-9833-464e-8e37-6f0f813f7e16"]={f:Ops.Gl.Texture_v2,objName:"Ops.Gl.Texture_v2"};Ops.Ui.PatchInput=function(){CABLES.Op.apply(this,arguments);const r=this;const e={};const i=r.addOutPort(new CABLES.Port(r,"create port",CABLES.OP_PORT_TYPE_DYNAMIC));function o(){for(let e in r.patch.ops){if(r.patch.ops[e].patchId){if(r.patch.ops[e].patchId.get()==r.uiAttribs.subPatch){return r.patch.ops[e]}}}}i.onLinkChanged=()=>{const e=o();if(!i.links.length)return;const t=i.links[0].getOtherPort(i);i.removeLinks();const n=e.addNewInPort(t);const a=gui.scene().link(t.parent,t.getName(),r,n);e.saveData()}};Ops.Ui.PatchInput.prototype=new CABLES.Op;CABLES.OPS["e3f68bc3-892a-4c78-9974-aca25c27025d"]={f:Ops.Ui.PatchInput,objName:"Ops.Ui.PatchInput"};Ops.Ui.PatchOutput=function(){CABLES.Op.apply(this,arguments);const r=this;const e={};const i=r.addInPort(new CABLES.Port(r,"create port",CABLES.OP_PORT_TYPE_DYNAMIC));function o(){for(let e in r.patch.ops){if(r.patch.ops[e].patchId){if(r.patch.ops[e].patchId.get()==r.uiAttribs.subPatch){return r.patch.ops[e]}}}}i.onLinkChanged=()=>{const e=o();if(!i.links.length)return;const t=i.links[0].getOtherPort(i);i.removeLinks();const n=e.addNewOutPort(t);const a=gui.scene().link(t.parent,t.getName(),r,n);e.saveData()}};Ops.Ui.PatchOutput.prototype=new CABLES.Op;CABLES.OPS["851b44cb-5667-4140-9800-5aeb7031f1d7"]={f:Ops.Ui.PatchOutput,objName:"Ops.Ui.PatchOutput"};Ops.Ui.SubPatch=function(){CABLES.Op.apply(this,arguments);const u=this;const e={};u.dyn=u.addInPort(new CABLES.Port(u,"create port",CABLES.OP_PORT_TYPE_DYNAMIC));u.dynOut=u.addOutPort(new CABLES.Port(u,"create port out",CABLES.OP_PORT_TYPE_DYNAMIC));const t=u.addInPort(new CABLES.Port(u,"dataStr",CABLES.OP_PORT_TYPE_VALUE,{display:"readonly"}));u.patchId=u.addInPort(new CABLES.Port(u,"patchId",CABLES.OP_PORT_TYPE_VALUE,{display:"readonly"}));if(CABLES.UI&&CABLES.sandbox.isDevEnv()){const s=u.inTriggerButton("Create Blueprint");s.setUiAttribs({hidePort:true});s.onTriggered=r}t.setUiAttribs({hideParam:true});u.patchId.setUiAttribs({hideParam:true});let m={ports:[],portsOut:[]};u.patchId.onChange=function(){const t=u.patch.getSubPatchOps(n);if(t.length==2){for(let e=0;e<t.length;e++){u.patch.deleteOp(t[e].id)}}else{}};var n=CABLES.generateUUID();u.patchId.set(n);u.onLoaded=function(){};u.onLoadedValueSet=function(){m=JSON.parse(t.get());if(!m){m={ports:[],portsOut:[]}}o()};function a(){}d();p();let c=false;t.onChange=function(){if(c)return;if(!t.get())return;try{a()}catch(e){u.logError("cannot load subpatch data...");u.logError(e)}};function i(){t.set(JSON.stringify(m))}u.saveData=i;function g(n,e){n.addEventListener("onUiAttrChange",function(t){if(t.title){let e=0;for(e=0;e<m.portsOut.length;e++)if(m.portsOut[e].name==n.name)m.portsOut[e].title=t.title;for(e=0;e<m.ports.length;e++)if(m.ports[e].name==n.name)m.ports[e].title=t.title;i()}});if(n.direction==CABLES.PORT_DIR_IN){if(n.type==CABLES.OP_PORT_TYPE_FUNCTION){n.onTriggered=function(){if(e.isLinked())e.trigger()}}else{n.onChange=function(){e.set(n.get())}}}}function o(){if(!u.patchId.get())return;const e=m.ports||[];const t=m.portsOut||[];let n=0;for(n=0;n<e.length;n++){if(!u.getPortByName(e[n].name)){const a=u.addInPort(new CABLES.Port(u,e[n].name,e[n].type));const r=d();const i=r.addOutPort(new CABLES.Port(r,e[n].name,e[n].type));a.ignoreValueSerialize=true;a.setUiAttribs({editableTitle:true});if(e[n].title){a.setUiAttribs({title:e[n].title});i.setUiAttribs({title:e[n].title})}if(e[n].objType){a.setUiAttribs({objType:e[n].objType});i.setUiAttribs({objType:e[n].objType})}g(a,i)}}for(n=0;n<t.length;n++){if(!u.getPortByName(t[n].name)){const o=u.addOutPort(new CABLES.Port(u,t[n].name,t[n].type));const s=p();const l=s.addInPort(new CABLES.Port(s,t[n].name,t[n].type));o.ignoreValueSerialize=true;o.setUiAttribs({editableTitle:true});if(t[n].title){o.setUiAttribs({title:t[n].title});l.setUiAttribs({title:t[n].title})}if(t[n].objType){o.setUiAttribs({objType:t[n].objType});l.setUiAttribs({objType:t[n].objType})}g(l,o)}}c=true}u.addNewInPort=function(e,t,n){const a="in"+m.ports.length+" "+e.parent.name+" "+e.name;const r={name:a,type:e.type};if(e.uiAttribs.objType)r.objType=e.uiAttribs.objType;m.ports.push(r);o();return a};u.dyn.onLinkChanged=function(){if(u.dyn.isLinked()){const e=u.dyn.links[0].getOtherPort(u.dyn);u.dyn.removeLinks();e.removeLinkTo(u.dyn);u.log("dyn link changed!!!");const t=u.addNewInPort(e);const n=gui.scene().link(e.parent,e.getName(),u,t);c=true;i()}else{setTimeout(function(){u.dyn.removeLinks()},100)}};u.addNewOutPort=function(e,t,n){const a="out"+m.portsOut.length+" "+e.parent.name+" "+e.name;const r={name:a,type:e.type};if(e.uiAttribs.objType)r.objType=e.uiAttribs.objType;m.portsOut.push(r);o();return a};u.dynOut.onLinkChanged=function(){if(u.dynOut.isLinked()){const e=u.dynOut.links[0].getOtherPort(u.dynOut);u.dynOut.removeLinks();e.removeLinkTo(u.dynOut);const t=u.addNewOutPort(e);gui.scene().link(e.parent,e.getName(),u,t);c=true;i()}else{setTimeout(function(){u.dynOut.removeLinks()},100);u.log("dynOut unlinked...")}};function p(){let e=u.patch.getSubPatchOp(u.patchId.get(),"Ops.Ui.PatchOutput");if(!e){u.patch.addOp("Ops.Ui.PatchOutput",{subPatch:u.patchId.get()});e=u.patch.getSubPatchOp(u.patchId.get(),"Ops.Ui.PatchOutput");if(!e)u.warn("no patchinput2!")}return e}function d(){let e=u.patch.getSubPatchOp(u.patchId.get(),"Ops.Ui.PatchInput");if(!e){u.patch.addOp("Ops.Ui.PatchInput",{subPatch:u.patchId.get()});e=u.patch.getSubPatchOp(u.patchId.get(),"Ops.Ui.PatchInput");if(!e)u.warn("no patchinput2!")}return e}u.addSubLink=function(e,t){const n=m.ports.length;const a="in"+(n-1)+" "+t.parent.name+" "+t.name;if(e.direction==CABLES.PORT_DIR_IN){gui.scene().link(e.parent,e.getName(),d(),a)}else{gui.scene().link(e.parent,e.getName(),p(),"out"+n+" "+t.parent.name+" "+t.name)}const r=gui.patchView.getSubPatchBounds(u.patchId.get());u.log("subpatchbounds",r);d().uiAttr({translate:{x:r.minx,y:r.miny-100}});p().uiAttr({translate:{x:r.minx,y:r.maxy+100}});i();return a};u.onDelete=function(){for(let e=u.patch.ops.length-1;e>=0;e--){if(u.patch.ops[e]&&u.patch.ops[e].uiAttribs&&u.patch.ops[e].uiAttribs.subPatch==u.patchId.get()){u.patch.deleteOp(u.patch.ops[e].id)}}};function r(){const e=u.patch.addOp(CABLES.UI.DEFAULTOPNAMES.blueprint);e.getPortByName("externalPatchId").set(gui.patchId);e.getPortByName("subPatchId").set(u.patchId.get());e.getPortByName("active").set(true);e.uiAttr({translate:{x:u.uiAttribs.translate.x-150,y:u.uiAttribs.translate.y}})}};Ops.Ui.SubPatch.prototype=new CABLES.Op;CABLES.OPS["84d9a6f0-ed7a-466d-b386-225ed9e89c60"]={f:Ops.Ui.SubPatch,objName:"Ops.Ui.SubPatch"};Ops.Sidebar.Sidebar=function(){CABLES.Op.apply(this,arguments);const o=this;const n={style_css:" /*\n * SIDEBAR\n  http://danielstern.ca/range.css/#/\n  https://developer.mozilla.org/en-US/docs/Web/CSS/::-webkit-progress-value\n */\n\n.sidebar-icon-undo\n{\n    width:10px;\n    height:10px;\n    background-image: url(\"data:image/svg+xml;charset=utf8, %3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' fill='none' stroke='grey' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M3 7v6h6'/%3E%3Cpath d='M21 17a9 9 0 00-9-9 9 9 0 00-6 2.3L3 13'/%3E%3C/svg%3E\");\n    background-size: 19px;\n    background-repeat: no-repeat;\n    top: -19px;\n    margin-top: -7px;\n}\n\n.icon-chevron-down {\n    top: 2px;\n    right: 9px;\n}\n\n.iconsidebar-chevron-up,.sidebar__close-button {\n\tbackground-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiM4ODg4ODgiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBjbGFzcz0iZmVhdGhlciBmZWF0aGVyLWNoZXZyb24tdXAiPjxwb2x5bGluZSBwb2ludHM9IjE4IDE1IDEyIDkgNiAxNSI+PC9wb2x5bGluZT48L3N2Zz4=);\n}\n\n.iconsidebar-minimizebutton {\n    background-position: 98% center;\n    background-repeat: no-repeat;\n}\n\n.sidebar-cables-right\n{\n    right: 15px;\n    left: initial !important;\n}\n\n.sidebar-cables {\n    --sidebar-color: #07f78c;\n    --sidebar-width: 220px;\n    --sidebar-border-radius: 10px;\n    --sidebar-monospace-font-stack: \"SFMono-Regular\", Consolas, \"Liberation Mono\", Menlo, Courier, monospace;\n    --sidebar-hover-transition-time: .2s;\n\n    position: absolute;\n    top: 15px;\n    left: 15px;\n    border-radius: var(--sidebar-border-radius);\n    z-index: 100000;\n    color: #BBBBBB;\n    width: var(  --sidebar-width);\n    max-height: 100%;\n    box-sizing: border-box;\n    overflow-y: auto;\n    overflow-x: hidden;\n    font-size: 13px;\n    font-family: Arial;\n    line-height: 1em; /* prevent emojis from breaking height of the title */\n}\n\n.sidebar-cables::selection {\n    background-color: var(--sidebar-color);\n    color: #EEEEEE;\n}\n\n.sidebar-cables::-webkit-scrollbar {\n    background-color: transparent;\n    --cables-scrollbar-width: 8px;\n    width: var(--cables-scrollbar-width);\n}\n\n.sidebar-cables::-webkit-scrollbar-track {\n    background-color: transparent;\n    width: var(--cables-scrollbar-width);\n}\n\n.sidebar-cables::-webkit-scrollbar-thumb {\n    background-color: #333333;\n    border-radius: 4px;\n    width: var(--cables-scrollbar-width);\n}\n\n.sidebar-cables--closed {\n    width: auto;\n}\n\n.sidebar__close-button {\n    background-color: #222;\n    /*-webkit-user-select: none;  */\n    /*-moz-user-select: none;     */\n    /*-ms-user-select: none;      */\n    /*user-select: none;          */\n    /*transition: background-color var(--sidebar-hover-transition-time);*/\n    /*color: #CCCCCC;*/\n    height: 2px;\n    /*border-bottom:20px solid #222;*/\n\n    /*box-sizing: border-box;*/\n    /*padding-top: 2px;*/\n    /*text-align: center;*/\n    /*cursor: pointer;*/\n    /*border-radius: 0 0 var(--sidebar-border-radius) var(--sidebar-border-radius);*/\n    /*opacity: 1.0;*/\n    /*transition: opacity 0.3s;*/\n    /*overflow: hidden;*/\n}\n\n.sidebar__close-button-icon {\n    display: inline-block;\n    /*opacity: 0;*/\n    width: 20px;\n    height: 20px;\n    /*position: relative;*/\n    /*top: -1px;*/\n\n\n}\n\n.sidebar--closed {\n    width: auto;\n    margin-right: 20px;\n}\n\n.sidebar--closed .sidebar__close-button {\n    margin-top: 8px;\n    margin-left: 8px;\n    padding:10px;\n\n    height: 25px;\n    width:25px;\n    border-radius: 50%;\n    cursor: pointer;\n    opacity: 0.3;\n    background-repeat: no-repeat;\n    background-position: center center;\n    transform:rotate(180deg);\n}\n\n.sidebar--closed .sidebar__group\n{\n    display:none;\n\n}\n.sidebar--closed .sidebar__close-button-icon {\n    background-position: 0px 0px;\n}\n\n.sidebar__close-button:hover {\n    background-color: #111111;\n    opacity: 1.0 !important;\n}\n\n/*\n * SIDEBAR ITEMS\n */\n\n.sidebar__items {\n    /* max-height: 1000px; */\n    /* transition: max-height 0.5;*/\n    background-color: #222;\n    padding-bottom: 20px;\n}\n\n.sidebar--closed .sidebar__items {\n    /* max-height: 0; */\n    height: 0;\n    display: none;\n    pointer-interactions: none;\n}\n\n.sidebar__item__right {\n    float: right;\n}\n\n/*\n * SIDEBAR GROUP\n */\n\n.sidebar__group {\n    /*background-color: #1A1A1A;*/\n    overflow: hidden;\n    box-sizing: border-box;\n    animate: height;\n    /*background-color: #151515;*/\n    /* max-height: 1000px; */\n    /* transition: max-height 0.5s; */\n--sidebar-group-header-height: 33px;\n}\n\n.sidebar__group-items\n{\n    padding-top: 15px;\n    padding-bottom: 15px;\n}\n\n.sidebar__group--closed {\n    /* max-height: 13px; */\n    height: var(--sidebar-group-header-height);\n}\n\n.sidebar__group-header {\n    box-sizing: border-box;\n    color: #EEEEEE;\n    background-color: #151515;\n    -webkit-user-select: none;  /* Chrome all / Safari all */\n    -moz-user-select: none;     /* Firefox all */\n    -ms-user-select: none;      /* IE 10+ */\n    user-select: none;          /* Likely future */\n\n    /*height: 100%;//var(--sidebar-group-header-height);*/\n\n    padding-top: 7px;\n    text-transform: uppercase;\n    letter-spacing: 0.08em;\n    cursor: pointer;\n    /*transition: background-color var(--sidebar-hover-transition-time);*/\n    position: relative;\n}\n\n.sidebar__group-header:hover {\n  background-color: #111111;\n}\n\n.sidebar__group-header-title {\n  /*float: left;*/\n  overflow: hidden;\n  padding: 0 15px;\n  padding-top:5px;\n  padding-bottom:10px;\n  font-weight:bold;\n}\n\n.sidebar__group-header-undo {\n    float: right;\n    overflow: hidden;\n    padding-right: 15px;\n    padding-top:5px;\n    font-weight:bold;\n  }\n\n.sidebar__group-header-icon {\n    width: 17px;\n    height: 14px;\n    background-repeat: no-repeat;\n    display: inline-block;\n    position: absolute;\n    background-size: cover;\n\n    /* icon open */\n    /* feather icon: chevron up */\n    background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiM4ODg4ODgiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBjbGFzcz0iZmVhdGhlciBmZWF0aGVyLWNoZXZyb24tdXAiPjxwb2x5bGluZSBwb2ludHM9IjE4IDE1IDEyIDkgNiAxNSI+PC9wb2x5bGluZT48L3N2Zz4=);\n    top: 4px;\n    right: 5px;\n    opacity: 0.0;\n    transition: opacity 0.3;\n}\n\n.sidebar__group-header:hover .sidebar__group-header-icon {\n    opacity: 1.0;\n}\n\n/* icon closed */\n.sidebar__group--closed .sidebar__group-header-icon {\n    /* feather icon: chevron down */\n    background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiM4ODg4ODgiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBjbGFzcz0iZmVhdGhlciBmZWF0aGVyLWNoZXZyb24tZG93biI+PHBvbHlsaW5lIHBvaW50cz0iNiA5IDEyIDE1IDE4IDkiPjwvcG9seWxpbmU+PC9zdmc+);\n    top: 4px;\n    right: 5px;\n}\n\n/*\n * SIDEBAR ITEM\n */\n\n.sidebar__item\n{\n    box-sizing: border-box;\n    padding: 7px;\n    padding-left:15px;\n    padding-right:15px;\n\n    overflow: hidden;\n    position: relative;\n}\n\n.sidebar__item-label {\n    display: inline-block;\n    -webkit-user-select: none;  /* Chrome all / Safari all */\n    -moz-user-select: none;     /* Firefox all */\n    -ms-user-select: none;      /* IE 10+ */\n    user-select: none;          /* Likely future */\n    width: calc(50% - 7px);\n    margin-right: 7px;\n    margin-top: 2px;\n    text-overflow: ellipsis;\n    /* overflow: hidden; */\n}\n\n.sidebar__item-value-label {\n    font-family: var(--sidebar-monospace-font-stack);\n    display: inline-block;\n    text-overflow: ellipsis;\n    overflow: hidden;\n    white-space: nowrap;\n    max-width: 60%;\n}\n\n.sidebar__item-value-label::selection {\n    background-color: var(--sidebar-color);\n    color: #EEEEEE;\n}\n\n.sidebar__item + .sidebar__item,\n.sidebar__item + .sidebar__group,\n.sidebar__group + .sidebar__item,\n.sidebar__group + .sidebar__group {\n    /*border-top: 1px solid #272727;*/\n}\n\n/*\n * SIDEBAR ITEM TOGGLE\n */\n\n/*.sidebar__toggle */\n.icon_toggle{\n    cursor: pointer;\n}\n\n.sidebar__toggle-input {\n    --sidebar-toggle-input-color: #CCCCCC;\n    --sidebar-toggle-input-color-hover: #EEEEEE;\n    --sidebar-toggle-input-border-size: 2px;\n    display: inline;\n    float: right;\n    box-sizing: border-box;\n    border-radius: 50%;\n    cursor: pointer;\n    --toggle-size: 11px;\n    margin-top: 2px;\n    background-color: transparent !important;\n    border: var(--sidebar-toggle-input-border-size) solid var(--sidebar-toggle-input-color);\n    width: var(--toggle-size);\n    height: var(--toggle-size);\n    transition: background-color var(--sidebar-hover-transition-time);\n    transition: border-color var(--sidebar-hover-transition-time);\n}\n.sidebar__toggle:hover .sidebar__toggle-input {\n    border-color: var(--sidebar-toggle-input-color-hover);\n}\n\n.sidebar__toggle .sidebar__item-value-label {\n    -webkit-user-select: none;  /* Chrome all / Safari all */\n    -moz-user-select: none;     /* Firefox all */\n    -ms-user-select: none;      /* IE 10+ */\n    user-select: none;          /* Likely future */\n    max-width: calc(50% - 12px);\n}\n.sidebar__toggle-input::after { clear: both; }\n\n.sidebar__toggle--active .icon_toggle\n{\n\n    background-image: url(data:image/svg+xml;base64,PHN2ZyBoZWlnaHQ9IjE1cHgiIHdpZHRoPSIzMHB4IiBmaWxsPSIjMDZmNzhiIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB2ZXJzaW9uPSIxLjEiIHg9IjBweCIgeT0iMHB4IiB2aWV3Qm94PSIwIDAgMTAwIDEwMCIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgMTAwIDEwMCIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+PGcgZGlzcGxheT0ibm9uZSI+PGcgZGlzcGxheT0iaW5saW5lIj48Zz48cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZmlsbD0iIzA2Zjc4YiIgZD0iTTMwLDI3QzE3LjM1LDI3LDcsMzcuMzUsNyw1MGwwLDBjMCwxMi42NSwxMC4zNSwyMywyMywyM2g0MCBjMTIuNjUsMCwyMy0xMC4zNSwyMy0yM2wwLDBjMC0xMi42NS0xMC4zNS0yMy0yMy0yM0gzMHogTTcwLDY3Yy05LjM4OSwwLTE3LTcuNjEtMTctMTdzNy42MTEtMTcsMTctMTdzMTcsNy42MSwxNywxNyAgICAgUzc5LjM4OSw2Nyw3MCw2N3oiPjwvcGF0aD48L2c+PC9nPjwvZz48Zz48cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTMwLDI3QzE3LjM1LDI3LDcsMzcuMzUsNyw1MGwwLDBjMCwxMi42NSwxMC4zNSwyMywyMywyM2g0MCAgIGMxMi42NSwwLDIzLTEwLjM1LDIzLTIzbDAsMGMwLTEyLjY1LTEwLjM1LTIzLTIzLTIzSDMweiBNNzAsNjdjLTkuMzg5LDAtMTctNy42MS0xNy0xN3M3LjYxMS0xNywxNy0xN3MxNyw3LjYxLDE3LDE3ICAgUzc5LjM4OSw2Nyw3MCw2N3oiPjwvcGF0aD48L2c+PGcgZGlzcGxheT0ibm9uZSI+PGcgZGlzcGxheT0iaW5saW5lIj48cGF0aCBmaWxsPSIjMDZmNzhiIiBzdHJva2U9IiMwNmY3OGIiIHN0cm9rZS13aWR0aD0iNCIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBkPSJNNyw1MGMwLDEyLjY1LDEwLjM1LDIzLDIzLDIzaDQwICAgIGMxMi42NSwwLDIzLTEwLjM1LDIzLTIzbDAsMGMwLTEyLjY1LTEwLjM1LTIzLTIzLTIzSDMwQzE3LjM1LDI3LDcsMzcuMzUsNyw1MEw3LDUweiI+PC9wYXRoPjwvZz48Y2lyY2xlIGRpc3BsYXk9ImlubGluZSIgZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGZpbGw9IiMwNmY3OGIiIHN0cm9rZT0iIzA2Zjc4YiIgc3Ryb2tlLXdpZHRoPSI0IiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIGN4PSI3MCIgY3k9IjUwIiByPSIxNyI+PC9jaXJjbGU+PC9nPjxnIGRpc3BsYXk9Im5vbmUiPjxwYXRoIGRpc3BsYXk9ImlubGluZSIgZD0iTTcwLDI1SDMwQzE2LjIxNSwyNSw1LDM2LjIxNSw1LDUwczExLjIxNSwyNSwyNSwyNWg0MGMxMy43ODUsMCwyNS0xMS4yMTUsMjUtMjVTODMuNzg1LDI1LDcwLDI1eiBNNzAsNzEgICBIMzBDMTguNDIxLDcxLDksNjEuNTc5LDksNTBzOS40MjEtMjEsMjEtMjFoNDBjMTEuNTc5LDAsMjEsOS40MjEsMjEsMjFTODEuNTc5LDcxLDcwLDcxeiBNNzAsMzFjLTEwLjQ3NywwLTE5LDguNTIzLTE5LDE5ICAgczguNTIzLDE5LDE5LDE5czE5LTguNTIzLDE5LTE5UzgwLjQ3NywzMSw3MCwzMXogTTcwLDY1Yy04LjI3MSwwLTE1LTYuNzI5LTE1LTE1czYuNzI5LTE1LDE1LTE1czE1LDYuNzI5LDE1LDE1Uzc4LjI3MSw2NSw3MCw2NXoiPjwvcGF0aD48L2c+PC9zdmc+);\n    opacity: 1;\n    transform: rotate(0deg);\n}\n\n\n.icon_toggle\n{\n    float: right;\n    width:40px;\n    height:18px;\n    background-image: url(data:image/svg+xml;base64,PHN2ZyBoZWlnaHQ9IjE1cHgiIHdpZHRoPSIzMHB4IiBmaWxsPSIjYWFhYWFhIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB2ZXJzaW9uPSIxLjEiIHg9IjBweCIgeT0iMHB4IiB2aWV3Qm94PSIwIDAgMTAwIDEwMCIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgMTAwIDEwMCIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+PGcgZGlzcGxheT0ibm9uZSI+PGcgZGlzcGxheT0iaW5saW5lIj48Zz48cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZmlsbD0iI2FhYWFhYSIgZD0iTTMwLDI3QzE3LjM1LDI3LDcsMzcuMzUsNyw1MGwwLDBjMCwxMi42NSwxMC4zNSwyMywyMywyM2g0MCBjMTIuNjUsMCwyMy0xMC4zNSwyMy0yM2wwLDBjMC0xMi42NS0xMC4zNS0yMy0yMy0yM0gzMHogTTcwLDY3Yy05LjM4OSwwLTE3LTcuNjEtMTctMTdzNy42MTEtMTcsMTctMTdzMTcsNy42MSwxNywxNyAgICAgUzc5LjM4OSw2Nyw3MCw2N3oiPjwvcGF0aD48L2c+PC9nPjwvZz48Zz48cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTMwLDI3QzE3LjM1LDI3LDcsMzcuMzUsNyw1MGwwLDBjMCwxMi42NSwxMC4zNSwyMywyMywyM2g0MCAgIGMxMi42NSwwLDIzLTEwLjM1LDIzLTIzbDAsMGMwLTEyLjY1LTEwLjM1LTIzLTIzLTIzSDMweiBNNzAsNjdjLTkuMzg5LDAtMTctNy42MS0xNy0xN3M3LjYxMS0xNywxNy0xN3MxNyw3LjYxLDE3LDE3ICAgUzc5LjM4OSw2Nyw3MCw2N3oiPjwvcGF0aD48L2c+PGcgZGlzcGxheT0ibm9uZSI+PGcgZGlzcGxheT0iaW5saW5lIj48cGF0aCBmaWxsPSIjYWFhYWFhIiBzdHJva2U9IiNhYWFhYWEiIHN0cm9rZS13aWR0aD0iNCIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBkPSJNNyw1MGMwLDEyLjY1LDEwLjM1LDIzLDIzLDIzaDQwICAgIGMxMi42NSwwLDIzLTEwLjM1LDIzLTIzbDAsMGMwLTEyLjY1LTEwLjM1LTIzLTIzLTIzSDMwQzE3LjM1LDI3LDcsMzcuMzUsNyw1MEw3LDUweiI+PC9wYXRoPjwvZz48Y2lyY2xlIGRpc3BsYXk9ImlubGluZSIgZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGZpbGw9IiNhYWFhYWEiIHN0cm9rZT0iI2FhYWFhYSIgc3Ryb2tlLXdpZHRoPSI0IiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIGN4PSI3MCIgY3k9IjUwIiByPSIxNyI+PC9jaXJjbGU+PC9nPjxnIGRpc3BsYXk9Im5vbmUiPjxwYXRoIGRpc3BsYXk9ImlubGluZSIgZD0iTTcwLDI1SDMwQzE2LjIxNSwyNSw1LDM2LjIxNSw1LDUwczExLjIxNSwyNSwyNSwyNWg0MGMxMy43ODUsMCwyNS0xMS4yMTUsMjUtMjVTODMuNzg1LDI1LDcwLDI1eiBNNzAsNzEgICBIMzBDMTguNDIxLDcxLDksNjEuNTc5LDksNTBzOS40MjEtMjEsMjEtMjFoNDBjMTEuNTc5LDAsMjEsOS40MjEsMjEsMjFTODEuNTc5LDcxLDcwLDcxeiBNNzAsMzFjLTEwLjQ3NywwLTE5LDguNTIzLTE5LDE5ICAgczguNTIzLDE5LDE5LDE5czE5LTguNTIzLDE5LTE5UzgwLjQ3NywzMSw3MCwzMXogTTcwLDY1Yy04LjI3MSwwLTE1LTYuNzI5LTE1LTE1czYuNzI5LTE1LDE1LTE1czE1LDYuNzI5LDE1LDE1Uzc4LjI3MSw2NSw3MCw2NXoiPjwvcGF0aD48L2c+PC9zdmc+);\n    background-size: 50px 37px;\n    background-position: -6px -10px;\n    transform: rotate(180deg);\n    opacity: 0.4;\n}\n\n\n\n/*.sidebar__toggle--active .sidebar__toggle-input {*/\n/*    transition: background-color var(--sidebar-hover-transition-time);*/\n/*    background-color: var(--sidebar-toggle-input-color);*/\n/*}*/\n/*.sidebar__toggle--active .sidebar__toggle-input:hover*/\n/*{*/\n/*    background-color: var(--sidebar-toggle-input-color-hover);*/\n/*    border-color: var(--sidebar-toggle-input-color-hover);*/\n/*    transition: background-color var(--sidebar-hover-transition-time);*/\n/*    transition: border-color var(--sidebar-hover-transition-time);*/\n/*}*/\n\n/*\n * SIDEBAR ITEM BUTTON\n */\n\n.sidebar__button {}\n\n.sidebar__button-input {\n    -webkit-user-select: none;  /* Chrome all / Safari all */\n    -moz-user-select: none;     /* Firefox all */\n    -ms-user-select: none;      /* IE 10+ */\n    user-select: none;          /* Likely future */\n    min-height: 24px;\n    background-color: transparent;\n    color: #CCCCCC;\n    box-sizing: border-box;\n    padding-top: 3px;\n    text-align: center;\n    border-radius: 125px;\n    border:2px solid #555;\n    cursor: pointer;\n    padding-bottom: 3px;\n}\n\n.sidebar__button-input.plus, .sidebar__button-input.minus {\n    display: inline-block;\n    min-width: 20px;\n}\n\n.sidebar__button-input:hover {\n  background-color: #333;\n  border:2px solid var(--sidebar-color);\n}\n\n/*\n * VALUE DISPLAY (shows a value)\n */\n\n.sidebar__value-display {}\n\n/*\n * SLIDER\n */\n\n.sidebar__slider {\n    --sidebar-slider-input-height: 3px;\n}\n\n.sidebar__slider-input-wrapper {\n    width: 100%;\n\n    margin-top: 8px;\n    position: relative;\n}\n\n.sidebar__slider-input {\n    -webkit-appearance: none;\n    appearance: none;\n    margin: 0;\n    width: 100%;\n    height: var(--sidebar-slider-input-height);\n    background: #555;\n    cursor: pointer;\n    outline: 0;\n\n    -webkit-transition: .2s;\n    transition: background-color .2s;\n    border: none;\n}\n\n.sidebar__slider-input:focus, .sidebar__slider-input:hover {\n    border: none;\n}\n\n.sidebar__slider-input-active-track {\n    user-select: none;\n    position: absolute;\n    z-index: 11;\n    top: 0;\n    left: 0;\n    background-color: var(--sidebar-color);\n    pointer-events: none;\n    height: var(--sidebar-slider-input-height);\n    max-width: 100%;\n}\n\n/* Mouse-over effects */\n.sidebar__slider-input:hover {\n    /*background-color: #444444;*/\n}\n\n/*.sidebar__slider-input::-webkit-progress-value {*/\n/*    background-color: green;*/\n/*    color:green;*/\n\n/*    }*/\n\n/* The slider handle (use -webkit- (Chrome, Opera, Safari, Edge) and -moz- (Firefox) to override default look) */\n\n.sidebar__slider-input::-moz-range-thumb\n{\n    position: absolute;\n    height: 15px;\n    width: 15px;\n    z-index: 900 !important;\n    border-radius: 20px !important;\n    cursor: pointer;\n    background: var(--sidebar-color) !important;\n    user-select: none;\n\n}\n\n.sidebar__slider-input::-webkit-slider-thumb\n{\n    position: relative;\n    appearance: none;\n    -webkit-appearance: none;\n    user-select: none;\n    height: 15px;\n    width: 15px;\n    display: block;\n    z-index: 900 !important;\n    border: 0;\n    border-radius: 20px !important;\n    cursor: pointer;\n    background: #777 !important;\n}\n\n.sidebar__slider-input:hover ::-webkit-slider-thumb {\n    background-color: #EEEEEE !important;\n}\n\n/*.sidebar__slider-input::-moz-range-thumb {*/\n\n/*    width: 0 !important;*/\n/*    height: var(--sidebar-slider-input-height);*/\n/*    background: #EEEEEE;*/\n/*    cursor: pointer;*/\n/*    border-radius: 0 !important;*/\n/*    border: none;*/\n/*    outline: 0;*/\n/*    z-index: 100 !important;*/\n/*}*/\n\n.sidebar__slider-input::-moz-range-track {\n    background-color: transparent;\n    z-index: 11;\n}\n\n/*.sidebar__slider-input::-moz-range-thumb:hover {*/\n  /* background-color: #EEEEEE; */\n/*}*/\n\n\n/*.sidebar__slider-input-wrapper:hover .sidebar__slider-input-active-track {*/\n/*    background-color: #EEEEEE;*/\n/*}*/\n\n/*.sidebar__slider-input-wrapper:hover .sidebar__slider-input::-moz-range-thumb {*/\n/*    background-color: #fff !important;*/\n/*}*/\n\n/*.sidebar__slider-input-wrapper:hover .sidebar__slider-input::-webkit-slider-thumb {*/\n/*    background-color: #EEEEEE;*/\n/*}*/\n\n.sidebar__slider input[type=text] {\n    box-sizing: border-box;\n    /*background-color: #333333;*/\n    text-align: right;\n    color: #BBBBBB;\n    display: inline-block;\n    background-color: transparent !important;\n\n    width: 40%;\n    height: 18px;\n    outline: none;\n    border: none;\n    border-radius: 0;\n    padding: 0 0 0 4px !important;\n    margin: 0;\n}\n\n.sidebar__slider input[type=text]:active,\n.sidebar__slider input[type=text]:focus,\n.sidebar__slider input[type=text]:hover {\n\n    color: #EEEEEE;\n}\n\n/*\n * TEXT / DESCRIPTION\n */\n\n.sidebar__text .sidebar__item-label {\n    width: auto;\n    display: block;\n    max-height: none;\n    margin-right: 0;\n    line-height: 1.1em;\n}\n\n/*\n * SIDEBAR INPUT\n */\n.sidebar__text-input textarea,\n.sidebar__text-input input[type=text] {\n    box-sizing: border-box;\n    background-color: #333333;\n    color: #BBBBBB;\n    display: inline-block;\n    width: 50%;\n    height: 18px;\n    outline: none;\n    border: none;\n    border-radius: 0;\n    border:1px solid #666;\n    padding: 0 0 0 4px !important;\n    margin: 0;\n}\n\n.sidebar__text-input textarea:focus::placeholder {\n  color: transparent;\n}\n\n.sidebar__color-picker .sidebar__item-label\n{\n    width:45%;\n}\n\n.sidebar__text-input textarea,\n.sidebar__text-input input[type=text]:active,\n.sidebar__text-input input[type=text]:focus,\n.sidebar__text-input input[type=text]:hover {\n    background-color: transparent;\n    color: #EEEEEE;\n}\n\n.sidebar__text-input textarea\n{\n    margin-top:10px;\n    height:60px;\n    width:100%;\n}\n\n/*\n * SIDEBAR SELECT\n */\n\n\n\n .sidebar__select {}\n .sidebar__select-select {\n    color: #BBBBBB;\n    /*-webkit-appearance: none;*/\n    /*-moz-appearance: none;*/\n    appearance: none;\n    /*box-sizing: border-box;*/\n    width: 50%;\n    /*height: 20px;*/\n    background-color: #333333;\n    /*background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiM4ODg4ODgiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBjbGFzcz0iZmVhdGhlciBmZWF0aGVyLWNoZXZyb24tZG93biI+PHBvbHlsaW5lIHBvaW50cz0iNiA5IDEyIDE1IDE4IDkiPjwvcG9seWxpbmU+PC9zdmc+);*/\n    background-repeat: no-repeat;\n    background-position: right center;\n    background-size: 16px 16px;\n    margin: 0;\n    /*padding: 0 2 2 6px;*/\n    border-radius: 5px;\n    border: 1px solid #777;\n    background-color: #444;\n    cursor: pointer;\n    outline: none;\n    padding-left: 5px;\n\n }\n\n.sidebar__select-select:hover,\n.sidebar__select-select:active,\n.sidebar__select-select:active {\n    background-color: #444444;\n    color: #EEEEEE;\n}\n\n/*\n * COLOR PICKER\n */\n\n\n .sidebar__color-picker input[type=text] {\n    box-sizing: border-box;\n    background-color: #333333;\n    color: #BBBBBB;\n    display: inline-block;\n    width: calc(50% - 21px); /* 50% minus space of picker circle */\n    height: 18px;\n    outline: none;\n    border: none;\n    border-radius: 0;\n    padding: 0 0 0 4px !important;\n    margin: 0;\n    margin-right: 7px;\n}\n\n.sidebar__color-picker input[type=text]:active,\n.sidebar__color-picker input[type=text]:focus,\n.sidebar__color-picker input[type=text]:hover {\n    background-color: #444444;\n    color: #EEEEEE;\n}\n\ndiv.sidebar__color-picker-color-input,\n.sidebar__color-picker input[type=color],\n.sidebar__palette-picker input[type=color] {\n    display: inline-block;\n    border-radius: 100%;\n    height: 14px;\n    width: 14px;\n\n    padding: 0;\n    border: none;\n    /*border:2px solid red;*/\n    border-color: transparent;\n    outline: none;\n    background: none;\n    appearance: none;\n    -moz-appearance: none;\n    -webkit-appearance: none;\n    cursor: pointer;\n    position: relative;\n    top: 3px;\n}\n.sidebar__color-picker input[type=color]:focus,\n.sidebar__palette-picker input[type=color]:focus {\n    outline: none;\n}\n.sidebar__color-picker input[type=color]::-moz-color-swatch,\n.sidebar__palette-picker input[type=color]::-moz-color-swatch {\n    border: none;\n}\n.sidebar__color-picker input[type=color]::-webkit-color-swatch-wrapper,\n.sidebar__palette-picker input[type=color]::-webkit-color-swatch-wrapper {\n    padding: 0;\n}\n.sidebar__color-picker input[type=color]::-webkit-color-swatch,\n.sidebar__palette-picker input[type=color]::-webkit-color-swatch {\n    border: none;\n    border-radius: 100%;\n}\n\n/*\n * Palette Picker\n */\n.sidebar__palette-picker .sidebar__palette-picker-color-input.first {\n    margin-left: 0;\n}\n.sidebar__palette-picker .sidebar__palette-picker-color-input.last {\n    margin-right: 0;\n}\n.sidebar__palette-picker .sidebar__palette-picker-color-input {\n    margin: 0 4px;\n}\n\n.sidebar__palette-picker .circlebutton {\n    width: 14px;\n    height: 14px;\n    border-radius: 1em;\n    display: inline-block;\n    top: 3px;\n    position: relative;\n}\n\n/*\n * Preset\n */\n.sidebar__item-presets-preset\n{\n    padding:4px;\n    cursor:pointer;\n    padding-left:8px;\n    padding-right:8px;\n    margin-right:4px;\n    background-color:#444;\n}\n\n.sidebar__item-presets-preset:hover\n{\n    background-color:#666;\n}\n\n.sidebar__greyout\n{\n    background: #222;\n    opacity: 0.8;\n    width: 100%;\n    height: 100%;\n    position: absolute;\n    z-index: 1000;\n    right: 0;\n    top: 0;\n}\n\n.sidebar_tabs\n{\n    background-color: #151515;\n    padding-bottom: 0px;\n}\n\n.sidebar_switchs\n{\n    float: right;\n}\n\n.sidebar_tab\n{\n    float:left;\n    background-color: #151515;\n    border-bottom:1px solid transparent;\n    padding-right:7px;\n    padding-left:7px;\n    padding-bottom: 5px;\n    padding-top: 5px;\n    cursor:pointer;\n}\n\n.sidebar_tab_active\n{\n    background-color: #272727;\n    color:white;\n}\n\n.sidebar_tab:hover\n{\n    border-bottom:1px solid #777;\n    color:white;\n}\n\n\n.sidebar_switch\n{\n    float:left;\n    background-color: #444;\n    padding-right:7px;\n    padding-left:7px;\n    padding-bottom: 5px;\n    padding-top: 5px;\n    cursor:pointer;\n}\n\n.sidebar_switch:last-child\n{\n    border-top-right-radius: 7px;\n    border-bottom-right-radius: 7px;\n}\n\n.sidebar_switch:first-child\n{\n    border-top-left-radius: 7px;\n    border-bottom-left-radius: 7px;\n}\n\n\n.sidebar_switch_active\n{\n    background-color: #999;\n    color:white;\n}\n\n.sidebar_switch:hover\n{\n    color:white;\n}\n"};const a="cables-sidebar-style";const r="cables-sidebar-dynamic-style";const s="sidebar-cables";const l="sidebar"+CABLES.uuid();const u="sidebar__items";const m="sidebar__close-button";const i="";const c="";let g=null;let e=null;let p=null;const t=o.inValueBool("Visible",true);const d=o.inValueSlider("Opacity",1);const f=o.inValueBool("Default Minimized");const h=o.inValueSlider("Minimized Opacity",.5);const b=o.inValueBool("Show undo button",false);const v=o.inValueBool("Show Minimize",false);const O=o.inString("Title","Sidebar");const T=o.inValueBool("Side");const I=o.outObject("childs");I.setUiAttribs({title:"Children"});const _=o.outBool("Opfened");_.setUiAttribs({title:"Opened"});let x=document.querySelector("."+l);if(!x){x=j()}const E=x.querySelector("."+u);I.set({parentElement:E,parentOp:o});N();w();y();t.onChange=M;d.onChange=P;f.onChange=N;h.onChange=S;b.onChange=C;o.onDelete=U;function S(){y()}v.onChange=A;function A(e){if(!e||e.uiAttribs)e=document.querySelector(".sidebar-cables .sidebar__group-header");if(!e)return;const t=document.querySelector(".sidebar-cables .sidebar__group-header .sidebar__group-header-undo");if(v.get()){e.classList.add("iconsidebar-chevron-up");e.classList.add("iconsidebar-minimizebutton");if(t)t.style.marginRight="20px"}else{e.classList.remove("iconsidebar-chevron-up");e.classList.remove("iconsidebar-minimizebutton");if(t)t.style.marginRight="initial"}}T.onChange=function(){if(T.get())x.classList.add("sidebar-cables-right");else x.classList.remove("sidebar-cables-right")};function C(){const e=document.querySelector(".sidebar-cables .sidebar__group-header");if(e){L(e)}}function L(e){if(e){const t=document.querySelector(".sidebar-cables .sidebar__group-header .sidebar__group-header-undo");if(t){if(!b.get()){t.remove()}}else{if(b.get()){const n=document.createElement("span");n.classList.add("sidebar__group-header-undo");n.classList.add("sidebar-icon-undo");n.addEventListener("click",function(e){e.stopPropagation();const t=document.querySelectorAll(".sidebar-cables .sidebar__reloadable");const n=document.createEvent("MouseEvents");n.initEvent("dblclick",true,true);t.forEach(e=>{e.dispatchEvent(n)})});e.appendChild(n)}}}A(e)}function N(){if(!g){return}if(f.get()){x.classList.add("sidebar--closed");if(t.get()){_.set(false)}}else{x.classList.remove("sidebar--closed");if(t.get()){_.set(true)}}}function P(){const e=d.get();x.style.opacity=e}function M(){if(t.get()){x.style.display="block";if(!x.classList.contains("sidebar--closed")){_.set(true)}}else{x.style.display="none";_.set(false)}}T.onChanged=function(){};function y(){const e=document.querySelectorAll("."+r);if(e){e.forEach(function(e){e.parentNode.removeChild(e)})}const t=document.createElement("style");t.classList.add(r);let n=".sidebar--closed .sidebar__close-button { ";n+="opacity: "+h.get();n+="}";const a=document.createTextNode(n);t.appendChild(a);document.body.appendChild(t)}function j(){const e=document.createElement("div");e.classList.add(s);e.classList.add(l);const t=o.patch.cgl.canvas.parentElement;const n=document.createElement("div");n.classList.add("sidebar__group");e.appendChild(n);const a=document.createElement("div");a.classList.add("sidebar__group-header");e.appendChild(a);const r=document.createElement("span");r.classList.add("sidebar__group-header-title");p=document.createElement("span");p.classList.add("sidebar__group-header-title-text");p.innerHTML=O.get();r.appendChild(p);a.appendChild(r);L(a);A(a);n.appendChild(a);e.appendChild(n);n.addEventListener("click",R);if(!t){o.warn("[sidebar] no canvas parentelement found...");return}t.appendChild(e);const i=document.createElement("div");i.classList.add(u);e.appendChild(i);g=document.createElement("div");g.classList.add(m);g.addEventListener("click",R);e.appendChild(g);return e}O.onChange=function(){if(p)p.innerHTML=O.get()};function G(e){}function R(e){e.stopPropagation();if(!x){o.logError("Sidebar could not be closed...");return}x.classList.toggle("sidebar--closed");const t=e.target;let n=i;if(x.classList.contains("sidebar--closed")){n=c;_.set(false)}else{_.set(true)}}function w(){const e=document.querySelectorAll("."+a);if(e){e.forEach(function(e){e.parentNode.removeChild(e)})}const t=document.createElement("style");t.innerHTML=n.style_css;t.classList.add(a);document.body.appendChild(t)}function U(){B(x)}function B(e){if(e&&e.parentNode&&e.parentNode.removeChild)e.parentNode.removeChild(e)}};Ops.Sidebar.Sidebar.prototype=new CABLES.Op;CABLES.OPS["5a681c35-78ce-4cb3-9858-bc79c34c6819"]={f:Ops.Sidebar.Sidebar,objName:"Ops.Sidebar.Sidebar"};Ops.Vars.VarGetNumber_v2=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};var n=e.outValue("Value");e.varName=e.inValueSelect("Variable",[],"",true);new CABLES.VarGetOpWrapper(e,"number",e.varName,n)};Ops.Vars.VarGetNumber_v2.prototype=new CABLES.Op;CABLES.OPS["421f5b52-c0fa-47c4-8b7a-012b9e1c864a"]={f:Ops.Vars.VarGetNumber_v2,objName:"Ops.Vars.VarGetNumber_v2"};Ops.Trigger.GateTrigger=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};const n=e.inTrigger("Execute"),a=e.inValueBool("Pass Through",true),r=e.outTrigger("Trigger out");n.onTriggered=function(){if(a.get())r.trigger()}};Ops.Trigger.GateTrigger.prototype=new CABLES.Op;CABLES.OPS["65e8b8a2-ba13-485f-883a-2bcf377989da"]={f:Ops.Trigger.GateTrigger,objName:"Ops.Trigger.GateTrigger"};Ops.Gl.GLTF.GltfScene_v3=function(){CABLES.Op.apply(this,arguments);const T=this;const l={inc_camera_js:"const gltfCamera = class\n{\n    constructor(gltf, node)\n    {\n        this.node=node;\n        this.name=node.name;\n        // console.log(gltf);\n        this.config=gltf.json.cameras[node.camera];\n\n        this.pos = vec3.create();\n        this.quat = quat.create();\n        this.quatOr = quat.create();\n        this.vCenter = vec3.create();\n        this.vUp = vec3.create();\n        this.vMat = mat4.create();\n\n    }\n\n    updateAnim(time)\n    {\n        if (this.node && this.node._animTrans)\n        {\n\n            vec3.set(this.pos,\n                this.node._animTrans[0].getValue(time),\n                this.node._animTrans[1].getValue(time),\n                this.node._animTrans[2].getValue(time));\n\n            quat.set(this.quat,\n                this.node._animRot[0].getValue(time),\n                this.node._animRot[1].getValue(time),\n                this.node._animRot[2].getValue(time),\n                this.node._animRot[3].getValue(time));\n        }\n    }\n\n    start(time)\n    {\n        if (cgl.frameStore.shadowPass) return;\n\n        this.updateAnim(time);\n        const asp = cgl.getViewPort()[2] / cgl.getViewPort()[3];\n\n        cgl.pushPMatrix();\n        // mat4.perspective(\n        //     cgl.pMatrix,\n        //     this.config.perspective.yfov*0.5,\n        //     asp,\n        //     this.config.perspective.znear,\n        //     this.config.perspective.zfar);\n\n        cgl.pushViewMatrix();\n        // mat4.identity(cgl.vMatrix);\n\n        // if(this.node && this.node.parent)\n        // {\n        //     console.log(this.node.parent)\n            // vec3.add(this.pos,this.pos,this.node.parent._node.translation);\n            // vec3.sub(this.vCenter,this.vCenter,this.node.parent._node.translation);\n            // mat4.translate(cgl.vMatrix,cgl.vMatrix,\n            // [\n            //     -this.node.parent._node.translation[0],\n            //     -this.node.parent._node.translation[1],\n            //     -this.node.parent._node.translation[2]\n            // ])\n        // }\n\n\n\n        // vec3.set(this.vUp, 0, 1, 0);\n        // vec3.set(this.vCenter, 0, -1, 0);\n        // // vec3.set(this.vCenter, 0, 1, 0);\n        // vec3.transformQuat(this.vCenter, this.vCenter, this.quat);\n        // vec3.normalize(this.vCenter, this.vCenter);\n        // vec3.add(this.vCenter, this.vCenter, this.pos);\n\n\n        // mat4.lookAt(cgl.vMatrix, this.pos, this.vCenter, this.vUp);\n\n\n        let mv=mat4.create();\n        mat4.invert(mv,this.node.modelMatAbs());\n\n        // console.log(this.node.modelMatAbs());\n\n        this.vMat=mv;\n\n        mat4.identity(cgl.vMatrix);\n        // console.log(mv);\n        mat4.mul(cgl.vMatrix,cgl.vMatrix,mv);\n\n\n    }\n\n    end()\n    {\n        if (cgl.frameStore.shadowPass) return;\n        cgl.popPMatrix();\n        cgl.popViewMatrix();\n    }\n};\n\n",inc_gltf_js:'const CHUNK_HEADER_SIZE = 8;\n\nconst Gltf = class\n{\n    constructor()\n    {\n        this.json = {};\n        this.accBuffers = [];\n        this.meshes = [];\n        this.nodes = [];\n        this.shaders = [];\n        this.timing = [];\n        this.cams = [];\n        this.startTime = performance.now();\n        this.bounds = new CGL.BoundingBox();\n        this.loaded = Date.now();\n        this.accBuffersDelete = [];\n    }\n\n    getNode(n)\n    {\n        for (let i = 0; i < this.nodes.length; i++)\n        {\n            if (this.nodes[i].name == n) return this.nodes[i];\n        }\n    }\n\n    unHideAll()\n    {\n        for (let i = 0; i < this.nodes.length; i++)\n        {\n            this.nodes[i].unHide();\n        }\n    }\n};\n\nfunction Utf8ArrayToStr(array)\n{\n    if (window.TextDecoder) return new TextDecoder("utf-8").decode(array);\n\n    let out, i, len, c;\n    let char2, char3;\n\n    out = "";\n    len = array.length;\n    i = 0;\n    while (i < len)\n    {\n        c = array[i++];\n        switch (c >> 4)\n        {\n        case 0: case 1: case 2: case 3: case 4: case 5: case 6: case 7:\n            // 0xxxxxxx\n            out += String.fromCharCode(c);\n            break;\n        case 12: case 13:\n            // 110x xxxx   10xx xxxx\n            char2 = array[i++];\n            out += String.fromCharCode(((c & 0x1F) << 6) | (char2 & 0x3F));\n            break;\n        case 14:\n            // 1110 xxxx  10xx xxxx  10xx xxxx\n            char2 = array[i++];\n            char3 = array[i++];\n            out += String.fromCharCode(((c & 0x0F) << 12) |\n                    ((char2 & 0x3F) << 6) |\n                    ((char3 & 0x3F) << 0));\n            break;\n        }\n    }\n\n    return out;\n}\n\nfunction readChunk(dv, bArr, arrayBuffer, offset)\n{\n    const chunk = {};\n\n    if (offset >= dv.byteLength)\n    {\n        op.log("could not read chunk...");\n        return;\n    }\n    chunk.size = dv.getUint32(offset + 0, le);\n\n    // chunk.type = new TextDecoder("utf-8").decode(bArr.subarray(offset+4, offset+4+4));\n    chunk.type = Utf8ArrayToStr(bArr.subarray(offset + 4, offset + 4 + 4));\n\n    if (chunk.type == "BIN\\0")\n    {\n        // console.log(chunk.size,arrayBuffer.length,offset);\n        // try\n        // {\n        chunk.dataView = new DataView(arrayBuffer, offset + 8, chunk.size);\n        // }\n        // catch(e)\n        // {\n        //     chunk.dataView = null;\n        //     console.log(e);\n        // }\n    }\n    else\n    if (chunk.type == "JSON")\n    {\n        const json = Utf8ArrayToStr(bArr.subarray(offset + 8, offset + 8 + chunk.size));\n\n        try\n        {\n            const obj = JSON.parse(json);\n            chunk.data = obj;\n            outGenerator.set(obj.asset.generator);\n        }\n        catch (e)\n        {\n        }\n    }\n    else\n    {\n        op.warn("unknown type", chunk.type);\n    }\n\n    return chunk;\n}\n\nfunction loadAnims(gltf)\n{\n    const uniqueAnimNames = {};\n\n    for (let i = 0; i < gltf.json.animations.length; i++)\n    {\n        const an = gltf.json.animations[i];\n\n        for (let ia = 0; ia < an.channels.length; ia++)\n        {\n            const chan = an.channels[ia];\n\n            const node = gltf.nodes[chan.target.node];\n            const sampler = an.samplers[chan.sampler];\n\n            const acc = gltf.json.accessors[sampler.input];\n            const bufferIn = gltf.accBuffers[sampler.input];\n\n            const accOut = gltf.json.accessors[sampler.output];\n            const bufferOut = gltf.accBuffers[sampler.output];\n\n            gltf.accBuffersDelete.push(sampler.output, sampler.input);\n\n            if (bufferIn && bufferOut)\n            {\n                let numComps = 1;\n                if (accOut.type == "VEC2")numComps = 2;\n                else if (accOut.type == "VEC3")numComps = 3;\n                else if (accOut.type == "VEC4")numComps = 4;\n                else op.warn("unknown accOut.type", accOut.type);\n\n                const anims = [];\n\n                uniqueAnimNames[an.name] = true;\n\n                for (let k = 0; k < numComps; k++)\n                {\n                    const newAnim = new CABLES.TL.Anim();\n                    // newAnim.name=an.name;\n                    anims.push(newAnim);\n                }\n\n                if (sampler.interpolation == "LINEAR") {}\n                else if (sampler.interpolation == "STEP") for (let k = 0; k < numComps; k++) anims[k].defaultEasing = CABLES.EASING_ABSOLUTE;\n                else if (sampler.interpolation == "CUBICSPLINE") for (let k = 0; k < numComps; k++) anims[k].defaultEasing = CABLES.EASING_CUBICSPLINE;\n                else op.warn("unknown interpolation", sampler.interpolation);\n\n                // console.log(bufferOut)\n\n                // if there is no keyframe for time 0 copy value of first keyframe at time 0\n                if (bufferIn[0] !== 0.0)\n                    for (let k = 0; k < numComps; k++)\n                        anims[k].setValue(0, bufferOut[0 * numComps + k]);\n\n                // console.log(sampler.interpolation,bufferOut.length/numComps)\n\n                for (let j = 0; j < bufferIn.length; j++)\n                {\n                    maxTime = Math.max(bufferIn[j], maxTime);\n\n                    for (let k = 0; k < numComps; k++)\n                    {\n                        if (anims[k].defaultEasing === CABLES.EASING_CUBICSPLINE)\n                        {\n                            const idx = ((j * numComps) * 3 + k);\n\n                            const key = anims[k].setValue(bufferIn[j], bufferOut[idx + numComps]);\n                            key.bezTangIn = bufferOut[idx];\n                            key.bezTangOut = bufferOut[idx + (numComps * 2)];\n\n                            // console.log(an.name,k,bufferOut[idx+1]);\n                        }\n                        else\n                        {\n                            // console.log(an.name,k,bufferOut[j * numComps + k]);\n                            anims[k].setValue(bufferIn[j], bufferOut[j * numComps + k]);\n                        }\n                    }\n                }\n\n                node.setAnim(chan.target.path, an.name, anims);\n            }\n            else\n            {\n                op.warn("loadAmins bufferIn undefined ", bufferIn === undefined);\n                op.warn("loadAmins bufferOut undefined ", bufferOut === undefined);\n                op.warn("loadAmins ", sampler, accOut);\n                op.warn("loadAmins num accBuffers", gltf.accBuffers.length);\n                op.warn("loadAmins num accessors", gltf.json.accessors.length);\n            }\n        }\n    }\n\n    outAnims.set(null);\n    outAnims.set(Object.keys(uniqueAnimNames));\n}\n\nfunction loadCams(gltf)\n{\n    if (!gltf || !gltf.json.cameras) return;\n\n    gltf.cameras = gltf.cameras || [];\n\n    for (let i = 0; i < gltf.nodes.length; i++)\n    {\n        if (gltf.nodes[i].hasOwnProperty("camera"))\n        {\n            const cam = new gltfCamera(gltf, gltf.nodes[i]);\n            gltf.cameras.push(cam);\n        }\n    }\n}\n\nfunction loadAfterDraco()\n{\n    if (!window.DracoDecoder)\n    {\n        setTimeout(() =>\n        {\n            loadAfterDraco();\n        }, 100);\n    }\n\n    reloadSoon();\n}\n\nfunction parseGltf(arrayBuffer)\n{\n    let j = 0, i = 0;\n\n    const gltf = new Gltf();\n    gltf.timing.push("Start parsing", Math.round((performance.now() - gltf.startTime)));\n\n    if (!arrayBuffer) return;\n    const byteArray = new Uint8Array(arrayBuffer);\n    let pos = 0;\n\n    // var string = new TextDecoder("utf-8").decode(byteArray.subarray(pos, 4));\n    const string = Utf8ArrayToStr(byteArray.subarray(pos, 4));\n    pos += 4;\n    if (string != "glTF") return;\n\n    gltf.timing.push("dataview", Math.round((performance.now() - gltf.startTime)));\n\n    const dv = new DataView(arrayBuffer);\n    const version = dv.getUint32(pos, le);\n    pos += 4;\n    const size = dv.getUint32(pos, le);\n    pos += 4;\n\n    outVersion.set(version);\n\n    const chunks = [];\n    gltf.chunks = chunks;\n\n    chunks.push(readChunk(dv, byteArray, arrayBuffer, pos));\n    pos += chunks[0].size + CHUNK_HEADER_SIZE;\n    gltf.json = chunks[0].data;\n    outJson.set(gltf.json);\n    outExtensions.set(gltf.json.extensionsUsed || []);\n\n    let ch = readChunk(dv, byteArray, arrayBuffer, pos);\n    while (ch)\n    {\n        chunks.push(ch);\n        pos += ch.size + CHUNK_HEADER_SIZE;\n        ch = readChunk(dv, byteArray, arrayBuffer, pos);\n    }\n\n    gltf.chunks = chunks;\n\n    const views = chunks[0].data.bufferViews;\n    const accessors = chunks[0].data.accessors;\n\n    gltf.timing.push("Parse buffers", Math.round((performance.now() - gltf.startTime)));\n\n    if (gltf.json.extensionsUsed && gltf.json.extensionsUsed.indexOf("KHR_draco_mesh_compression") > -1)\n    {\n        if (!window.DracoDecoder)\n        {\n            op.setUiError("gltfdraco", "GLTF draco compression lib not found / add draco op to your patch!");\n\n            loadAfterDraco();\n            return gltf;\n        }\n        else\n        {\n            gltf.useDraco = true;\n        }\n    }\n\n    op.setUiError("gltfdraco", null);\n    // let accPos = (view.byteOffset || 0) + (acc.byteOffset || 0);\n\n    if (views)\n    {\n        for (i = 0; i < accessors.length; i++)\n        {\n            const acc = accessors[i];\n\n            const view = views[acc.bufferView];\n\n            // if(!view || !acc)\n            // {\n\n            //     continue;\n            // }\n\n            let numComps = 0;\n            if (acc.type == "SCALAR")numComps = 1;\n            else if (acc.type == "VEC2")numComps = 2;\n            else if (acc.type == "VEC3")numComps = 3;\n            else if (acc.type == "VEC4")numComps = 4;\n            else if (acc.type == "MAT4")numComps = 16;\n            else console.error("unknown accessor type", acc.type);\n\n            //   const decoder = new decoderModule.Decoder();\n            //   const decodedGeometry = decodeDracoData(data, decoder);\n            //   // Encode mesh\n            //   encodeMeshToFile(decodedGeometry, decoder);\n\n            //   decoderModule.destroy(decoder);\n            //   decoderModule.destroy(decodedGeometry);\n\n            // 5120 (BYTE)\t1\n            // 5121 (UNSIGNED_BYTE)\t1\n            // 5122 (SHORT)\t2\n\n            if (chunks[1].dataView)\n            {\n                if (view)\n                {\n                    const num = acc.count * numComps;\n                    let accPos = (view.byteOffset || 0) + (acc.byteOffset || 0);\n                    let stride = view.byteStride || 0;\n                    let dataBuff = null;\n\n                    if (acc.componentType == 5126 || acc.componentType == 5125) // 4byte FLOAT or INT\n                    {\n                        stride = stride || 4;\n\n                        const isInt = acc.componentType == 5125;\n                        if (isInt)dataBuff = new Uint32Array(num);\n                        else dataBuff = new Float32Array(num);\n\n                        for (j = 0; j < num; j++)\n                        {\n                            if (isInt) dataBuff[j] = chunks[1].dataView.getUint32(accPos, le);\n                            else dataBuff[j] = chunks[1].dataView.getFloat32(accPos, le);\n\n                            if (stride != 4 && (j + 1) % numComps === 0)accPos += stride - (numComps * 4);\n                            accPos += 4;\n                        }\n                    }\n                    else if (acc.componentType == 5123) // UNSIGNED_SHORT\n                    {\n                        stride = stride || 2;\n\n                        dataBuff = new Uint16Array(num);\n\n                        for (j = 0; j < num; j++)\n                        {\n                            dataBuff[j] = chunks[1].dataView.getUint16(accPos, le);\n\n                            if (stride != 2 && (j + 1) % numComps === 0) accPos += stride - (numComps * 2);\n\n                            accPos += 2;\n                        }\n                    }\n                    else if (acc.componentType == 5121) // UNSIGNED_BYTE\n                    {\n                        stride = stride || 1;\n\n                        dataBuff = new Uint8Array(num);\n\n                        for (j = 0; j < num; j++)\n                        {\n                            dataBuff[j] = chunks[1].dataView.getUint8(accPos, le);\n\n                            if (stride != 1 && (j + 1) % numComps === 0) accPos += stride - (numComps * 1);\n\n                            accPos += 1;\n                        }\n                    }\n\n                    else\n                    {\n                        console.error("unknown component type", acc.componentType);\n                    }\n\n                    gltf.accBuffers.push(dataBuff);\n                }\n                else\n                {\n                    // console.log("has no dataview");\n                }\n            }\n        }\n    }\n\n    gltf.timing.push("Parse mesh groups", Math.round((performance.now() - gltf.startTime)));\n\n    gltf.json.meshes = gltf.json.meshes || [];\n\n    if (gltf.json.meshes)\n    {\n        for (i = 0; i < gltf.json.meshes.length; i++)\n        {\n            const mesh = new gltfMeshGroup(gltf, gltf.json.meshes[i]);\n            gltf.meshes.push(mesh);\n        }\n    }\n\n    gltf.timing.push("Parse nodes", Math.round((performance.now() - gltf.startTime)));\n\n    for (i = 0; i < gltf.json.nodes.length; i++)\n    {\n        if (gltf.json.nodes[i].children)\n            for (j = 0; j < gltf.json.nodes[i].children.length; j++)\n            {\n                gltf.json.nodes[gltf.json.nodes[i].children[j]].isChild = true;\n            }\n    }\n\n    for (i = 0; i < gltf.json.nodes.length; i++)\n    {\n        const node = new gltfNode(gltf.json.nodes[i], gltf);\n        gltf.nodes.push(node);\n    }\n\n    for (i = 0; i < gltf.nodes.length; i++)\n    {\n        const node = gltf.nodes[i];\n\n        if (!node.children) continue;\n        for (let j = 0; j < node.children.length; j++)\n        {\n            gltf.nodes[node.children[j]].parent = node;\n        }\n    }\n\n    for (i = 0; i < gltf.nodes.length; i++)\n    {\n        if (gltf.nodes[i].skin > -1)\n        {\n            gltf.nodes[i].skinRenderer = new GltfSkin(gltf.nodes[i]);\n        }\n    }\n\n    needsMatUpdate = true;\n\n    gltf.timing.push("load anims", Math.round((performance.now() - gltf.startTime)));\n\n    if (gltf.json.animations) loadAnims(gltf);\n\n    gltf.timing.push("load cameras", Math.round((performance.now() - gltf.startTime)));\n\n    if (gltf.json.cameras) loadCams(gltf);\n\n    gltf.timing.push("finished", Math.round((performance.now() - gltf.startTime)));\n\n    return gltf;\n}\n',inc_mesh_js:'let gltfMesh = class\n{\n    constructor(name, prim, gltf, finished)\n    {\n        this.POINTS = 0;\n        this.LINES = 1;\n        this.LINE_LOOP = 2;\n        this.LINE_STRIP = 3;\n        this.TRIANGLES = 4;\n        this.TRIANGLE_STRIP = 5;\n        this.TRIANGLE_FAN = 6;\n\n        this.test = 0;\n        this.name = name;\n        this.submeshIndex = 0;\n        this.material = prim.material;\n        this.mesh = null;\n        this.geom = new CGL.Geometry("gltf_" + this.name);\n        this.geom.verticesIndices = [];\n        this.bounds = null;\n        this.primitive = 4;\n        if (prim.hasOwnProperty("mode")) this.primitive = prim.mode;\n\n        if (prim.hasOwnProperty("indices")) this.geom.verticesIndices = gltf.accBuffers[prim.indices];\n\n        gltf.loadingMeshes = gltf.loadingMeshes || 0;\n        gltf.loadingMeshes++;\n\n        this.materialJson =\n            this._matPbrMetalness =\n            this._matPbrRoughness =\n            this._matDiffuseColor = null;\n\n        if (gltf.json.materials)\n        {\n            if (this.material != -1) this.materialJson = gltf.json.materials[this.material];\n\n            if (this.materialJson && this.materialJson.pbrMetallicRoughness)\n            {\n                if (this.materialJson.pbrMetallicRoughness.baseColorFactor)\n                    this._matDiffuseColor = this.materialJson.pbrMetallicRoughness.baseColorFactor;\n\n                this._matDiffuseColor = this.materialJson.pbrMetallicRoughness.baseColorFactor;\n\n                this._matPbrMetalness = this.materialJson.pbrMetallicRoughness.metallicFactor || null;\n                this._matPbrRoughness = this.materialJson.pbrMetallicRoughness.roughnessFactor || null;\n            }\n        }\n\n        if (gltf.useDraco && prim.extensions.KHR_draco_mesh_compression)\n        {\n            const view = gltf.chunks[0].data.bufferViews[prim.extensions.KHR_draco_mesh_compression.bufferView];\n            const num = view.byteLength;\n            const dataBuff = new Int8Array(num);\n            let accPos = (view.byteOffset || 0);// + (acc.byteOffset || 0);\n            for (let j = 0; j < num; j++)\n            {\n                dataBuff[j] = gltf.chunks[1].dataView.getInt8(accPos, le);\n                accPos++;\n            }\n\n            const dracoDecoder = window.DracoDecoder;\n            dracoDecoder.decodeGeometry(dataBuff.buffer, (geometry) =>\n            {\n                const geom = new CGL.Geometry("draco mesh " + name);\n\n                for (let i = 0; i < geometry.attributes.length; i++)\n                {\n                    const attr = geometry.attributes[i];\n\n                    if (attr.name === "position") geom.vertices = attr.array;\n                    else if (attr.name === "normal") geom.vertexNormals = attr.array;\n                    else if (attr.name === "uv") geom.texCoords = attr.array;\n                    else if (attr.name === "color") this.setGeomVertCols(geom, attr.array);\n                    else if (attr.name === "joints") geom.setAttribute("attrJoints", Array.from(attr.array), 4);\n                    else if (attr.name === "weights")\n                    {\n                        const arr4 = new Float32Array(attr.array.length / attr.itemSize * 4);\n\n                        for (let k = 0; k < attr.array.length / attr.itemSize; k++)\n                        {\n                            arr4[k * 4] = arr4[k * 4 + 1] = arr4[k * 4 + 2] = arr4[k * 4 + 3] = 0;\n                            for (let j = 0; j < attr.itemSize; j++)\n                                arr4[k * 4 + j] = attr.array[k * attr.itemSize + j];\n                        }\n                        geom.setAttribute("attrWeights", arr4, 4);\n                    }\n                    else op.logWarn("unknown draco attrib", attr);\n                }\n\n                geometry.attributes = null;\n                geom.verticesIndices = geometry.index.array;\n\n                this.setGeom(geom);\n\n                this.mesh = null;\n                gltf.loadingMeshes--;\n                if (finished)finished(this);\n            }, (error) => { op.logError(error); });\n        }\n        else\n        {\n            gltf.loadingMeshes--;\n            this.fillGeomAttribs(gltf, this.geom, prim.attributes);\n\n            if (prim.targets)\n            {\n                console.log("prim.targets", prim.targets.length);\n                for (let j = 0; j < prim.targets.length; j++)\n                {\n                    // var tgeom=new CGL.Geometry("gltf_"+this.name);\n                    let tgeom = this.geom.copy();\n\n                    if (prim.hasOwnProperty("indices")) tgeom.verticesIndices = gltf.accBuffers[prim.indices];\n\n                    this.fillGeomAttribs(gltf, tgeom, prim.targets[j], false);\n\n                    { // calculate normals for final position of morphtarget for later...\n                        for (let i = 0; i < tgeom.vertices.length; i++) tgeom.vertices[i] += this.geom.vertices[i];\n                        tgeom.calculateNormals();\n                        for (let i = 0; i < tgeom.vertices.length; i++) tgeom.vertices[i] -= this.geom.vertices[i];\n                    }\n\n                    this.geom.morphTargets.push(tgeom);\n                }\n            }\n            if (finished)finished(this);\n        }\n    }\n\n    _linearToSrgb(x)\n    {\n        if (x <= 0)\n            return 0;\n        else if (x >= 1)\n            return 1;\n        else if (x < 0.0031308)\n            return x * 12.92;\n        else\n            return Math.pow(x, 1 / 2.2) * 1.055 - 0.055;\n    }\n\n    setGeomVertCols(tgeom, arr)\n    {\n        if (arr instanceof Float32Array)\n        {\n            let div = false;\n            for (let i = 0; i < arr.length; i++)\n            {\n                if (arr[i] > 1)\n                {\n                    div = true;\n                    continue;\n                }\n            }\n\n            if (div)\n                for (let i = 0; i < arr.length; i++) arr[i] /= 65535;\n\n            tgeom.vertexColors = arr;\n        }\n\n        else if (arr instanceof Uint16Array)\n        {\n            const fb = new Float32Array(arr.length);\n            for (let i = 0; i < arr.length; i++) fb[i] = arr[i] / 65535;\n\n            tgeom.vertexColors = fb;\n        }\n        else tgeom.vertexColors = arr;\n\n        for (let i = 0; i < tgeom.vertexColors.length; i++)\n        {\n            tgeom.vertexColors[i] = this._linearToSrgb(tgeom.vertexColors[i]);\n        }\n    }\n\n    fillGeomAttribs(gltf, tgeom, attribs, setGeom)\n    {\n        if (attribs.hasOwnProperty("POSITION"))tgeom.vertices = gltf.accBuffers[attribs.POSITION];\n        if (attribs.hasOwnProperty("NORMAL"))tgeom.vertexNormals = gltf.accBuffers[attribs.NORMAL];\n        if (attribs.hasOwnProperty("TEXCOORD_0"))tgeom.texCoords = gltf.accBuffers[attribs.TEXCOORD_0];\n        if (attribs.hasOwnProperty("TANGENT"))tgeom.tangents = gltf.accBuffers[attribs.TANGENT];\n        if (attribs.hasOwnProperty("COLOR_0")) this.setGeomVertCols(tgeom, gltf.accBuffers[attribs.COLOR_0]);\n\n        if (attribs.hasOwnProperty("TEXCOORD_1"))tgeom.setAttribute("attrTexCoord1", gltf.accBuffers[attribs.TEXCOORD_1], 2);\n        if (attribs.hasOwnProperty("TEXCOORD_2"))tgeom.setAttribute("attrTexCoord2", gltf.accBuffers[attribs.TEXCOORD_2], 2);\n        if (attribs.hasOwnProperty("TEXCOORD_3"))tgeom.setAttribute("attrTexCoord3", gltf.accBuffers[attribs.TEXCOORD_3], 2);\n        if (attribs.hasOwnProperty("TEXCOORD_4"))tgeom.setAttribute("attrTexCoord4", gltf.accBuffers[attribs.TEXCOORD_4], 2);\n\n        if (attribs.hasOwnProperty("WEIGHTS_0"))\n        {\n            tgeom.setAttribute("attrWeights", gltf.accBuffers[attribs.WEIGHTS_0], 4);\n        }\n        if (attribs.hasOwnProperty("JOINTS_0"))\n        {\n            if (!gltf.accBuffers[attribs.JOINTS_0])console.log("no !gltf.accBuffers[attribs.JOINTS_0]");\n            tgeom.setAttribute("attrJoints", gltf.accBuffers[attribs.JOINTS_0], 4);\n        }\n\n        if (attribs.hasOwnProperty("POSITION")) gltf.accBuffersDelete.push(attribs.POSITION);\n        if (attribs.hasOwnProperty("NORMAL")) gltf.accBuffersDelete.push(attribs.NORMAL);\n        if (attribs.hasOwnProperty("TEXCOORD_0")) gltf.accBuffersDelete.push(attribs.TEXCOORD_0);\n        if (attribs.hasOwnProperty("TANGENT")) gltf.accBuffersDelete.push(attribs.TANGENT);\n        if (attribs.hasOwnProperty("COLOR_0"))gltf.accBuffersDelete.push(attribs.COLOR_0);\n        if (attribs.hasOwnProperty("TEXCOORD_1")) gltf.accBuffersDelete.push(attribs.TEXCOORD_1);\n        if (attribs.hasOwnProperty("TEXCOORD_2")) gltf.accBuffersDelete.push(attribs.TEXCOORD_2);\n        if (attribs.hasOwnProperty("TEXCOORD_3")) gltf.accBuffersDelete.push(attribs.TEXCOORD_3);\n        if (attribs.hasOwnProperty("TEXCOORD_4")) gltf.accBuffersDelete.push(attribs.TEXCOORD_4);\n\n        if (setGeom !== false) if (tgeom && tgeom.verticesIndices) this.setGeom(tgeom);\n    }\n\n    setGeom(geom)\n    {\n        if (inNormFormat.get() == "X-ZY")\n        {\n            for (let i = 0; i < geom.vertexNormals.length; i += 3)\n            {\n                let t = geom.vertexNormals[i + 2];\n                geom.vertexNormals[i + 2] = geom.vertexNormals[i + 1];\n                geom.vertexNormals[i + 1] = -t;\n            }\n        }\n\n        if (inVertFormat.get() == "XZ-Y")\n        {\n            for (let i = 0; i < geom.vertices.length; i += 3)\n            {\n                let t = geom.vertices[i + 2];\n                geom.vertices[i + 2] = -geom.vertices[i + 1];\n                geom.vertices[i + 1] = t;\n            }\n        }\n\n        if (this.primitive == this.TRIANGLES)\n        {\n            if (!geom.vertexNormals.length || inCalcNormals.get()) geom.calculateNormals();\n\n            if ((!geom.biTangents || geom.biTangents.length == 0) && geom.tangents)\n            {\n                const bitan = vec3.create();\n                const tan = vec3.create();\n\n                const tangents = geom.tangents;\n                geom.tangents = new Float32Array(tangents.length / 4 * 3);\n                geom.biTangents = new Float32Array(tangents.length / 4 * 3);\n\n                for (let i = 0; i < tangents.length; i += 4)\n                {\n                    const idx = i / 4 * 3;\n\n                    vec3.cross(\n                        bitan,\n                        [geom.vertexNormals[idx], geom.vertexNormals[idx + 1], geom.vertexNormals[idx + 2]],\n                        [tangents[i], tangents[i + 1], tangents[i + 2]]\n                    );\n\n                    vec3.div(bitan, bitan, [tangents[i + 3], tangents[i + 3], tangents[i + 3]]);\n                    vec3.normalize(bitan, bitan);\n\n                    geom.biTangents[idx + 0] = bitan[0];\n                    geom.biTangents[idx + 1] = bitan[1];\n                    geom.biTangents[idx + 2] = bitan[2];\n\n                    geom.tangents[idx + 0] = tangents[i + 0];\n                    geom.tangents[idx + 1] = tangents[i + 1];\n                    geom.tangents[idx + 2] = tangents[i + 2];\n                }\n            }\n\n            if (geom.tangents.length === 0 || inCalcNormals.get()) geom.calcTangentsBitangents();\n        }\n\n        this.geom = geom;\n\n        this.bounds = geom.getBounds();\n    }\n\n    render(cgl, ignoreMaterial, skinRenderer)\n    {\n        if (!this.mesh && this.geom && this.geom.verticesIndices)\n        {\n            let g = this.geom;\n            if (this.geom.vertices.length / 3 > 64000)\n            {\n                g = this.geom.copy();\n                g.unIndex(false, true);\n            }\n\n            let glprim;\n            if (this.primitive == this.TRIANGLES)glprim = cgl.gl.TRIANGLES;\n            else if (this.primitive == this.LINES)glprim = cgl.gl.LINES;\n            else if (this.primitive == this.LINE_STRIP)glprim = cgl.gl.LINE_STRIP;\n            else if (this.primitive == this.POINTS)glprim = cgl.gl.POINTS;\n            else\n            {\n                op.logWarn("unknown primitive type", this);\n            }\n\n            this.mesh = new CGL.Mesh(cgl, g, glprim);\n            this.mesh._geom = null;\n        }\n        else\n        {\n            // update morphTargets\n            if (this.geom && this.geom.morphTargets.length)\n            {\n                this.morphGeom = this.geom.copy();\n\n                this.test = time * 11.7;\n\n                if (this.test >= this.geom.morphTargets.length - 1) this.test = 0;\n\n                const mt = this.geom.morphTargets[Math.floor(this.test)];\n                const mt2 = this.geom.morphTargets[Math.floor(this.test + 1)];\n\n                if (mt && mt.vertices && mt2)\n                {\n                    if (this.morphGeom.vertexNormals.length != mt.vertexNormals.length)\n                        this.morphGeom.vertexNormals = new Float32Array(mt.vertexNormals.length);\n\n                    const fract = this.test % 1;\n                    for (let i = 0; i < this.morphGeom.vertices.length; i++)\n                    {\n                        this.morphGeom.vertices[i] =\n                            this.geom.vertices[i] +\n                            (1.0 - fract) * mt.vertices[i] +\n                            fract * mt2.vertices[i];\n\n                        this.morphGeom.vertexNormals[i] =\n                            (1.0 - fract) * mt.vertexNormals[i] +\n                            fract * mt2.vertexNormals[i];\n                    }\n\n                    this.mesh.updateNormals(this.morphGeom);\n                    this.mesh.updateVertices(this.morphGeom);\n                }\n            }\n\n            let useMat = !ignoreMaterial && this.material != -1 && gltf.shaders[this.material];\n            if (skinRenderer)useMat = false;\n\n            // console.log(gltf.shaders[this.material])\n\n            if (useMat) cgl.pushShader(gltf.shaders[this.material]);\n\n            const currentShader = cgl.getShader() || {};\n            const uniDiff = currentShader.uniformColorDiffuse;\n\n            const uniPbrMetalness = currentShader.uniformPbrMetalness;\n            const uniPbrRoughness = currentShader.uniformPbrRoughness;\n\n            if (!gltf.shaders[this.material] && inUseMatProps.get())\n            {\n                if (uniDiff && this._matDiffuseColor)\n                {\n                    this._matDiffuseColorOrig = [uniDiff.getValue()[0], uniDiff.getValue()[1], uniDiff.getValue()[2], uniDiff.getValue()[3]];\n                    uniDiff.setValue(this._matDiffuseColor);\n                }\n\n                if (uniPbrMetalness)\n                    if (this._matPbrMetalness != null)\n                    {\n                        this._matPbrMetalnessOrig = uniPbrMetalness.getValue();\n                        uniPbrMetalness.setValue(this._matPbrMetalness);\n                    }\n                    else\n                        uniPbrMetalness.setValue(0);\n\n                if (uniPbrRoughness)\n                    if (this._matPbrRoughness != null)\n                    {\n                        this._matPbrRoughnessOrig = uniPbrRoughness.getValue();\n                        uniPbrRoughness.setValue(this._matPbrRoughness);\n                    }\n                    else uniPbrRoughness.setValue(0);\n            }\n\n            if (this.mesh) this.mesh.render(cgl.getShader(), ignoreMaterial);\n\n            if (inUseMatProps.get())\n            {\n                if (uniDiff && this._matDiffuseColor) uniDiff.setValue(this._matDiffuseColorOrig);\n                if (uniPbrMetalness && this._matPbrMetalnessOrig != undefined) uniPbrMetalness.setValue(this._matPbrMetalnessOrig);\n                if (uniPbrRoughness && this._matPbrRoughnessOrig != undefined) uniPbrRoughness.setValue(this._matPbrRoughnessOrig);\n            }\n\n            if (useMat) cgl.popShader();\n        }\n    }\n};\n',inc_meshGroup_js:"const gltfMeshGroup = class\n{\n    constructor(gltf, m)\n    {\n        this.bounds = new CGL.BoundingBox();\n        this.meshes = [];\n        this.name = m.name;\n        const prims = m.primitives;\n\n        for (let i = 0; i < prims.length; i++)\n        {\n            const mesh = new gltfMesh(this.name, prims[i], gltf,\n                (mesh) =>\n                {\n                    this.bounds.apply(mesh.bounds);\n                });\n\n            mesh.submeshIndex = i;\n            this.meshes.push(mesh);\n        }\n    }\n\n    render(cgl, ignoreMat, skinRenderer, _time)\n    {\n        for (let i = 0; i < this.meshes.length; i++)\n        {\n            const useMat = gltf.shaders[this.meshes[i].material];\n\n            if (useMat) cgl.pushShader(gltf.shaders[this.meshes[i].material]);\n            // console.log(gltf.shaders[this.meshes[i].material],this.meshes[i].material)\n            if (skinRenderer)skinRenderer.renderStart(cgl, skinRenderer._time);\n\n            this.meshes[i].render(cgl, ignoreMat, skinRenderer, _time);\n            if (skinRenderer)skinRenderer.renderFinish(cgl);\n            if (useMat) cgl.popShader();\n        }\n    }\n};\n",inc_node_js:'const gltfNode = class\n{\n    constructor(node, gltf)\n    {\n        this.isChild = node.isChild || false;\n        this.name = node.name;\n        if (node.hasOwnProperty("camera")) this.camera = node.camera;\n        this.hidden = false;\n        this.mat = mat4.create();\n        this._animMat = mat4.create();\n        this._tempMat = mat4.create();\n        this._tempQuat = quat.create();\n        this._tempRotmat = mat4.create();\n        this.mesh = null;\n        this.children = [];\n        this._node = node;\n        this._gltf = gltf;\n        this.absMat = mat4.create();\n        this.addTranslate = null;\n        this.addMulMat = null;\n        this.updateMatrix();\n        this._animActions = {};\n    }\n\n    get skin()\n    {\n        if (this._node.hasOwnProperty("skin")) return this._node.skin;\n        else return -1;\n    }\n\n    hasSkin()\n    {\n        if (this._node.hasOwnProperty("skin")) return this._gltf.json.skins[this._node.skin].name || "unknown";\n        return false;\n    }\n\n    updateMatrix()\n    {\n        mat4.identity(this.mat);\n        if (this._node.translation) mat4.translate(this.mat, this.mat, this._node.translation);\n\n        if (this._node.rotation)\n        {\n            const rotmat = mat4.create();\n            this._rot = this._node.rotation;\n\n            mat4.fromQuat(rotmat, this._node.rotation);\n            mat4.mul(this.mat, this.mat, rotmat);\n        }\n\n        if (this._node.scale)\n        {\n            this._scale = this._node.scale;\n            mat4.scale(this.mat, this.mat, this._scale);\n        }\n\n        if (this._node.hasOwnProperty("mesh"))\n        {\n            this.mesh = this._gltf.meshes[this._node.mesh];\n        }\n\n        if (this._node.children)\n        {\n            for (let i = 0; i < this._node.children.length; i++)\n            {\n                this._gltf.json.nodes[i].isChild = true;\n                if (this._gltf.nodes[this._node.children[i]]) this._gltf.nodes[this._node.children[i]].isChild = true;\n                this.children.push(this._node.children[i]);\n            }\n        }\n    }\n\n    unHide()\n    {\n        this.hidden = false;\n        for (let i = 0; i < this.children.length; i++)\n            if (this.children[i].unHide) this.children[i].unHide();\n    }\n\n    calcBounds(gltf, mat, bounds)\n    {\n        const localMat = mat4.create();\n\n        if (mat) mat4.copy(localMat, mat);\n        if (this.mat) mat4.mul(localMat, localMat, this.mat);\n\n        if (this.mesh)\n        {\n            const bb = this.mesh.bounds.copy();\n            bb.mulMat4(localMat);\n            bounds.apply(bb);\n\n            if (bounds.changed)\n            {\n                boundingPoints.push(\n                    bb._min[0] || 0, bb._min[1] || 0, bb._min[2] || 0,\n                    bb._max[0] || 0, bb._max[1] || 0, bb._max[2] || 0);\n            }\n        }\n\n        for (let i = 0; i < this.children.length; i++)\n        {\n            if (gltf.nodes[this.children[i]] && gltf.nodes[this.children[i]].calcBounds)\n            {\n                const b = gltf.nodes[this.children[i]].calcBounds(gltf, localMat, bounds);\n\n                bounds.apply(b);\n            }\n        }\n\n        if (bounds.changed) return bounds;\n        else return null;\n    }\n\n    setAnimAction(name)\n    {\n        if (name && !this._animActions[name]) return;// console.log("no action found: ", name);\n\n        for (let path in this._animActions[name])\n        {\n            if (path == "translation") this._animTrans = this._animActions[name][path];\n            else if (path == "rotation") this._animRot = this._animActions[name][path];\n            else if (path == "scale") this._animScale = this._animActions[name][path];\n            else console.warn("unknown anim path", path, this._animActions[name][path]);\n        }\n    }\n\n    setAnim(path, name, anims)\n    {\n        this._animActions[name] = this._animActions[name] || {};\n\n        if (this._animActions[name][path])op.warn("animation action path already exists", name, path, this._animActions[name][path]);\n\n        this._animActions[name][path] = anims;\n\n        // console.log(name,path,this._animTrans);\n        // console.log(this._animActions);\n\n        if (path == "translation") this._animTrans = anims;\n        else if (path == "rotation") this._animRot = anims;\n        else if (path == "scale") this._animScale = anims;\n        else console.warn("unknown anim path", path, anims);\n    }\n\n    modelMatLocal()\n    {\n        return this._animMat || this.mat;\n    }\n\n    modelMatAbs()\n    {\n        return this.absMat;\n    }\n\n    transform(cgl, _time)\n    {\n        if (!_time && _time != 0)_time = time;\n\n        this._lastTimeTrans = _time;\n\n        if (!this._animTrans && !this._animRot && !this._animScale)\n        {\n            mat4.mul(cgl.mMatrix, cgl.mMatrix, this.mat);\n            this._animMat = null;\n        }\n        else\n        {\n            this._animMat = this._animMat || mat4.create();\n            mat4.identity(this._animMat);\n\n            const playAnims = true;\n\n            if (playAnims && this._animTrans)\n            {\n                mat4.translate(this._animMat, this._animMat, [\n                    this._animTrans[0].getValue(_time),\n                    this._animTrans[1].getValue(_time),\n                    this._animTrans[2].getValue(_time)]);\n            }\n            else\n            if (this._node.translation) mat4.translate(this._animMat, this._animMat, this._node.translation);\n\n            if (playAnims && this._animRot)\n            {\n                if (this._animRot[0].defaultEasing == CABLES.EASING_LINEAR) CABLES.TL.Anim.slerpQuaternion(_time, this._tempQuat, this._animRot[0], this._animRot[1], this._animRot[2], this._animRot[3]);\n                else if (this._animRot[0].defaultEasing == CABLES.EASING_ABSOLUTE)\n                {\n                    this._tempQuat[0] = this._animRot[0].getValue(_time);\n                    this._tempQuat[1] = this._animRot[1].getValue(_time);\n                    this._tempQuat[2] = this._animRot[2].getValue(_time);\n                    this._tempQuat[3] = this._animRot[3].getValue(_time);\n                }\n                else if (this._animRot[0].defaultEasing == CABLES.EASING_CUBICSPLINE)\n                {\n                    CABLES.TL.Anim.slerpQuaternion(_time, this._tempQuat, this._animRot[0], this._animRot[1], this._animRot[2], this._animRot[3]);\n                }\n\n                mat4.fromQuat(this._tempMat, this._tempQuat);\n                mat4.mul(this._animMat, this._animMat, this._tempMat);\n            }\n            else if (this._rot)\n            {\n                mat4.fromQuat(this._tempRotmat, this._rot);\n                mat4.mul(this._animMat, this._animMat, this._tempRotmat);\n            }\n\n            if (playAnims && this._animScale)\n            {\n                mat4.scale(this._animMat, this._animMat, [\n                    this._animScale[0].getValue(_time),\n                    this._animScale[1].getValue(_time),\n                    this._animScale[2].getValue(_time)]);\n            }\n            else if (this._scale) mat4.scale(this._animMat, this._animMat, this._scale);\n\n            mat4.mul(cgl.mMatrix, cgl.mMatrix, this._animMat);\n        }\n\n        if (this.addTranslate)mat4.translate(cgl.mMatrix, cgl.mMatrix, this.addTranslate);\n\n        if (this.addMulMat) mat4.mul(cgl.mMatrix, cgl.mMatrix, this.addMulMat);\n\n        mat4.copy(this.absMat, cgl.mMatrix);\n    }\n\n    render(cgl, dontTransform, dontDrawMesh, ignoreMaterial, ignoreChilds, drawHidden, _time)\n    {\n        if (!dontTransform) cgl.pushModelMatrix();\n\n        if (_time === undefined)_time = gltf.time;\n\n        if (!dontTransform || this.skinRenderer) this.transform(cgl, _time);\n\n        if (this.hidden && !drawHidden)\n        {\n        }\n        else\n        {\n            if (this.skinRenderer)\n            {\n                this.skinRenderer.time = _time;\n                if (!dontDrawMesh) this.mesh.render(cgl, ignoreMaterial, this.skinRenderer, _time);\n            }\n            else\n            {\n                if (this.mesh && !dontDrawMesh)\n                    this.mesh.render(cgl, ignoreMaterial, null, _time);\n            }\n        }\n\n        if (!ignoreChilds && !this.hidden)\n            for (let i = 0; i < this.children.length; i++)\n                if (gltf.nodes[this.children[i]])\n                {\n                    gltf.nodes[this.children[i]].render(cgl, dontTransform, dontDrawMesh, ignoreMaterial, ignoreChilds, drawHidden, _time);\n                }\n\n        if (!dontTransform)cgl.popModelMatrix();\n    }\n};\n',inc_print_js:'let tab = null;\n\nfunction closeTab()\n{\n    if (tab)gui.mainTabs.closeTab(tab.id);\n    tab = null;\n}\n\nfunction printNode(html, node, level)\n{\n    if (!gltf) return;\n\n    html += "<tr class=\\"row\\">";\n\n    let ident = "";\n    let identSpace = "";\n\n    for (let i = 1; i < level; i++)\n    {\n        identSpace += "&nbsp;&nbsp;&nbsp;";\n        let identClass = "identBg";\n        if (i == 1)identClass = "identBgLevel0";\n        ident += "<td class=\\"ident " + identClass + "\\" ><div style=\\"\\"></div></td>";\n    }\n    let id = CABLES.uuid();\n    html += ident;\n    html += "<td colspan=\\"" + (21 - level) + "\\">";\n    // html+=\'<div style="display:inline-block;border:0px solid red;height:10px;width:\'+level*10+\'px"></div>\';\n\n    if (node.mesh && node.mesh.meshes.length)html += "<span class=\\"icon icon-cube\\"></span>&nbsp;";\n    else html += "<span class=\\"icon icon-box-select\\"></span> &nbsp;";\n\n    html += node.name + "</td><td></td>";\n\n    if (node.mesh)\n    {\n        html += "<td>";\n        for (let i = 0; i < node.mesh.meshes.length; i++)\n        {\n            if (i > 0)html += ", ";\n            html += node.mesh.meshes[i].name;\n        }\n\n        html += "</td>";\n\n        html += "<td>";\n        html += node.hasSkin() || "-";\n        html += "</td>";\n\n        html += "<td>";\n        let countMats = 0;\n        for (let i = 0; i < node.mesh.meshes.length; i++)\n        {\n            if (countMats > 0)html += ", ";\n            if (node.mesh.meshes[i].material)\n            {\n                html += gltf.json.materials[node.mesh.meshes[i].material].name;\n                countMats++;\n            }\n        }\n        if (countMats == 0)html += "none";\n        html += "</td>";\n    }\n    else\n    {\n        html += "<td>-</td><td>-</td><td>-</td>";\n    }\n\n    html += "<td>";\n    if (node._animRot || node._animScale || node._animTrans)\n    {\n        if (node._animRot) html += "Rot ";\n        if (node._animScale) html += "Scale ";\n        if (node._animTrans) html += "Trans ";\n    }\n    else html += "None";\n    html += "</td>";\n\n    html += "<td>";\n    let hideclass = "";\n    if (node.hidden)hideclass = "node-hidden";\n\n    // html+=\'\';\n    html += "<a onclick=\\"gui.corePatch().getOpById(\'" + op.id + "\').exposeNode(\'" + node.name + "\',\'transform\')\\" class=\\"treebutton\\">Transform</a>";\n    html += " <a onclick=\\"gui.corePatch().getOpById(\'" + op.id + "\').exposeNode(\'" + node.name + "\',\'hierarchy\')\\" class=\\"treebutton\\">Hierarchy</a>";\n    html += " <a onclick=\\"gui.corePatch().getOpById(\'" + op.id + "\').exposeNode(\'" + node.name + "\')\\" class=\\"treebutton\\">Node</a>";\n\n    if (node.hasSkin())\n        html += " <a onclick=\\"gui.corePatch().getOpById(\'" + op.id + "\').exposeNode(\'" + node.name + "\',false,{skin:true});\\" class=\\"treebutton\\">Skin</a>";\n\n    html += "</td><td>";\n    html += "&nbsp;<span class=\\"icon iconhover icon-eye " + hideclass + "\\" onclick=\\"gui.corePatch().getOpById(\'" + op.id + "\').toggleNodeVisibility(\'" + node.name + "\');this.classList.toggle(\'node-hidden\');\\"></span>";\n    html += "</td>";\n\n    html += "</tr>";\n\n    if (node.children)\n    {\n        for (let i = 0; i < node.children.length; i++)\n            html = printNode(html, gltf.nodes[node.children[i]], level + 1);\n    }\n\n    return html;\n}\n\nfunction printMaterial(mat, idx)\n{\n    let html = "<tr>";\n    html += " <td>" + idx + "</td>";\n    html += " <td>" + mat.name + "</td>";\n    // html+=\' <td><a onclick="" class="treebutton">Assign</a><td>\';\n\n    html += " <td>";\n    if (mat.pbrMetallicRoughness && mat.pbrMetallicRoughness.baseColorFactor)\n    {\n        let rgb = "";\n        rgb += "" + Math.round(mat.pbrMetallicRoughness.baseColorFactor[0] * 255);\n        rgb += "," + Math.round(mat.pbrMetallicRoughness.baseColorFactor[1] * 255);\n        rgb += "," + Math.round(mat.pbrMetallicRoughness.baseColorFactor[2] * 255);\n\n        html += "<div style=\\"width:15px;height:15px;;background-color:rgb(" + rgb + ")\\">&nbsp;</a>";\n    }\n    html += " <td style=\\"\\">" + (gltf.shaders[idx] ? "-" : "<a onclick=\\"gui.corePatch().getOpById(\'" + op.id + "\').assignMaterial(\'" + mat.name + "\')\\" class=\\"treebutton\\">Assign</a>") + "<td>";\n    html += "<td>";\n\n    html += "</tr>";\n    return html;\n}\n\nfunction printInfo()\n{\n    if (!gltf) return;\n\n    const startTime = performance.now();\n    const sizes = {};\n    let html = "<div style=\\"overflow:scroll;width:100%;height:100%\\">";\n\n    html += "generator:" + gltf.json.asset.generator;\n\n    let numNodes = 0;\n    if (gltf.json.nodes)numNodes = gltf.json.nodes.length;\n    html += "<div id=\\"groupNodes\\">Nodes (" + numNodes + ")</div>";\n\n    html += "<table id=\\"sectionNodes\\" class=\\"table treetable\\">";\n\n    html += "<tr>";\n    html += " <th colspan=\\"21\\">Name</th>";\n    html += " <th>Mesh</th>";\n    html += " <th>Skin</th>";\n    html += " <th>Material</th>";\n    html += " <th>Anim</th>";\n    html += " <th>Expose</th>";\n    html += " <th></th>";\n    html += "</tr>";\n\n    for (let i = 0; i < gltf.nodes.length; i++)\n    {\n        if (!gltf.nodes[i].isChild)\n            html = printNode(html, gltf.nodes[i], 1);\n    }\n    html += "</table>";\n\n    /// //////////////////\n\n    let numMaterials = 0;\n    if (gltf.json.materials)numMaterials = gltf.json.materials.length;\n    html += "<div id=\\"groupMaterials\\">Materials (" + numMaterials + ")</div>";\n\n    if (!gltf.json.materials || gltf.json.materials.length == 0)\n    {\n    }\n    else\n    {\n        html += "<table id=\\"materialtable\\"  class=\\"table treetable\\">";\n        html += "<tr>";\n        html += " <th>Index</th>";\n        html += " <th>Name</th>";\n        html += " <th>Color</th>";\n        html += " <th>Function</th>";\n        html += " <th></th>";\n        html += "</tr>";\n        for (let i = 0; i < gltf.json.materials.length; i++)\n        {\n            html += printMaterial(gltf.json.materials[i], i);\n        }\n        html += "</table>";\n    }\n\n    /// ///////////////////////\n\n    html += "<div id=\\"groupMeshes\\">Meshes (" + gltf.json.meshes.length + ")</div>";\n\n    html += "<table id=\\"meshestable\\"  class=\\"table treetable\\">";\n    html += "<tr>";\n    html += " <th>Name</th>";\n    html += " <th>Node</th>";\n    html += " <th>Material</th>";\n    html += " <th>Vertices</th>";\n    html += " <th>Attributes</th>";\n    html += "</tr>";\n\n    let sizeBufferViews = [];\n    sizes.meshes = 0;\n\n    console.log(gltf);\n\n    for (let i = 0; i < gltf.json.meshes.length; i++)\n    {\n        html += "<tr>";\n        html += "<td>" + gltf.json.meshes[i].name + "</td>";\n\n        html += "<td>";\n        let count = 0;\n        let nodename = "";\n        for (var j = 0; j < gltf.json.nodes.length; j++)\n        {\n            if (gltf.json.nodes[j].mesh == i)\n            {\n                count++;\n                if (count == 1)\n                {\n                    nodename = gltf.json.nodes[j].name;\n                }\n            }\n        }\n        if (count > 1) html += (count) + " nodes (" + nodename + " ...)";\n        else html += nodename;\n        html += "</td>";\n\n        // -------\n\n        html += "<td>";\n        for (var j = 0; j < gltf.json.meshes[i].primitives.length; j++)\n        {\n            if (gltf.json.meshes[i].primitives[j].material)\n            {\n                html += gltf.json.materials[gltf.json.meshes[i].primitives[j].material].name + " ";\n            }\n            else html += "None";\n        }\n        html += "</td>";\n\n        html += "<td>";\n        let numVerts = 0;\n        for (var j = 0; j < gltf.json.meshes[i].primitives.length; j++)\n        {\n            if (gltf.json.meshes[i].primitives[j].attributes.POSITION != undefined)\n            {\n                let v = parseInt(gltf.json.accessors[gltf.json.meshes[i].primitives[j].attributes.POSITION].count);\n                numVerts += v;\n                html += "" + v + "<br/>";\n            }\n            else html += "-<br/>";\n        }\n\n        if (gltf.json.meshes[i].primitives.length > 0)\n            html += "=" + numVerts;\n        html += "</td>";\n\n        html += "<td style=\\"vertical-align:top;\\">";\n        for (let j = 0; j < gltf.json.meshes[i].primitives.length; j++)\n        {\n            html += Object.keys(gltf.json.meshes[i].primitives[j].attributes);\n            html += " <a onclick=\\"gui.corePatch().getOpById(\'" + op.id + "\').exposeGeom(\'" + gltf.json.meshes[i].name + "\'," + j + ")\\" class=\\"treebutton\\">Geometry</a>";\n            html += "<br/>";\n        }\n        html += "</td>";\n        html += "</tr>";\n\n        for (let j = 0; j < gltf.json.meshes[i].primitives.length; j++)\n        {\n            const accessor = gltf.json.accessors[gltf.json.meshes[i].primitives[j].indices];\n            if (accessor)\n            {\n                let bufView = accessor.bufferView;\n\n                if (sizeBufferViews.indexOf(bufView) == -1)\n                {\n                    sizeBufferViews.push(bufView);\n                    if (gltf.json.bufferViews[bufView])sizes.meshes += gltf.json.bufferViews[bufView].byteLength;\n                }\n            }\n\n            for (let k in gltf.json.meshes[i].primitives[j].attributes)\n            {\n                const attr = gltf.json.meshes[i].primitives[j].attributes[k];\n                const bufView2 = gltf.json.accessors[attr].bufferView;\n\n                if (sizeBufferViews.indexOf(bufView2) == -1)\n                {\n                    sizeBufferViews.push(bufView2);\n                    if (gltf.json.bufferViews[bufView2])sizes.meshes += gltf.json.bufferViews[bufView2].byteLength;\n                }\n            }\n        }\n    }\n    html += "</table>";\n\n    /// //////////////////////////////////\n\n    let numAnims = 0;\n    if (gltf.json.animations)numAnims = gltf.json.animations.length;\n    html += "<div id=\\"groupAnims\\">Animations (" + numAnims + ")</div>";\n\n    if (gltf.json.animations)\n    {\n        html += "<table id=\\"sectionAnim\\" class=\\"table treetable\\">";\n        html += "<tr>";\n        html += "  <th>Name</th>";\n        html += "  <th>Target node</th>";\n        html += "  <th>Path</th>";\n        html += "  <th>Interpolation</th>";\n        html += "  <th>Keys</th>";\n        html += "</tr>";\n\n        sizes.animations = 0;\n\n        for (let i = 0; i < gltf.json.animations.length; i++)\n        {\n            for (let j = 0; j < gltf.json.animations[i].samplers.length; j++)\n            {\n                let bufView = gltf.json.accessors[gltf.json.animations[i].samplers[j].input].bufferView;\n                if (sizeBufferViews.indexOf(bufView) == -1)\n                {\n                    sizeBufferViews.push(bufView);\n                    sizes.animations += gltf.json.bufferViews[bufView].byteLength;\n                }\n\n                bufView = gltf.json.accessors[gltf.json.animations[i].samplers[j].output].bufferView;\n                if (sizeBufferViews.indexOf(bufView) == -1)\n                {\n                    sizeBufferViews.push(bufView);\n                    sizes.animations += gltf.json.bufferViews[bufView].byteLength;\n                }\n            }\n\n            for (let j = 0; j < gltf.json.animations[i].channels.length; j++)\n            {\n                html += "<tr>";\n                html += "  <td> Anim " + i + ": " + gltf.json.animations[i].name + "</td>";\n\n                html += "  <td>" + gltf.nodes[gltf.json.animations[i].channels[j].target.node].name + "</td>";\n                html += "  <td>";\n                html += gltf.json.animations[i].channels[j].target.path + " ";\n                html += "  </td>";\n\n                const smplidx = gltf.json.animations[i].channels[j].sampler;\n                const smplr = gltf.json.animations[i].samplers[smplidx];\n\n                html += "  <td>" + smplr.interpolation + "</td>";\n\n                html += "  <td>" + gltf.json.accessors[smplr.output].count;\n\n                html += "&nbsp;&nbsp;<a onclick=\\"gui.corePatch().getOpById(\'" + op.id + "\').showAnim(\'" + i + "\',\'" + j + "\')\\" class=\\"icon icon-search\\"></a>";\n\n                html += "</td>";\n\n                html += "</tr>";\n            }\n        }\n        html += "</table>";\n    }\n    else\n    {\n\n    }\n\n    /// ///////////////////\n\n    let numImages = 0;\n    if (gltf.json.images)numImages = gltf.json.images.length;\n    html += "<div id=\\"groupImages\\">Images (" + numImages + ")</div>";\n\n    if (gltf.json.images)\n    {\n        html += "<table id=\\"sectionImages\\" class=\\"table treetable\\">";\n\n        html += "<tr>";\n        html += "  <th>name</th>";\n        html += "  <th>type</th>";\n        html += "  <th>func</th>";\n\n        html += "</tr>";\n\n        sizes.images = 0;\n\n        for (let i = 0; i < gltf.json.images.length; i++)\n        {\n            if (gltf.json.images[i].bufferView)\n                sizes.images += gltf.json.bufferViews[gltf.json.images[i].bufferView].byteLength;\n\n            html += "<tr>";\n            html += "<td>" + gltf.json.images[i].name + "</td>";\n            html += "<td>" + gltf.json.images[i].mimeType + "</td>";\n            html += "<td>";\n\n            let name = gltf.json.images[i].name;\n            if (name === undefined)name = gltf.json.images[i].bufferView;\n\n            html += "<a onclick=\\"gui.corePatch().getOpById(\'" + op.id + "\').exposeTexture(\'" + name + "\')\\" class=\\"treebutton\\">Expose</a>";\n            html += "</td>";\n\n            html += "<tr>";\n        }\n        html += "</table>";\n    }\n\n    /// ///////////////////////\n\n    let numCameras = 0;\n    if (gltf.json.cameras)numCameras = gltf.json.cameras.length;\n    html += "<div id=\\"groupCameras\\">Cameras (" + numCameras + ")</div>";\n\n    if (gltf.json.cameras)\n    {\n        html += "<table id=\\"sectionCameras\\" class=\\"table treetable\\">";\n\n        html += "<tr>";\n        html += "  <th>name</th>";\n        html += "  <th>type</th>";\n        html += "  <th>info</th>";\n        html += "</tr>";\n\n        for (let i = 0; i < gltf.json.cameras.length; i++)\n        {\n            html += "<tr>";\n            html += "<td>" + gltf.json.cameras[i].name + "</td>";\n            html += "<td>" + gltf.json.cameras[i].type + "</td>";\n            html += "<td>";\n            html += "yfov: " + Math.round(gltf.json.cameras[i].perspective.yfov * 100) / 100;\n            html += ", ";\n            html += "zfar: " + Math.round(gltf.json.cameras[i].perspective.zfar * 100) / 100;\n            html += ", ";\n            html += "znear: " + Math.round(gltf.json.cameras[i].perspective.znear * 100) / 100;\n            html += "</td>";\n\n            html += "<tr>";\n        }\n        html += "</table>";\n    }\n\n    /// ////////////////////////////////////\n\n    let numSkins = 0;\n    if (gltf.json.skins)numSkins = gltf.json.skins.length;\n    html += "<div id=\\"groupSkins\\">Skins (" + numSkins + ")</div>";\n\n    if (gltf.json.skins)\n    {\n        // html += "<h3>Skins (" + gltf.json.skins.length + ")</h3>";\n        html += "<table id=\\"sectionSkins\\" class=\\"table treetable\\">";\n\n        html += "<tr>";\n        html += "  <th>name</th>";\n        html += "  <th></th>";\n        html += "  <th>total joints</th>";\n        html += "</tr>";\n\n        for (let i = 0; i < gltf.json.skins.length; i++)\n        {\n            html += "<tr>";\n            html += "<td>" + gltf.json.skins[i].name + "</td>";\n            html += "<td>" + "</td>";\n            html += "<td>" + gltf.json.skins[i].joints.length + "</td>";\n            html += "<td>";\n            html += "</td>";\n            html += "<tr>";\n        }\n        html += "</table>";\n    }\n\n    /// //////////////////////////\n\n    let sizeBin = 0;\n    if (gltf.json.buffers)\n        sizeBin = gltf.json.buffers[0].byteLength;\n\n    html += "<div id=\\"groupBinary\\">File Size Allocation (" + Math.round(sizeBin / 1024) + "k )</div>";\n\n    html += "<table id=\\"sectionBinary\\" class=\\"table treetable\\">";\n    html += "<tr>";\n    html += "  <th>name</th>";\n    html += "  <th>size</th>";\n    html += "  <th>%</th>";\n    html += "</tr>";\n    let sizeUnknown = sizeBin;\n    for (let i in sizes)\n    {\n        // html+=i+\':\'+Math.round(sizes[i]/1024);\n        html += "<tr>";\n        html += "<td>" + i + "</td>";\n        html += "<td>" + readableSize(sizes[i]) + " </td>";\n        html += "<td>" + Math.round(sizes[i] / sizeBin * 100) + "% </td>";\n        html += "<tr>";\n        sizeUnknown -= sizes[i];\n    }\n\n    if (sizeUnknown != 0)\n    {\n        html += "<tr>";\n        html += "<td>unknown</td>";\n        html += "<td>" + readableSize(sizeUnknown) + " </td>";\n        html += "<td>" + Math.round(sizeUnknown / sizeBin * 100) + "% </td>";\n        html += "<tr>";\n    }\n\n    html += "</table>";\n    html += "</div>";\n\n    tab = new CABLES.UI.Tab("GLTF", { "icon": "cube", "infotext": "tab_gltf", "padding": true, "singleton": true });\n    gui.mainTabs.addTab(tab, true);\n\n    tab.addEventListener("onClose", closeTab);\n    tab.html(html);\n\n    CABLES.UI.Collapsable.setup(ele.byId("groupNodes"), ele.byId("sectionNodes"), false);\n    CABLES.UI.Collapsable.setup(ele.byId("groupMaterials"), ele.byId("materialtable"), true);\n    CABLES.UI.Collapsable.setup(ele.byId("groupAnims"), ele.byId("sectionAnim"), true);\n    CABLES.UI.Collapsable.setup(ele.byId("groupMeshes"), ele.byId("meshestable"), true);\n    CABLES.UI.Collapsable.setup(ele.byId("groupCameras"), ele.byId("sectionCameras"), true);\n    CABLES.UI.Collapsable.setup(ele.byId("groupImages"), ele.byId("sectionImages"), true);\n    CABLES.UI.Collapsable.setup(ele.byId("groupSkins"), ele.byId("sectionSkins"), true);\n    CABLES.UI.Collapsable.setup(ele.byId("groupBinary"), ele.byId("sectionBinary"), true);\n\n    gui.maintabPanel.show(true);\n}\n\nfunction readableSize(n)\n{\n    if (n > 1024) return Math.round(n / 1024) + " kb";\n    if (n > 1024 * 500) return Math.round(n / 1024) + " mb";\n    else return n + " bytes";\n}\n',inc_skin_js:'const GltfSkin = class\n{\n    constructor(node)\n    {\n        this._mod = null;\n        this._node = node;\n        this._lastTime = 0;\n        this._matArr = [];\n        this._m = mat4.create();\n        this._invBindMatrix = mat4.create();\n    }\n\n    renderFinish(cgl)\n    {\n        cgl.popModelMatrix();\n        this._mod.unbind();\n    }\n\n    renderStart(cgl, time)\n    {\n        if (!this._mod)\n        {\n            this._mod = new CGL.ShaderModifier(cgl, op.name + this._node.name);\n\n            this._mod.addModule({\n                "priority": -2,\n                "name": "MODULE_VERTEX_POSITION",\n                "srcHeadVert": attachments.skin_head_vert || "",\n                "srcBodyVert": attachments.skin_vert || ""\n            });\n\n            this._mod.addUniformVert("m4[]", "MOD_boneMats", []);// bohnenmatze\n            const tr = vec3.create();\n        }\n\n        const skinIdx = this._node.skin;\n        const arrLength = gltf.json.skins[skinIdx].joints.length * 16;\n\n        // if(this._lastTime!=inTime.get())\n        {\n            // this._lastTime=inTime.get();\n            if (this._matArr.length != arrLength) this._matArr.length = arrLength;\n\n            for (let i = 0; i < gltf.json.skins[skinIdx].joints.length; i++)\n            {\n                const i16 = i * 16;\n                const jointIdx = gltf.json.skins[skinIdx].joints[i];\n                const nodeJoint = gltf.nodes[jointIdx];\n\n                for (let j = 0; j < 16; j++)\n                    this._invBindMatrix[j] = gltf.accBuffers[gltf.json.skins[skinIdx].inverseBindMatrices][i16 + j];\n\n                mat4.mul(this._m, nodeJoint.modelMatAbs(), this._invBindMatrix);\n\n                for (let j = 0; j < this._m.length; j++) this._matArr[i16 + j] = this._m[j];\n            }\n\n            this._mod.setUniformValue("MOD_boneMats", this._matArr);\n            // this._lastTime = time;\n        }\n        // else\n        // {\n        //     // console.log("skip")\n        // }\n\n        this._mod.define("SKIN_NUM_BONES", gltf.json.skins[skinIdx].joints.length);\n\n        this._mod.bind();\n\n        // draw mesh...\n        cgl.pushModelMatrix();\n        mat4.identity(cgl.mMatrix);\n    }\n};\n',skin_vert:"int index=int(attrJoints.x);\nvec4 newPos = (MOD_boneMats[index] * pos) * attrWeights.x;\nvec3 newNorm = (vec4((MOD_boneMats[index] * vec4(norm.xyz, 0.0)) * attrWeights.x).xyz);\n\nindex=int(attrJoints.y);\nnewPos += (MOD_boneMats[index] * pos) * attrWeights.y;\nnewNorm = (vec4((MOD_boneMats[index] * vec4(norm.xyz, 0.0)) * attrWeights.y).xyz)+newNorm;\n\nindex=int(attrJoints.z);\nnewPos += (MOD_boneMats[index] * pos) * attrWeights.z;\nnewNorm = (vec4((MOD_boneMats[index] * vec4(norm.xyz, 0.0)) * attrWeights.z).xyz)+newNorm;\n\nindex=int(attrJoints.w);\nnewPos += (MOD_boneMats[index] * pos) * attrWeights.w ;\nnewNorm = (vec4((MOD_boneMats[index] * vec4(norm.xyz, 0.0)) * attrWeights.w).xyz)+newNorm;\n\npos=newPos;\n\nnorm=normalize(newNorm.xyz);\n\n\n",skin_head_vert:"\nIN vec4 attrWeights;\nIN vec4 attrJoints;\nUNI mat4 MOD_boneMats[SKIN_NUM_BONES];\n"};const a=class{constructor(e,t){this.node=t;this.name=t.name;this.config=e.json.cameras[t.camera];this.pos=vec3.create();this.quat=quat.create();this.quatOr=quat.create();this.vCenter=vec3.create();this.vUp=vec3.create();this.vMat=mat4.create()}updateAnim(e){if(this.node&&this.node._animTrans){vec3.set(this.pos,this.node._animTrans[0].getValue(e),this.node._animTrans[1].getValue(e),this.node._animTrans[2].getValue(e));quat.set(this.quat,this.node._animRot[0].getValue(e),this.node._animRot[1].getValue(e),this.node._animRot[2].getValue(e),this.node._animRot[3].getValue(e))}}start(e){if(ne.frameStore.shadowPass)return;this.updateAnim(e);const t=ne.getViewPort()[2]/ne.getViewPort()[3];ne.pushPMatrix();ne.pushViewMatrix();let n=mat4.create();mat4.invert(n,this.node.modelMatAbs());this.vMat=n;mat4.identity(ne.vMatrix);mat4.mul(ne.vMatrix,ne.vMatrix,n)}end(){if(ne.frameStore.shadowPass)return;ne.popPMatrix();ne.popViewMatrix()}};const I=8;const _=class{constructor(){this.json={};this.accBuffers=[];this.meshes=[];this.nodes=[];this.shaders=[];this.timing=[];this.cams=[];this.startTime=performance.now();this.bounds=new CGL.BoundingBox;this.loaded=Date.now();this.accBuffersDelete=[]}getNode(t){for(let e=0;e<this.nodes.length;e++){if(this.nodes[e].name==t)return this.nodes[e]}}unHideAll(){for(let e=0;e<this.nodes.length;e++){this.nodes[e].unHide()}}};function x(e){if(window.TextDecoder)return new TextDecoder("utf-8").decode(e);let t,n,a,r;let i,o;t="";a=e.length;n=0;while(n<a){r=e[n++];switch(r>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:t+=String.fromCharCode(r);break;case 12:case 13:i=e[n++];t+=String.fromCharCode((r&31)<<6|i&63);break;case 14:i=e[n++];o=e[n++];t+=String.fromCharCode((r&15)<<12|(i&63)<<6|(o&63)<<0);break}}return t}function E(e,t,n,a){const r={};if(a>=e.byteLength){T.log("could not read chunk...");return}r.size=e.getUint32(a+0,te);r.type=x(t.subarray(a+4,a+4+4));if(r.type=="BIN\0"){r.dataView=new DataView(n,a+8,r.size)}else if(r.type=="JSON"){const i=x(t.subarray(a+8,a+8+r.size));try{const o=JSON.parse(i);r.data=o;X.set(o.asset.generator)}catch(e){}}else{T.warn("unknown type",r.type)}return r}function S(t){const a={};for(let e=0;e<t.json.animations.length;e++){const r=t.json.animations[e];for(let e=0;e<r.channels.length;e++){const i=r.channels[e];const o=t.nodes[i.target.node];const s=r.samplers[i.sampler];const n=t.json.accessors[s.input];const l=t.accBuffers[s.input];const u=t.json.accessors[s.output];const m=t.accBuffers[s.output];t.accBuffersDelete.push(s.output,s.input);if(l&&m){let n=1;if(u.type=="VEC2")n=2;else if(u.type=="VEC3")n=3;else if(u.type=="VEC4")n=4;else T.warn("unknown accOut.type",u.type);const c=[];a[r.name]=true;for(let e=0;e<n;e++){const g=new CABLES.TL.Anim;c.push(g)}if(s.interpolation=="LINEAR"){}else if(s.interpolation=="STEP")for(let e=0;e<n;e++)c[e].defaultEasing=CABLES.EASING_ABSOLUTE;else if(s.interpolation=="CUBICSPLINE")for(let e=0;e<n;e++)c[e].defaultEasing=CABLES.EASING_CUBICSPLINE;else T.warn("unknown interpolation",s.interpolation);if(l[0]!==0)for(let e=0;e<n;e++)c[e].setValue(0,m[0*n+e]);for(let t=0;t<l.length;t++){se=Math.max(l[t],se);for(let e=0;e<n;e++){if(c[e].defaultEasing===CABLES.EASING_CUBICSPLINE){const p=t*n*3+e;const d=c[e].setValue(l[t],m[p+n]);d.bezTangIn=m[p];d.bezTangOut=m[p+n*2]}else{c[e].setValue(l[t],m[t*n+e])}}}o.setAnim(i.target.path,r.name,c)}else{T.warn("loadAmins bufferIn undefined ",l===undefined);T.warn("loadAmins bufferOut undefined ",m===undefined);T.warn("loadAmins ",s,u);T.warn("loadAmins num accBuffers",t.accBuffers.length);T.warn("loadAmins num accessors",t.json.accessors.length)}}}K.set(null);K.set(Object.keys(a))}function A(n){if(!n||!n.json.cameras)return;n.cameras=n.cameras||[];for(let t=0;t<n.nodes.length;t++){if(n.nodes[t].hasOwnProperty("camera")){const e=new a(n,n.nodes[t]);n.cameras.push(e)}}}function C(){if(!window.DracoDecoder){setTimeout(()=>{C()},100)}_e()}function r(e){let r=0,t=0;const i=new _;i.timing.push("Start parsing",Math.round(performance.now()-i.startTime));if(!e)return;const n=new Uint8Array(e);let a=0;const o=x(n.subarray(a,4));a+=4;if(o!="glTF")return;i.timing.push("dataview",Math.round(performance.now()-i.startTime));const s=new DataView(e);const l=s.getUint32(a,te);a+=4;const u=s.getUint32(a,te);a+=4;H.set(l);const m=[];i.chunks=m;m.push(E(s,n,e,a));a+=m[0].size+I;i.json=m[0].data;J.set(i.json);Y.set(i.json.extensionsUsed||[]);let c=E(s,n,e,a);while(c){m.push(c);a+=c.size+I;c=E(s,n,e,a)}i.chunks=m;const g=m[0].data.bufferViews;const p=m[0].data.accessors;i.timing.push("Parse buffers",Math.round(performance.now()-i.startTime));if(i.json.extensionsUsed&&i.json.extensionsUsed.indexOf("KHR_draco_mesh_compression")>-1){if(!window.DracoDecoder){T.setUiError("gltfdraco","GLTF draco compression lib not found / add draco op to your patch!");C();return i}else{i.useDraco=true}}T.setUiError("gltfdraco",null);if(g){for(t=0;t<p.length;t++){const d=p[t];const f=g[d.bufferView];let a=0;if(d.type=="SCALAR")a=1;else if(d.type=="VEC2")a=2;else if(d.type=="VEC3")a=3;else if(d.type=="VEC4")a=4;else if(d.type=="MAT4")a=16;else console.error("unknown accessor type",d.type);if(m[1].dataView){if(f){const h=d.count*a;let e=(f.byteOffset||0)+(d.byteOffset||0);let t=f.byteStride||0;let n=null;if(d.componentType==5126||d.componentType==5125){t=t||4;const b=d.componentType==5125;if(b)n=new Uint32Array(h);else n=new Float32Array(h);for(r=0;r<h;r++){if(b)n[r]=m[1].dataView.getUint32(e,te);else n[r]=m[1].dataView.getFloat32(e,te);if(t!=4&&(r+1)%a===0)e+=t-a*4;e+=4}}else if(d.componentType==5123){t=t||2;n=new Uint16Array(h);for(r=0;r<h;r++){n[r]=m[1].dataView.getUint16(e,te);if(t!=2&&(r+1)%a===0)e+=t-a*2;e+=2}}else if(d.componentType==5121){t=t||1;n=new Uint8Array(h);for(r=0;r<h;r++){n[r]=m[1].dataView.getUint8(e,te);if(t!=1&&(r+1)%a===0)e+=t-a*1;e+=1}}else{console.error("unknown component type",d.componentType)}i.accBuffers.push(n)}else{}}}}i.timing.push("Parse mesh groups",Math.round(performance.now()-i.startTime));i.json.meshes=i.json.meshes||[];if(i.json.meshes){for(t=0;t<i.json.meshes.length;t++){const v=new L(i,i.json.meshes[t]);i.meshes.push(v)}}i.timing.push("Parse nodes",Math.round(performance.now()-i.startTime));for(t=0;t<i.json.nodes.length;t++){if(i.json.nodes[t].children)for(r=0;r<i.json.nodes[t].children.length;r++){i.json.nodes[i.json.nodes[t].children[r]].isChild=true}}for(t=0;t<i.json.nodes.length;t++){const O=new N(i.json.nodes[t],i);i.nodes.push(O)}for(t=0;t<i.nodes.length;t++){const O=i.nodes[t];if(!O.children)continue;for(let e=0;e<O.children.length;e++){i.nodes[O.children[e]].parent=O}}for(t=0;t<i.nodes.length;t++){if(i.nodes[t].skin>-1){i.nodes[t].skinRenderer=new j(i.nodes[t])}}ue=true;i.timing.push("load anims",Math.round(performance.now()-i.startTime));if(i.json.animations)S(i);i.timing.push("load cameras",Math.round(performance.now()-i.startTime));if(i.json.cameras)A(i);i.timing.push("finished",Math.round(performance.now()-i.startTime));return i}let o=class{constructor(e,n,i,o){this.POINTS=0;this.LINES=1;this.LINE_LOOP=2;this.LINE_STRIP=3;this.TRIANGLES=4;this.TRIANGLE_STRIP=5;this.TRIANGLE_FAN=6;this.test=0;this.name=e;this.submeshIndex=0;this.material=n.material;this.mesh=null;this.geom=new CGL.Geometry("gltf_"+this.name);this.geom.verticesIndices=[];this.bounds=null;this.primitive=4;if(n.hasOwnProperty("mode"))this.primitive=n.mode;if(n.hasOwnProperty("indices"))this.geom.verticesIndices=i.accBuffers[n.indices];i.loadingMeshes=i.loadingMeshes||0;i.loadingMeshes++;this.materialJson=this._matPbrMetalness=this._matPbrRoughness=this._matDiffuseColor=null;if(i.json.materials){if(this.material!=-1)this.materialJson=i.json.materials[this.material];if(this.materialJson&&this.materialJson.pbrMetallicRoughness){if(this.materialJson.pbrMetallicRoughness.baseColorFactor)this._matDiffuseColor=this.materialJson.pbrMetallicRoughness.baseColorFactor;this._matDiffuseColor=this.materialJson.pbrMetallicRoughness.baseColorFactor;this._matPbrMetalness=this.materialJson.pbrMetallicRoughness.metallicFactor||null;this._matPbrRoughness=this.materialJson.pbrMetallicRoughness.roughnessFactor||null}}if(i.useDraco&&n.extensions.KHR_draco_mesh_compression){const a=i.chunks[0].data.bufferViews[n.extensions.KHR_draco_mesh_compression.bufferView];const r=a.byteLength;const s=new Int8Array(r);let t=a.byteOffset||0;for(let e=0;e<r;e++){s[e]=i.chunks[1].dataView.getInt8(t,te);t++}const l=window.DracoDecoder;l.decodeGeometry(s.buffer,t=>{const n=new CGL.Geometry("draco mesh "+e);for(let e=0;e<t.attributes.length;e++){const a=t.attributes[e];if(a.name==="position")n.vertices=a.array;else if(a.name==="normal")n.vertexNormals=a.array;else if(a.name==="uv")n.texCoords=a.array;else if(a.name==="color")this.setGeomVertCols(n,a.array);else if(a.name==="joints")n.setAttribute("attrJoints",Array.from(a.array),4);else if(a.name==="weights"){const r=new Float32Array(a.array.length/a.itemSize*4);for(let t=0;t<a.array.length/a.itemSize;t++){r[t*4]=r[t*4+1]=r[t*4+2]=r[t*4+3]=0;for(let e=0;e<a.itemSize;e++)r[t*4+e]=a.array[t*a.itemSize+e]}n.setAttribute("attrWeights",r,4)}else T.logWarn("unknown draco attrib",a)}t.attributes=null;n.verticesIndices=t.index.array;this.setGeom(n);this.mesh=null;i.loadingMeshes--;if(o)o(this)},e=>{T.logError(e)})}else{i.loadingMeshes--;this.fillGeomAttribs(i,this.geom,n.attributes);if(n.targets){console.log("prim.targets",n.targets.length);for(let e=0;e<n.targets.length;e++){let t=this.geom.copy();if(n.hasOwnProperty("indices"))t.verticesIndices=i.accBuffers[n.indices];this.fillGeomAttribs(i,t,n.targets[e],false);{for(let e=0;e<t.vertices.length;e++)t.vertices[e]+=this.geom.vertices[e];t.calculateNormals();for(let e=0;e<t.vertices.length;e++)t.vertices[e]-=this.geom.vertices[e]}this.geom.morphTargets.push(t)}}if(o)o(this)}}_linearToSrgb(e){if(e<=0)return 0;else if(e>=1)return 1;else if(e<.0031308)return e*12.92;else return Math.pow(e,1/2.2)*1.055-.055}setGeomVertCols(n,a){if(a instanceof Float32Array){let t=false;for(let e=0;e<a.length;e++){if(a[e]>1){t=true;continue}}if(t)for(let e=0;e<a.length;e++)a[e]/=65535;n.vertexColors=a}else if(a instanceof Uint16Array){const t=new Float32Array(a.length);for(let e=0;e<a.length;e++)t[e]=a[e]/65535;n.vertexColors=t}else n.vertexColors=a;for(let e=0;e<n.vertexColors.length;e++){n.vertexColors[e]=this._linearToSrgb(n.vertexColors[e])}}fillGeomAttribs(e,t,n,a){if(n.hasOwnProperty("POSITION"))t.vertices=e.accBuffers[n.POSITION];if(n.hasOwnProperty("NORMAL"))t.vertexNormals=e.accBuffers[n.NORMAL];if(n.hasOwnProperty("TEXCOORD_0"))t.texCoords=e.accBuffers[n.TEXCOORD_0];if(n.hasOwnProperty("TANGENT"))t.tangents=e.accBuffers[n.TANGENT];if(n.hasOwnProperty("COLOR_0"))this.setGeomVertCols(t,e.accBuffers[n.COLOR_0]);if(n.hasOwnProperty("TEXCOORD_1"))t.setAttribute("attrTexCoord1",e.accBuffers[n.TEXCOORD_1],2);if(n.hasOwnProperty("TEXCOORD_2"))t.setAttribute("attrTexCoord2",e.accBuffers[n.TEXCOORD_2],2);if(n.hasOwnProperty("TEXCOORD_3"))t.setAttribute("attrTexCoord3",e.accBuffers[n.TEXCOORD_3],2);if(n.hasOwnProperty("TEXCOORD_4"))t.setAttribute("attrTexCoord4",e.accBuffers[n.TEXCOORD_4],2);if(n.hasOwnProperty("WEIGHTS_0")){t.setAttribute("attrWeights",e.accBuffers[n.WEIGHTS_0],4)}if(n.hasOwnProperty("JOINTS_0")){if(!e.accBuffers[n.JOINTS_0])console.log("no !gltf.accBuffers[attribs.JOINTS_0]");t.setAttribute("attrJoints",e.accBuffers[n.JOINTS_0],4)}if(n.hasOwnProperty("POSITION"))e.accBuffersDelete.push(n.POSITION);if(n.hasOwnProperty("NORMAL"))e.accBuffersDelete.push(n.NORMAL);if(n.hasOwnProperty("TEXCOORD_0"))e.accBuffersDelete.push(n.TEXCOORD_0);if(n.hasOwnProperty("TANGENT"))e.accBuffersDelete.push(n.TANGENT);if(n.hasOwnProperty("COLOR_0"))e.accBuffersDelete.push(n.COLOR_0);if(n.hasOwnProperty("TEXCOORD_1"))e.accBuffersDelete.push(n.TEXCOORD_1);if(n.hasOwnProperty("TEXCOORD_2"))e.accBuffersDelete.push(n.TEXCOORD_2);if(n.hasOwnProperty("TEXCOORD_3"))e.accBuffersDelete.push(n.TEXCOORD_3);if(n.hasOwnProperty("TEXCOORD_4"))e.accBuffersDelete.push(n.TEXCOORD_4);if(a!==false)if(t&&t.verticesIndices)this.setGeom(t)}setGeom(n){if(R.get()=="X-ZY"){for(let t=0;t<n.vertexNormals.length;t+=3){let e=n.vertexNormals[t+2];n.vertexNormals[t+2]=n.vertexNormals[t+1];n.vertexNormals[t+1]=-e}}if(w.get()=="XZ-Y"){for(let t=0;t<n.vertices.length;t+=3){let e=n.vertices[t+2];n.vertices[t+2]=-n.vertices[t+1];n.vertices[t+1]=e}}if(this.primitive==this.TRIANGLES){if(!n.vertexNormals.length||U.get())n.calculateNormals();if((!n.biTangents||n.biTangents.length==0)&&n.tangents){const t=vec3.create();const e=vec3.create();const a=n.tangents;n.tangents=new Float32Array(a.length/4*3);n.biTangents=new Float32Array(a.length/4*3);for(let e=0;e<a.length;e+=4){const r=e/4*3;vec3.cross(t,[n.vertexNormals[r],n.vertexNormals[r+1],n.vertexNormals[r+2]],[a[e],a[e+1],a[e+2]]);vec3.div(t,t,[a[e+3],a[e+3],a[e+3]]);vec3.normalize(t,t);n.biTangents[r+0]=t[0];n.biTangents[r+1]=t[1];n.biTangents[r+2]=t[2];n.tangents[r+0]=a[e+0];n.tangents[r+1]=a[e+1];n.tangents[r+2]=a[e+2]}}if(n.tangents.length===0||U.get())n.calcTangentsBitangents()}this.geom=n;this.bounds=n.getBounds()}render(n,t,a){if(!this.mesh&&this.geom&&this.geom.verticesIndices){let e=this.geom;if(this.geom.vertices.length/3>64e3){e=this.geom.copy();e.unIndex(false,true)}let t;if(this.primitive==this.TRIANGLES)t=n.gl.TRIANGLES;else if(this.primitive==this.LINES)t=n.gl.LINES;else if(this.primitive==this.LINE_STRIP)t=n.gl.LINE_STRIP;else if(this.primitive==this.POINTS)t=n.gl.POINTS;else{T.logWarn("unknown primitive type",this)}this.mesh=new CGL.Mesh(n,e,t);this.mesh._geom=null}else{if(this.geom&&this.geom.morphTargets.length){this.morphGeom=this.geom.copy();this.test=le*11.7;if(this.test>=this.geom.morphTargets.length-1)this.test=0;const l=this.geom.morphTargets[Math.floor(this.test)];const u=this.geom.morphTargets[Math.floor(this.test+1)];if(l&&l.vertices&&u){if(this.morphGeom.vertexNormals.length!=l.vertexNormals.length)this.morphGeom.vertexNormals=new Float32Array(l.vertexNormals.length);const m=this.test%1;for(let e=0;e<this.morphGeom.vertices.length;e++){this.morphGeom.vertices[e]=this.geom.vertices[e]+(1-m)*l.vertices[e]+m*u.vertices[e];this.morphGeom.vertexNormals[e]=(1-m)*l.vertexNormals[e]+m*u.vertexNormals[e]}this.mesh.updateNormals(this.morphGeom);this.mesh.updateVertices(this.morphGeom)}}let e=!t&&this.material!=-1&&oe.shaders[this.material];if(a)e=false;if(e)n.pushShader(oe.shaders[this.material]);const r=n.getShader()||{};const i=r.uniformColorDiffuse;const o=r.uniformPbrMetalness;const s=r.uniformPbrRoughness;if(!oe.shaders[this.material]&&k.get()){if(i&&this._matDiffuseColor){this._matDiffuseColorOrig=[i.getValue()[0],i.getValue()[1],i.getValue()[2],i.getValue()[3]];i.setValue(this._matDiffuseColor)}if(o)if(this._matPbrMetalness!=null){this._matPbrMetalnessOrig=o.getValue();o.setValue(this._matPbrMetalness)}else o.setValue(0);if(s)if(this._matPbrRoughness!=null){this._matPbrRoughnessOrig=s.getValue();s.setValue(this._matPbrRoughness)}else s.setValue(0)}if(this.mesh)this.mesh.render(n.getShader(),t);if(k.get()){if(i&&this._matDiffuseColor)i.setValue(this._matDiffuseColorOrig);if(o&&this._matPbrMetalnessOrig!=undefined)o.setValue(this._matPbrMetalnessOrig);if(s&&this._matPbrRoughnessOrig!=undefined)s.setValue(this._matPbrRoughnessOrig)}if(e)n.popShader()}}};const L=class{constructor(t,e){this.bounds=new CGL.BoundingBox;this.meshes=[];this.name=e.name;const n=e.primitives;for(let e=0;e<n.length;e++){const a=new o(this.name,n[e],t,e=>{this.bounds.apply(e.bounds)});a.submeshIndex=e;this.meshes.push(a)}}render(t,n,a,r){for(let e=0;e<this.meshes.length;e++){const i=oe.shaders[this.meshes[e].material];if(i)t.pushShader(oe.shaders[this.meshes[e].material]);if(a)a.renderStart(t,a._time);this.meshes[e].render(t,n,a,r);if(a)a.renderFinish(t);if(i)t.popShader()}}};const N=class{constructor(e,t){this.isChild=e.isChild||false;this.name=e.name;if(e.hasOwnProperty("camera"))this.camera=e.camera;this.hidden=false;this.mat=mat4.create();this._animMat=mat4.create();this._tempMat=mat4.create();this._tempQuat=quat.create();this._tempRotmat=mat4.create();this.mesh=null;this.children=[];this._node=e;this._gltf=t;this.absMat=mat4.create();this.addTranslate=null;this.addMulMat=null;this.updateMatrix();this._animActions={}}get skin(){if(this._node.hasOwnProperty("skin"))return this._node.skin;else return-1}hasSkin(){if(this._node.hasOwnProperty("skin"))return this._gltf.json.skins[this._node.skin].name||"unknown";return false}updateMatrix(){mat4.identity(this.mat);if(this._node.translation)mat4.translate(this.mat,this.mat,this._node.translation);if(this._node.rotation){const e=mat4.create();this._rot=this._node.rotation;mat4.fromQuat(e,this._node.rotation);mat4.mul(this.mat,this.mat,e)}if(this._node.scale){this._scale=this._node.scale;mat4.scale(this.mat,this.mat,this._scale)}if(this._node.hasOwnProperty("mesh")){this.mesh=this._gltf.meshes[this._node.mesh]}if(this._node.children){for(let e=0;e<this._node.children.length;e++){this._gltf.json.nodes[e].isChild=true;if(this._gltf.nodes[this._node.children[e]])this._gltf.nodes[this._node.children[e]].isChild=true;this.children.push(this._node.children[e])}}}unHide(){this.hidden=false;for(let e=0;e<this.children.length;e++)if(this.children[e].unHide)this.children[e].unHide()}calcBounds(t,e,n){const a=mat4.create();if(e)mat4.copy(a,e);if(this.mat)mat4.mul(a,a,this.mat);if(this.mesh){const r=this.mesh.bounds.copy();r.mulMat4(a);n.apply(r);if(n.changed){ie.push(r._min[0]||0,r._min[1]||0,r._min[2]||0,r._max[0]||0,r._max[1]||0,r._max[2]||0)}}for(let e=0;e<this.children.length;e++){if(t.nodes[this.children[e]]&&t.nodes[this.children[e]].calcBounds){const i=t.nodes[this.children[e]].calcBounds(t,a,n);n.apply(i)}}if(n.changed)return n;else return null}setAnimAction(t){if(t&&!this._animActions[t])return;for(let e in this._animActions[t]){if(e=="translation")this._animTrans=this._animActions[t][e];else if(e=="rotation")this._animRot=this._animActions[t][e];else if(e=="scale")this._animScale=this._animActions[t][e];else console.warn("unknown anim path",e,this._animActions[t][e])}}setAnim(e,t,n){this._animActions[t]=this._animActions[t]||{};if(this._animActions[t][e])T.warn("animation action path already exists",t,e,this._animActions[t][e]);this._animActions[t][e]=n;if(e=="translation")this._animTrans=n;else if(e=="rotation")this._animRot=n;else if(e=="scale")this._animScale=n;else console.warn("unknown anim path",e,n)}modelMatLocal(){return this._animMat||this.mat}modelMatAbs(){return this.absMat}transform(e,t){if(!t&&t!=0)t=le;this._lastTimeTrans=t;if(!this._animTrans&&!this._animRot&&!this._animScale){mat4.mul(e.mMatrix,e.mMatrix,this.mat);this._animMat=null}else{this._animMat=this._animMat||mat4.create();mat4.identity(this._animMat);const n=true;if(n&&this._animTrans){mat4.translate(this._animMat,this._animMat,[this._animTrans[0].getValue(t),this._animTrans[1].getValue(t),this._animTrans[2].getValue(t)])}else if(this._node.translation)mat4.translate(this._animMat,this._animMat,this._node.translation);if(n&&this._animRot){if(this._animRot[0].defaultEasing==CABLES.EASING_LINEAR)CABLES.TL.Anim.slerpQuaternion(t,this._tempQuat,this._animRot[0],this._animRot[1],this._animRot[2],this._animRot[3]);else if(this._animRot[0].defaultEasing==CABLES.EASING_ABSOLUTE){this._tempQuat[0]=this._animRot[0].getValue(t);this._tempQuat[1]=this._animRot[1].getValue(t);this._tempQuat[2]=this._animRot[2].getValue(t);this._tempQuat[3]=this._animRot[3].getValue(t)}else if(this._animRot[0].defaultEasing==CABLES.EASING_CUBICSPLINE){CABLES.TL.Anim.slerpQuaternion(t,this._tempQuat,this._animRot[0],this._animRot[1],this._animRot[2],this._animRot[3])}mat4.fromQuat(this._tempMat,this._tempQuat);mat4.mul(this._animMat,this._animMat,this._tempMat)}else if(this._rot){mat4.fromQuat(this._tempRotmat,this._rot);mat4.mul(this._animMat,this._animMat,this._tempRotmat)}if(n&&this._animScale){mat4.scale(this._animMat,this._animMat,[this._animScale[0].getValue(t),this._animScale[1].getValue(t),this._animScale[2].getValue(t)])}else if(this._scale)mat4.scale(this._animMat,this._animMat,this._scale);mat4.mul(e.mMatrix,e.mMatrix,this._animMat)}if(this.addTranslate)mat4.translate(e.mMatrix,e.mMatrix,this.addTranslate);if(this.addMulMat)mat4.mul(e.mMatrix,e.mMatrix,this.addMulMat);mat4.copy(this.absMat,e.mMatrix)}render(t,n,a,r,i,o,s){if(!n)t.pushModelMatrix();if(s===undefined)s=oe.time;if(!n||this.skinRenderer)this.transform(t,s);if(this.hidden&&!o){}else{if(this.skinRenderer){this.skinRenderer.time=s;if(!a)this.mesh.render(t,r,this.skinRenderer,s)}else{if(this.mesh&&!a)this.mesh.render(t,r,null,s)}}if(!i&&!this.hidden)for(let e=0;e<this.children.length;e++)if(oe.nodes[this.children[e]]){oe.nodes[this.children[e]].render(t,n,a,r,i,o,s)}if(!n)t.popModelMatrix()}};let v=null;function O(){if(v)gui.mainTabs.closeTab(v.id);v=null}function P(n,a,r){if(!oe)return;n+='<tr class="row">';let i="";let o="";for(let t=1;t<r;t++){o+="&nbsp;&nbsp;&nbsp;";let e="identBg";if(t==1)e="identBgLevel0";i+='<td class="ident '+e+'" ><div style=""></div></td>'}let e=CABLES.uuid();n+=i;n+='<td colspan="'+(21-r)+'">';if(a.mesh&&a.mesh.meshes.length)n+='<span class="icon icon-cube"></span>&nbsp;';else n+='<span class="icon icon-box-select"></span> &nbsp;';n+=a.name+"</td><td></td>";if(a.mesh){n+="<td>";for(let e=0;e<a.mesh.meshes.length;e++){if(e>0)n+=", ";n+=a.mesh.meshes[e].name}n+="</td>";n+="<td>";n+=a.hasSkin()||"-";n+="</td>";n+="<td>";let t=0;for(let e=0;e<a.mesh.meshes.length;e++){if(t>0)n+=", ";if(a.mesh.meshes[e].material){n+=oe.json.materials[a.mesh.meshes[e].material].name;t++}}if(t==0)n+="none";n+="</td>"}else{n+="<td>-</td><td>-</td><td>-</td>"}n+="<td>";if(a._animRot||a._animScale||a._animTrans){if(a._animRot)n+="Rot ";if(a._animScale)n+="Scale ";if(a._animTrans)n+="Trans "}else n+="None";n+="</td>";n+="<td>";let t="";if(a.hidden)t="node-hidden";n+="<a onclick=\"gui.corePatch().getOpById('"+T.id+"').exposeNode('"+a.name+"','transform')\" class=\"treebutton\">Transform</a>";n+=" <a onclick=\"gui.corePatch().getOpById('"+T.id+"').exposeNode('"+a.name+"','hierarchy')\" class=\"treebutton\">Hierarchy</a>";n+=" <a onclick=\"gui.corePatch().getOpById('"+T.id+"').exposeNode('"+a.name+'\')" class="treebutton">Node</a>';if(a.hasSkin())n+=" <a onclick=\"gui.corePatch().getOpById('"+T.id+"').exposeNode('"+a.name+'\',false,{skin:true});" class="treebutton">Skin</a>';n+="</td><td>";n+='&nbsp;<span class="icon iconhover icon-eye '+t+'" onclick="gui.corePatch().getOpById(\''+T.id+"').toggleNodeVisibility('"+a.name+"');this.classList.toggle('node-hidden');\"></span>";n+="</td>";n+="</tr>";if(a.children){for(let e=0;e<a.children.length;e++)n=P(n,oe.nodes[a.children[e]],r+1)}return n}function M(t,e){let n="<tr>";n+=" <td>"+e+"</td>";n+=" <td>"+t.name+"</td>";n+=" <td>";if(t.pbrMetallicRoughness&&t.pbrMetallicRoughness.baseColorFactor){let e="";e+=""+Math.round(t.pbrMetallicRoughness.baseColorFactor[0]*255);e+=","+Math.round(t.pbrMetallicRoughness.baseColorFactor[1]*255);e+=","+Math.round(t.pbrMetallicRoughness.baseColorFactor[2]*255);n+='<div style="width:15px;height:15px;;background-color:rgb('+e+')">&nbsp;</a>'}n+=' <td style="">'+(oe.shaders[e]?"-":"<a onclick=\"gui.corePatch().getOpById('"+T.id+"').assignMaterial('"+t.name+'\')" class="treebutton">Assign</a>')+"<td>";n+="<td>";n+="</tr>";return n}function e(){if(!oe)return;const e=performance.now();const r={};let i='<div style="overflow:scroll;width:100%;height:100%">';i+="generator:"+oe.json.asset.generator;let t=0;if(oe.json.nodes)t=oe.json.nodes.length;i+='<div id="groupNodes">Nodes ('+t+")</div>";i+='<table id="sectionNodes" class="table treetable">';i+="<tr>";i+=' <th colspan="21">Name</th>';i+=" <th>Mesh</th>";i+=" <th>Skin</th>";i+=" <th>Material</th>";i+=" <th>Anim</th>";i+=" <th>Expose</th>";i+=" <th></th>";i+="</tr>";for(let e=0;e<oe.nodes.length;e++){if(!oe.nodes[e].isChild)i=P(i,oe.nodes[e],1)}i+="</table>";let n=0;if(oe.json.materials)n=oe.json.materials.length;i+='<div id="groupMaterials">Materials ('+n+")</div>";if(!oe.json.materials||oe.json.materials.length==0){}else{i+='<table id="materialtable"  class="table treetable">';i+="<tr>";i+=" <th>Index</th>";i+=" <th>Name</th>";i+=" <th>Color</th>";i+=" <th>Function</th>";i+=" <th></th>";i+="</tr>";for(let e=0;e<oe.json.materials.length;e++){i+=M(oe.json.materials[e],e)}i+="</table>"}i+='<div id="groupMeshes">Meshes ('+oe.json.meshes.length+")</div>";i+='<table id="meshestable"  class="table treetable">';i+="<tr>";i+=" <th>Name</th>";i+=" <th>Node</th>";i+=" <th>Material</th>";i+=" <th>Vertices</th>";i+=" <th>Attributes</th>";i+="</tr>";let o=[];r.meshes=0;console.log(oe);for(let a=0;a<oe.json.meshes.length;a++){i+="<tr>";i+="<td>"+oe.json.meshes[a].name+"</td>";i+="<td>";let e=0;let t="";for(var s=0;s<oe.json.nodes.length;s++){if(oe.json.nodes[s].mesh==a){e++;if(e==1){t=oe.json.nodes[s].name}}}if(e>1)i+=e+" nodes ("+t+" ...)";else i+=t;i+="</td>";i+="<td>";for(var s=0;s<oe.json.meshes[a].primitives.length;s++){if(oe.json.meshes[a].primitives[s].material){i+=oe.json.materials[oe.json.meshes[a].primitives[s].material].name+" "}else i+="None"}i+="</td>";i+="<td>";let n=0;for(var s=0;s<oe.json.meshes[a].primitives.length;s++){if(oe.json.meshes[a].primitives[s].attributes.POSITION!=undefined){let e=parseInt(oe.json.accessors[oe.json.meshes[a].primitives[s].attributes.POSITION].count);n+=e;i+=""+e+"<br/>"}else i+="-<br/>"}if(oe.json.meshes[a].primitives.length>0)i+="="+n;i+="</td>";i+='<td style="vertical-align:top;">';for(let e=0;e<oe.json.meshes[a].primitives.length;e++){i+=Object.keys(oe.json.meshes[a].primitives[e].attributes);i+=" <a onclick=\"gui.corePatch().getOpById('"+T.id+"').exposeGeom('"+oe.json.meshes[a].name+"',"+e+')" class="treebutton">Geometry</a>';i+="<br/>"}i+="</td>";i+="</tr>";for(let t=0;t<oe.json.meshes[a].primitives.length;t++){const p=oe.json.accessors[oe.json.meshes[a].primitives[t].indices];if(p){let e=p.bufferView;if(o.indexOf(e)==-1){o.push(e);if(oe.json.bufferViews[e])r.meshes+=oe.json.bufferViews[e].byteLength}}for(let e in oe.json.meshes[a].primitives[t].attributes){const d=oe.json.meshes[a].primitives[t].attributes[e];const f=oe.json.accessors[d].bufferView;if(o.indexOf(f)==-1){o.push(f);if(oe.json.bufferViews[f])r.meshes+=oe.json.bufferViews[f].byteLength}}}}i+="</table>";let a=0;if(oe.json.animations)a=oe.json.animations.length;i+='<div id="groupAnims">Animations ('+a+")</div>";if(oe.json.animations){i+='<table id="sectionAnim" class="table treetable">';i+="<tr>";i+="  <th>Name</th>";i+="  <th>Target node</th>";i+="  <th>Path</th>";i+="  <th>Interpolation</th>";i+="  <th>Keys</th>";i+="</tr>";r.animations=0;for(let n=0;n<oe.json.animations.length;n++){for(let t=0;t<oe.json.animations[n].samplers.length;t++){let e=oe.json.accessors[oe.json.animations[n].samplers[t].input].bufferView;if(o.indexOf(e)==-1){o.push(e);r.animations+=oe.json.bufferViews[e].byteLength}e=oe.json.accessors[oe.json.animations[n].samplers[t].output].bufferView;if(o.indexOf(e)==-1){o.push(e);r.animations+=oe.json.bufferViews[e].byteLength}}for(let e=0;e<oe.json.animations[n].channels.length;e++){i+="<tr>";i+="  <td> Anim "+n+": "+oe.json.animations[n].name+"</td>";i+="  <td>"+oe.nodes[oe.json.animations[n].channels[e].target.node].name+"</td>";i+="  <td>";i+=oe.json.animations[n].channels[e].target.path+" ";i+="  </td>";const h=oe.json.animations[n].channels[e].sampler;const b=oe.json.animations[n].samplers[h];i+="  <td>"+b.interpolation+"</td>";i+="  <td>"+oe.json.accessors[b.output].count;i+="&nbsp;&nbsp;<a onclick=\"gui.corePatch().getOpById('"+T.id+"').showAnim('"+n+"','"+e+'\')" class="icon icon-search"></a>';i+="</td>";i+="</tr>"}}i+="</table>"}else{}let l=0;if(oe.json.images)l=oe.json.images.length;i+='<div id="groupImages">Images ('+l+")</div>";if(oe.json.images){i+='<table id="sectionImages" class="table treetable">';i+="<tr>";i+="  <th>name</th>";i+="  <th>type</th>";i+="  <th>func</th>";i+="</tr>";r.images=0;for(let t=0;t<oe.json.images.length;t++){if(oe.json.images[t].bufferView)r.images+=oe.json.bufferViews[oe.json.images[t].bufferView].byteLength;i+="<tr>";i+="<td>"+oe.json.images[t].name+"</td>";i+="<td>"+oe.json.images[t].mimeType+"</td>";i+="<td>";let e=oe.json.images[t].name;if(e===undefined)e=oe.json.images[t].bufferView;i+="<a onclick=\"gui.corePatch().getOpById('"+T.id+"').exposeTexture('"+e+'\')" class="treebutton">Expose</a>';i+="</td>";i+="<tr>"}i+="</table>"}let u=0;if(oe.json.cameras)u=oe.json.cameras.length;i+='<div id="groupCameras">Cameras ('+u+")</div>";if(oe.json.cameras){i+='<table id="sectionCameras" class="table treetable">';i+="<tr>";i+="  <th>name</th>";i+="  <th>type</th>";i+="  <th>info</th>";i+="</tr>";for(let e=0;e<oe.json.cameras.length;e++){i+="<tr>";i+="<td>"+oe.json.cameras[e].name+"</td>";i+="<td>"+oe.json.cameras[e].type+"</td>";i+="<td>";i+="yfov: "+Math.round(oe.json.cameras[e].perspective.yfov*100)/100;i+=", ";i+="zfar: "+Math.round(oe.json.cameras[e].perspective.zfar*100)/100;i+=", ";i+="znear: "+Math.round(oe.json.cameras[e].perspective.znear*100)/100;i+="</td>";i+="<tr>"}i+="</table>"}let m=0;if(oe.json.skins)m=oe.json.skins.length;i+='<div id="groupSkins">Skins ('+m+")</div>";if(oe.json.skins){i+='<table id="sectionSkins" class="table treetable">';i+="<tr>";i+="  <th>name</th>";i+="  <th></th>";i+="  <th>total joints</th>";i+="</tr>";for(let e=0;e<oe.json.skins.length;e++){i+="<tr>";i+="<td>"+oe.json.skins[e].name+"</td>";i+="<td>"+"</td>";i+="<td>"+oe.json.skins[e].joints.length+"</td>";i+="<td>";i+="</td>";i+="<tr>"}i+="</table>"}let c=0;if(oe.json.buffers)c=oe.json.buffers[0].byteLength;i+='<div id="groupBinary">File Size Allocation ('+Math.round(c/1024)+"k )</div>";i+='<table id="sectionBinary" class="table treetable">';i+="<tr>";i+="  <th>name</th>";i+="  <th>size</th>";i+="  <th>%</th>";i+="</tr>";let g=c;for(let e in r){i+="<tr>";i+="<td>"+e+"</td>";i+="<td>"+y(r[e])+" </td>";i+="<td>"+Math.round(r[e]/c*100)+"% </td>";i+="<tr>";g-=r[e]}if(g!=0){i+="<tr>";i+="<td>unknown</td>";i+="<td>"+y(g)+" </td>";i+="<td>"+Math.round(g/c*100)+"% </td>";i+="<tr>"}i+="</table>";i+="</div>";v=new CABLES.UI.Tab("GLTF",{icon:"cube",infotext:"tab_gltf",padding:true,singleton:true});gui.mainTabs.addTab(v,true);v.addEventListener("onClose",O);v.html(i);CABLES.UI.Collapsable.setup(ele.byId("groupNodes"),ele.byId("sectionNodes"),false);CABLES.UI.Collapsable.setup(ele.byId("groupMaterials"),ele.byId("materialtable"),true);CABLES.UI.Collapsable.setup(ele.byId("groupAnims"),ele.byId("sectionAnim"),true);CABLES.UI.Collapsable.setup(ele.byId("groupMeshes"),ele.byId("meshestable"),true);CABLES.UI.Collapsable.setup(ele.byId("groupCameras"),ele.byId("sectionCameras"),true);CABLES.UI.Collapsable.setup(ele.byId("groupImages"),ele.byId("sectionImages"),true);CABLES.UI.Collapsable.setup(ele.byId("groupSkins"),ele.byId("sectionSkins"),true);CABLES.UI.Collapsable.setup(ele.byId("groupBinary"),ele.byId("sectionBinary"),true);gui.maintabPanel.show(true)}function y(e){if(e>1024)return Math.round(e/1024)+" kb";if(e>1024*500)return Math.round(e/1024)+" mb";else return e+" bytes"}const j=class{constructor(e){this._mod=null;this._node=e;this._lastTime=0;this._matArr=[];this._m=mat4.create();this._invBindMatrix=mat4.create()}renderFinish(e){e.popModelMatrix();this._mod.unbind()}renderStart(e,t){if(!this._mod){this._mod=new CGL.ShaderModifier(e,T.name+this._node.name);this._mod.addModule({priority:-2,name:"MODULE_VERTEX_POSITION",srcHeadVert:l.skin_head_vert||"",srcBodyVert:l.skin_vert||""});this._mod.addUniformVert("m4[]","MOD_boneMats",[]);const r=vec3.create()}const n=this._node.skin;const a=oe.json.skins[n].joints.length*16;{if(this._matArr.length!=a)this._matArr.length=a;for(let e=0;e<oe.json.skins[n].joints.length;e++){const i=e*16;const o=oe.json.skins[n].joints[e];const s=oe.nodes[o];for(let e=0;e<16;e++)this._invBindMatrix[e]=oe.accBuffers[oe.json.skins[n].inverseBindMatrices][i+e];mat4.mul(this._m,s.modelMatAbs(),this._invBindMatrix);for(let e=0;e<this._m.length;e++)this._matArr[i+e]=this._m[e]}this._mod.setUniformValue("MOD_boneMats",this._matArr)}this._mod.define("SKIN_NUM_BONES",oe.json.skins[n].joints.length);this._mod.bind();e.pushModelMatrix();mat4.identity(e.mMatrix)}};const t=T.inString("data"),n=T.inTrigger("Render"),s=T.inUrl("glb File",[".glb"]),u=T.inBool("Draw",true),m=T.inDropDown("Camera",["None"],"None"),c=T.inString("Animation",""),g=T.inTriggerButton("Show Structure"),p=T.inSwitch("Center",["None","XYZ","XZ"],"XYZ"),d=T.inBool("Rescale",true),f=T.inFloat("Rescale Size",2.5),h=T.inFloat("Time"),b=T.inBool("Sync to timeline",false),G=T.inBool("Loop",true),R=T.inSwitch("Normals Format",["XYZ","X-ZY"],"XYZ"),w=T.inSwitch("Vertices Format",["XYZ","XZ-Y"],"XYZ"),U=T.inBool("Calc Normals",false),B=T.inObject("Materials"),D=T.inArray("Hide Nodes"),k=T.inBool("Use Material Properties",false),V=T.inBool("Active",true),F=T.outTrigger("Render Before"),z=T.outTrigger("Next"),X=T.outString("Generator"),H=T.outNumber("GLTF Version"),Y=T.outArray("GLTF Extensions Used"),W=T.outNumber("Anim Length",0),Z=T.outNumber("Anim Time",0),J=T.outObject("Json"),K=T.outArray("Anims"),q=T.outArray("BoundingPoints"),Q=T.outObject("Bounds"),$=T.outTrigger("Finished"),ee=T.outBool("Loading");T.setPortGroup("Timing",[h,b,G]);const te=true;const ne=T.patch.cgl;s.onChange=w.onChange=U.onChange=R.onChange=_e;let ae=false;let re=null;let ie=[];let oe=null;let se=0;let le=0;let ue=true;let me=null;let ce=null;let ge=null;const pe=vec3.create();let de=0;let fe=false;const he=vec3.create();g.onTriggered=e;t.setUiAttribs({hideParam:true,hidePort:true});t.onChange=Ae;D.onChange=Se;c.onChange=Le;T.setPortGroup("Transform",[d,f,p]);p.onChange=ve;function be(){const t=["None"];if(oe){for(let e=0;e<oe.nodes.length;e++){if(oe.nodes[e].camera>=0){t.push(oe.nodes[e].name)}}}m.uiAttribs.values=t}function ve(){fe=p.get()!="None";if(oe&&oe.bounds){he.set(oe.bounds.center);he[0]=-he[0];he[1]=-he[1];he[2]=-he[2];if(p.get()=="XZ")he[1]=-oe.bounds.minY}}d.onChange=function(){f.setUiAttribs({greyout:!d.get()})};B.onChange=function(){ue=true};T.onDelete=function(){O()};b.onChange=function(){h.setUiAttribs({greyout:b.get()})};m.onChange=Oe;function Oe(){re=null;if(!oe)return;for(let e=0;e<oe.nodes.length;e++){if(oe.nodes[e].name==m.get())re=new a(oe,oe.nodes[e])}}n.onTriggered=function(){if(!ae)return;if(!V.get())return;if(b.get())le=T.patch.timer.getTime();else le=Math.max(0,h.get());if(G.get()){le%=se;if(le<de)$.trigger()}else{if(se>0&&le>=se)$.trigger()}de=le;ne.pushModelMatrix();Z.set(le||0);if(ae&&oe&&oe.bounds){if(d.get()){let e=f.get()/oe.bounds.maxAxis;oe.scale=e;vec3.set(pe,e,e,e);mat4.scale(ne.mMatrix,ne.mMatrix,pe)}if(fe){mat4.translate(ne.mMatrix,ne.mMatrix,he)}}ne.frameStore.currentScene=oe;F.trigger();if(ae){if(ue)xe();if(re)re.start(le);if(oe){oe.time=le;{if(oe.bounds&&ne.shouldDrawHelpers(T)){if(CABLES.UI.renderHelper)ne.pushShader(CABLES.GL_MARKER.getDefaultShader(ne));else ne.pushShader(CABLES.GL_MARKER.getSelectedShader(ne));oe.bounds.render(ne);ne.popShader()}if(u.get()){for(let e=0;e<oe.nodes.length;e++)if(!oe.nodes[e].isChild)oe.nodes[e].render(ne)}else{for(let e=0;e<oe.nodes.length;e++)if(!oe.nodes[e].isChild)oe.nodes[e].render(ne,false,true)}}}}z.trigger();ne.frameStore.currentScene=null;ne.popModelMatrix();if(re)re.end()};function Te(){if(!oe){T.setUiError("nogltf","gltf not found");return}T.setUiError("nogltf",null);if(oe.loadingMeshes>0){setTimeout(Te,100);return}oe.timing.push("finishLoading()",Math.round(performance.now()-oe.startTime));ue=true;W.set(se);oe.bounds=new CGL.BoundingBox;if(!oe)T.setUiError("urlerror",'could not load gltf:<br/>"'+s.get()+'"',2);else T.setUiError("urlerror",null);oe.timing.push("start calc bounds",Math.round(performance.now()-oe.startTime));for(let e=0;e<oe.nodes.length;e++){const t=oe.nodes[e];t.updateMatrix();if(!t.isChild)t.calcBounds(oe,null,oe.bounds)}if(oe.bounds)Q.set(oe.bounds);oe.timing.push("calced bounds",Math.round(performance.now()-oe.startTime));Se();oe.timing.push("hideNodesFromData",Math.round(performance.now()-oe.startTime));if(v)e();oe.timing.push("printinfo",Math.round(performance.now()-oe.startTime));be();Oe();q.set(ie);if(oe){if(s.get()&&!s.get().startsWith("data:")){T.setUiAttrib({extendTitle:CABLES.basename(s.get())})}oe.loaded=Date.now()}if(oe){for(let e=0;e<oe.nodes.length;e++){if(!oe.nodes[e].isChild){oe.nodes[e].render(ne,false,true,true,false,true,0)}}for(let e=0;e<oe.nodes.length;e++){const t=oe.nodes[e];t.children=Me(t.children)}}ve();Le();ee.set(false);ne.patch.loading.finished(ce);ce=null;T.setUiAttrib({accBuffersDelete:CABLES.basename(s.get())});if(oe.accBuffersDelete){for(let e=0;e<oe.accBuffersDelete.length;e++){oe.accBuffers[oe.accBuffersDelete[e]]=null}}ae=true}function Ie(e){if(!V.get())return;if(!ce)ce=ne.patch.loading.start("gltfScene",s.get());let t=s.get();let n=T.patch.getFilePath(String(s.get()));if(s.get()&&!s.get().startsWith("data:")){if(e)n+="?rnd="+CABLES.generateUUID()}ae=false;ee.set(true);fetch(n).then(e=>e.arrayBuffer()).then(e=>{if(s.get()!=t){ne.patch.loading.finished(ce);ce=null;return}ie=[];se=0;oe=r(e);Te()});O();const a=new XMLHttpRequest;a.open("GET",n,true);a.responseType="arraybuffer";ne.patch.loading.addAssetLoadingTask(()=>{})}T.onFileChanged=function(e){oe.accBuffersDelete[i];if(e&&e.length>3&&s.get()&&s.get().indexOf(e)>-1)_e(true)};T.onFileChanged=function(e){if(s.get()&&s.get().indexOf(e)>-1){_e(true)}};V.onChange=()=>{if(V.get())_e();if(!V.get()){oe=null}};function _e(e){clearTimeout(me);me=setTimeout(function(){Ie(e)},30)}function xe(){if(!oe)return;oe.shaders={};if(B.links.length==1&&B.get()){const n=B.links[0].portOut.parent;const a=n.getPort("Shader");const r=n.getPort("Material Name");if(!a&&!r){const i=B.get();for(let t in i){console.log("matname",t);if(i[t]&&oe.json.materials)for(let e=0;e<oe.json.materials.length;e++){console.log("gltf.json.materials[i].name",oe.json.materials[e].name);if(oe.json.materials[e].name==t){if(oe.shaders[e]){n.warn("double material assignment:",name)}oe.shaders[e]=i[t];console.log("shader found!",oe.shaders[e])}}}}}if(B.get()){for(let e=0;e<B.links.length;e++){const t=B.links[e].portOut.parent;const a=t.getPort("Shader");const r=t.getPort("Material Name");if(a&&r&&a.get()){const name=r.get();if(oe.json.materials)for(let e=0;e<oe.json.materials.length;e++)if(oe.json.materials[e].name==name){if(oe.shaders[e]){t.warn("double material assignment:",name)}oe.shaders[e]=a.get()}}}}ue=false;if(v)e()}function Ee(){const t=D.get();if(!oe||!ge||!ge.hiddenNodes)return;if(!t){return}for(let e=0;e<t.length;e++){const n=oe.getNode(t[e]);if(n)n.hidden=true}}function Se(){if(!ge)Ae();if(!oe)return;oe.unHideAll();if(ge&&ge.hiddenNodes){for(const e in ge.hiddenNodes){const t=oe.getNode(e);if(t)t.hidden=true;else T.verbose("node to be hidden not found",e,t)}}Ee()}function Ae(){ge=t.get();if(!ge||ge==="")ge={};else ge=JSON.parse(ge);if(oe)Se();return ge}function Ce(){t.set(JSON.stringify(ge))}function Le(){if(oe&&oe.nodes){for(let e=0;e<oe.nodes.length;e++){oe.nodes[e].setAnimAction(c.get())}}}function Ne(t,n){for(let e=0;e<oe.nodes.length;e++){if(oe.nodes[e].children.indexOf(n)>=0){t.push(oe.nodes[e]);if(oe.nodes[e].isChild)Ne(t,e)}}}T.exposeTexture=function(e){const t=gui.corePatch().addOp("Ops.Gl.GLTF.GltfTexture");t.getPort("Name").set(e);Pe(t,1);T.patch.link(T,z.name,t,"Render");gui.patchView.centerSelectOp(t.id,true);gui.patchView.testCollision(t)};T.exposeGeom=function(e,t){const n=gui.corePatch().addOp("Ops.Gl.GLTF.GltfGeometry");n.getPort("Name").set(e);n.getPort("Submesh").set(t);Pe(n,1);T.patch.link(T,z.name,n,"Update");gui.patchView.centerSelectOp(n.id,true);gui.patchView.testCollision(n)};function Pe(e,t){t=t||1;e.setUiAttrib({translate:{x:T.uiAttribs.translate.x,y:T.uiAttribs.translate.y+t*CABLES.GLUI.glUiConfig.newOpDistanceY}})}T.exposeNode=function(n,e,a){let t=e=="hierarchy";if(t){let r=[];for(let e=0;e<oe.nodes.length;e++){if(oe.nodes[e].name==n){let t=[];const i=oe.nodes[e];Ne(t,e);t=t.reverse();t.push(i,i);let n=z.name;let a=T;for(let e=0;e<t.length;e++){const o=gui.corePatch().addOp("Ops.Gl.GLTF.GltfNode_v2");o.getPort("Node Name").set(t[e].name);T.patch.link(a,n,o,"Render");Pe(o,e);if(e==t.length-1){o.getPort("Transformation").set(false)}else{o.getPort("Draw Mesh").set(false);o.getPort("Draw Childs").set(false)}n="Next";a=o;r.push(o);gui.patchView.testCollision(o)}}}for(let e=0;e<r.length;e++){r[e].selectChilds()}}else{let t="Ops.Gl.GLTF.GltfNode_v2";if(a&&a.skin)t="Ops.Gl.GLTF.GltfSkin";if(e=="transform")t="Ops.Gl.GLTF.GltfNodeTransform_v2";gui.serverOps.loadOpLibs(t,()=>{let e=gui.corePatch().addOp(t);e.getPort("Node Name").set(n);Pe(e);T.patch.link(T,z.name,e,"Render");gui.patchView.centerSelectOp(e.id,true);gui.patchView.testCollision(e)})}gui.closeModal()};T.assignMaterial=function(e){const t=gui.corePatch().addOp("Ops.Gl.GLTF.GltfSetMaterial");t.getPort("Material Name").set(e);T.patch.link(T,B.name,t,"Material");gui.patchView.centerSelectOp(t.id,true);Pe(t);gui.patchView.testCollision(t);gui.closeModal()};T.toggleNodeVisibility=function(e){const t=oe.getNode(e);t.hidden=!t.hidden;ge.hiddenNodes=ge.hiddenNodes||{};if(t)if(t.hidden)ge.hiddenNodes[e]=true;else delete ge.hiddenNodes[e];Ce()};T.showAnim=function(e,t){console.log("showanim",t);console.log(oe.json.animations[e].channels[t]);const n=oe.json.animations[e];const a=oe.json.animations[e].channels[t];const r=oe.nodes[a.target.node];const i=n.samplers[a.sampler];const o=oe.json.accessors[i.input];const s=oe.accBuffers[i.input];const l=oe.json.accessors[i.output];const u=oe.accBuffers[i.output];console.log({channel:a,sampler:i,bufferIn:s,bufferOut:u})};function Me(n){const a={},r=[];for(let e=0,t=n.length;e<t;++e){if(!a.hasOwnProperty(n[e])){r.push(n[e]);a[n[e]]=1}}return r}};Ops.Gl.GLTF.GltfScene_v3.prototype=new CABLES.Op;CABLES.OPS["a9c59d94-8aea-4c20-ab5d-63ce46ecfa16"]={f:Ops.Gl.GLTF.GltfScene_v3,objName:"Ops.Gl.GLTF.GltfScene_v3"};Ops.Gl.Pbr.PbrMaterial=function(){CABLES.Op.apply(this,arguments);const t=this;const s={BasicPBR_frag:'precision highp float;\nprecision highp int;\n{{MODULES_HEAD}}\n\n// set by cables\nUNI vec3 camPos;\n// utility maps\n#ifdef USE_ENVIRONMENT_LIGHTING\n    uniform sampler2D IBL_BRDF_LUT;\n#endif\n// mesh maps\n#ifdef USE_ALBEDO_TEX\n    UNI sampler2D _AlbedoMap;\n#else\n    UNI vec4 _Albedo;\n#endif\n#ifdef USE_NORMAL_TEX\n    UNI sampler2D _NormalMap;\n#endif\n#ifdef USE_HEIGHT_TEX\n    UNI sampler2D _HeightMap;\n#endif\n#ifdef USE_AORM_TEX\n    UNI sampler2D _AORMMap;\n#else\n    UNI float _Roughness;\n    UNI float _Metalness;\n#endif\n\n#ifdef USE_LIGHTMAP\n    #ifndef VERTEX_COLORS\n        UNI sampler2D _Lightmap;\n    #else\n        #ifndef VCOL_LIGHTMAP\n            UNI sampler2D _Lightmap;\n        #endif\n    #endif\n#endif\n#ifdef USE_CLEAR_COAT\n    UNI float _ClearCoatRoughness;\n#endif\n// IBL inputs\n#ifdef USE_ENVIRONMENT_LIGHTING\n    UNI samplerCube _irradiance;\n    UNI samplerCube _prefilteredEnvironmentColour;\n    UNI float MAX_REFLECTION_LOD;\n    UNI float diffuseIntensity;\n    UNI float specularIntensity;\n#endif\n#ifdef USE_LIGHTMAP\n    UNI float lightmapIntensity;\n#endif\nUNI float tonemappingExposure;\n#ifdef USE_HEIGHT_TEX\n    UNI float _HeightDepth;\n    #ifndef USE_OPTIMIZED_HEIGHT\n        UNI mat4 modelMatrix;\n    #endif\n#endif\n#ifdef USE_PARALLAX_CORRECTION\n    UNI vec3 _PCOrigin;\n    UNI vec3 _PCboxMin;\n    UNI vec3 _PCboxMax;\n#endif\n\nIN vec2 texCoord;\n#ifdef USE_LIGHTMAP\n    #ifndef VERTEX_COLORS\n        IN vec2 texCoord1;\n    #else\n        #ifndef VCOL_LIGHTMAP\n            IN vec2 texCoord1;\n        #endif\n    #endif\n#endif\nIN vec4 FragPos;\nIN mat3 TBN;\nIN vec3 norm;\nIN vec3 normM;\n#ifdef VERTEX_COLORS\n    IN vec4 vertCol;\n#endif\n#ifdef USE_HEIGHT_TEX\n    #ifdef USE_OPTIMIZED_HEIGHT\n        IN vec3 fragTangentViewDir;\n    #else\n        IN mat3 invTBN;\n    #endif\n#endif\n\n// structs\nstruct Light {\n    vec3 color;\n    vec3 position;\n    vec3 specular;\n\n    #define INTENSITY x\n    #define ATTENUATION y\n    #define FALLOFF z\n    #define RADIUS w\n    vec4 lightProperties;\n\n    int castLight;\n\n    vec3 conePointAt;\n    #define COSCONEANGLE x\n    #define COSCONEANGLEINNER y\n    #define SPOTEXPONENT z\n    vec3 spotProperties;\n};\n\n\n#ifdef WEBGL1\n    #ifdef GL_EXT_shader_texture_lod\n        #define textureLod textureCubeLodEXT\n    #endif\n#endif\n#define SAMPLETEX textureLod\n\n// https://community.khronos.org/t/addition-of-two-hdr-rgbe-values/55669\nhighp vec4 EncodeRGBE8(highp vec3 rgb)\n{\n    highp vec4 vEncoded;\n    float maxComponent = max(max(rgb.r, rgb.g), rgb.b);\n    float fExp = ceil(log2(maxComponent));\n    vEncoded.rgb = rgb / exp2(fExp);\n    vEncoded.a = (fExp + 128.0) / 255.0;\n    return vEncoded;\n}\n// https://enkimute.github.io/hdrpng.js/\nhighp vec3 DecodeRGBE8(highp vec4 rgbe)\n{\n    highp vec3 vDecoded = rgbe.rgb * pow(2.0, rgbe.a * 255.0-128.0);\n    return vDecoded;\n}\n\n// from https://github.com/BabylonJS/Babylon.js/blob/master/src/Shaders/ShadersInclude/pbrIBLFunctions.fx\nfloat environmentRadianceOcclusion(float ambientOcclusion, float NdotVUnclamped) {\n    // Best balanced (implementation time vs result vs perf) analytical environment specular occlusion found.\n    // http://research.tri-ace.com/Data/cedec2011_RealtimePBR_Implementation_e.pptx\n    float temp = NdotVUnclamped + ambientOcclusion;\n    return clamp(temp * temp - 1.0 + ambientOcclusion, 0.0, 1.0);\n}\nfloat environmentHorizonOcclusion(vec3 view, vec3 normal, vec3 geometricNormal) {\n    // http://marmosetco.tumblr.com/post/81245981087\n    vec3 reflection = reflect(view, normal);\n    float temp = clamp(1.0 + 1.1 * dot(reflection, geometricNormal), 0.0, 1.0);\n    return temp * temp;\n}\n#ifdef ALPHA_DITHERED\n// from https://github.com/google/filament/blob/main/shaders/src/dithering.fs\n// modified to use this to discard based on factor instead of dithering\nfloat interleavedGradientNoise(highp vec2 n) {\n    return fract(52.982919 * fract(dot(vec2(0.06711, 0.00584), n)));\n}\nfloat Dither_InterleavedGradientNoise(float a) {\n    // Jimenez 2014, "Next Generation Post-Processing in Call of Duty"\n    highp vec2 uv = gl_FragCoord.xy;\n\n    // The noise variable must be highp to workaround Adreno bug #1096.\n    highp float noise = interleavedGradientNoise(uv);\n\n    return step(noise, a);\n}\n#endif\n\n#ifdef USE_HEIGHT_TEX\n#ifndef WEBGL1\n// based on Jasper Flicks great tutorials (:\nfloat getSurfaceHeight(sampler2D surfaceHeightMap, vec2 UV)\n{\n\treturn texture2D(surfaceHeightMap, UV).r;\n}\n\nvec2 RaymarchedParallax(vec2 UV, sampler2D surfaceHeightMap, float strength, vec3 viewDir)\n{\n    #ifndef USE_OPTIMIZED_HEIGHT\n\t#define PARALLAX_RAYMARCHING_STEPS 50\n    #else\n    #define PARALLAX_RAYMARCHING_STEPS 20\n    #endif\n\tvec2 uvOffset = vec2(0.0);\n\tfloat stepSize = 1.0 / float(PARALLAX_RAYMARCHING_STEPS);\n\tvec2 uvDelta = vec2(viewDir * (stepSize * strength));\n\tfloat stepHeight = 1.0;\n\tfloat surfaceHeight = getSurfaceHeight(surfaceHeightMap, UV);\n\n\tvec2 prevUVOffset = uvOffset;\n\tfloat prevStepHeight = stepHeight;\n\tfloat prevSurfaceHeight = surfaceHeight;\n\n    // doesnt work with webgl 1.0 as the && condition is not fixed length for loop\n\tfor (int i = 1; i < PARALLAX_RAYMARCHING_STEPS && stepHeight > surfaceHeight; ++i)\n\t{\n\t\tprevUVOffset = uvOffset;\n\t\tprevStepHeight = stepHeight;\n\t\tprevSurfaceHeight = surfaceHeight;\n\n\t\tuvOffset -= uvDelta;\n\t\tstepHeight -= stepSize;\n\t\tsurfaceHeight = getSurfaceHeight(surfaceHeightMap, UV + uvOffset);\n\t}\n\n\tfloat prevDifference = prevStepHeight - prevSurfaceHeight;\n\tfloat difference = surfaceHeight - stepHeight;\n\tfloat t = prevDifference / (prevDifference + difference);\n\tuvOffset = mix(prevUVOffset, uvOffset, t);\n\treturn uvOffset;\n}\n#endif // TODO: use non raymarched parallax mapping here if webgl 1.0?\n#endif\n\n#ifdef USE_PARALLAX_CORRECTION\nvec3 BoxProjection(vec3 direction, vec3 position, vec3 cubemapPosition, vec3 boxMin, vec3 boxMax)\n{\n\tboxMin -= position;\n\tboxMax -= position;\n\tfloat x = (direction.x > 0.0 ? boxMax.x : boxMin.x) / direction.x;\n\tfloat y = (direction.y > 0.0 ? boxMax.y : boxMin.y) / direction.y;\n\tfloat z = (direction.z > 0.0 ? boxMax.z : boxMin.z) / direction.z;\n\tfloat scalar = min(min(x, y), z);\n\n\treturn direction * scalar + (position - cubemapPosition);\n}\n#endif\n\n{{PBR_FRAGMENT_HEAD}}\nvoid main()\n{\n    vec4 col;\n\n    // set up interpolated vertex data\n    vec2 UV0             = texCoord;\n    #ifdef USE_LIGHTMAP\n        #ifndef VERTEX_COLORS\n            vec2 UV1             = texCoord1;\n        #else\n            #ifndef VCOL_LIGHTMAP\n                vec2 UV1             = texCoord1;\n            #endif\n        #endif\n    #endif\n    vec3 V               = normalize(camPos - FragPos.xyz);\n\n    #ifdef USE_HEIGHT_TEX\n        #ifndef USE_OPTIMIZED_HEIGHT\n            vec3 fragTangentViewDir = normalize(invTBN * (camPos - FragPos.xyz));\n        #endif\n        #ifndef WEBGL1\n            UV0 += RaymarchedParallax(UV0, _HeightMap, _HeightDepth * 0.1, fragTangentViewDir);\n        #endif\n    #endif\n\n    // load relevant mesh maps\n    #ifdef USE_ALBEDO_TEX\n        vec4 AlbedoMap   = texture2D(_AlbedoMap, UV0);\n    #else\n        vec4 AlbedoMap   = _Albedo;\n    #endif\n    #ifdef ALPHA_MASKED\n\tif ( AlbedoMap.a <= 0.5 )\n\t    discard;\n\t#endif\n\n\t#ifdef ALPHA_DITHERED\n\tif ( Dither_InterleavedGradientNoise(AlbedoMap.a) <= 0.5 )\n\t    discard;\n\t#endif\n\n    #ifdef USE_AORM_TEX\n        vec4 AORM        = texture2D(_AORMMap, UV0);\n    #else\n        vec4 AORM        = vec4(1.0, _Roughness, _Metalness, 1.0);\n    #endif\n    #ifdef USE_NORMAL_TEX\n        vec3 internalNormals = texture2D(_NormalMap, UV0).rgb;\n        internalNormals      = internalNormals * 2.0 - 1.0;\n        internalNormals      = normalize(TBN * internalNormals);\n    #else\n        vec3 internalNormals = normM;\n    #endif\n\t#ifdef USE_LIGHTMAP\n    \t#ifndef VERTEX_COLORS\n\t        #ifndef LIGHTMAP_IS_RGBE\n                vec3 Lightmap = texture2D(_Lightmap, UV1).rgb;\n            #else\n                vec3 Lightmap = DecodeRGBE8(texture2D(_Lightmap, UV1));\n            #endif\n        #else\n            #ifdef VCOL_LIGHTMAP\n                vec3 Lightmap = pow(vertCol.rgb, vec3(2.2));\n            #else\n  \t            #ifndef LIGHTMAP_IS_RGBE\n                    vec3 Lightmap = texture2D(_Lightmap, UV1).rgb;\n                #else\n                    vec3 Lightmap = DecodeRGBE8(texture2D(_Lightmap, UV1));\n                #endif\n            #endif\n        #endif\n    #endif\n    // initialize texture values\n    float AO             = AORM.r;\n    float specK          = AORM.g;\n    float metalness      = AORM.b;\n    vec3  N              = normalize(internalNormals);\n    vec3  albedo         = pow(AlbedoMap.rgb, vec3(2.2));\n\n    #ifdef VERTEX_COLORS\n        #ifdef VCOL_COLOUR\n            albedo.rgb *= pow(vertCol.rgb, vec3(2.2));\n            AlbedoMap.rgb *= pow(vertCol.rgb, vec3(2.2));\n        #endif\n        #ifdef VCOL_AORM\n            AO = vertCol.r;\n            specK = vertCol.g;\n            metalness = vertCol.b;\n        #endif\n        #ifdef VCOL_AO\n            AO = vertCol.r;\n        #endif\n        #ifdef VCOL_R\n            specK = vertCol.g;\n        #endif\n        #ifdef VCOL_M\n            metalness = vertCol.b;\n        #endif\n    #endif\n\n    // set up values for later calculations\n    float NdotV          = abs(dot(N, V));\n    vec3  F0             = mix(vec3(0.04), AlbedoMap.rgb, metalness);\n\n    #ifndef WEBGL1\n        #ifndef DONT_USE_GR\n            // from https://github.com/BabylonJS/Babylon.js/blob/5e6321d887637877d8b28b417410abbbeb651c6e/src/Shaders/ShadersInclude/pbrHelperFunctions.fx\n            // modified to fit variable names\n            #ifndef DONT_USE_NMGR\n                vec3 nDfdx = dFdx(normM.xyz);\n                vec3 nDfdy = dFdy(normM.xyz);\n            #else\n                vec3 nDfdx = dFdx(N.xyz) + dFdx(normM.xyz);\n                vec3 nDfdy = dFdy(N.xyz) + dFdy(normM.xyz);\n            #endif\n            float slopeSquare = max(dot(nDfdx, nDfdx), dot(nDfdy, nDfdy));\n\n            // Vive analytical lights roughness factor.\n            float geometricRoughnessFactor = pow(clamp(slopeSquare, 0.0, 1.0), 0.333);\n\n            specK = max(specK, geometricRoughnessFactor);\n            #endif\n        #endif\n\n    \t// IBL\n    \t// from https://github.com/google/filament/blob/df6a100fcba66d9c99328a49d41fe3adecc0165d/shaders/src/light_indirect.fs\n    \t// and https://github.com/google/filament/blob/df6a100fcba66d9c99328a49d41fe3adecc0165d/shaders/src/shading_lit.fs\n    \t// modified to fit structure/variable names\n    \t#ifdef USE_ENVIRONMENT_LIGHTING\n        \tvec2 envBRDF = texture(IBL_BRDF_LUT, vec2(NdotV, specK)).xy;\n        \tvec3 E = mix(envBRDF.xxx, envBRDF.yyy, F0);\n        #endif\n\n        float specOcclusion    = environmentRadianceOcclusion(AO, NdotV);\n        float horizonOcclusion = environmentHorizonOcclusion(-V, N, normM);\n\n        #ifdef USE_ENVIRONMENT_LIGHTING\n            float envSampleSpecK = specK * MAX_REFLECTION_LOD;\n            vec3  R = reflect(-V, N);\n\n            #ifdef USE_PARALLAX_CORRECTION\n                R = BoxProjection(R, FragPos.xyz, _PCOrigin, _PCboxMin, _PCboxMax);\n            #endif\n\n    \t    vec3 prefilteredEnvColour = DecodeRGBE8(SAMPLETEX(_prefilteredEnvironmentColour, R, envSampleSpecK)) * specularIntensity;\n\n        \tvec3 Fr = E * prefilteredEnvColour;\n        \tFr *= specOcclusion * horizonOcclusion * (1.0 + F0 * (1.0 / envBRDF.y - 1.0));\n        \tFr *= 1.0 + F0; // TODO: this might be wrong, figure this out\n\n        \t#ifdef USE_LIGHTMAP\n                vec3 IBLIrradiance = Lightmap * lightmapIntensity;\n            #else\n                vec3 IBLIrradiance = DecodeRGBE8(SAMPLETEX(_irradiance, N, 0.0)) * diffuseIntensity;\n        #endif\n\t    vec3 Fd = (1.0 - metalness) * albedo * IBLIrradiance * (1.0 - E) * AO;\n    #endif\n    vec3 directLighting = vec3(0.0);\n\n    {{PBR_FRAGMENT_BODY}}\n\n    // combine IBL\n    col.rgb = directLighting;\n    #ifdef USE_ENVIRONMENT_LIGHTING\n        col.rgb += Fr + Fd;\n        #ifdef USE_CLEAR_COAT\n            float CCEnvSampleSpecK = _ClearCoatRoughness * MAX_REFLECTION_LOD;\n            vec3  CCR = reflect(-V, normM);\n\n            #ifdef USE_PARALLAX_CORRECTION\n                CCR = BoxProjection(CCR, FragPos.xyz, _PCOrigin, _PCboxMin, _PCboxMax);\n            #endif\n\n        \tvec3 CCPrefilteredEnvColour = DecodeRGBE8(SAMPLETEX(_prefilteredEnvironmentColour, CCR, CCEnvSampleSpecK));\n        \tvec3 CCFr = E * CCPrefilteredEnvColour;\n        \tCCFr *= specOcclusion * horizonOcclusion * (0.96 + (0.04 / envBRDF.y));\n        \tCCFr *= 1.04;\n        \tcol.rgb += CCFr;\n        #endif\n    #else\n        #ifdef USE_LIGHTMAP\n            col.rgb += (1.0 - metalness) * albedo * Lightmap * lightmapIntensity;\n        #endif\n    #endif\n    col.a   = 1.0;\n\n    #ifdef ALPHA_BLEND\n        col.a = AlbedoMap.a;\n    #endif\n\n    // from https://github.com/BabylonJS/Babylon.js/blob/5e6321d887637877d8b28b417410abbbeb651c6e/src/Shaders/tonemap.fragment.fx\n    // modified to fit variable names\n    #ifdef TONEMAP_HejiDawson\n        col.rgb *= tonemappingExposure;\n\n        vec3 X = max(vec3(0.0, 0.0, 0.0), col.rgb - 0.004);\n        vec3 retColor = (X * (6.2 * X + 0.5)) / (X * (6.2 * X + 1.7) + 0.06);\n\n        col.rgb = retColor * retColor;\n    #elif defined(TONEMAP_Photographic)\n        col.rgb =  vec3(1.0, 1.0, 1.0) - exp2(-tonemappingExposure * col.rgb);\n    #else\n        col.rgb *= tonemappingExposure;\n        //col.rgb = clamp(col.rgb, vec3(0.0), vec3(1.0));\n    #endif\n\n    col.rgb = pow(col.rgb, vec3(1.0/2.2));\n    {{MODULE_COLOR}}\n    outColor = col;\n}\n',BasicPBR_vert:"precision highp float;\nprecision highp int;\n\nUNI vec3 camPos;\n\nIN vec3  vPosition;\nIN vec2  attrTexCoord;\n#ifdef USE_LIGHTMAP\nIN vec2 attrTexCoord1;\n#endif\nIN vec3  attrVertNormal;\nIN vec3  attrTangent;\nIN vec3  attrBiTangent;\nIN float attrVertIndex;\n#ifdef VERTEX_COLORS\nIN vec4 attrVertColor;\n#endif\n\n{{MODULES_HEAD}}\n\nOUT vec2 texCoord;\n#ifdef USE_LIGHTMAP\nOUT vec2 texCoord1;\n#endif\nOUT vec4 FragPos;\nOUT mat3 TBN;\nOUT vec3 norm;\nOUT vec3 normM;\n#ifdef VERTEX_COLORS\nOUT vec4 vertCol;\n#endif\n#ifdef USE_HEIGHT_TEX\n#ifdef USE_OPTIMIZED_HEIGHT\nOUT vec3 fragTangentViewDir;\n#else\nOUT mat3 invTBN;\n#endif\n#endif\nUNI mat4 projMatrix;\nUNI mat4 viewMatrix;\nUNI mat4 modelMatrix;\n\nvoid main()\n{\n    mat4 mMatrix = modelMatrix; // needed to make vertex effects work\n    #ifdef USE_LIGHTMAP\n    texCoord1 = attrTexCoord1;\n    #endif\n    texCoord = attrTexCoord;\n    texCoord.y = 1.0 - texCoord.y;\n    vec4 pos = vec4(vPosition,  1.0);\n    norm = attrVertNormal;\n    vec3 tangent = attrTangent;\n    vec3 bitangent = attrBiTangent;\n\n    {{MODULE_VERTEX_POSITION}}\n\n    #ifndef INSTANCING\n    FragPos = mMatrix * pos;\n    #else\n    FragPos = instMat * pos;\n    #endif\n\n    #ifndef INSTANCING\n        tangent = normalize(vec3(mMatrix * vec4(tangent,    0.0)));\n        vec3 N = normalize(vec3(mMatrix * vec4(norm, 0.0)));\n    #else\n        tangent = normalize(vec3(instMat * vec4(tangent,    0.0)));\n        vec3 N = normalize(vec3(instMat * vec4(norm, 0.0)));\n    #endif\n\n    #ifndef INSTANCING\n        bitangent = normalize(vec3(mMatrix * vec4(bitangent,  0.0)));\n    #else\n        bitangent = normalize(vec3(instMat * vec4(bitangent,  0.0)));\n    #endif\n\n    #ifdef VERTEX_COLORS\n        vertCol = attrVertColor;\n    #endif\n\n    TBN = mat3(tangent, bitangent, N);\n\n    #ifdef USE_HEIGHT_TEX\n    #ifndef WEBGL1\n    #ifdef USE_OPTIMIZED_HEIGHT\n    fragTangentViewDir = normalize(transpose(TBN) * (camPos - FragPos.xyz));\n    #else\n    invTBN = transpose(TBN);\n    #endif\n    #endif\n    #endif\n\n    normM = N;\n    gl_Position = projMatrix * (viewMatrix*mMatrix) * pos;\n}\n",light_body_directional_frag:"\nvec3 L{{LIGHT_INDEX}} = normalize(lightOP{{LIGHT_INDEX}}.position);\n#ifdef USE_ENVIRONMENT_LIGHTING\ndirectLighting += evaluateLighting(lightOP{{LIGHT_INDEX}}, L{{LIGHT_INDEX}}, FragPos, V, N, albedo, specK, NdotV, F0, envBRDF.y, AO, false);\n#else\ndirectLighting += evaluateLighting(lightOP{{LIGHT_INDEX}}, L{{LIGHT_INDEX}}, FragPos, V, N, albedo, specK, NdotV, F0, AO, false);\n#endif\n",light_body_point_frag:"\nvec3 L{{LIGHT_INDEX}} = normalize(lightOP{{LIGHT_INDEX}}.position - FragPos.xyz);\n#ifdef USE_ENVIRONMENT_LIGHTING\ndirectLighting += evaluateLighting(lightOP{{LIGHT_INDEX}}, L{{LIGHT_INDEX}}, FragPos, V, N, albedo, specK, NdotV, F0, envBRDF.y, AO, true);\n#else\ndirectLighting += evaluateLighting(lightOP{{LIGHT_INDEX}}, L{{LIGHT_INDEX}}, FragPos, V, N, albedo, specK, NdotV, F0, AO, true);\n#endif\n",light_body_spot_frag:"\nvec3 L{{LIGHT_INDEX}} = normalize(lightOP{{LIGHT_INDEX}}.position - FragPos.xyz);\nfloat spotIntensity{{LIGHT_INDEX}} = CalculateSpotLightEffect(\n    lightOP{{LIGHT_INDEX}}.position, lightOP{{LIGHT_INDEX}}.conePointAt, lightOP{{LIGHT_INDEX}}.spotProperties.COSCONEANGLE,\n    lightOP{{LIGHT_INDEX}}.spotProperties.COSCONEANGLEINNER, lightOP{{LIGHT_INDEX}}.spotProperties.SPOTEXPONENT,\n    L{{LIGHT_INDEX}}\n);\n#ifdef USE_ENVIRONMENT_LIGHTING\ndirectLighting += evaluateLighting(lightOP{{LIGHT_INDEX}}, L{{LIGHT_INDEX}}, FragPos, V, N, albedo, specK, NdotV, F0, envBRDF.y, AO * spotIntensity{{LIGHT_INDEX}}, true);\n#else\ndirectLighting += evaluateLighting(lightOP{{LIGHT_INDEX}}, L{{LIGHT_INDEX}}, FragPos, V, N, albedo, specK, NdotV, F0, AO * spotIntensity{{LIGHT_INDEX}}, true);\n#endif\n",light_head_frag:"UNI Light lightOP{{LIGHT_INDEX}};\n",light_includes_frag:'\n#define PI 3.14159265359\n\n// from https://github.com/google/filament/blob/036bfa9b20d730bb8e5852ed449b024570167648/shaders/src/brdf.fs\n// modified to fit variable names / structure\nfloat F_Schlick(float f0, float f90, float VoH)\n{\n    return f0 + (f90 - f0) * pow(1.0 - VoH, 5.0);\n}\nvec3 F_Schlick(const vec3 f0, float VoH)\n{\n    float f = pow(1.0 - VoH, 5.0);\n    return f + f0 * (1.0 - f);\n}\nfloat Fd_Burley(float roughness, float NoV, float NoL, float LoH)\n{\n    // Burley 2012, "Physically-Based Shading at Disney"\n    float f90 = 0.5 + 2.0 * roughness * LoH * LoH;\n    float lightScatter = F_Schlick(1.0, f90, NoL);\n    float viewScatter  = F_Schlick(1.0, f90, NoV);\n    return lightScatter * viewScatter * (1.0 / PI);\n}\nfloat D_GGX(float roughness, float NoH, const vec3 h)\n{\n    float oneMinusNoHSquared = 1.0 - NoH * NoH;\n\n    float a = NoH * roughness;\n    float k = roughness / (oneMinusNoHSquared + a * a);\n    float d = k * k * (1.0 / PI);\n    return clamp(d, 0.0, 1.0);\n}\nfloat V_SmithGGXCorrelated(float roughness, float NoV, float NoL)\n{\n    // Heitz 2014, "Understanding the Masking-Shadowing Function in Microfacet-Based BRDFs"\n    float a2 = roughness * roughness;\n    // TODO: lambdaV can be pre-computed for all the lights, it should be moved out of this function\n    float lambdaV = NoL * sqrt((NoV - a2 * NoV) * NoV + a2);\n    float lambdaL = NoV * sqrt((NoL - a2 * NoL) * NoL + a2);\n    float v = 0.5 / (lambdaV + lambdaL);\n    // a2=0 => v = 1 / 4*NoL*NoV   => min=1/4, max=+inf\n    // a2=1 => v = 1 / 2*(NoL+NoV) => min=1/4, max=+inf\n    // clamp to the maximum value representable in mediump\n    return clamp(v, 0.0, 1.0);\n}\n// from https://github.com/google/filament/blob/73e339b05d67749e3b1d1d243650441162c10f8a/shaders/src/light_punctual.fs\n// modified to fit variable names\nfloat getSquareFalloffAttenuation(float distanceSquare, float falloff)\n{\n    float factor = distanceSquare * falloff;\n    float smoothFactor = clamp(1.0 - factor * factor, 0.0, 1.0);\n    // We would normally divide by the square distance here\n    // but we do it at the call site\n    return smoothFactor * smoothFactor;\n}\n\nfloat getDistanceAttenuation(vec3 posToLight, float falloff, vec3 V, float volume)\n{\n    float distanceSquare = dot(posToLight, posToLight);\n    float attenuation = getSquareFalloffAttenuation(distanceSquare, falloff);\n    // light far attenuation\n    float d = dot(V, V);\n    float f = 100.0; // CONFIG_Z_LIGHT_FAR, ttps://github.com/google/filament/blob/df6a100fcba66d9c99328a49d41fe3adecc0165d/filament/src/details/Engine.h\n    vec2 lightFarAttenuationParams = 0.5 * vec2(10.0, 10.0 / (f * f));\n    attenuation *= clamp(lightFarAttenuationParams.x - d * lightFarAttenuationParams.y, 0.0, 1.0);\n    // Assume a punctual light occupies a min volume of 1cm to avoid a division by 0\n    return attenuation / max(distanceSquare, max(1e-4, volume));\n}\n\n#ifdef USE_CLEAR_COAT\n// from https://github.com/google/filament/blob/73e339b05d67749e3b1d1d243650441162c10f8a/shaders/src/shading_model_standard.fs\n// modified to fit variable names / structure\nfloat clearCoatLobe(vec3 shading_clearCoatNormal, vec3 h, float LoH, float CCSpecK)\n{\n    float clearCoatNoH = clamp(dot(shading_clearCoatNormal, h), 0.0, 1.0);\n\n    // clear coat specular lobe\n    float D = D_GGX(CCSpecK, clearCoatNoH, h);\n    // from https://github.com/google/filament/blob/036bfa9b20d730bb8e5852ed449b024570167648/shaders/src/brdf.fs\n    float V = clamp(0.25 / (LoH * LoH), 0.0, 1.0);\n    float F = F_Schlick(0.04, 1.0, LoH); // fix IOR to 1.5\n\n    return D * V * F;\n}\n#endif\n\n#ifdef USE_ENVIRONMENT_LIGHTING\nvec3 evaluateLighting(Light light, vec3 L, vec4 FragPos, vec3 V, vec3 N, vec3 albedo, float specK, float NdotV, vec3 F0, float envBRDFY, float AO, bool hasFalloff)\n#else\nvec3 evaluateLighting(Light light, vec3 L, vec4 FragPos, vec3 V, vec3 N, vec3 albedo, float specK, float NdotV, vec3 F0, float AO, bool hasFalloff)\n#endif\n{\n    vec3 directLightingResult = vec3(0.0);\n    if (light.castLight == 1)\n    {\n        specK = max(0.08, specK);\n        // from https://github.com/google/filament/blob/73e339b05d67749e3b1d1d243650441162c10f8a/shaders/src/shading_model_standard.fs\n        // modified to fit variable names / structure\n        vec3 H = normalize(V + L);\n\n        float NdotL = clamp(dot(N, L), 0.0, 1.0);\n        float NdotH = clamp(dot(N, H), 0.0, 1.0);\n        float LdotH = clamp(dot(L, H), 0.0, 1.0);\n\n        vec3 Fd = albedo * Fd_Burley(specK, NdotV, NdotL, LdotH);\n\n        float D  = D_GGX(specK, NdotH, H);\n        float V2 = V_SmithGGXCorrelated(specK, NdotV, NdotL);\n        vec3  F  = F_Schlick(F0, LdotH);\n\n        // TODO: modify this with the radius\n        vec3 Fr = (D * V2) * F;\n\n        #ifdef USE_ENVIRONMENT_LIGHTING\n        vec3 directLighting = Fd + Fr * (1.0 + F0 * (1.0 / envBRDFY - 1.0));\n        #else\n        vec3 directLighting = Fd + Fr;\n        #endif\n\n        float attenuation = getDistanceAttenuation(L, hasFalloff ? light.lightProperties.FALLOFF : 0.0, V, light.lightProperties.RADIUS);\n\n        directLightingResult = (directLighting * light.color) *\n                          (light.lightProperties.INTENSITY * attenuation * NdotL * AO);\n\n        #ifdef USE_CLEAR_COAT\n        directLightingResult += clearCoatLobe(normM, H, LdotH, _ClearCoatRoughness);\n        #endif\n    }\n    return directLightingResult;\n}\n\n// from phong OP to make sure the light parameters change lighting similar to what people are used to\nfloat CalculateSpotLightEffect(vec3 lightPosition, vec3 conePointAt, float cosConeAngle, float cosConeAngleInner, float spotExponent, vec3 lightDirection) {\n    vec3 spotLightDirection = normalize(lightPosition-conePointAt);\n    float spotAngle = dot(-lightDirection, spotLightDirection);\n    float epsilon = cosConeAngle - cosConeAngleInner;\n\n    float spotIntensity = clamp((spotAngle - cosConeAngle)/epsilon, 0.0, 1.0);\n    spotIntensity = pow(spotIntensity, max(0.01, spotExponent));\n\n    return max(0., spotIntensity);\n}\n'};const n=t.patch.cgl;const e=t.inTrigger("render");e.onTriggered=Ie;const a=t.inFloat("R",Math.random());const r=t.inFloat("G",Math.random());const i=t.inFloat("B",Math.random());const o=t.inFloatSlider("A",1);const l=[a,r,i,o];t.setPortGroup("Diffuse Color",l);const u=t.inFloatSlider("Roughness",.5);const m=t.inFloatSlider("Metalness",0);const c=t.inSwitch("Alpha Mode",["Opaque","Masked","Dithered","Blend"],"Blend");const g=t.inSwitch("Tonemapping",["sRGB","HejiDawson","Photographic"],"sRGB");const p=t.inFloat("Exposure",1);const d=t.inBool("Disable geometric roughness",false);const f=t.inBool("Use roughness from normal map",false);const h=t.inValueBool("Use Vertex Colours",false);const b=t.inSwitch("Vertex Colour Mode",["colour","AORM","AO","R","M","lightmap"],"colour");const v=t.inFloat("Height Intensity",1);const O=t.inValueBool("Faster heightmapping",false);const T=t.inValueBool("Use Clear Coat",false);const I=t.inFloatSlider("Clear Coat Roughness",.5);const _=t.inTexture("IBL LUT");const x=t.inTexture("Diffuse Irradiance");const E=t.inTexture("Pre-filtered envmap");const S=t.inInt("Num mip levels");const A=t.inTexture("Albedo");const C=t.inTexture("AORM");const L=t.inTexture("Normal map");const N=t.inTexture("Height");const P=t.inTexture("Lightmap");const M=t.inFloat("Diffuse Intensity",1);const y=t.inFloat("Specular Intensity",1);const j=t.inBool("Lightmap is RGBE",false);const G=t.inFloat("Lightmap Intensity",1);const R=t.outTrigger("Next");const w=t.outObject("Shader");w.ignoreValueSerialize=true;t.toWorkPortsNeedToBeLinked(e);a.setUiAttribs({colorPick:true});t.setPortGroup("Shader Parameters",[u,m,c]);t.setPortGroup("Advanced Shader Parameters",[d,f,h,b,v,O,T,I]);t.setPortGroup("Textures",[A,C,L,N,P]);t.setPortGroup("Lighting",[M,y,G,j,_,x,E,S]);t.setPortGroup("Tonemapping",[g,p]);const U=new CGL.Shader(n,"PBRShader");U.setModules(["MODULE_VERTEX_POSITION","MODULE_COLOR","MODULE_BEGIN_FRAG"]);let B=[];const D=[];const k=new RegExp("{{LIGHT_INDEX}}","g");const V=new RegExp("{{PBR_FRAGMENT_HEAD}}","g");const F=new RegExp("{{PBR_FRAGMENT_BODY}}","g");const z=s.light_head_frag;const X={point:s.light_body_point_frag,directional:s.light_body_directional_frag,spot:s.light_body_spot_frag};const H=e=>z.replace("{{LIGHT_INDEX}}",e);const Y=(e,t)=>X[t].replace(k,e);let W=-1;if(n.glVersion==1){if(!n.gl.getExtension("EXT_shader_texture_lod")){t.log("no EXT_shader_texture_lod texture extension");throw"no EXT_shader_texture_lod texture extension"}else{U.enableExtension("GL_EXT_shader_texture_lod");n.gl.getExtension("OES_texture_float");n.gl.getExtension("OES_texture_float_linear");n.gl.getExtension("OES_texture_half_float");n.gl.getExtension("OES_texture_half_float_linear");U.enableExtension("GL_OES_standard_derivatives");U.enableExtension("GL_OES_texture_float");U.enableExtension("GL_OES_texture_float_linear");U.enableExtension("GL_OES_texture_half_float");U.enableExtension("GL_OES_texture_half_float_linear")}}Oe();const Z=new CGL.Uniform(U,"t","_AlbedoMap",0);const J=new CGL.Uniform(U,"t","_AORMMap",0);const K=new CGL.Uniform(U,"t","_NormalMap",0);const q=new CGL.Uniform(U,"t","IBL_BRDF_LUT",0);const Q=new CGL.Uniform(U,"tc","_irradiance",1);const $=new CGL.Uniform(U,"tc","_prefilteredEnvironmentColour",1);const ee=new CGL.Uniform(U,"f","MAX_REFLECTION_LOD",0);const te=new CGL.Uniform(U,"f","tonemappingExposure",p);const ne=new CGL.Uniform(U,"f","diffuseIntensity",M);const ae=new CGL.Uniform(U,"f","specularIntensity",y);const re=new CGL.Uniform(U,"t","_HeightMap",0);const ie=new CGL.Uniform(U,"t","_Lightmap",0);const oe=new CGL.Uniform(U,"f","lightmapIntensity",G);const se=new CGL.Uniform(U,"4f","_Albedo",a,r,i,o);const le=new CGL.Uniform(U,"f","_Roughness",u);const ue=new CGL.Uniform(U,"f","_Metalness",m);const me=new CGL.Uniform(U,"f","_HeightDepth",v);const ce=new CGL.Uniform(U,"f","_ClearCoatRoughness",I);const ge=new CGL.Uniform(U,"3f","_PCOrigin",[0,0,0]);const pe=new CGL.Uniform(U,"3f","_PCboxMin",[-1,-1,-1]);const de=new CGL.Uniform(U,"3f","_PCboxMax",[1,1,1]);U.uniformColorDiffuse=se;U.uniformPbrMetalness=ue;U.uniformPbrRoughness=le;E.onChange=be;C.onChange=j.onChange=T.onChange=A.onChange=L.onChange=N.onChange=c.onChange=f.onChange=g.onChange=P.onChange=O.onChange=h.onChange=d.onChange=b.onChange=fe;function fe(){U.toggleDefine("USE_OPTIMIZED_HEIGHT",O.get());U.toggleDefine("USE_CLEAR_COAT",T.get());U.toggleDefine("LIGHTMAP_IS_RGBE",j.get());U.toggleDefine("USE_LIGHTMAP",P.isLinked()||b.get()==="lightmap");U.toggleDefine("USE_NORMAL_TEX",L.isLinked());U.toggleDefine("USE_HEIGHT_TEX",N.isLinked());U.toggleDefine("DONT_USE_NMGR",f.get());U.toggleDefine("DONT_USE_GR",d.get());U.toggleDefine("VCOL_COLOUR",b.get()==="colour");U.toggleDefine("VCOL_AORM",b.get()==="AORM");U.toggleDefine("VCOL_AO",b.get()==="AO");U.toggleDefine("VCOL_R",b.get()==="R");U.toggleDefine("VCOL_M",b.get()==="M");U.toggleDefine("VCOL_LIGHTMAP",b.get()==="lightmap");U.toggleDefine("USE_ALBEDO_TEX",A.get());a.setUiAttribs({greyout:A.get()});r.setUiAttribs({greyout:A.get()});i.setUiAttribs({greyout:A.get()});o.setUiAttribs({greyout:A.get()});U.toggleDefine("USE_AORM_TEX",C.get());u.setUiAttribs({greyout:C.get()});m.setUiAttribs({greyout:C.get()});U.toggleDefine("VERTEX_COLORS",h.get());if(!h.get()){U.toggleDefine("USE_LIGHTMAP",P.get())}else{if(b.get()==="lightmap"){U.define("USE_LIGHTMAP")}}U.toggleDefine("ALPHA_MASKED",c.get()==="Masked");U.toggleDefine("ALPHA_DITHERED",c.get()==="Dithered");U.toggleDefine("ALPHA_BLEND",c.get()==="Blend");U.toggleDefine("TONEMAP_sRGB",g.get()==="sRGB");U.toggleDefine("TONEMAP_HejiDawson",g.get()==="HejiDawson");U.toggleDefine("TONEMAP_Photographic",g.get()==="Photographic")}fe();function he(e){U.toggleDefine("USE_ENVIRONMENT_LIGHTING",e)}t.preRender=function(){U.bind();Ie()};function be(){S.setUiAttribs({greyout:!E.get()})}function ve(){for(let e=0;e<B.length;e+=1){const t=B[e];t.isUsed=true;D[e].position.setValue(t.position);D[e].color.setValue(t.color);D[e].specular.setValue(t.specular);D[e].lightProperties.setValue([t.intensity,t.attenuation,t.falloff,t.radius]);D[e].conePointAt.setValue(t.conePointAt);D[e].spotProperties.setValue([t.cosConeAngle,t.cosConeAngleInner,t.spotExponent]);D[e].castLight.setValue(t.castLight)}}function Oe(){const e=s.BasicPBR_vert;const t=s.light_includes_frag;let n=s.BasicPBR_frag;let a="";let r="";if(B.length>0){a=a.concat(t)}for(let e=0;e<B.length;e+=1){const i=B[e];const o=i.type;a=a.concat(H(e));r=r.concat(Y(e,i.type))}n=n.replace(V,a);n=n.replace(F,r);U.setSource(e,n);w.set(U);for(let e=0;e<B.length;e+=1){D[e]=null;if(!D[e]){D[e]={color:new CGL.Uniform(U,"3f","lightOP"+e+".color",[1,1,1]),position:new CGL.Uniform(U,"3f","lightOP"+e+".position",[0,11,0]),specular:new CGL.Uniform(U,"3f","lightOP"+e+".specular",[1,1,1]),lightProperties:new CGL.Uniform(U,"4f","lightOP"+e+".lightProperties",[1,1,1,1]),conePointAt:new CGL.Uniform(U,"3f","lightOP"+e+".conePointAt",vec3.create()),spotProperties:new CGL.Uniform(U,"3f","lightOP"+e+".spotProperties",[0,0,0,0]),castLight:new CGL.Uniform(U,"i","lightOP"+e+".castLight",1)}}}}function Te(){if(n.frameStore.lightStack&&W!==n.frameStore.lightStack.length){B=n.frameStore.lightStack;Oe();W=n.frameStore.lightStack.length}}function Ie(){n.pushShader(U);U.popTextures();if((!n.frameStore.pbrEnvStack||n.frameStore.pbrEnvStack.length==0)&&!P.isLinked()&&B.length==0)t.setUiError("noPbrEnv","No PBR lights found in branch, create a light to see something");else t.setUiError("noPbrEnv",null);if(n.frameStore.pbrEnvStack&&n.frameStore.pbrEnvStack.length>0&&n.frameStore.pbrEnvStack[n.frameStore.pbrEnvStack.length-1].texIBLLUT.tex&&n.frameStore.pbrEnvStack[n.frameStore.pbrEnvStack.length-1].texDiffIrr.tex&&n.frameStore.pbrEnvStack[n.frameStore.pbrEnvStack.length-1].texPreFiltered.tex){const e=n.frameStore.pbrEnvStack[n.frameStore.pbrEnvStack.length-1];U.pushTexture(q,e.texIBLLUT.tex);U.pushTexture(Q,e.texDiffIrr.tex,n.gl.TEXTURE_CUBE_MAP);U.pushTexture($,e.texPreFiltered.tex,n.gl.TEXTURE_CUBE_MAP);ee.setValue(e.texPreFilteredMipLevels||7);U.toggleDefine("USE_PARALLAX_CORRECTION",e.UseParallaxCorrection);if(e.UseParallaxCorrection){ge.setValue(e.PCOrigin);pe.setValue(e.PCboxMin);de.setValue(e.PCboxMax)}he(true)}else{he(false)}if(_.get()){he(true);U.pushTexture(q,_.get().tex);ee.setValue(S.get());if(x.get())U.pushTexture(Q,x.get().cubemap,n.gl.TEXTURE_CUBE_MAP);if(E.get())U.pushTexture($,E.get().cubemap,n.gl.TEXTURE_CUBE_MAP)}if(A.get())U.pushTexture(Z,A.get().tex);if(C.get())U.pushTexture(J,C.get().tex);if(L.get())U.pushTexture(K,L.get().tex);if(N.get())U.pushTexture(re,N.get().tex);if(P.get())U.pushTexture(ie,P.get().tex);Te();ve();R.trigger();n.popShader()}};Ops.Gl.Pbr.PbrMaterial.prototype=new CABLES.Op;CABLES.OPS["a5234947-f65a-41e2-a691-b81382903a71"]={f:Ops.Gl.Pbr.PbrMaterial,objName:"Ops.Gl.Pbr.PbrMaterial"};Ops.Gl.Pbr.PbrEnvironmentLight=function(){CABLES.Op.apply(this,arguments);const e=this;const t={IBLLUT_frag:"precision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\n#ifndef WEBGL1\n#define NUM_SAMPLES 1024u\n#else\n#define NUM_SAMPLES 1024\n#endif\n#define PI 3.14159265358\n\nIN vec3 P;\n{{MODULES_HEAD}}\n\n// from https://github.com/BabylonJS/Babylon.js/blob/5e6321d887637877d8b28b417410abbbeb651c6e/src/Shaders/ShadersInclude/hdrFilteringFunctions.fx\n// modified to use different syntax for a number of variables\n#if NUM_SAMPLES > 0\n    #ifndef WEBGL1\n        // https://learnopengl.com/PBR/IBL/Specular-IBL\n        // Hammersley\n        float radicalInverse_VdC(uint bits)\n        {\n            bits = (bits << 16u) | (bits >> 16u);\n            bits = ((bits & 0x55555555u) << 1u) | ((bits & 0xAAAAAAAAu) >> 1u);\n            bits = ((bits & 0x33333333u) << 2u) | ((bits & 0xCCCCCCCCu) >> 2u);\n            bits = ((bits & 0x0F0F0F0Fu) << 4u) | ((bits & 0xF0F0F0F0u) >> 4u);\n            bits = ((bits & 0x00FF00FFu) << 8u) | ((bits & 0xFF00FF00u) >> 8u);\n            return float(bits) * 2.3283064365386963e-10; // / 0x100000000\n        }\n\n        vec2 hammersley(uint i, uint N)\n        {\n            return vec2(float(i)/float(N), radicalInverse_VdC(i));\n        }\n    #else\n        float vanDerCorpus(int n, int base)\n        {\n            float invBase = 1.0 / float(base);\n            float denom   = 1.0;\n            float result  = 0.0;\n\n            for(int i = 0; i < 32; ++i)\n            {\n                if(n > 0)\n                {\n                    denom   = mod(float(n), 2.0);\n                    result += denom * invBase;\n                    invBase = invBase / 2.0;\n                    n       = int(float(n) / 2.0);\n                }\n            }\n\n            return result;\n        }\n\n        vec2 hammersley(int i, int N)\n        {\n            return vec2(float(i)/float(N), vanDerCorpus(i, 2));\n        }\n    #endif\n\n\t// from https://github.com/BabylonJS/Babylon.js/blob/5e6321d887637877d8b28b417410abbbeb651c6e/src/Shaders/ShadersInclude/importanceSampling.fx\n\tvec3 hemisphereImportanceSampleDggx(vec2 u, float a) {\n\t\t// pdf = D(a) * cosTheta\n\t\tfloat phi = 2. * PI * u.x;\n\n\t\t// NOTE: (aa-1) == (a-1)(a+1) produces better fp accuracy\n\t\tfloat cosTheta2 = (1. - u.y) / (1. + (a + 1.) * ((a - 1.) * u.y));\n\t\tfloat cosTheta = sqrt(cosTheta2);\n\t\tfloat sinTheta = sqrt(1. - cosTheta2);\n\n\t\treturn vec3(sinTheta * cos(phi), sinTheta * sin(phi), cosTheta);\n\t}\n\n\t// from https://google.github.io/filament/Filament.md.html#toc9.5\n\t// modified to use different syntax for a number of variables\n    const float NUM_SAMPLES_FLOAT = float(NUM_SAMPLES);\n    const float NUM_SAMPLES_FLOAT_INVERSED = 1. / NUM_SAMPLES_FLOAT;\n    const float NUM_SAMPLES_FLOAT_INVERSED4 = 4. / NUM_SAMPLES_FLOAT;\n\n    float Visibility(float NdotV, float NdotL, float alphaG)\n    {\n        // from https://github.com/BabylonJS/Babylon.js/blob/5e6321d887637877d8b28b417410abbbeb651c6e/src/Shaders/ShadersInclude/pbrBRDFFunctions.fx\n        #ifdef WEBGL1\n            // Appply simplification as all squared root terms are below 1 and squared\n            float GGXV = NdotL * (NdotV * (1.0 - alphaG) + alphaG);\n            float GGXL = NdotV * (NdotL * (1.0 - alphaG) + alphaG);\n            return 0.5 / (GGXV + GGXL);\n        #else\n            float a2 = alphaG * alphaG;\n            float GGXV = NdotL * sqrt(NdotV * (NdotV - a2 * NdotV) + a2);\n            float GGXL = NdotV * sqrt(NdotL * (NdotL - a2 * NdotL) + a2);\n            return 0.5 / (GGXV + GGXL);\n        #endif\n    }\n\n\tvoid main()\n\t{\n\t    // actual implementation (not documentation) here: https://github.com/google/filament/blob/94ff2ea6b1e39d909e9066459f2ce8c2942eb876/libs/ibl/src/CubemapIBL.cpp\n\t\t{{MODULE_BEGIN_FRAG}}\n\t\tfloat NoV = P.x;\n\t\tfloat a   = P.y;\n\n\t\tvec3 V;\n\t\tV.x = sqrt(1.0 - NoV*NoV);\n\t\tV.y = 0.0;\n\t\tV.z = NoV;\n\n\t\tvec2 r = vec2(0.0);\n\n        #ifndef WEBGL1\n        for(uint i = 0u; i < NUM_SAMPLES; i++)\n        #else\n        for(int i = 0; i < NUM_SAMPLES; i++)\n        #endif\n        {\n\t\t\tvec2 Xi = hammersley(i, NUM_SAMPLES);\n\t\t\tvec3 H  = hemisphereImportanceSampleDggx(Xi, a);\n\t\t\tvec3 L  = 2.0 * dot(V, H) * H - V;\n\n\t\t\tfloat VoH = clamp(dot(V, H), 0.0, 1.0);\n\t\t\tfloat NoL = clamp(L.z, 0.0, 1.0);\n\t\t\tfloat NoH = clamp(H.z, 0.0, 1.0);\n\n\t\t\tif (NoL > 0.0) {\n\t\t\t\tfloat Gv = Visibility(NoV, NoL, a) * NoL * (VoH / NoH);\n\t\t\t\tfloat Fc = pow(1.0 - VoH, 5.0);\n\n\t\t\t\t// modified for multiscattering https://google.github.io/filament/Filament.md.html#toc5.3.4.7\n\t\t\t    r.x += Gv * Fc;\n\t\t\t\tr.y += Gv;\n\t\t\t}\n\t\t}\n\t\tr *= NUM_SAMPLES_FLOAT_INVERSED4;\n\n\t\t{{MODULE_COLOR}}\n\t\toutColor = vec4(r.x, r.y, 0.0, 1.0);\n\t}\n#endif\n",IBLLUT_vert:"precision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\n{{MODULES_HEAD}}\nIN vec3 vPosition;\nOUT vec3 P;\nUNI mat4 projMatrix;\nUNI mat4 viewMatrix;\nUNI mat4 modelMatrix;\n\nvoid main()\n{\n   vec4 pos     = vec4(vPosition,  1.0);\n   mat4 mMatrix = modelMatrix;\n\n   {{MODULE_VERTEX_POSITION}}\n\n   gl_Position  = pos;\n\n   P            = (vPosition + 1.0) * 0.5;\n}\n",irradiance_frag:'precision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\n\n// from https://github.com/BabylonJS/Babylon.js/blob/5e6321d887637877d8b28b417410abbbeb651c6e/src/Shaders/ShadersInclude/hdrFilteringFunctions.fx\n// modified to use different syntax for a number of variables, equirectangular projection and rgbe encoding\n{{MODULES_HEAD}}\n#ifndef WEBGL1\n#define NUM_SAMPLES 2048u\n#else\n#define NUM_SAMPLES 2048\n#endif\n#define PI 3.14159265358\n#define PI_TWO 2.*PI\n#define RECIPROCAL_PI 1./PI\n#define RECIPROCAL_PI2 RECIPROCAL_PI/2.\n\n\n#ifdef WEBGL1\n    #ifdef GL_EXT_shader_texture_lod\n        #define textureLod texture2DLodEXT\n    #endif\n#endif\n#define SAMPLETEX textureLod\n\n// set by cables\nUNI vec3 camPos;\n\nIN  vec3 FragPos;\nUNI float rotation;\nUNI vec2 filteringInfo;\nUNI sampler2D EquiCubemap;\n\nvec2 SampleSphericalMap(vec3 direction, float rotation)\n{\n    #ifndef WEBGL1\n        vec3 newDirection = normalize(direction);\n\t\tvec2 sampleUV;\n\t\tsampleUV.x = -1. * (atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5);\n\t\tsampleUV.y = asin( clamp(direction.y, -1., 1.) ) * RECIPROCAL_PI + 0.5;\n    #endif\n\n    #ifdef WEBGL1\n        vec3 newDirection = normalize(direction);\n\t\tvec2 sampleUV = vec2(atan(newDirection.z, newDirection.x), asin(newDirection.y+1e-6));\n        sampleUV *= vec2(-0.1591, 0.3183);\n        sampleUV += 0.5;\n    #endif\n    sampleUV.x += rotation;\n    return sampleUV * vec2(-1.,1.);\n}\n\n// https://community.khronos.org/t/addition-of-two-hdr-rgbe-values/55669\nvec4 EncodeRGBE8(vec3 rgb)\n{\n    vec4 vEncoded;\n    float maxComponent = max(max(rgb.r, rgb.g), rgb.b);\n    float fExp = ceil(log2(maxComponent));\n    vEncoded.rgb = rgb / exp2(fExp);\n    vEncoded.a = (fExp + 128.0) / 255.0;\n    return vEncoded;\n}\n// https://enkimute.github.io/hdrpng.js/\nvec3 DecodeRGBE8(vec4 rgbe)\n{\n    vec3 vDecoded = rgbe.rgb * pow(2.0, rgbe.a * 255.0 - 128.0);\n    return vDecoded;\n}\n\n// from https://github.com/BabylonJS/Babylon.js/blob/5e6321d887637877d8b28b417410abbbeb651c6e/src/Shaders/ShadersInclude/importanceSampling.fx\nvec3 hemisphereCosSample(vec2 u) {\n    // pdf = cosTheta / M_PI;\n    float phi = 2. * PI * u.x;\n\n    float cosTheta2 = 1. - u.y;\n    float cosTheta = sqrt(cosTheta2);\n    float sinTheta = sqrt(1. - cosTheta2);\n\n    return vec3(sinTheta * cos(phi), sinTheta * sin(phi), cosTheta);\n}\n\n#ifndef WEBGL1\n    // https://learnopengl.com/PBR/IBL/Specular-IBL\n    // Hammersley\n    float radicalInverse_VdC(uint bits)\n    {\n        bits = (bits << 16u) | (bits >> 16u);\n        bits = ((bits & 0x55555555u) << 1u) | ((bits & 0xAAAAAAAAu) >> 1u);\n        bits = ((bits & 0x33333333u) << 2u) | ((bits & 0xCCCCCCCCu) >> 2u);\n        bits = ((bits & 0x0F0F0F0Fu) << 4u) | ((bits & 0xF0F0F0F0u) >> 4u);\n        bits = ((bits & 0x00FF00FFu) << 8u) | ((bits & 0xFF00FF00u) >> 8u);\n        return float(bits) * 2.3283064365386963e-10; // / 0x100000000\n    }\n\n    vec2 hammersley(uint i, uint N)\n    {\n        return vec2(float(i)/float(N), radicalInverse_VdC(i));\n    }\n#else\n    float vanDerCorpus(int n, int base)\n    {\n        float invBase = 1.0 / float(base);\n        float denom   = 1.0;\n        float result  = 0.0;\n\n        for(int i = 0; i < 32; ++i)\n        {\n            if(n > 0)\n            {\n                denom   = mod(float(n), 2.0);\n                result += denom * invBase;\n                invBase = invBase / 2.0;\n                n       = int(float(n) / 2.0);\n            }\n        }\n\n        return result;\n    }\n\n    vec2 hammersley(int i, int N)\n    {\n        return vec2(float(i)/float(N), vanDerCorpus(i, 2));\n    }\n#endif\n\n// from https://github.com/google/filament/blob/main/shaders/src/light_indirect.fs\nfloat prefilteredImportanceSampling(float ipdf, float omegaP)\n{\n    // See: "Real-time Shading with Filtered Importance Sampling", Jaroslav Krivanek\n    // Prefiltering doesn\'t work with anisotropy\n    const float numSamples = float(NUM_SAMPLES);\n    const float invNumSamples = 1.0 / float(numSamples);\n    const float K = 4.0;\n    float omegaS = invNumSamples * ipdf;\n    float mipLevel = log2(K * omegaS / omegaP) * 0.5;    // log4\n    return mipLevel;\n}\n\nconst float NUM_SAMPLES_FLOAT = float(NUM_SAMPLES);\nconst float NUM_SAMPLES_FLOAT_INVERSED = 1. / NUM_SAMPLES_FLOAT;\n\nconst float K = 4.;\n\nvoid main()\n{\n    {{MODULE_BEGIN_FRAG}}\n    vec4 col = vec4(0.0, 0.0, 0.0, 0.0);\n\n    vec3 n = normalize(FragPos);\n    vec3 tangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));\n    vec3 bitangent = cross(n, tangent);\n    mat3 tbn = mat3(tangent, bitangent, n);\n\n    float maxLevel = filteringInfo.y;\n    float dim0 = filteringInfo.x;\n    float omegaP = (4. * PI) / (6. * dim0 * dim0);\n\n    #ifndef WEBGL1\n    for(uint i = 0u; i < NUM_SAMPLES; ++i)\n    #else\n    for(int i = 0; i < NUM_SAMPLES; ++i)\n    #endif\n    {\n        vec2 Xi = hammersley(i, NUM_SAMPLES);\n        vec3 Ls = hemisphereCosSample(Xi);\n\n        Ls = normalize(Ls);\n\n        vec3 Ns = vec3(0., 0., 1.);\n\n        float NoL = dot(Ns, Ls);\n\n        if (NoL > 0.) {\n            float pdf_inversed = PI / NoL;\n\n            float omegaS = NUM_SAMPLES_FLOAT_INVERSED * pdf_inversed;\n            // from https://github.com/google/filament/blob/main/shaders/src/light_indirect.fs\n            float l = log2(K * omegaS / omegaP) * 0.5;\n            float mipLevel = clamp(l + 1.0, 0.0, maxLevel);\n\n            #ifndef DONT_USE_RGBE_CUBEMAPS\n            vec3 c = DecodeRGBE8(SAMPLETEX(EquiCubemap, SampleSphericalMap(tbn * Ls, rotation), mipLevel)).rgb;\n            #else\n            vec3 c = SAMPLETEX(EquiCubemap, SampleSphericalMap(tbn * Ls, rotation), mipLevel).rgb;\n            #endif\n            col.rgb += c;\n        }\n    }\n\n    col = EncodeRGBE8(col.rgb * PI * NUM_SAMPLES_FLOAT_INVERSED);\n\n    {{MODULE_COLOR}}\n    outColor = col;\n}\n',irradiance_vert:"precision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\n\n{{MODULES_HEAD}}\nIN vec3 vPosition;\nIN float attrVertIndex;\n\nOUT vec3 FragPos;\nUNI mat4 projMatrix;\nUNI mat4 viewMatrix;\nUNI mat4 modelMatrix;\n\n\nvoid main()\n{\n    FragPos     = vPosition;\n\n    {{MODULE_VERTEX_POSITION}}\n    gl_Position = projMatrix * viewMatrix * modelMatrix * vec4(vPosition, 1.0);\n    gl_Position = gl_Position.xyww;\n}\n",prefiltering_frag:"precision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\n\n// from https://github.com/BabylonJS/Babylon.js/blob/5e6321d887637877d8b28b417410abbbeb651c6e/src/Shaders/ShadersInclude/hdrFilteringFunctions.fx\n// modified to use different syntax for a number of variables, equirectangular projection and rgbe encoding\n{{MODULES_HEAD}}\n#ifndef WEBGL1\n#define NUM_SAMPLES 2048u\n#else\n#define NUM_SAMPLES 2048\n#endif\n#define PI 3.14159265358\n#define PI_TWO 2.*PI\n#define RECIPROCAL_PI 1./PI\n#define RECIPROCAL_PI2 RECIPROCAL_PI/2.\n#define MINIMUMVARIANCE 0.0005\n\n\n#ifdef WEBGL1\n    #ifdef GL_EXT_shader_texture_lod\n        #define textureLod texture2DLodEXT\n    #endif\n#endif\n#define SAMPLETEX textureLod\n\nIN  vec3 FragPos;\nUNI float roughness;\nUNI float rotation;\nUNI vec2 filteringInfo;\nUNI sampler2D EquiCubemap;\n\nvec2 SampleSphericalMap(vec3 direction, float rotation)\n{\n    #ifndef WEBGL1\n        vec3 newDirection = normalize(direction);\n\t\tvec2 sampleUV;\n\t\tsampleUV.x = -1. * (atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5);\n\t\tsampleUV.y = asin( clamp(direction.y, -1., 1.) ) * RECIPROCAL_PI + 0.5;\n    #endif\n\n    #ifdef WEBGL1\n        vec3 newDirection = normalize(direction);\n\t\tvec2 sampleUV = vec2(atan(newDirection.z, newDirection.x), asin(newDirection.y+1e-6));\n        sampleUV *= vec2(-0.1591, 0.3183);\n        sampleUV += 0.5;\n    #endif\n    sampleUV.x += rotation;\n    return sampleUV * vec2(-1.,1.);\n}\n\n// https://community.khronos.org/t/addition-of-two-hdr-rgbe-values/55669\nvec4 EncodeRGBE8(vec3 rgb)\n{\n    vec4 vEncoded;\n    float maxComponent = max(max(rgb.r, rgb.g), rgb.b);\n    float fExp = ceil(log2(maxComponent));\n    vEncoded.rgb = rgb / exp2(fExp);\n    vEncoded.a = (fExp + 128.0) / 255.0;\n    return vEncoded;\n}\n// https://enkimute.github.io/hdrpng.js/\nvec3 DecodeRGBE8(vec4 rgbe)\n{\n    vec3 vDecoded = rgbe.rgb * pow(2.0, rgbe.a * 255.0-128.0);\n    return vDecoded;\n}\n\n// from https://github.com/BabylonJS/Babylon.js/blob/5e6321d887637877d8b28b417410abbbeb651c6e/src/Shaders/ShadersInclude/importanceSampling.fx\nvec3 hemisphereImportanceSampleDggx(vec2 u, float a) {\n    // pdf = D(a) * cosTheta\n    float phi = 2. * PI * u.x;\n\n    // NOTE: (aa-1) == (a-1)(a+1) produces better fp accuracy\n    float cosTheta2 = (1. - u.y) / (1. + (a + 1.) * ((a - 1.) * u.y));\n    float cosTheta = sqrt(cosTheta2);\n    float sinTheta = sqrt(1. - cosTheta2);\n\n    return vec3(sinTheta * cos(phi), sinTheta * sin(phi), cosTheta);\n}\n\n// from https://github.com/BabylonJS/Babylon.js/blob/5e6321d887637877d8b28b417410abbbeb651c6e/src/Shaders/ShadersInclude/pbrBRDFFunctions.fx\nfloat normalDistributionFunction_TrowbridgeReitzGGX(float NdotH, float alphaG)\n{\n    // Note: alphaG is average slope (gradient) of the normals in slope-space.\n    // It is also the (trigonometric) tangent of the median distribution value, i.e. 50% of normals have\n    // a tangent (gradient) closer to the macrosurface than this slope.\n    float a2 = alphaG * alphaG;\n    float d = NdotH * NdotH * (a2 - 1.0) + 1.0;\n    return a2 / (PI * d * d);\n}\n\n// from https://github.com/BabylonJS/Babylon.js/blob/5e6321d887637877d8b28b417410abbbeb651c6e/src/Shaders/ShadersInclude/pbrHelperFunctions.fx\nfloat convertRoughnessToAverageSlope(float roughness)\n{\n    // Calculate AlphaG as square of roughness (add epsilon to avoid numerical issues)\n    return (roughness * roughness) + MINIMUMVARIANCE;\n}\n\n\n#ifndef WEBGL1\n    // https://learnopengl.com/PBR/IBL/Specular-IBL\n    // Hammersley\n    float radicalInverse_VdC(uint bits)\n    {\n        bits = (bits << 16u) | (bits >> 16u);\n        bits = ((bits & 0x55555555u) << 1u) | ((bits & 0xAAAAAAAAu) >> 1u);\n        bits = ((bits & 0x33333333u) << 2u) | ((bits & 0xCCCCCCCCu) >> 2u);\n        bits = ((bits & 0x0F0F0F0Fu) << 4u) | ((bits & 0xF0F0F0F0u) >> 4u);\n        bits = ((bits & 0x00FF00FFu) << 8u) | ((bits & 0xFF00FF00u) >> 8u);\n        return float(bits) * 2.3283064365386963e-10; // / 0x100000000\n    }\n\n    vec2 hammersley(uint i, uint N)\n    {\n        return vec2(float(i)/float(N), radicalInverse_VdC(i));\n    }\n#else\n    float vanDerCorpus(int n, int base)\n    {\n        float invBase = 1.0 / float(base);\n        float denom   = 1.0;\n        float result  = 0.0;\n\n        for(int i = 0; i < 32; ++i)\n        {\n            if(n > 0)\n            {\n                denom   = mod(float(n), 2.0);\n                result += denom * invBase;\n                invBase = invBase / 2.0;\n                n       = int(float(n) / 2.0);\n            }\n        }\n\n        return result;\n    }\n\n    vec2 hammersley(int i, int N)\n    {\n        return vec2(float(i)/float(N), vanDerCorpus(i, 2));\n    }\n#endif\n\nfloat log4(float x)\n{\n    return log2(x) / 2.;\n}\n\nconst float NUM_SAMPLES_FLOAT = float(NUM_SAMPLES);\nconst float NUM_SAMPLES_FLOAT_INVERSED = 1. / NUM_SAMPLES_FLOAT;\n\nconst float K = 4.;\n\nvoid main()\n{\n    {{MODULE_BEGIN_FRAG}}\n    vec3 n = normalize(FragPos);\n    float alphaG = convertRoughnessToAverageSlope(roughness);\n    vec4 result = vec4(0.);\n\n    if (alphaG == 0.)\n    {\n        result = SAMPLETEX(EquiCubemap, SampleSphericalMap(n, rotation), 0.0);\n    }\n    else\n    {\n        vec3 tangent = abs(n.z) < 0.999 ? vec3(0., 0., 1.) : vec3(1., 0., 0.);\n        tangent = normalize(cross(tangent, n));\n        vec3 bitangent = cross(n, tangent);\n        mat3 tbn = mat3(tangent, bitangent, n);\n\n        float maxLevel = filteringInfo.y;\n        float dim0 = filteringInfo.x;\n        float omegaP = (4. * PI) / (6. * dim0 * dim0);\n\n        float weight = 0.;\n        #if defined(WEBGL2)\n        for(uint i = 0u; i < NUM_SAMPLES; ++i)\n        #else\n        for(int i = 0; i < NUM_SAMPLES; ++i)\n        #endif\n        {\n            vec2 Xi = hammersley(i, NUM_SAMPLES);\n            vec3 H = hemisphereImportanceSampleDggx(Xi, alphaG);\n\n            float NoV = 1.;\n            float NoH = H.z;\n            float NoH2 = H.z * H.z;\n            float NoL = 2. * NoH2 - 1.;\n            vec3 L = vec3(2. * NoH * H.x, 2. * NoH * H.y, NoL);\n            L = normalize(L);\n\n            if (NoL > 0.)\n            {\n                float pdf_inversed = 4. / normalDistributionFunction_TrowbridgeReitzGGX(NoH, alphaG);\n\n                float omegaS = NUM_SAMPLES_FLOAT_INVERSED * pdf_inversed;\n                float l = log4(omegaS) - log4(omegaP) + log4(K);\n                float mipLevel = clamp(l, 0.0, maxLevel);\n\n                weight += NoL;\n\n                #ifndef DONT_USE_RGBE_CUBEMAPS\n                vec3 c = DecodeRGBE8(SAMPLETEX(EquiCubemap, SampleSphericalMap(tbn * L, rotation), mipLevel)).rgb;\n                #else\n                vec3 c = SAMPLETEX(EquiCubemap, SampleSphericalMap(tbn * L, rotation), mipLevel).rgb;\n                #endif\n                result.rgb += c * NoL;\n            }\n        }\n\n        result = result / weight;\n        result = EncodeRGBE8(result.rgb);\n    }\n\n    {{MODULE_COLOR}}\n    outColor = result;\n}\n",prefiltering_vert:"precision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\n{{MODULES_HEAD}}\nIN vec3 vPosition;\nIN float attrVertIndex;\n\nOUT vec3 FragPos;\nUNI mat4 projMatrix;\nUNI mat4 viewMatrix;\nUNI mat4 modelMatrix;\n\n\nvoid main()\n{\n    FragPos     = vPosition;\n\n    {{MODULE_VERTEX_POSITION}}\n    gl_Position = projMatrix * viewMatrix * modelMatrix * vec4(vPosition, 1.0);\n    gl_Position = gl_Position.xyww;\n}\n"};const i=e.patch.cgl;const n=i.glVersion==1;const a=new CGL.BoundingBox;const r=new CGL.Geometry("unit cube");r.vertices=new Float32Array([-1,1,-1,-1,-1,-1,1,-1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,-1,1,-1,1,1,1,1,1,1,1,1,1,-1,1,-1,-1,-1,-1,1,-1,1,1,1,1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,1,-1,1,1,1,1,1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,1,-1,1]);const o=new CGL.Mesh(i,r);const s=CGL.MESHES.getSimpleRect(i,"fullscreenRectangle");const l=e.inTrigger("render");const u=e.inTexture("RGBE Environment map");const m=e.inDropDown("Size Irradiance map",[16,32,64],64);const c=e.inDropDown("Size pre-filtered environment",[64,128],128);const g=e.inDropDown("Size IBL LUT",[128,256,512,1024],256);const p=e.inBool("Environment map does not contain RGBE data",false);const d=e.inFloat("Rotation",0);const f=e.inValueBool("Use parallax correction",false);const h=e.inFloat("center X",0);const b=e.inFloat("center Y",1.8);const v=e.inFloat("center Z",0);const O=e.inFloat("Box min X",-1);const T=e.inFloat("Box min Y",-1);const I=e.inFloat("Box min Z",-1);const _=e.inFloat("Box max X",1);const x=e.inFloat("Box max Y",1);const E=e.inFloat("Box max Z",1);e.setPortGroup("Parallax Correction",[f,h,b,v,O,T,I,_,x,E]);let S=true;let A=true;let C=true;m.onChange=()=>{S=true};c.onChange=()=>{A=true};g.onChange=()=>{C=true};const L=e.outTrigger("next");const N=e.outTexture("IBL LUT");const P=e.outTexture("cubemap (diffuse irradiance)");const M=e.outTexture("cubemap (pre-filtered environment map)");const y=e.outNumber("Number of Pre-filtered mip levels");e.toWorkPortsNeedToBeLinked(u);let j=null;let G=null;let R=null;let w=null;let U=null;const B={};const D=new CGL.Shader(i,"IrradianceShader");const k=new CGL.Shader(i,"PrefilteringShader");D.setModules(["MODULE_VERTEX_POSITION","MODULE_COLOR","MODULE_BEGIN_FRAG"]);k.setModules(["MODULE_VERTEX_POSITION","MODULE_COLOR","MODULE_BEGIN_FRAG"]);if(i.glVersion==1){if(!i.gl.getExtension("EXT_shader_texture_lod")){e.log("no EXT_shader_texture_lod texture extension");throw"no EXT_shader_texture_lod texture extension"}else{D.enableExtension("GL_EXT_shader_texture_lod");k.enableExtension("GL_EXT_shader_texture_lod");i.gl.getExtension("OES_texture_float");i.gl.getExtension("OES_texture_float_linear");i.gl.getExtension("OES_texture_half_float");i.gl.getExtension("OES_texture_half_float_linear");i.gl.getExtension("WEBGL_color_buffer_float");D.enableExtension("GL_OES_standard_derivatives");D.enableExtension("GL_OES_texture_float");D.enableExtension("GL_OES_texture_float_linear");D.enableExtension("GL_OES_texture_half_float");D.enableExtension("GL_OES_texture_half_float_linear");k.enableExtension("GL_OES_standard_derivatives");k.enableExtension("GL_OES_texture_float");k.enableExtension("GL_OES_texture_float_linear");k.enableExtension("GL_OES_texture_half_float");k.enableExtension("GL_OES_texture_half_float_linear")}}let V=[0,0];D.offScreenPass=true;const F=new CGL.Uniform(D,"t","EquiCubemap",0);const z=new CGL.Uniform(D,"2f","filteringInfo",V);const X=new CGL.Uniform(D,"f","rotation",0);D.setSource(t.irradiance_vert,t.irradiance_frag);let H=[0,0];k.offScreenPass=true;const Y=new CGL.Uniform(k,"t","EquiCubemap",0);const W=new CGL.Uniform(k,"f","roughness",0);const Z=new CGL.Uniform(k,"f","rotation",0);const J=new CGL.Uniform(k,"2f","filteringInfo",H);k.setSource(t.prefiltering_vert,t.prefiltering_frag);const K=new CGL.Shader(i,"IBLLUTShader");K.offScreenPass=true;K.setModules(["MODULE_VERTEX_POSITION","MODULE_COLOR","MODULE_BEGIN_FRAG"]);K.setSource(t.IBLLUT_vert,t.IBLLUT_frag);p.onChange=()=>{D.toggleDefine("DONT_USE_RGBE_CUBEMAPS",p);k.toggleDefine("DONT_USE_RGBE_CUBEMAPS",p);S=true;A=true};d.onChange=()=>{A=S=true};function q(e){if(j){j.setSize(Number(e),Number(e))}else{j=new CGL.CubemapFramebuffer(i,Number(e),Number(e),{isFloatingPointTexture:true,filter:CGL.Texture.FILTER_NEAREST,wrap:CGL.Texture.WRAP_CLAMP_TO_EDGE})}V[0]=e;V[1]=1+Math.floor(Math.log(e)*1.4426950408889634);D.popTextures();D.pushTexture(F,u.get().tex);X.setValue(d.get()/360);j.renderStart(i);for(let e=0;e<6;e+=1){j.renderStartCubemapFace(e);i.gl.clearColor(0,0,0,0);i.gl.clear(i.gl.COLOR_BUFFER_BIT|i.gl.DEPTH_BUFFER_BIT);o.render(D);j.renderEndCubemapFace()}j.renderEnd();P.set(null);P.set(j.getTextureColor())}function Q(a){a=Number(a);let r=new CGL.CubemapFramebuffer(i,a,a,{filter:CGL.Texture.FILTER_LINEAR,wrap:CGL.Texture.WRAP_CLAMP_TO_EDGE});if(R){R.setSize(a,a)}else{R=new CGL.CubemapFramebuffer(i,a,a,{filter:CGL.Texture.FILTER_MIPMAP,wrap:CGL.Texture.WRAP_CLAMP_TO_EDGE})}i.gl.bindTexture(i.gl.TEXTURE_CUBE_MAP,R.getTextureColor().tex);i.gl.texParameteri(i.gl.TEXTURE_CUBE_MAP,i.gl.TEXTURE_WRAP_R,i.gl.CLAMP_TO_EDGE);i.gl.texParameteri(i.gl.TEXTURE_CUBE_MAP,i.gl.TEXTURE_MIN_FILTER,i.gl.LINEAR_MIPMAP_LINEAR);i.gl.texParameteri(i.gl.TEXTURE_CUBE_MAP,i.gl.TEXTURE_MAG_FILTER,i.gl.LINEAR);i.gl.generateMipmap(i.gl.TEXTURE_CUBE_MAP);U=1+Math.floor(Math.log(a)*1.4426950408889634);y.set(U);H[0]=a;H[1]=U;k.popTextures();k.pushTexture(Y,u.get().tex);Z.setValue(d.get()/360);for(let n=0;n<=U;++n){let t=a*Math.pow(.5,n);let e=n/(U-1);W.setValue(e);r.setSize(Number(t),Number(t));r.renderStart(i);for(let e=0;e<6;e+=1){r.renderStartCubemapFace(e);i.gl.clearColor(0,0,0,0);i.gl.clear(i.gl.COLOR_BUFFER_BIT|i.gl.DEPTH_BUFFER_BIT);o.render(k);i.gl.bindTexture(i.gl.TEXTURE_CUBE_MAP,R.getTextureColor().tex);i.gl.copyTexImage2D(i.gl.TEXTURE_CUBE_MAP_POSITIVE_X+e,n,i.gl.RGBA,0,0,Number(t),Number(t),null);r.renderEndCubemapFace()}r.renderEnd()}r.delete();i.setTexture(0,null);M.set(null);M.set(R.getTextureColor())}function $(e){e=Number(e);if(w){w.setSize(e,e)}else{if(n){w=new CGL.Framebuffer(i,e,e,{isFloatingPointTexture:true,filter:CGL.Texture.FILTER_LINEAR,wrap:CGL.Texture.WRAP_CLAMP_TO_EDGE})}else{w=new CGL.Framebuffer2(i,e,e,{isFloatingPointTexture:true,filter:CGL.Texture.FILTER_LINEAR,wrap:CGL.Texture.WRAP_CLAMP_TO_EDGE})}}i.frameStore.renderOffscreen=true;w.renderStart(i);s.render(K);w.renderEnd();i.frameStore.renderOffscreen=false;N.set(w.getTextureColor())}u.onChange=()=>{if(u.get())e.setUiError("nocubemapinput",null);A=S=true};function ee(){gui.setTransformGizmo({posX:h,posY:b,posZ:v});gui.setTransformGizmo({posX:O,posY:T,posZ:I},1);gui.setTransformGizmo({posX:_,posY:x,posZ:E},2);if(CABLES.UI.renderHelper){i.pushShader(CABLES.GL_MARKER.getDefaultShader(i))}else{i.pushShader(CABLES.GL_MARKER.getSelectedShader(i))}i.pushModelMatrix();mat4.translate(i.mMatrix,i.mMatrix,[(O.get()+_.get())/2,(T.get()+x.get())/2,(I.get()+E.get())/2]);mat4.scale(i.mMatrix,i.mMatrix,[(_.get()-O.get())/2,(x.get()-T.get())/2,(E.get()-I.get())/2]);a.render(i);i.popShader();i.popModelMatrix()}f.onChange=()=>{const e=f.get();h.setUiAttribs({greyout:!e});b.setUiAttribs({greyout:!e});v.setUiAttribs({greyout:!e});O.setUiAttribs({greyout:!e});T.setUiAttribs({greyout:!e});I.setUiAttribs({greyout:!e});_.setUiAttribs({greyout:!e});x.setUiAttribs({greyout:!e});E.setUiAttribs({greyout:!e})};l.onTriggered=function(){if(!u.get()){L.trigger();e.setUiError("nocubemapinput","No Environment Texture connected");return}z.setValue(V);J.setValue(H);if(!i.frameStore.shadowPass){if(C){$(Number(g.get()));C=false}if(A){Q(Number(c.get()));A=false}if(S){q(Number(m.get()));S=false}}B.texIBLLUT=N.get();B.texDiffIrr=P.get();B.texPreFiltered=M.get();B.texPreFilteredMipLevels=y.get();B.UseParallaxCorrection=f.get();B.PCOrigin=[h.get(),b.get(),v.get()];B.PCboxMin=[O.get(),T.get(),I.get()];B.PCboxMax=[_.get(),x.get(),E.get()];i.frameStore.pbrEnvStack=i.frameStore.pbrEnvStack||[];i.frameStore.pbrEnvStack.push(B);if(i.shouldDrawHelpers(e)&&B.UseParallaxCorrection&&!i.frameStore.shadowPass)ee();L.trigger();i.frameStore.pbrEnvStack.pop()}};Ops.Gl.Pbr.PbrEnvironmentLight.prototype=new CABLES.Op;CABLES.OPS["7110f169-adfd-4649-a77a-c825751eaa9b"]={f:Ops.Gl.Pbr.PbrEnvironmentLight,objName:"Ops.Gl.Pbr.PbrEnvironmentLight"};Ops.Value.TriggerOnChangeNumber=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};const n=e.inFloat("Value"),a=e.outTrigger("Next"),r=e.outNumber("Number");n.onChange=function(){r.set(n.get());a.trigger()}};Ops.Value.TriggerOnChangeNumber.prototype=new CABLES.Op;CABLES.OPS["f5c8c433-ce13-49c4-9a33-74e98f110ed0"]={f:Ops.Value.TriggerOnChangeNumber,objName:"Ops.Value.TriggerOnChangeNumber"};Ops.Trigger.TriggerSend=function(){CABLES.Op.apply(this,arguments);const a=this;const e={};const t=a.inTriggerButton("Trigger");a.varName=a.inValueSelect("Named Trigger",[],"",true);a.varName.onChange=r;t.onTriggered=i;a.patch.addEventListener("namedTriggersChanged",n);n();function n(){if(CABLES.UI){const e=[];const t=a.patch.namedTriggers;e.push("+ create new one");for(const n in t)e.push(n);a.varName.uiAttribs.values=e}}function r(){if(CABLES.UI){if(a.varName.get()=="+ create new one"){new CABLES.UI.ModalDialog({prompt:true,title:"New Trigger",text:"enter a name for the new trigger",promptValue:"",promptOk:e=>{a.varName.set(e);a.patch.namedTriggers[e]=a.patch.namedTriggers[e]||[];n()}});return}if(a.isCurrentUiOp())gui.opParams.show(a)}if(!a.patch.namedTriggers[a.varName.get()]){a.patch.namedTriggers[a.varName.get()]=a.patch.namedTriggers[a.varName.get()]||[];a.patch.emitEvent("namedTriggersChanged")}a.setTitle(">"+a.varName.get());if(a.isCurrentUiOp())gui.opParams.show(a);a.patch.emitEvent("opTriggerNameChanged",a,a.varName.get())}function i(){const t=a.patch.namedTriggers[a.varName.get()];a.patch.emitEvent("namedTriggerSent",a.varName.get());if(!t){a.setUiError("unknowntrigger","unknown trigger");return}else a.setUiError("unknowntrigger",null);for(let e=0;e<t.length;e++){t[e]()}}};Ops.Trigger.TriggerSend.prototype=new CABLES.Op;CABLES.OPS["ce1eaf2b-943b-4dc0-ab5e-ee11b63c9ed0"]={f:Ops.Trigger.TriggerSend,objName:"Ops.Trigger.TriggerSend"};Ops.Trigger.TriggerReceive=function(){CABLES.Op.apply(this,arguments);const a=this;const e={};const t=a.outTrigger("Triggered");a.varName=a.inValueSelect("Named Trigger",[],"",true);i();a.patch.addEventListener("namedTriggersChanged",i);let n=null;function r(){t.trigger()}function i(){if(CABLES.UI){let t=[];let n=a.patch.namedTriggers;for(let e in n)t.push(e);a.varName.uiAttribs.values=t}}a.varName.onChange=function(){if(n){let e=a.patch.namedTriggers[n];let t=e.indexOf(r);if(t!=-1)e.splice(t,1)}a.setTitle(">"+a.varName.get());a.patch.namedTriggers[a.varName.get()]=a.patch.namedTriggers[a.varName.get()]||[];let e=a.patch.namedTriggers[a.varName.get()];e.push(r);n=a.varName.get();o();a.patch.emitEvent("opTriggerNameChanged",a,a.varName.get())};a.on("uiParamPanel",o);function o(){if(!a.varName.get()){a.setUiError("unknowntrigger","unknown trigger")}else a.setUiError("unknowntrigger",null)}};Ops.Trigger.TriggerReceive.prototype=new CABLES.Op;CABLES.OPS["0816c999-f2db-466b-9777-2814573574c5"]={f:Ops.Trigger.TriggerReceive,objName:"Ops.Trigger.TriggerReceive"};Ops.Sidebar.SideBarSwitch=function(){CABLES.Op.apply(this,arguments);const t=this;const e={};const n=t.inObject("link"),a=t.inArray("Names"),r=t.inSwitch("Style",["Tabs","Switch"],"Switch"),i=t.inString("Text","Switch"),o=t.inInt("Input",0),s=t.inTriggerButton("Set Default"),l=t.inBool("Grey Out",false),u=t.inValue("Default",0),m=t.outObject("childs"),c=t.outNumber("Index",-1),g=t.outString("String");let p=null;const d=document.createElement("div");d.classList.add("sidebar__item");d.dataset.op=t.id;d.classList.add("cablesEle");u.setUiAttribs({greyout:true});const f=document.createElement("div");f.classList.add("sidebar__item-label");const h=document.createTextNode(i.get());f.appendChild(h);d.appendChild(f);const b=document.createElement("div");d.appendChild(b);const v=document.createElement("div");v.classList.add("sidebar__greyout");d.appendChild(v);v.style.display="none";n.onChange=S;t.onDelete=L;t.toWorkNeedsParent("Ops.Sidebar.Sidebar");t.setPortGroup("Default Item",[u,s]);const O=[];a.onChange=T;r.onChange=I;I();i.onChange=()=>{f.innerHTML=i.get()};l.onChange=function(){v.style.display=l.get()?"block":"none"};function T(){O.length=0;b.innerHTML="";p=null;const n=a.get();if(!n)return;for(let t=0;t<n.length;t++){const e=_(String(n[t]));if(t==u.get())x(e)}}s.onTriggered=()=>{u.set(c.get());if(t.isCurrentUiOp())gui.opParams.show(t)};function I(){if(r.get()=="Tabs"){d.classList.add("sidebar_tabs");b.classList.remove("sidebar_switchs");f.style.display="none"}else{d.classList.remove("sidebar_tabs");b.classList.add("sidebar_switchs");f.style.display="inline-block"}i.setUiAttribs({greyout:r.get()=="Tabs"});T()}function _(e){const t=document.createElement("div");if(r.get()=="Tabs")t.classList.add("sidebar_tab");else t.classList.add("sidebar_switch");t.id="tabEle"+O.length;t.innerHTML=e;t.dataset.index=O.length;t.dataset.txt=e;t.addEventListener("click",E);b.appendChild(t);O.push(t);return t}o.onChange=()=>{if(O.length>o.get())E({target:O[o.get()]})};function x(e){if(e){p=e;t.log(e.dataset.index);c.set(parseInt(e.dataset.index));g.set(e.dataset.txt);if(r.get()=="Tabs")e.classList.add("sidebar_tab_active");else e.classList.add("sidebar_switch_active")}}function E(e){if(p)if(r.get()=="Tabs")p.classList.remove("sidebar_tab_active");else p.classList.remove("sidebar_switch_active");x(e.target)}function S(){m.set(null);const e=n.get();if(e&&e.parentElement){e.parentElement.appendChild(d);m.set(e)}else{if(d.parentElement)d.parentElement.removeChild(d)}}function A(e){if(!e)return;e.style.display="block"}function C(e){if(!e)return;e.style.display="none"}function L(){N(d)}function N(e){if(e&&e.parentNode&&e.parentNode.removeChild){e.parentNode.removeChild(e)}}};Ops.Sidebar.SideBarSwitch.prototype=new CABLES.Op;CABLES.OPS["ebc8c92c-5fa6-4598-a9c6-b8e12f22f7c2"]={f:Ops.Sidebar.SideBarSwitch,objName:"Ops.Sidebar.SideBarSwitch"};Ops.Array.ParseArray_v2=function(){CABLES.Op.apply(this,arguments);const a=this;const e={};const r=a.inStringEditor("text","1,2,3"),i=a.inString("separator",","),o=a.inValueBool("Numbers",true),s=a.inValueBool("Trim",true),l=a.outTrigger("Parsed"),u=a.outArray("array"),m=a.outValue("length");r.onChange=i.onChange=o.onChange=s.onChange=t;t();function t(){if(!r.get()){u.set(null);u.set([]);m.set(0);return}let e=r.get();if(s.get()&&e){e=e.replace(/^\s+|\s+$/g,"");e=e.trim()}const t=i.get();if(i.get()=="\\n")t=="\n";const n=e.split(t);if(n[n.length-1]==="")n.length-=1;m.set(n.length);if(s.get()){for(let e=0;e<n.length;e++){n[e]=n[e].replace(/^\s+|\s+$/g,"");n[e]=n[e].trim()}}a.setUiError("notnum",null);if(o.get()){let t=false;for(let e=0;e<n.length;e++){n[e]=Number(n[e]);if(!CABLES.UTILS.isNumeric(n[e])){t=true}}if(t){a.setUiError("notnum","Parse Error / Not all values numerical!")}}u.set(null);u.set(n);l.trigger()}};Ops.Array.ParseArray_v2.prototype=new CABLES.Op;CABLES.OPS["c974de41-4ce4-4432-b94d-724741109c71"]={f:Ops.Array.ParseArray_v2,objName:"Ops.Array.ParseArray_v2"};Ops.Value.RouteNumber=function(){CABLES.Op.apply(this,arguments);const a=this;const e={};const r=10;const t=0;let n=null;const i=a.inValue("Index",0);const o=a.inValue("Value",0);const s=a.inValue("Default Value",t);const l=a.inBool("Set inactive to default",false);const u=m(t);i.onChange=g;o.onChange=g;s.onChange=c;l.onChange=d;c();function m(){let n=[];for(let t=0;t<r;t++){let e=a.outNumber("Index "+t+" Value");n.push(e)}return n}function c(){const t=s.get();u.forEach(e=>{e.set(t)})}function g(){let e=i.get();e=Math.round(e);e=p(e,0,r-1);if(l.get()&&n!==null&&n!=e){u[n].set(s.get())}const t=o.get();u[e].set(t);n=e}function p(e,t,n){return Math.min(Math.max(e,t),n)}function d(){if(l.get()){c();g()}}};Ops.Value.RouteNumber.prototype=new CABLES.Op;CABLES.OPS["e3b1fc2d-a813-4d9b-8cb0-595fc95af4e2"]={f:Ops.Value.RouteNumber,objName:"Ops.Value.RouteNumber"};Ops.Sidebar.Group=function(){CABLES.Op.apply(this,arguments);const t=this;const e={};let n=t.inObject("link");let a=t.inString("Text","Group");const r=t.inBool("Show Title",true);let i=t.inValueBool("Default Minimized");const o=t.inBool("Visible",true);let s=t.outObject("next");let l=t.outObject("childs");o.onChange=function(){u.style.display=o.get()?"block":"none"};var u=document.createElement("div");u.dataset.op=t.id;u.classList.add("sidebar__group");f();let m=document.createElement("div");m.classList.add("sidebar__group-header");m.classList.add("cablesEle");u.appendChild(m);m.addEventListener("click",h);let c=document.createElement("div");c.classList.add("sidebar__group-header-title");m.appendChild(c);let g=document.createElement("span");g.textContent=a.get();g.classList.add("sidebar__group-header-title-text");c.appendChild(g);let p=document.createElement("span");p.classList.add("sidebar__group-header-icon");p.classList.add("iconsidebar-chevron-up");c.appendChild(p);let d=document.createElement("div");d.classList.add("sidebar__group-items");u.appendChild(d);t.toWorkPortsNeedToBeLinked(n);n.onChange=v;a.onChange=b;i.onChange=f;t.onDelete=I;r.onChange=()=>{if(r.get())m.style.display="block";else m.style.display="none"};function f(){if(i.get()){u.classList.add("sidebar__group--closed")}else{u.classList.remove("sidebar__group--closed")}}function h(e){e.stopPropagation();u.classList.toggle("sidebar__group--closed")}function b(){let e=a.get();g.textContent=e;if(CABLES.UI){t.setTitle("Group: "+e)}}function v(){l.set(null);let e=n.get();if(e&&e.parentElement){e.parentElement.appendChild(u);l.set({parentElement:d,parentOp:t});s.set(e)}else{if(u.parentElement){u.parentElement.removeChild(u)}}}function O(e){if(e){e.style.display="block"}}function T(e){if(e){e.style.display="none"}}function I(){_(u)}function _(e){if(e&&e.parentNode&&e.parentNode.removeChild){e.parentNode.removeChild(e)}}};Ops.Sidebar.Group.prototype=new CABLES.Op;CABLES.OPS["86ea2333-b51c-48ed-94c2-8b7b6e9ff34c"]={f:Ops.Sidebar.Group,objName:"Ops.Sidebar.Group"};Ops.String.Split_v2=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};const n=e.inStringEditor("Input String","1,2,3"),a=e.inString("Separator",","),r=e.inBool("Split Lines",false),i=e.inBool("Numbers",false),o=e.outArray("Result");i.onChange=a.onChange=n.onChange=s;s();r.onChange=()=>{a.setUiAttribs({greyout:r.get()});s()};function s(){let e=n.get();if(e){let t;if(r.get())t=e.split("\n");else t=e.split(a.get());if(i.get()){for(let e=0;e<t.length;e++)t[e]=parseFloat(t[e])}o.set(t)}}};Ops.String.Split_v2.prototype=new CABLES.Op;CABLES.OPS["3585e0c5-f738-43e9-aa96-8582d1ea97dd"]={f:Ops.String.Split_v2,objName:"Ops.String.Split_v2"};Ops.Json.ArrayGetStringByPath=function(){CABLES.Op.apply(this,arguments);const i=this;const e={};const t=i.inArray("Array");const o=i.inString("Path");const s=i.inBool("Return path if missing",false);const l=i.outString("Output");const u=i.outBool("Found");t.onChange=n;o.onChange=n;s.onChange=n;function n(){const e=t.get();const n=o.get();i.setUiError("missing",null);if(e&&n){if(!Array.isArray(e)&&!(typeof e==="object")){u.set(false);i.setUiError("notiterable","input object of type "+typeof e+" is not travesable by path")}else{i.setUiError("notiterable",null);const a=n.split(".");i.setUiAttrib({extendTitle:a[a.length-1]+""});let t=m(n,e);if(t===undefined){const r="could not find element at path "+n;let e=2;t=null;u.set(false);if(s.get()){t=n;e=1}else{t=null}i.setUiError("missing",r,e)}else{u.set(true);t=String(t)}l.set(t)}}else{u.set(false)}}function m(e,t=self,n="."){const a=Array.isArray(e)?e:e.split(n);return a.reduce((e,t)=>e&&e[t],t)}};Ops.Json.ArrayGetStringByPath.prototype=new CABLES.Op;CABLES.OPS["064fc275-f61d-4c5f-9692-28c2062248bf"]={f:Ops.Json.ArrayGetStringByPath,objName:"Ops.Json.ArrayGetStringByPath"};Ops.Sidebar.Toggle_v3=function(){CABLES.Op.apply(this,arguments);const t=this;const e={};const n=true;const a=t.inObject("link");const r=t.inString("Text","Toggle");const i=t.inValueBool("Input",n);const o=t.inTriggerButton("Set Default");const s=t.inValueBool("Default",n);s.setUiAttribs({hidePort:true,greyout:true});const l=t.inBool("Grey Out",false);const u=t.inBool("Visible",true);const m=t.outObject("childs");const c=t.outNumber("Value",s.get());const g=document.createElement("div");g.dataset.op=t.id;g.classList.add("cablesEle");g.classList.add("sidebar__item");g.classList.add("sidebar__toggle");g.classList.add("sidebar__reloadable");if(n)g.classList.add("sidebar__toggle--active");g.addEventListener("dblclick",function(){c.set(s.get());i.set(s.get())});t.onLoaded=t.onInit=function(){i.set(s.get())};const p=document.createElement("div");p.classList.add("sidebar__item-label");const d=document.createTextNode(r.get());p.appendChild(d);g.appendChild(p);const f=document.createElement("div");f.classList.add("icon_toggle");f.addEventListener("click",v);g.appendChild(f);const h=document.createElement("div");h.classList.add("sidebar__greyout");g.appendChild(h);h.style.display="none";a.onChange=_;r.onChange=I;s.onChange=T;i.onChange=O;t.onDelete=S;o.onTriggered=b;function b(){const e=i.get();s.set(e);c.set(e);if(CABLES.UI&&t.isCurrentUiOp())gui.opParams.show(t)}function v(){g.classList.toggle("sidebar__toggle--active");if(g.classList.contains("sidebar__toggle--active")){c.set(true);i.set(true);f.classList.add("icon_toggle_true");f.classList.remove("icon_toggle_false")}else{f.classList.remove("icon_toggle_true");f.classList.add("icon_toggle_false");c.set(false);i.set(false)}if(CABLES.UI&&t.isCurrentUiOp())gui.opParams.show(t)}function O(){const e=i.get();if(e){g.classList.add("sidebar__toggle--active");c.set(true)}else{g.classList.remove("sidebar__toggle--active");c.set(false)}}function T(){}function I(){const e=r.get();p.textContent=e;if(CABLES.UI)t.setTitle("Toggle: "+e)}function _(){m.set(null);const e=a.get();if(e&&e.parentElement){e.parentElement.appendChild(g);m.set(e)}else if(g.parentElement)g.parentElement.removeChild(g)}function x(e){if(e)e.style.display="block"}function E(e){if(e)e.style.display="none"}function S(){A(g)}function A(e){if(e&&e.parentNode&&e.parentNode.removeChild)e.parentNode.removeChild(e)}l.onChange=function(){h.style.display=l.get()?"block":"none"};u.onChange=function(){g.style.display=u.get()?"block":"none"}};Ops.Sidebar.Toggle_v3.prototype=new CABLES.Op;CABLES.OPS["fb60ab7d-f2f2-4fc5-bcd0-88c6ed481908"]={f:Ops.Sidebar.Toggle_v3,objName:"Ops.Sidebar.Toggle_v3"};Ops.Vars.VarSetNumber_v2=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};const n=e.inValueFloat("Value",0);e.varName=e.inDropDown("Variable",[],"",true);new CABLES.VarSetOpWrapper(e,"number",n,e.varName)};Ops.Vars.VarSetNumber_v2.prototype=new CABLES.Op;CABLES.OPS["b5249226-6095-4828-8a1c-080654e192fa"]={f:Ops.Vars.VarSetNumber_v2,objName:"Ops.Vars.VarSetNumber_v2"};Ops.Gl.Meshes.Cube_v2=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};const n=e.inTrigger("Render"),a=e.inValueBool("Render Mesh",true),o=e.inValue("Width",1),s=e.inValue("Length",1),l=e.inValue("Height",1),u=e.inValueBool("Center",true),m=e.inSwitch("Mapping",["Side","Cube +-"],"Side"),g=e.inValue("Bias",0),p=e.inValueBool("Flip X",true),c=e.inValueBool("Top",true),d=e.inValueBool("Bottom",true),f=e.inValueBool("Left",true),h=e.inValueBool("Right",true),b=e.inValueBool("Front",true),v=e.inValueBool("Back",true),r=e.outTrigger("Next"),O=e.outObject("geometry",null,"geometry");const T=e.patch.cgl;e.toWorkPortsNeedToBeLinked(n);e.setPortGroup("Mapping",[m,g,p]);e.setPortGroup("Geometry",[o,l,s,u]);e.setPortGroup("Sides",[c,d,f,h,b,v]);let I=null,_=null,x=true,E=true;g.onChange=p.onChange=c.onChange=d.onChange=f.onChange=h.onChange=b.onChange=v.onChange=m.onChange=o.onChange=l.onChange=s.onChange=u.onChange=i;function i(){E=true}n.onLinkChanged=function(){if(!n.isLinked()){O.set(null);return}S()};n.onTriggered=function(){if(E)S();if(a.get()&&_&&x)_.render(T.getShader());r.trigger()};e.preRender=function(){S();_.render(T.getShader())};function S(){if(!I)I=new CGL.Geometry("cubemesh");I.clear();let e=o.get();let t=-1*o.get();let n=l.get();let a=-1*l.get();let r=s.get();let i=-1*s.get();if(!u.get()){t=0;a=0;i=0}else{e*=.5;t*=.5;n*=.5;a*=.5;r*=.5;i*=.5}if(m.get()=="Side")A(I,e,n,r,t,a,i);else C(I,e,n,r,t,a,i);I.verticesIndices=[];if(c.get())I.verticesIndices.push(8,9,10,8,10,11);if(d.get())I.verticesIndices.push(12,13,14,12,14,15);if(f.get())I.verticesIndices.push(20,21,22,20,22,23);if(h.get())I.verticesIndices.push(16,17,18,16,18,19);if(v.get())I.verticesIndices.push(4,5,6,4,6,7);if(b.get())I.verticesIndices.push(0,1,2,0,2,3);if(I.verticesIndices.length===0)x=false;else x=true;if(_)_.dispose();_=new CGL.Mesh(T,I);O.set(null);O.set(I);E=false}e.onDelete=function(){if(_)_.dispose()};function A(e,t,n,a,r,i,o){e.vertices=[r,i,a,t,i,a,t,n,a,r,n,a,r,i,o,r,n,o,t,n,o,t,i,o,r,n,o,r,n,a,t,n,a,t,n,o,r,i,o,t,i,o,t,i,a,r,i,a,t,i,o,t,n,o,t,n,a,t,i,a,r,i,o,r,i,a,r,n,a,r,n,o];const s=g.get();let l=1;let u=0;if(p.get()){l=0;u=1}e.setTexCoords([u+s,1-s,l-s,1-s,l-s,0+s,u+s,0+s,l-s,1-s,l-s,0+s,u+s,0+s,u+s,1-s,u+s,0+s,u+s,1-s,l-s,1-s,l-s,0+s,l-s,0+s,u+s,0+s,u+s,1-s,l-s,1-s,l-s,1-s,l-s,0+s,u+s,0+s,u+s,1-s,u+s,1-s,l-s,1-s,l-s,0+s,u+s,0+s]);e.vertexNormals=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]);e.tangents=new Float32Array([-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1]);e.biTangents=new Float32Array([0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0])}function C(e,t,n,a,r,i,o){e.vertices=[r,i,a,t,i,a,t,n,a,r,n,a,r,i,o,r,n,o,t,n,o,t,i,o,r,n,o,r,n,a,t,n,a,t,n,o,r,i,o,t,i,o,t,i,a,r,i,a,t,i,o,t,n,o,t,n,a,t,i,a,r,i,o,r,i,a,r,n,a,r,n,o];const s=.25;const l=1/3;const u=g.get();let m=0;if(p.get())m=1;const c=[];c.push(m+s+u,l*2-u,m+s*2-u,l*2-u,m+s*2-u,l+u,m+s+u,l+u,m+s*4-u,l*2-u,m+s*4-u,l+u,m+s*3+u,l+u,m+s*3+u,l*2-u);if(p.get())c.push(s+u,0-u,s*2-u,0-u,s*2-u,l*1+u,s+u,l*1+u,s+u,l*3+u,s+u,l*2-u,s*2-u,l*2-u,s*2-u,l*3+u);else c.push(s+u,0+u,s+u,l*1-u,s*2-u,l*1-u,s*2-u,0+u,s+u,l*3-u,s*2-u,l*3-u,s*2-u,l*2+u,s+u,l*2+u);c.push(m+s*3-u,1-l-u,m+s*3-u,1-l*2+u,m+s*2+u,1-l*2+u,m+s*2+u,1-l-u,m+s*0+u,1-l-u,m+s*1-u,1-l-u,m+s*1-u,1-l*2+u,m+s*0+u,1-l*2+u);e.setTexCoords(c);e.vertexNormals=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0];e.tangents=new Float32Array([-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1]);e.biTangents=new Float32Array([0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0])}};Ops.Gl.Meshes.Cube_v2.prototype=new CABLES.Op;CABLES.OPS["37b92ba4-cea5-42ae-bf28-a513ca28549c"]={f:Ops.Gl.Meshes.Cube_v2,objName:"Ops.Gl.Meshes.Cube_v2"};Ops.Math.Sum=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};const n=e.inValueFloat("number1",1),a=e.inValueFloat("number2",1),r=e.outValue("result");n.onChange=a.onChange=i;i();function i(){const e=n.get()+a.get();if(!isNaN(e))r.set(e)}};Ops.Math.Sum.prototype=new CABLES.Op;CABLES.OPS["c8fb181e-0b03-4b41-9e55-06b6267bc634"]={f:Ops.Math.Sum,objName:"Ops.Math.Sum"};Ops.Ui.Comment_v2=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};const n=e.inString("title","New comment"),a=e.inTextarea("text");n.setUiAttribs({hidePort:true});a.setUiAttribs({hidePort:true});e.init=n.onChange=a.onChange=e.onLoaded=r;r();function r(){if(CABLES.UI){e.uiAttr({comment_title:n.get(),comment_text:a.get()});e.name=n.get()}}};Ops.Ui.Comment_v2.prototype=new CABLES.Op;CABLES.OPS["93492eeb-bf35-4a62-98f7-d85b0b79bfe5"]={f:Ops.Ui.Comment_v2,objName:"Ops.Ui.Comment_v2"};Ops.Sidebar.Button_v2=function(){CABLES.Op.apply(this,arguments);const t=this;const e={};const n=t.inObject("link");const a=t.inString("Text","Button");const r=t.outObject("childs");const i=t.outTrigger("Pressed Trigger");const o=t.inBool("Grey Out",false);const s=t.inBool("Visible",true);const l=document.createElement("div");l.dataset.op=t.id;l.classList.add("cablesEle");l.classList.add("sidebar__item");l.classList.add("sidebar--button");const u=document.createElement("div");u.classList.add("sidebar__button-input");l.appendChild(u);u.addEventListener("click",g);const m=document.createTextNode(a.get());u.appendChild(m);t.toWorkNeedsParent("Ops.Sidebar.Sidebar");n.onChange=d;a.onChange=p;t.onDelete=b;const c=document.createElement("div");c.classList.add("sidebar__greyout");l.appendChild(c);c.style.display="none";o.onChange=function(){c.style.display=o.get()?"block":"none"};s.onChange=function(){l.style.display=s.get()?"block":"none"};function g(){i.trigger()}function p(){const e=a.get();u.textContent=e;if(CABLES.UI){t.setTitle("Button: "+e)}}function d(){r.set(null);const e=n.get();if(e&&e.parentElement){e.parentElement.appendChild(l);r.set(e)}else{if(l.parentElement){l.parentElement.removeChild(l)}}}function f(e){if(e){e.style.display="block"}}function h(e){if(e){e.style.display="none"}}function b(){v(l)}function v(e){if(e&&e.parentNode&&e.parentNode.removeChild){e.parentNode.removeChild(e)}}};Ops.Sidebar.Button_v2.prototype=new CABLES.Op;CABLES.OPS["5e9c6933-0605-4bf7-8671-a016d917f327"]={f:Ops.Sidebar.Button_v2,objName:"Ops.Sidebar.Button_v2"};Ops.Gl.Geometry.GeometryInfo=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};const n=e.inObject("Geometry",null,"geometry"),a=e.outValue("Indexed",false),r=e.outValue("Faces"),i=e.outValue("Vertices"),o=e.outValue("Normals"),s=e.outValue("TexCoords"),l=e.outValue("Tangents"),u=e.outValue("BiTangents"),m=e.outValue("VertexColors"),c=e.outValue("Other Attributes");n.onLinkChanged=()=>{};n.onChange=function(){let e=n.get();if(e){const t=e.getInfo();r.set(t.Faces);i.set(t.numVerts);o.set(t.numNormals);s.set(t.numTexCoords);l.set(t.numTangents);u.set(t.numBiTangents);m.set(t.numVertexColors);c.set(t.numAttribs);a.set(t.isIndexed)}else{a.set(null);r.set(null);i.set(null);o.set(null);s.set(null);l.set(null);u.set(null);m.set(null);c.set(null)}}};Ops.Gl.Geometry.GeometryInfo.prototype=new CABLES.Op;CABLES.OPS["a9208e84-e957-43ac-9a79-9c719eff95eb"]={f:Ops.Gl.Geometry.GeometryInfo,objName:"Ops.Gl.Geometry.GeometryInfo"};Ops.User.kikohs.PLYLoader=function(){CABLES.Op.apply(this,arguments);const r=this;const e={};const i=r.inUrl("PLY File",[".ply"]);const t=r.inBool("Auto-load",false);const n=r.inObject("Custom Property map");const a=r.inTriggerButton("Reload");const o=r.outTrigger("Loaded");const s=r.outObject("Geometry");const l=r.outBool("Loading");const u=r.outBool("Is Point Cloud?");const m=r.outString("Error");const c=r.patch.cgl;let g=null;let p=null;let d=false;let f={};i.onChange=()=>{if(t.get())T(true)};a.onTriggered=T;n.onChange=h;function h(){const e=n.get();if(e){f=e}else{f={}}}function b(e){function t(e){const t=/^ply([\s\S]*)end_header\r?\n/;let n="";let a=0;const r=t.exec(e);if(r!==null){n=r[1];a=new Blob([r[0]]).size}const i={comments:[],elements:[],headerLength:a,objInfo:""};const o=n.split("\n");let s;function l(e,t){const n={type:e[0]};if(n.type==="list"){n.name=e[3];n.countType=e[1];n.itemType=e[2]}else{n.name=e[1]}if(n.name in t){n.name=t[n.name]}return n}for(let t=0;t<o.length;t++){let e=o[t];e=e.trim();if(e==="")continue;const u=e.split(/\s+/);const m=u.shift();e=u.join(" ");switch(m){case"format":i.format=u[0];i.version=u[1];break;case"comment":i.comments.push(e);break;case"element":if(s!==undefined){i.elements.push(s)}s={};s.name=u[0];s.count=parseInt(u[1]);s.properties=[];break;case"property":s.properties.push(l(u,f));break;case"obj_info":i.objInfo=e;break;default:console.log("unhandled",m,u)}}if(s!==undefined){i.elements.push(s)}return i}function s(e,t){switch(t){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":return parseInt(e);case"float":case"double":case"float32":case"float64":return parseFloat(e)}}function m(n,e){const a=e.split(/\s+/);const r={};for(let t=0;t<n.length;t++){if(n[t].type==="list"){const i=[];const o=s(a.shift(),n[t].countType);for(let e=0;e<o;e++){i.push(s(a.shift(),n[t].itemType))}r[n[t].name]=i}else{r[n[t].name]=s(a.shift(),n[t].type)}}return r}function n(e,n){const a={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[]};let t;const r=/end_header\s([\s\S]*)$/;let i="";if((t=r.exec(e))!==null){i=t[1]}const o=i.split("\n");let s=0;let l=0;for(let t=0;t<o.length;t++){let e=o[t];e=e.trim();if(e===""){continue}if(l>=n.elements[s].count){s++;l=0}const u=m(n.elements[s].properties,e);c(a,n.elements[s].name,u);l++}return a}function c(e,t,r){function n(n){for(let e=0,t=n.length;e<t;e++){const a=n[e];if(a in r)return a}return null}const a=n(["x","px","posx"])||"x";const i=n(["y","py","posy"])||"y";const o=n(["z","pz","posz"])||"z";const s=n(["nx","normalx"]);const l=n(["ny","normaly"]);const u=n(["nz","normalz"]);const m=n(["s","u","texture_u","tx"]);const c=n(["t","v","texture_v","ty"]);const g=n(["red","diffuse_red","r","diffuse_r"]);const p=n(["green","diffuse_green","g","diffuse_g"]);const d=n(["blue","diffuse_blue","b","diffuse_b"]);if(t==="vertex"){e.vertices.push(r[a],r[i],r[o]);if(s!==null&&l!==null&&u!==null){e.normals.push(r[s],r[l],r[u])}if(m!==null&&c!==null){e.uvs.push(r[m],r[c])}if(g!==null&&p!==null&&d!==null){e.colors.push(r[g]/255,r[p]/255,r[d]/255)}}else if(t==="face"){const f=r.vertex_indices||r.vertex_index;const h=r.texcoord;if(f.length===3){e.indices.push(f[0],f[1],f[2]);if(h&&h.length===6){e.faceVertexUvs.push(h[0],h[1]);e.faceVertexUvs.push(h[2],h[3]);e.faceVertexUvs.push(h[4],h[5])}}else if(f.length===4){e.indices.push(f[0],f[1],f[3]);e.indices.push(f[1],f[2],f[3])}}}function g(e,t,n,a){switch(n){case"int8":case"char":return[e.getInt8(t),1];case"uint8":case"uchar":return[e.getUint8(t),1];case"int16":case"short":return[e.getInt16(t,a),2];case"uint16":case"ushort":return[e.getUint16(t,a),2];case"int32":case"int":return[e.getInt32(t,a),4];case"uint32":case"uint":return[e.getUint32(t,a),4];case"float32":case"float":return[e.getFloat32(t,a),4];case"float64":case"double":return[e.getFloat64(t,a),8]}}function u(n,a,r,i){const e={};let o,s=0;for(let t=0;t<r.length;t++){if(r[t].type==="list"){const l=[];o=g(n,a+s,r[t].countType,i);const u=o[0];s+=o[1];for(let e=0;e<u;e++){o=g(n,a+s,r[t].itemType,i);l.push(o[0]);s+=o[1]}e[r[t].name]=l}else{o=g(n,a+s,r[t].type,i);e[r[t].name]=o[0];s+=o[1]}}return[e,s]}function a(e,n){const a={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[]};const r=n.format==="binary_little_endian";const i=new DataView(e,n.headerLength);let o,s=0;for(let t=0;t<n.elements.length;t++){for(let e=0;e<n.elements[t].count;e++){o=u(i,s,n.elements[t].properties,r);s+=o[1];const l=o[0];c(a,n.elements[t].name,l)}}return a}function r(n){if(typeof TextDecoder!=="undefined"){return(new TextDecoder).decode(n)}let a="";for(let e=0,t=n.length;e<t;e++){a+=String.fromCharCode(n[e])}try{return decodeURIComponent(escape(a))}catch(e){return a}}let i=null;if(e instanceof ArrayBuffer){const o=r(new Uint8Array(e));const l=t(o);i=l.format==="ascii"?n(o,l):a(e,l)}else{i=n(e,t(e))}return i}function v(t){function e(e){if(e<=0)return 0;else if(e>=1)return 1;else if(e<.04045)return e/12.92;else return Math.pow((e+.055)/1.055,2.4)}function n(e){if(e<=0)return 0;else if(e>=1)return 1;else if(e<.0031308)return e*12.92;else return Math.pow(e,1/2.2)*1.055-.055}let a=new CGL.Geometry("PLYLoader");a.clear();a.verticesIndices=t.indices;a.setVertices(t.vertices);a.vertexNormals=new Float32Array(t.normals);a.setTexCoords(t.uvs);a.texCoordsIndices=t.faceVertexUvs;a.vertexColors.length=t.colors.length/3*4;for(let e=0;e<t.colors.length/3;e++){a.vertexColors[e*4]=t.colors[e*3];a.vertexColors[e*4+1]=t.colors[e*3+1];a.vertexColors[e*4+2]=t.colors[e*3+2];a.vertexColors[e*4+3]=1}a.calculateNormals();return a}function O(n){m.set(null);s.set(null);try{let e=b(n);let t=v(e);t.verticesIndices.length>0?u.set(false):u.set(true);s.set(t)}catch(e){r.logError(e);s.set(null);m.set(e)}c.patch.loading.finished(g);d=true;l.set(false);o.trigger()}function T(e){clearTimeout(p);p=setTimeout(()=>{I(e)},30)}function I(e){let t=r.patch.getFilePath(String(i.get()));const n=t.split("?")[0];if(!n.endsWith(".ply")){l.set(false);u.set(false);s.set(null);m.set("Not PLY file");return}if(!g)g=r.patch.loading.start("ply"+i.get(),i.get());if(e)t+="?rnd="+CABLES.generateUUID();d=false;l.set(true);const a=new XMLHttpRequest;a.open("GET",t,true);a.responseType="arraybuffer";r.patch.loading.addAssetLoadingTask(()=>{a.onload=e=>{O(a.response)};a.send(null)})}};Ops.User.kikohs.PLYLoader.prototype=new CABLES.Op;Ops.User.kikohs.DropDown_withReset=function(){CABLES.Op.apply(this,arguments);const t=this;const e={};const n=t.inObject("Link");const a=t.inString("Text","Value");const r=t.inArray("Values");const i=t.inString("Default","");const o=t.inBool("Grey Out",false);const s=t.inBool("Visible",true);const l=t.inInt("Lines",1);const u=t.inTriggerButton("Reset");const m=t.outObject("Children");const c=t.outString("Result",i.get());const g=t.outNumber("Index");const p=document.createElement("div");function d(){c.set(i.get());const e=b.querySelectorAll("option");e.forEach(function(e,t){if(e.value.trim()===i.get()){e.selected=true;g.set(t)}else{e.removeAttribute("selected")}})}p.addEventListener("dblclick",d);p.dataset.op=t.id;p.classList.add("cablesEle");p.classList.add("sidebar__item");p.classList.add("sidebar__select");p.classList.add("sidebar__reloadable");const f=document.createElement("div");f.classList.add("sidebar__item-label");const h=document.createTextNode(a.get());f.appendChild(h);p.appendChild(f);const b=document.createElement("select");b.classList.add("sidebar__select-select");p.appendChild(b);b.addEventListener("input",x);const v=document.createElement("div");v.classList.add("sidebar__greyout");p.appendChild(v);v.style.display="none";o.onChange=function(){v.style.display=o.get()?"block":"none"};s.onChange=function(){p.style.display=s.get()?"block":"none"};n.onChange=A;a.onChange=S;i.onChange=E;t.onDelete=N;r.onChange=T;let O=[];l.onChange=()=>{b.setAttribute("size",l.get())};t.onLoaded=function(){c.set(i.get())};u.onTriggered=d;function T(){while(b.lastChild){b.removeChild(b.lastChild)}O=r.get();const a=i.get();if(O){O.forEach(function(e){const t=document.createElement("option");t.setAttribute("value",e);if(e===a||e===c.get()){t.setAttribute("selected","")}const n=document.createTextNode(e);t.appendChild(n);b.appendChild(t)})}else{c.set("")}g.set(0);_()}let I=0;function _(e){const t=b.querySelectorAll("option");let n=null;t.forEach(function(e,t){if(e.value.trim()===c.get()){n=e;I=t}e.removeAttribute("selected")});if(e){const a=i.get()+"".trim();t.forEach(function(e,t){if(e.value.trim()===a){n=e;I=t}e.removeAttribute("selected")})}if(n)n.setAttribute("selected","");g.set(I)}function x(e){c.set(e.target.value);g.set(O.indexOf(e.target.value));_()}function E(){const e=i.get();c.set(e);b.value=e;_()}function S(){const e=a.get();f.textContent=e;if(CABLES.UI){t.setTitle("Dropdown: "+e)}}function A(){m.set(null);const e=n.get();if(e&&e.parentElement){e.parentElement.appendChild(p);m.set(e)}else{if(p.parentElement){p.parentElement.removeChild(p)}}}function C(e){if(e){e.style.display="block"}_()}function L(e){if(e){e.style.display="none"}}function N(){P(p)}function P(e){if(e&&e.parentNode&&e.parentNode.removeChild){e.parentNode.removeChild(e)}}};Ops.User.kikohs.DropDown_withReset.prototype=new CABLES.Op;Ops.Vars.VarSetArray_v2=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};const n=e.inArray("Value",null);e.varName=e.inDropDown("Variable",[],"",true);new CABLES.VarSetOpWrapper(e,"array",n,e.varName)};Ops.Vars.VarSetArray_v2.prototype=new CABLES.Op;CABLES.OPS["8088290f-45d4-4312-b4ca-184d34ca4667"]={f:Ops.Vars.VarSetArray_v2,objName:"Ops.Vars.VarSetArray_v2"};Ops.Math.Compare.GreaterThan=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};const n=e.outValue("result"),a=e.inValueFloat("number1"),r=e.inValueFloat("number2");a.onChange=r.onChange=i;function i(){n.set(a.get()>r.get())}};Ops.Math.Compare.GreaterThan.prototype=new CABLES.Op;CABLES.OPS["b250d606-f7f8-44d3-b099-c29efff2608a"]={f:Ops.Math.Compare.GreaterThan,objName:"Ops.Math.Compare.GreaterThan"};Ops.Boolean.IfTrueThen_v2=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};const n=e.inTrigger("exe"),a=e.inValueBool("boolean",false),r=e.outTrigger("then"),i=e.outTrigger("else");n.onTriggered=o;function o(){if(a.get())r.trigger();else i.trigger()}};Ops.Boolean.IfTrueThen_v2.prototype=new CABLES.Op;CABLES.OPS["9549e2ed-a544-4d33-a672-05c7854ccf5d"]={f:Ops.Boolean.IfTrueThen_v2,objName:"Ops.Boolean.IfTrueThen_v2"};Ops.Cables.AssetPathURL=function(){CABLES.Op.apply(this,arguments);const n=this;const e={};const a=n.inString("Filename",""),r=n.outString("Path");a.onChange=t;t();function t(){let e=a.get();if(!a.get()){r.set("");return}e=n.patch.getAssetPath()+e;let t=n.patch.getFilePath(e);r.set(t)}};Ops.Cables.AssetPathURL.prototype=new CABLES.Op;CABLES.OPS["e502ae39-c87e-4516-9e78-cb71333bcfff"]={f:Ops.Cables.AssetPathURL,objName:"Ops.Cables.AssetPathURL"};Ops.Trigger.TriggerOnce=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};const n=e.inTriggerButton("Exec"),a=e.inTriggerButton("Reset"),r=e.outTrigger("Next");var i=e.outValue("Was Triggered");var o=false;e.toWorkPortsNeedToBeLinked(n);a.onTriggered=function(){o=false;i.set(o)};n.onTriggered=function(){if(o)return;o=true;r.trigger();i.set(o)}};Ops.Trigger.TriggerOnce.prototype=new CABLES.Op;CABLES.OPS["cf3544e4-e392-432b-89fd-fcfb5c974388"]={f:Ops.Trigger.TriggerOnce,objName:"Ops.Trigger.TriggerOnce"};Ops.String.ParseInt_v2=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};const n=e.inString("String",5711),a=e.outValue("Number");n.onChange=function(){var e=parseInt(n.get());if(e!=e)e=0;a.set(e)}};Ops.String.ParseInt_v2.prototype=new CABLES.Op;CABLES.OPS["6d208424-daf2-4a2b-874f-daac406c1f66"]={f:Ops.String.ParseInt_v2,objName:"Ops.String.ParseInt_v2"};Ops.String.FilterValidString=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};const n=e.inString("String",""),a=e.inBool("Invalid if null",true),r=e.inBool("Invalid if undefined",true),i=e.inBool("Invalid if empty",true),o=e.inBool("Invalid if 0",true),s=e.outString("Last Valid String"),l=e.outBool("Is Valid");n.onChange=a.onChange=r.onChange=i.onChange=function(){const e=n.get();var t=true;if(t===false)t=false;if(t&&o.get()&&(e===0||e==="0"))t=false;if(t&&a.get()&&e===null)t=false;if(t&&r.get()&&e===undefined)t=false;if(t&&i.get()&&e==="")t=false;if(t)s.set(e);l.set(t)}};Ops.String.FilterValidString.prototype=new CABLES.Op;CABLES.OPS["a522235d-f220-46ea-bc26-13a5b20ec8c6"]={f:Ops.String.FilterValidString,objName:"Ops.String.FilterValidString"};Ops.Values.SequenceNumbers=function(){CABLES.Op.apply(this,arguments);const t=this;const e={};const n=[];const a=[];for(let e=0;e<16;e++){const r=t.inFloat("Number "+e,0);const i=t.outNumber("Output "+e);r.changeAlways=true;n.push(i);a.push(r)}for(let e=0;e<a.length;e++){const r=a[e];r.onChange=function(){for(let e=0;e<n.length;e++)n[e].set(r.get())}}};Ops.Values.SequenceNumbers.prototype=new CABLES.Op;CABLES.OPS["98e8a6cf-1f2f-4cb8-9e33-e5189e3d70ce"]={f:Ops.Values.SequenceNumbers,objName:"Ops.Values.SequenceNumbers"};Ops.Vars.VarTriggerNumber=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};const n=e.inValueFloat("Value",0),a=e.inTriggerButton("Trigger"),r=e.outTrigger("Next");e.varName=e.inDropDown("Variable",[],"",true);new CABLES.VarSetOpWrapper(e,"number",n,e.varName,a,r)};Ops.Vars.VarTriggerNumber.prototype=new CABLES.Op;CABLES.OPS["2c29baf0-2af2-486d-9218-4299594ee9c1"]={f:Ops.Vars.VarTriggerNumber,objName:"Ops.Vars.VarTriggerNumber"};Ops.Sidebar.Slider_v3=function(){CABLES.Op.apply(this,arguments);const r=this;const e={};const t=1e-5;const n=r.inObject("link");const a=r.inString("Text","Slider");const i=r.inValue("Min",0);const o=r.inValue("Max",1);const s=r.inValue("Step",t);const l=r.inString("Suffix","");const u=r.inBool("Grey Out",false);const m=r.inBool("Visible",true);const c=r.inValue("Input",.5);const g=r.inTriggerButton("Set Default");const p=r.inTriggerButton("Reset");let d=null;const f=r.inValue("Default",.5);f.setUiAttribs({hidePort:true,greyout:true});const h=r.outObject("childs");const b=r.outValue("Result",f.get());r.toWorkNeedsParent("Ops.Sidebar.Sidebar");r.setPortGroup("Range",[i,o,s]);r.setPortGroup("Display",[u,m]);const v=document.createElement("div");v.addEventListener("dblclick",function(){b.set(parseFloat(f.get()));c.set(parseFloat(f.get()))});v.dataset.op=r.id;v.classList.add("cablesEle");v.classList.add("sidebar__item");v.classList.add("sidebar__slider");v.classList.add("sidebar__reloadable");r.patch.on("sidebarStylesChanged",()=>{y()});const O=document.createElement("div");O.classList.add("sidebar__item-label");const T=document.createElement("div");T.classList.add("sidebar__greyout");v.appendChild(T);T.style.display="none";const I=document.createTextNode(a.get());O.appendChild(I);v.appendChild(O);const _=document.createElement("input");_.value=f.get();_.classList.add("sidebar__text-input-input");_.setAttribute("type","text");_.oninput=C;v.appendChild(_);const x=document.createElement("span");v.appendChild(x);l.onChange=()=>{x.innerHTML=l.get()};const E=document.createElement("div");E.classList.add("sidebar__slider-input-wrapper");v.appendChild(E);const S=document.createElement("div");S.classList.add("sidebar__slider-input-active-track");E.appendChild(S);const A=document.createElement("input");A.classList.add("sidebar__slider-input");A.setAttribute("min",i.get());A.setAttribute("max",o.get());A.setAttribute("type","range");A.setAttribute("step",s.get());A.setAttribute("value",f.get());A.style.display="block";E.appendChild(A);y();A.addEventListener("input",P);n.onChange=U;a.onChange=w;c.onChange=L;f.onChange=R;g.onTriggered=N;i.onChange=j;o.onChange=G;s.onChange=M;r.onDelete=F;r.onLoaded=r.onInit=function(){if(r.patch.config.sidebar){r.patch.config.sidebar[a.get()];b.set(r.patch.config.sidebar[a.get()])}else{b.set(parseFloat(f.get()));c.set(parseFloat(f.get()))}};p.onTriggered=function(){const e=parseFloat(f.get());b.set(e);B(e);D(e);c.set(e);y()};u.onChange=function(){T.style.display=u.get()?"block":"none"};m.onChange=function(){v.style.display=m.get()?"block":"none"};function C(e){let t=parseFloat(e.target.value);if(isNaN(t))t=0;const n=i.get();const a=o.get();if(t<n){t=n}else if(t>a){t=a}b.set(t);y();c.set(t);if(r.isCurrentUiOp())gui.opParams.show(r)}function L(){let e=parseFloat(c.get());const t=i.get();const n=o.get();if(e>n){e=n}else if(e<t){e=t}B(e);D(e);b.set(e);y()}function N(){let e=parseFloat(c.get());const t=i.get();const n=o.get();if(e>n){e=n}else if(e<t){e=t}B(e);D(e);b.set(e);f.set(e);if(r.isCurrentUiOp())gui.opParams.show(r);y()}function P(e){e.preventDefault();e.stopPropagation();B(e.target.value);const t=parseFloat(e.target.value);b.set(t);c.set(t);if(r.isCurrentUiOp())gui.opParams.show(r);y();return false}function M(){const e=s.get();A.setAttribute("step",e);y()}function y(e){let t=parseFloat(A.value);if(typeof e!=="undefined")t=e;let n=S.parentElement.getBoundingClientRect().width||220;if(d)n=parseInt(getComputedStyle(d.parentElement).getPropertyValue("--sidebar-width"))-20;const a=CABLES.map(t,parseFloat(A.min),parseFloat(A.max),0,n-16);S.style.width=a+"px"}function j(){const e=i.get();A.setAttribute("min",e);y()}function G(){const e=o.get();A.setAttribute("max",e);y()}function R(){const e=f.get();b.set(parseFloat(e));j();G();D(e);B(e);y(e)}function w(){const e=a.get();O.textContent=e;if(CABLES.UI)r.setTitle("Slider: "+e)}function U(){h.set(null);d=n.get();if(d&&d.parentElement){d.parentElement.appendChild(v);h.set(d)}else if(v.parentElement)v.parentElement.removeChild(v);y()}function B(e){_.value=e}function D(e){A.value=e}function k(e){if(e)e.style.display="block"}function V(e){if(e)e.style.display="none"}function F(){z(v)}function z(e){if(e&&e.parentNode&&e.parentNode.removeChild)e.parentNode.removeChild(e)}};Ops.Sidebar.Slider_v3.prototype=new CABLES.Op;CABLES.OPS["74730122-5cba-4d0d-b610-df334ec6220a"]={f:Ops.Sidebar.Slider_v3,objName:"Ops.Sidebar.Slider_v3"};Ops.Math.Compare.Equals=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};const n=e.inValue("number1",1);const a=e.inValue("number2",1);const r=e.outValue("result");n.onChange=i;a.onChange=i;i();function i(){r.set(n.get()==a.get())}};Ops.Math.Compare.Equals.prototype=new CABLES.Op;CABLES.OPS["4dd3cc55-eebc-4187-9d4e-2e053a956fab"]={f:Ops.Math.Compare.Equals,objName:"Ops.Math.Compare.Equals"};Ops.Boolean.And=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};const n=e.inValueBool("bool 1"),a=e.inValueBool("bool 2"),r=e.outValueBool("result");n.onChange=a.onChange=i;function i(){r.set(a.get()&&n.get())}};Ops.Boolean.And.prototype=new CABLES.Op;CABLES.OPS["c26e6ce0-8047-44bb-9bc8-5a4f911ed8ad"]={f:Ops.Boolean.And,objName:"Ops.Boolean.And"};Ops.Json.ObjectGetArrayValuesByPath=function(){CABLES.Op.apply(this,arguments);const c=this;const e={};const t=c.inObject("Object");const g=c.inString("Path");const p=c.outArray("Output");const d=c.outBool("Found");t.onChange=n;g.onChange=n;function n(){const i=t.get();let o=[];const e=g.get();c.setUiError("path",null);if(i&&e){if(typeof i!=="object"){d.set(false);c.setUiError("notiterable","input object of type "+typeof i+" is not travesable by path")}else if(Array.isArray(i)){d.set(false);c.setUiError("notiterable","input of type "+typeof i+" is not an object")}else{c.setUiError("notiterable",null);const s=e.split(".");d.set(false);let t="";let n="";let a="";let r=null;for(let e=0;e<s.length;e++){t+=s[e];r=f(t,i);if(Array.isArray(r)){n=t;a=s.splice(e+2,s.length-(e+2)).join(".");break}t+="."}if(r){if(s.length>1){for(let t=0;t<r.length;t++){let e=n+"."+t;if(a&&a!==""){e+="."+a}const m=f(e,i);if(typeof m!=="undefined"){d.set(true)}o.push(m)}}else{if(Array.isArray(r)){o=r}else{o=[r]}d.set(true)}const l=g.get().split(".");const u=l[l.length-1]+"";c.setUiAttrib({extendTitle:u})}if(d.get()){p.set(o)}else{c.setUiError("path","given path seems to be invalid!",1);p.set([])}}}else{d.set(false)}}function f(e,t=self,n="."){const a=Array.isArray(e)?e:e.split(n);return a.reduce((e,t)=>e&&e[t],t)}};Ops.Json.ObjectGetArrayValuesByPath.prototype=new CABLES.Op;CABLES.OPS["609a645e-5e24-4a5e-a379-804c5b64f5d5"]={f:Ops.Json.ObjectGetArrayValuesByPath,objName:"Ops.Json.ObjectGetArrayValuesByPath"};Ops.Vars.VarGetArray_v2=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};const n=e.outArray("Value");e.varName=e.inValueSelect("Variable",[],"",true);new CABLES.VarGetOpWrapper(e,"array",e.varName,n)};Ops.Vars.VarGetArray_v2.prototype=new CABLES.Op;CABLES.OPS["afa79294-aa9c-43bc-a49a-cade000a1de5"]={f:Ops.Vars.VarGetArray_v2,objName:"Ops.Vars.VarGetArray_v2"};Ops.Array.FilterValidArray=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};const n=e.inArray("Array"),a=e.inBool("Invalid when length is 0",true),r=e.outArray("Last Valid Array"),i=e.outBool("Is Valid");a.onChange=n.onChange=o;function o(){const e=n.get();let t=true;if(!e||!e.length)t=false;else if(a.get()&&e.length==0)t=false;if(t){r.set([]);r.set(e)}i.set(t)}};Ops.Array.FilterValidArray.prototype=new CABLES.Op;CABLES.OPS["f2669593-eb06-48a6-b94c-4bc243747ee1"]={f:Ops.Array.FilterValidArray,objName:"Ops.Array.FilterValidArray"};Ops.Array.CutArray=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};const o=e.inArray("Source Array");const s=e.inInt("Remove from Start");const l=e.inInt("Remove From End");const u=e.outArray("Cut Array");const m=e.outNumber("Array Length");s.onChange=l.onChange=o.onChange=n;function n(){const t=o.get();if(!t){u.set(null);m.set(0);return}const n=t.length;const a=Math.max(0,Number(s.get()));const r=Math.max(0,Number(l.get()));const i=[];for(let e=a;e<n-r;e+=1){i.push(t[e])}u.set(null);u.set(i);m.set(i.length)}};Ops.Array.CutArray.prototype=new CABLES.Op;CABLES.OPS["9e6ea32a-3f5d-417a-b437-05c59d47c56e"]={f:Ops.Array.CutArray,objName:"Ops.Array.CutArray"};Ops.Gl.GLTF.GltfNode_v2=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};const n=e.inTrigger("Render"),a=e.inString("Node Name"),r=e.inBool("Transformation",true),i=e.inBool("Draw Mesh",true),o=e.inBool("Draw Childs",true),s=e.inBool("Ignore Material",true),l=e.inBool("Use Scene Time",true),u=e.inFloat("Time",0),m=e.outTrigger("Next"),c=e.outObject("Geometry",null,"geometry"),g=e.outBool("Found");const p=e.patch.cgl;let d=null;let f=null;a.onChange=function(){c.set(null);d=null;g.set(false);e.setUiAttrib({extendTitle:a.get()})};l.onChange=h;h();function h(){u.setUiAttribs({greyout:l.get()})}n.onTriggered=function(){if(!p.frameStore.currentScene)return;if(f!=p.frameStore.currentScene.loaded)d=null;if(!d){const t=a.get();if(!p.frameStore||!p.frameStore.currentScene||!p.frameStore.currentScene.nodes){return}f=p.frameStore.currentScene.loaded;for(let e=0;e<p.frameStore.currentScene.nodes.length;e++){if(p.frameStore.currentScene.nodes[e].name==t){d=p.frameStore.currentScene.nodes[e];g.set(true);if(d&&d.mesh&&d.mesh.meshes&&d.mesh.meshes[0].geom)c.set(d.mesh.meshes[0].geom);else c.set(null)}}}p.pushModelMatrix();if(d){if(r.get()){p.pushModelMatrix();d.transform(p)}let e;if(!l.get())e=u.get();d.render(p,!r.get(),!i.get(),s.get(),!o.get(),true,e)}m.trigger();if(d){if(r.get())p.popModelMatrix()}p.popModelMatrix()}};Ops.Gl.GLTF.GltfNode_v2.prototype=new CABLES.Op;CABLES.OPS["10d09387-0085-4162-ab5b-b89eebbf3cf4"]={f:Ops.Gl.GLTF.GltfNode_v2,objName:"Ops.Gl.GLTF.GltfNode_v2"};Ops.Gl.Geometry.GeometryBoundingBox=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};const n=e.inObject("Geometry"),a=e.outObject("Boundings"),r=e.outNumber("Min X"),i=e.outNumber("Min Y"),o=e.outNumber("Min Z"),s=e.outNumber("Max X"),l=e.outNumber("Max Y"),u=e.outNumber("Max Z"),m=e.outArray("MaxMin Points");const c=[];n.onChange=()=>{const e=new CGL.BoundingBox(n.get());a.set(e);r.set(e._min[0]);i.set(e._min[1]);o.set(e._min[2]);s.set(e._max[0]);l.set(e._max[1]);u.set(e._max[2]);c.length=0;c.push(e._max[0],e._max[1],e._max[2],e._max[0],e._min[1],e._max[2],e._min[0],e._min[1],e._max[2],e._min[0],e._max[1],e._max[2],e._max[0],e._max[1],e._min[2],e._max[0],e._min[1],e._min[2],e._min[0],e._min[1],e._min[2],e._min[0],e._max[1],e._min[2],e._center[0],e._center[1],e._center[2]);m.set(null);m.set(c)}};Ops.Gl.Geometry.GeometryBoundingBox.prototype=new CABLES.Op;CABLES.OPS["7c13487b-87b2-40c9-b363-c5f699968579"]={f:Ops.Gl.Geometry.GeometryBoundingBox,objName:"Ops.Gl.Geometry.GeometryBoundingBox"};Ops.String.Concat_v2=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};var a=e.inString("string1","ABC");var r=e.inString("string2","XYZ");var i=e.inValueBool("New Line",false);var o=e.outString("result");i.onChange=r.onChange=a.onChange=n;n();function n(){var e=a.get();var t=r.get();if(!e&&!t){o.set("");return}if(!e)e="";if(!t)t="";var n="";if(e&&t&&i.get())n="\n";o.set(String(e)+n+String(t))}};Ops.String.Concat_v2.prototype=new CABLES.Op;CABLES.OPS["a52722aa-0ca9-402c-a844-b7e98a6c6e60"]={f:Ops.String.Concat_v2,objName:"Ops.String.Concat_v2"};Ops.User.kikohs.NumberFormatter=function(){CABLES.Op.apply(this,arguments);const a=this;const e={};const r=a.inValue("Input Number");const i=a.inSwitch("Locale",["browser","custom"],"browser");const o=a.inString("Locale string","");const s=a.inSwitch("Style",["decimal","currency","percent"],"decimal");const l=a.inInt("Maximum Fraction Digits",3);const u=a.inInt("Maximum Significant Digits",21);const m=a.inInt("Minimum Fraction Digits",3);const c=a.inInt("Minimum Integer Digits",1);const g=a.inInt("Minimum Significant Digits",21);const p=a.inBool("Use Grouping",true);const d=a.inString("Currency Name","EUR");const f=a.inSwitch("Currency Display",["symbol","code","name"],"symbol");a.setPortGroup("Currency",[d,f]);const h=a.outString("Formatted Number");const b=a.outBool("Has error");r.onChange=o.onChange=s.onChange=l.onChange=u.onChange=m.onChange=c.onChange=g.onChange=p.onChange=d.onChange=f.onChange=i.onChange=t;function v(e,t,n){if(e<t)e=t;if(e>n)e=n;return e}function t(){const t=r.get();const e=s.get();let n={style:e,maximumFractionDigits:v(l.get(),0,20),maximumSignificantDigits:v(u.get(),1,21),minimumFractionDigits:v(m.get(),0,20),minimumIntegerDigits:v(c.get(),1,21),minimumSignificantDigits:v(g.get(),1,21),useGrouping:p.get()};if(e==="currency"){n["currency"]=d.get();n["currencyDisplay"]=f.get()}try{let e="";if(i.get()==="browser")e=t.toLocaleString(undefined,n);else e=t.toLocaleString(o.get(),n);h.set(e);if(b.get())a.setUiError("format_error",null);b.set(false)}catch(e){b.set(true);h.set("");a.setUiError("format_error",e)}}};Ops.User.kikohs.NumberFormatter.prototype=new CABLES.Op;Ops.Cables.UIMode=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};const n=e.outBool("UI",e.patch.isEditorMode());const a=e.outBool("Remote Viewer",window.gui?window.gui.isRemoteClient:false)};Ops.Cables.UIMode.prototype=new CABLES.Op;CABLES.OPS["7c110d60-829f-4b06-b3e4-0af911550570"]={f:Ops.Cables.UIMode,objName:"Ops.Cables.UIMode"};Ops.Html.CSS_v2=function(){CABLES.Op.apply(this,arguments);const t=this;const n={};const a=t.inStringEditor("css code");a.setUiAttribs({editorSyntax:"css",ignoreBigPort:true});let r=null;const i="css_"+CABLES.uuid();a.onChange=e;e();function o(){let e=a.get();if(e){e=e.replace(new RegExp("{{ASSETPATH}}","g"),t.patch.getAssetPath())}return e}function e(){r=document.getElementById(i);if(r){r.textContent=o()}else{r=document.createElement("style");r.type="text/css";r.id=i;r.textContent=n.css_spinner;const e=document.getElementsByTagName("body")[0];e.appendChild(r)}}t.onDelete=function(){r=document.getElementById(i);if(r)r.remove()}};Ops.Html.CSS_v2.prototype=new CABLES.Op;CABLES.OPS["a56d3edd-06ad-44ed-9810-dbf714600c67"]={f:Ops.Html.CSS_v2,objName:"Ops.Html.CSS_v2"};Ops.Json.ObjectGetArrayByPath=function(){CABLES.Op.apply(this,arguments);const i=this;const e={};const o=i.inObject("Object");const s=i.inString("Path");const l=i.outArray("Output");const u=i.outBool("Found");o.onChange=t;s.onChange=t;function t(){const t=o.get();const n=s.get();i.setUiError("missing",null);if(t&&n){if(!Array.isArray(t)&&!(typeof t==="object")){u.set(false);i.setUiError("notiterable","input object of type "+typeof t+" is not travesable by path")}else{i.setUiError("notiterable",null);const a=n.split(".");i.setUiAttrib({extendTitle:a[a.length-1]+""});let e=m(n,t);if(e===undefined){const r="could not find element at path "+n;u.set(false);e=null;i.setUiError("missing",r,2)}else if(!Array.isArray(e)){const r="element at path "+n+" is not an array";u.set(false);e=null;i.setUiError("missing",r,2)}else{u.set(true)}l.set(e)}}else{u.set(false)}}function m(e,t=self,n="."){const a=Array.isArray(e)?e:e.split(n);return a.reduce((e,t)=>e&&e[t],t)}};Ops.Json.ObjectGetArrayByPath.prototype=new CABLES.Op;CABLES.OPS["a9354531-a42d-4216-ad8c-364df989a9a1"]={f:Ops.Json.ObjectGetArrayByPath,objName:"Ops.Json.ObjectGetArrayByPath"};Ops.User.kikohs.ArraySelfMultiply=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};const n=e.inArray("In numbers");const a=e.outNumber("Result");n.onChange=()=>{const e=n.get();if(!e){a.set(0);return}const t=e.reduce((e,t)=>e*t,1);a.set(t)}};Ops.User.kikohs.ArraySelfMultiply.prototype=new CABLES.Op;Ops.Array.ArrayIteratorStrings=function(){CABLES.Op.apply(this,arguments);const n=this;const e={};const t=n.inTrigger("Exe"),a=n.inArray("Array"),r=n.outTrigger("Trigger"),i=n.outNumber("Index"),o=n.outString("Value");t.onTriggered=function(){if(!a.get())return;for(let t=0;t<a.get().length;t++){i.set(t);let e=null;if(a.get()[t]){e=String(a.get()[t])}o.set(e);r.trigger();n.patch.instancing.increment()}}};Ops.Array.ArrayIteratorStrings.prototype=new CABLES.Op;CABLES.OPS["0f8ee026-e094-484d-8403-547c92293be9"]={f:Ops.Array.ArrayIteratorStrings,objName:"Ops.Array.ArrayIteratorStrings"};Ops.Array.ArraySetNumber_v2=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};const n=e.inTriggerButton("Execute"),a=e.inArray("Array"),r=e.inInt("Index",0),i=e.inFloat("Number",1),o=e.outTrigger("Next"),s=e.outArray("Result");let l=[];a.onChange=()=>{l=a.get()};n.onTriggered=()=>{if(!l){s.set(null);return}const t=[];for(let e=0;e<l.length;e++)t[e]=l[e];const e=Math.floor(r.get());if(e>=0){t[e]=i.get()}l=t;s.set(null);s.set(t);o.trigger()}};Ops.Array.ArraySetNumber_v2.prototype=new CABLES.Op;CABLES.OPS["a6366c3e-dab0-4b4c-b790-e66b82b93a25"]={f:Ops.Array.ArraySetNumber_v2,objName:"Ops.Array.ArraySetNumber_v2"};Ops.Array.Array_v2=function(){CABLES.Op.apply(this,arguments);const t=this;const e={};const a=t.inValueInt("Array length",10),n=t.inSwitch("Mode select",["Number","1,2,3,4","0-1","1-0"],"Number"),r=t.inValueFloat("Default Value"),i=t.outArray("Array"),o=t.outNumber("Array length out");let s=[];let l=0;const u=0;const m=1;const c=2;const g=3;n.onChange=p;r.onChange=a.onChange=()=>{d()};p();d();function p(){let e=n.get();if(e==="Number")l=u;else if(e==="1,2,3,4")l=m;else if(e==="0-1")l=c;else if(e==="1-0")l=g;if(l===u){r.setUiAttribs({greyout:false})}else if(l===m){r.setUiAttribs({greyout:true})}else if(l===c){r.setUiAttribs({greyout:true})}else if(l===g){r.setUiAttribs({greyout:true})}t.setUiAttrib({extendTitle:n.get()});d()}function d(){s.length=0;let e=a.get();let t=r.get();let n;if(l===u){for(n=0;n<e;n++){s[n]=t}}else if(l===m){for(n=0;n<e;n++){s[n]=n}}else if(l===c){for(n=0;n<e;n++){s[n]=n/e}}else if(l===g){for(n=0;n<e;n++){s[n]=1-n/e}}i.set(null);i.set(s);o.set(s.length)}};Ops.Array.Array_v2.prototype=new CABLES.Op;CABLES.OPS["ca9219d2-9f06-4516-9cf2-98e61f84d4bb"]={f:Ops.Array.Array_v2,objName:"Ops.Array.Array_v2"};Ops.Math.MapRange=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};const g=e.inValueFloat("value",0),p=e.inValueFloat("old min",0),d=e.inValueFloat("old max",1),f=e.inValueFloat("new min",-1),h=e.inValueFloat("new max",1),n=e.inValueSelect("Easing",["Linear","Smoothstep","Smootherstep"],"Linear"),b=e.outValue("result",0);e.setPortGroup("Input Range",[p,d]);e.setPortGroup("Output Range",[f,h]);let v=0;let O=0;g.onChange=p.onChange=d.onChange=f.onChange=h.onChange=a;a();n.onChange=function(){if(n.get()=="Smoothstep")v=1;else if(n.get()=="Smootherstep")v=2;else v=0};function a(){const e=f.get();const t=h.get();const n=p.get();const a=d.get();let r=g.get();if(r>=Math.max(a,n)){b.set(t);return}else if(r<=Math.min(a,n)){b.set(e);return}let i=false;const o=Math.min(n,a);const s=Math.max(n,a);if(o!=n)i=true;let l=false;const u=Math.min(e,t);const m=Math.max(e,t);if(u!=e)l=true;let c=0;if(i)c=(s-r)*(m-u)/(s-o);else c=(r-o)*(m-u)/(s-o);if(l)O=m-c;else O=c+u;if(v===0){b.set(O)}else if(v==1){r=Math.max(0,Math.min(1,(O-e)/(t-e)));b.set(e+r*r*(3-2*r)*(t-e))}else if(v==2){r=Math.max(0,Math.min(1,(O-e)/(t-e)));b.set(e+r*r*r*(r*(r*6-15)+10)*(t-e))}}};Ops.Math.MapRange.prototype=new CABLES.Op;CABLES.OPS["2617b407-60a0-4ff6-b4a7-18136cfa7817"]={f:Ops.Math.MapRange,objName:"Ops.Math.MapRange"};Ops.Array.InfoArray=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};const i=e.inArray("Array"),o=e.outValue("Min"),s=e.outValue("Max"),l=e.outValue("Average");i.onChange=function(){var e=i.get();var t=999999999;var n=-999999999;var a=0;if(e){for(var r=0;r<e.length;r++){a+=e[r];t=Math.min(t,e[r]);n=Math.max(n,e[r])}a/=e.length}o.set(t);s.set(n);l.set(a)}};Ops.Array.InfoArray.prototype=new CABLES.Op;CABLES.OPS["1db230c8-212f-4679-87d6-3531659363da"]={f:Ops.Array.InfoArray,objName:"Ops.Array.InfoArray"};Ops.WebAudio.Mixer=function(){CABLES.Op.apply(this,arguments);const i=this;const e={};function a(e,t,n){return Math.min(Math.max(e,t),n)}const r=CABLES.WEBAUDIO.createAudioContext(i);const t=i.inObject("Audio In 0",null,"audioNode");const n=i.inObject("Audio In 1",null,"audioNode");const o=i.inObject("Audio In 2",null,"audioNode");const s=i.inObject("Audio In 3",null,"audioNode");const l=i.inObject("Audio In 4",null,"audioNode");const u=i.inObject("Audio In 5",null,"audioNode");const m=i.inObject("Audio In 6",null,"audioNode");const c=i.inObject("Audio In 7",null,"audioNode");const g=i.inFloatSlider("In 0 Gain",1);const p=i.inFloatSlider("In 1 Gain",1);const d=i.inFloatSlider("In 2 Gain",1);const f=i.inFloatSlider("In 3 Gain",1);const h=i.inFloatSlider("In 4 Gain",1);const b=i.inFloatSlider("In 5 Gain",1);const v=i.inFloatSlider("In 6 Gain",1);const O=i.inFloatSlider("In 7 Gain",1);const T=i.inFloat("In 0 Pan",0);const I=i.inFloat("In 1 Pan",0);const _=i.inFloat("In 2 Pan",0);const x=i.inFloat("In 3 Pan",0);const E=i.inFloat("In 4 Pan",0);const S=i.inFloat("In 5 Pan",0);const A=i.inFloat("In 6 Pan",0);const C=i.inFloat("In 7 Pan",0);const L=i.inFloatSlider("Output Gain",1);let N=false;let P=null;let M=()=>{};if(r.createStereoPanner){N=false}else{N=true}const y=i.outObject("Audio Out",null,"audioNode");const j=r.createGain();y.set(j);const G=8;const R=[t,n,o,s,l,u,m,c];const w=[g,p,d,f,h,b,v,O];const U=[T,I,_,x,E,S,A,C];i.setPortGroup("Audio Inputs",R);i.setPortGroup("Input",w);i.setPortGroup("Panning",U);i.setPortGroup("Output ",[L]);const B=R.map(()=>({node:null,isConnected:false}));w.forEach((e,t)=>{e.gainNode=r.createGain();e.onChange=()=>e.gainNode.gain.linearRampToValueAtTime(w[t].get()||0,r.currentTime+.01)});U.forEach((t,n)=>{if(N){t.panNode=r.createPanner();t.panNode.panningModel="equalpower"}else{t.panNode=r.createStereoPanner()}t.panNode.connect(w[n].gainNode);t.onChange=()=>{const e=a(U[n].get(),-1,1);if(!N)t.panNode.pan.linearRampToValueAtTime(e,r.currentTime+.01);else t.panNode.setPosition(e,0,1-Math.abs(e))}});R.forEach((e,r)=>{e.onChange=()=>{const e=R[r].get();try{if(e){if(e.connect){const t=B[r];t.node=e;const n=w[r].gainNode;const a=U[r].panNode;if(!t.isConnected){t.node.connect(a);n.connect(j);t.isConnected=true}}}else{const t=B[r];const n=w[r].gainNode;const a=U[r].panNode;if(t.isConnected){t.node.disconnect(a);n.disconnect(j);t.isConnected=false}}}catch(e){i.log(e)}};e.audioInPortNr=r});L.onChange=()=>j.gain.linearRampToValueAtTime(L.get()||0,r.currentTime+.01);i.onDelete=()=>{for(let e=0;e<U.length;e+=1){U[e].panNode.disconnect()}}};Ops.WebAudio.Mixer.prototype=new CABLES.Op;CABLES.OPS["363980dc-39b8-4690-8b8d-bff954f65d49"]={f:Ops.WebAudio.Mixer,objName:"Ops.WebAudio.Mixer"};Ops.WebAudio.Output_v2=function(){CABLES.Op.apply(this,arguments);const r=this;const e={};let t=false;let i=CABLES.WEBAUDIO.createAudioContext(r);let o=i.createGain();const n=i.destination;const a=r.inObject("Audio In",null,"audioNode"),s=r.inFloatSlider("Volume",1),l=r.inBool("Mute",false),u=r.inBool("Show Audio Suspended Button",true),m=r.outNumber("Current Volume",0),c=r.outString("Context State","unknown");r.setPortGroup("Volume Settings",[l,s]);let g=null;let p=false;let d=null;l.onChange=()=>{v(l.get())};s.onChange=b;r.onMasterVolumeChanged=b;let f=r.patch.on("pause",b);let h=r.patch.on("resume",b);i.addEventListener("statechange",O);u.onChange=T;O();T();r.onDelete=()=>{if(o)o.disconnect();o=null;if(d)d.remove();if(f)r.patch.off(f);if(h)r.patch.off(h)};a.onChange=function(){if(!a.get()){if(g){try{if(g.disconnect){g.disconnect(o)}}catch(e){r.logError(e)}}r.setUiError("multipleInputs",null);if(p){if(o)o.disconnect(n);p=false}}else{if(a.links.length>1)r.setUiError("multipleInputs","You have connected multiple inputs. It is possible that you experience unexpected behaviour. Please use a Mixer op to connect multiple audio streams.",1);else r.setUiError("multipleInputs",null);if(a.get().connect)a.get().connect(o)}g=a.get();if(!p){if(o)o.connect(n);p=true}b()};function b(e){const t=r.patch.config.masterVolume||0;let n=s.get()*t;if(r.patch._paused||l.get())n=0;let a=.05;if(e)a=.2;n=CABLES.clamp(n,0,1);if(!o)r.logError("gainNode undefined");if(o)o.gain.linearRampToValueAtTime(n,i.currentTime+a);m.set(n)}function v(e){if(e){if(i.state==="suspended"){if(o){o.gain.cancelScheduledValues(i.currentTime);o.gain.value=0;o.gain.setValueAtTime(0,i.currentTime)}m.set(0);return}}b(true)}function O(){c.set(i.state);r.logVerbose("audioCtx.state change",i.state);if(i.state=="suspended")r.setUiError("ctxSusp","Your Browser suspended audio context, use playButton op to play audio after a user interaction");else r.setUiError("ctxSusp",null);T()}function T(){if(!u.get()&&d){d.remove();d=null}if(i.state=="suspended"){v(true);if(u.get()){t=true;if(!d){d=document.createElement("div");const e=r.patch.cgl.canvas.parentElement;if(e)e.appendChild(d);d.addEventListener("pointerdown",function(e){if(i&&i.state=="suspended"){i.resume()}})}d.style.padding="10px";d.style.position="absolute";d.style.right="20px";d.style.bottom="20px";d.style.width="24px";d.style.height="24px";d.style.cursor="pointer";d.style["border-radius"]="40px";d.style.background="#444";d.style["z-index"]="9999";d.style.display="block";d.dataset.opid=r.id;d.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather feather-volume-2"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>'}}else{if(d)d.remove();d=null;if(t){r.log("was suspended - set vol");b(true)}}}};Ops.WebAudio.Output_v2.prototype=new CABLES.Op;CABLES.OPS["90b95403-b0c4-4980-ab3b-b6c354771c81"]={f:Ops.WebAudio.Output_v2,objName:"Ops.WebAudio.Output_v2"};Ops.User.kikohs.Oscillator=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};const n=e.inBool("Play",false);const a=e.inFloat("Frequency",440);const r=e.inSwitch("Wave type",["sine","square","sawtooth","triangle"],"sine");const i=e.outObject("Audio Out",null,"audioNode");let o=CABLES.WEBAUDIO.createAudioContext(e);let s=null;let l=false;n.onChange=m;function u(){i.set(null);s=o.createOscillator();s.type=r.get();s.frequency.setValueAtTime(440,o.currentTime);i.set(s);l=false}function m(){if(n.get()){if(l){u()}s.start()}else{s.stop();s=null;i.set(null);l=true}}r.onChange=()=>{if(!s)return;s.type=r.get()};function c(e,t,n){}a.onChange=()=>{if(!s)return;s.type=r.get();let e=a.get();e=Math.min(Math.max(e,20),2e4);s.frequency.value=e};u()};Ops.User.kikohs.Oscillator.prototype=new CABLES.Op;Ops.Anim.Bang=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};const n=e.inTrigger("update"),a=e.inTriggerButton("Bang"),r=e.inValue("Duration",.1),i=e.inBool("Invert",false),o=e.outTrigger("Trigger Out"),s=e.outValue("Value");const l=new CABLES.Anim;var u=CABLES.now();e.toWorkPortsNeedToBeLinked(n);a.onTriggered=function(){u=CABLES.now();l.clear();l.setValue(0,1);l.setValue(r.get(),0)};n.onTriggered=function(){var e=l.getValue((CABLES.now()-u)/1e3);if(i.get())s.set(1-e);else s.set(e);o.trigger()}};Ops.Anim.Bang.prototype=new CABLES.Op;CABLES.OPS["92ca45a7-5b4b-4238-956e-23d79bdc659f"]={f:Ops.Anim.Bang,objName:"Ops.Anim.Bang"};Ops.Math.Multiply=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};const n=e.inValueFloat("number1",1);const a=e.inValueFloat("number2",2);const r=e.outValue("result");n.onChange=a.onChange=i;i();function i(){const e=n.get();const t=a.get();r.set(e*t)}};Ops.Math.Multiply.prototype=new CABLES.Op;CABLES.OPS["1bbdae06-fbb2-489b-9bcc-36c9d65bd441"]={f:Ops.Math.Multiply,objName:"Ops.Math.Multiply"};Ops.Math.Floor=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};const n=e.inValue("Number");const a=e.outValue("Result");n.onChange=r;function r(){a.set(Math.floor(n.get()))}};Ops.Math.Floor.prototype=new CABLES.Op;CABLES.OPS["0c77617c-b688-4b55-addf-2cbcaabf98af"]={f:Ops.Math.Floor,objName:"Ops.Math.Floor"};Ops.String.String_v2=function(){CABLES.Op.apply(this,arguments);const e=this;const t={};const n=e.inString("value",""),a=e.outString("String");n.onChange=function(){a.set(n.get())}};Ops.String.String_v2.prototype=new CABLES.Op;CABLES.OPS["d697ff82-74fd-4f31-8f54-295bc64e713d"]={f:Ops.String.String_v2,objName:"Ops.String.String_v2"};Ops.Gl.Meshes.TextMesh_v2=function(){CABLES.Op.apply(this,arguments);const t=this;const e={textmesh_frag:"UNI sampler2D tex;\n#ifdef DO_MULTEX\n    UNI sampler2D texMul;\n#endif\n#ifdef DO_MULTEX_MASK\n    UNI sampler2D texMulMask;\n#endif\nIN vec2 texCoord;\nIN vec2 texPos;\nUNI float r;\nUNI float g;\nUNI float b;\nUNI float a;\n\nvoid main()\n{\n    vec4 col=texture(tex,texCoord);\n    col.a=col.r;\n    col.r*=r;\n    col.g*=g;\n    col.b*=b;\n    col*=a;\n\n    if(col.a==0.0)discard;\n\n    #ifdef DO_MULTEX\n        col*=texture(texMul,texPos);\n    #endif\n\n    #ifdef DO_MULTEX_MASK\n        col*=texture(texMulMask,texPos).r;\n    #endif\n\n    outColor=col;\n}",textmesh_vert:"UNI sampler2D tex;\nUNI mat4 projMatrix;\nUNI mat4 modelMatrix;\nUNI mat4 viewMatrix;\nUNI float scale;\nIN vec3 vPosition;\nIN vec2 attrTexCoord;\nIN mat4 instMat;\nIN vec2 attrTexOffsets;\nIN vec2 attrTexSize;\nIN vec2 attrTexPos;\nOUT vec2 texPos;\n\nOUT vec2 texCoord;\n\nvoid main()\n{\n    texCoord=(attrTexCoord*(attrTexSize)) + attrTexOffsets;\n    mat4 instMVMat=instMat;\n    instMVMat[3][0]*=scale;\n\n    texPos=attrTexPos;\n\n    vec4 vert=vec4( vPosition.x*(attrTexSize.x/attrTexSize.y)*scale,vPosition.y*scale,vPosition.z*scale, 1. );\n\n    mat4 mvMatrix=viewMatrix * modelMatrix * instMVMat;\n\n    gl_Position = projMatrix * mvMatrix * vert;\n}\n"};const n=t.inTrigger("Render"),v=t.inString("Text","cables"),a=t.inValueFloat("Scale",1),c=t.inString("Font","Arial"),O=t.inValueSelect("align",["left","center","right"],"center"),r=t.inValueSelect("vertical align",["Top","Middle","Bottom"],"Middle"),T=t.inValueFloat("Line Height",1),I=t.inValueFloat("Letter Spacing"),s=t.inSwitch("filter",["nearest","linear","mipmap"],"mipmap"),l=t.inSwitch("Anisotropic",[0,1,2,4,8,16],0),i=t.inTexture("Texture Color"),o=t.inTexture("Texture Mask"),u=t.outTrigger("Next"),_=t.outTexture("texture"),x=t.outNumber("Total Lines",0),E=t.outNumber("Width",0),m=t.outValue("Font Available",0);const S=t.patch.cgl;t.setPortGroup("Masking",[i,o]);const g=1024;let p=false;let d=true;O.onChange=v.onChange=T.onChange=f;function f(){d=true}let h=null;CABLES.OpTextureMeshCanvas={};let b=0;const A=null;let C=null;let L=true;let N=true;l.onChange=s.onChange=()=>{M().texture=null;N=true};o.onChange=i.onChange=function(){y.toggleDefine("DO_MULTEX",i.get());y.toggleDefine("DO_MULTEX_MASK",o.get())};_.set(null);c.onChange=function(){N=true;L=true;P()};t.patch.on("fontLoaded",e=>{if(e==c.get()){N=true;L=true}});function P(){const e=p;try{p=document.fonts.check('20px "'+c.get()+'"')}catch(e){t.logError(e)}if(!e&&p){m.set(true);N=true;L=true}if(!p)setTimeout(P,250)}r.onChange=function(){if(r.get()=="Middle")b=0;else if(r.get()=="Top")b=1;else if(r.get()=="Bottom")b=2};function M(){h=""+c.get();if(CABLES.OpTextureMeshCanvas.hasOwnProperty(h))return CABLES.OpTextureMeshCanvas[h];const e=document.createElement("canvas");e.dataset.font=c.get();e.id="texturetext_"+CABLES.generateUUID();e.style.display="none";const t=document.getElementsByTagName("body")[0];t.appendChild(e);const n=e.getContext("2d");CABLES.OpTextureMeshCanvas[h]={ctx:n,canvas:e,chars:{},characters:"",fontSize:320};return CABLES.OpTextureMeshCanvas[h]}t.onDelete=function(){if(h&&CABLES.OpTextureMeshCanvas[h])CABLES.OpTextureMeshCanvas[h].canvas.remove()};var y=new CGL.Shader(S,"TextMesh");y.setSource(e.textmesh_vert,e.textmesh_frag);const j=new CGL.Uniform(y,"t","tex",0);const G=new CGL.Uniform(y,"t","texMul",1);const R=new CGL.Uniform(y,"t","texMulMask",2);const w=new CGL.Uniform(y,"f","scale",a);const U=t.inValueSlider("r",1),B=t.inValueSlider("g",1),D=t.inValueSlider("b",1),k=t.inValueSlider("a",1),V=new CGL.Uniform(y,"f","r",U),F=new CGL.Uniform(y,"f","g",B),z=new CGL.Uniform(y,"f","b",D),X=new CGL.Uniform(y,"f","a",k);U.setUiAttribs({colorPick:true});t.setPortGroup("Display",[a,c]);t.setPortGroup("Alignment",[O,r]);t.setPortGroup("Color",[U,B,D,k]);let H=0;const Y=vec3.create();let W=-1;let Z=false;n.onTriggered=function(){if(d){J();d=false}const e=M();if(e.lastChange!=W){L=true;W=e.lastChange}if(N)q();if(L)J();if(C&&C.numInstances>0){S.pushBlendMode(CGL.BLEND_NORMAL,true);S.setShader(y);S.setTexture(0,_.get().tex);const t=i.get();if(t)S.setTexture(1,t.tex);const n=o.get();if(n)S.setTexture(2,n.tex);if(b===2)vec3.set(Y,0,H,0);else if(b===1)vec3.set(Y,0,0,0);else if(b===0)vec3.set(Y,0,H/2,0);Y[1]-=T.get();S.pushModelMatrix();mat4.translate(S.mMatrix,S.mMatrix,Y);if(!Z)C.render(S.getShader());S.popModelMatrix();S.setTexture(0,null);S.setPreviousShader();S.popBlendMode()}u.trigger()};I.onChange=function(){L=true};function J(){const e=String(v.get()+"");if(!_.get())return;const r=M();if(!r.geom){r.geom=new CGL.Geometry("textmesh");r.geom.vertices=[1,1,0,0,1,0,1,0,0,0,0,0];r.geom.texCoords=new Float32Array([1,1,0,1,1,0,0,0]);r.geom.verticesIndices=[0,1,2,2,1,3]}if(!C)C=new CGL.Mesh(S,r.geom);const i=e.split("\n");x.set(i.length);const o=[];const s=[];const l=[];const u=[];let m=0;N=false;const c=mat4.create();let g=0;for(let a=0;a<i.length;a++){const d=i[a];const f=d.length;let e=0;let t=0;let n=0;for(var p=0;p<f;p++){const h=d.substring(p,p+1);const b=r.chars[String(h)];if(b){n+=b.texCoordWidth/b.texCoordHeight;n+=I.get()}}n-=I.get();H=0;if(O.get()=="left")t=0;else if(O.get()=="right")t=n;else if(O.get()=="center")t=n/2;H=(a+1)*T.get();for(var p=0;p<f;p++){const h=d.substring(p,p+1);const b=r.chars[String(h)];if(!b){N=true;return}else{u.push(e/n*.99+.005,(1-a/(i.length-1))*.99+.005);s.push(b.texCoordX,1-b.texCoordY-b.texCoordHeight);l.push(b.texCoordWidth,b.texCoordHeight);mat4.identity(c);mat4.translate(c,c,[e-t,0-a*T.get(),0]);e+=b.texCoordWidth/b.texCoordHeight+I.get();g=Math.max(g,e-t);o.push(Array.prototype.slice.call(c));m++}}}const t=[].concat.apply([],o);Z=false;if(t.length==0)Z=true;C.numInstances=t.length/16;if(C.numInstances==0){Z=true;return}E.set(g*a.get());C.setAttribute("instMat",new Float32Array(t),16,{instanced:true});C.setAttribute("attrTexOffsets",new Float32Array(s),2,{instanced:true});C.setAttribute("attrTexSize",new Float32Array(l),2,{instanced:true});C.setAttribute("attrTexPos",new Float32Array(u),2,{instanced:true});L=false;if(N)q()}function K(e,t){const n=M();if(!t)n.chars={};const a=n.ctx;a.font=e+"px "+c.get();a.textAlign="left";var r=0,i=0;let o=0;const s=e*1.4;const l={fits:true};for(var i=0;i<n.characters.length;i++){const u=String(n.characters.substring(i,i+1));const m=a.measureText(u).width;if(o+m>=g){r+=s+2;o=0}if(!t){n.chars[u]={str:u,texCoordX:o/g,texCoordY:r/g,texCoordWidth:m/g,texCoordHeight:s/g};a.fillText(u,o,r+e)}o+=m+12}if(r>g-s){l.fits=false}l.spaceLeft=g-r;return l}function q(){let e=CGL.Texture.FILTER_LINEAR;if(s.get()=="nearest")e=CGL.Texture.FILTER_NEAREST;if(s.get()=="mipmap")e=CGL.Texture.FILTER_MIPMAP;const t=M();let n=String(v.get());if(n==null||n==undefined)n="";for(let e=0;e<n.length;e++){const o=n.substring(e,e+1);if(t.characters.indexOf(o)==-1){t.characters+=o;N=true}}const a=t.ctx;t.canvas.width=t.canvas.height=g;if(!t.texture)t.texture=CGL.Texture.createFromImage(S,t.canvas,{filter:e,anisotropic:parseFloat(l.get())});t.texture.setSize(g,g);a.fillStyle="transparent";a.clearRect(0,0,g,g);a.fillStyle="rgba(255,255,255,255)";let r=t.fontSize+40;let i=K(r,true);while(!i.fits){r-=5;i=K(r,true)}K(r,false);a.restore();t.texture.initTexture(t.canvas,e);t.texture.unpackAlpha=true;_.set(t.texture);t.lastChange=CABLES.now();L=true;N=false}};Ops.Gl.Meshes.TextMesh_v2.prototype=new CABLES.Op;CABLES.OPS["2390f6b3-2122-412e-8c8d-5c2f574e8bd1"]={f:Ops.Gl.Meshes.TextMesh_v2,objName:"Ops.Gl.Meshes.TextMesh_v2"};Ops.Patch.LoadingStatus_v2=function(){CABLES.Op.apply(this,arguments);const a=this;const e={};const t=a.addInPort(new CABLES.Port(a,"exe",CABLES.OP_PORT_TYPE_FUNCTION)),r=a.inValueBool("PreRender Ops"),i=a.inBool("Play Timeline",true),o=a.outTrigger("Next"),s=a.outBool("Finished Initial Loading",false),l=a.outBool("Loading"),u=a.outNumber("Progress"),m=a.outArray("Jobs"),c=a.outTrigger("Trigger Loading Finished ");const g=a.patch.cgl;const p=a.patch;let d=false;const n=[];let f=true;document.body.classList.add("cables-loading");let h=g.patch.loading.start("loadingStatusInit","loadingStatusInit");t.onTriggered=()=>{const e=a.patch.loading.getListJobs();u.set(p.loading.getProgress());let t=e.length===0;const n=!t;if(n){m.set(a.patch.loading.getListJobs())}if(n){if(f){if(r.get())a.patch.preRenderOps();a.patch.timer.setTime(0);if(i.get()){a.patch.timer.play()}}f=false;document.body.classList.remove("cables-loading");document.body.classList.add("cables-loaded")}else{d=true;m.set(a.patch.loading.getListJobs());if(p.loading.getProgress()<1){a.patch.timer.setTime(0);a.patch.timer.pause()}}s.set(d);if(l.get()&&t)c.trigger();l.set(n);o.trigger();if(h){g.patch.loading.finished(h);h=null}}};Ops.Patch.LoadingStatus_v2.prototype=new CABLES.Op;CABLES.OPS["e62f7f4c-7436-437e-8451-6bc3c28545f7"]={f:Ops.Patch.LoadingStatus_v2,objName:"Ops.Patch.LoadingStatus_v2"};window.addEventListener("load",function(e){CABLES.jsLoaded=new Event("CABLES.jsLoaded");document.dispatchEvent(CABLES.jsLoaded)});this.CGL=this.CGL||{},this.CGL.COREMODULES=this.CGL.COREMODULES||{},this.CGL.COREMODULES.Shadermodifier=function(n){var a={};function r(e){if(a[e])return a[e].exports;var t=a[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,r),t.l=!0,t.exports}return r.m=n,r.c=a,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)r.d(n,a,function(e){return t[e]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,n){"use strict";n.r(t);CGL.ShaderModifier=class{constructor(e,t,n){this._cgl=e,this._name=t,this._origShaders={},this._uniforms=[],this._structUniforms=[],this._definesToggled={},this._defines={},this._mods=[],this._textures=[],this._boundShader=null,this._changedDefines=!0,this._changedUniforms=!0,this._modulesChanged=!1,this.needsTexturePush=!1,this._lastShader=null,1==this._cgl.glVersion&&(this._cgl.gl.getExtension("OES_texture_float"),this._cgl.gl.getExtension("OES_texture_float_linear"),this._cgl.gl.getExtension("OES_texture_half_float"),this._cgl.gl.getExtension("OES_texture_half_float_linear"))}bind(){const n=this._cgl.getShader();if(!n)return;this._boundShader=this._origShaders[n.id];let a=!1;if(this._boundShader&&this._lastShader!=this._boundShader.shader&&(this._boundShader.shader.hasModule(this._mods[0].id)||(a=!0)),(a||!this._boundShader||n.lastCompile!=this._boundShader.lastCompile||this._modulesChanged||n._needsRecompile)&&(this._boundShader&&this._boundShader.shader.dispose(),n._needsRecompile&&n.compile(),this._boundShader=this._origShaders[n.id]={lastCompile:n.lastCompile,orig:n,shader:n.copy()},1==this._cgl.glVersion&&(this._boundShader.shader.enableExtension("GL_OES_standard_derivatives"),this._boundShader.shader.enableExtension("GL_OES_texture_float"),this._boundShader.shader.enableExtension("GL_OES_texture_float_linear"),this._boundShader.shader.enableExtension("GL_OES_texture_half_float"),this._boundShader.shader.enableExtension("GL_OES_texture_half_float_linear")),this._addModulesToShader(this._boundShader.shader),this._updateDefinesShader(this._boundShader.shader),this._updateUniformsShader(this._boundShader.shader)),this._boundShader.wireframe=n.wireframe,this._changedDefines&&this._updateDefines(),this._changedUniforms&&this._updateUniforms(),this._cgl.pushShader(this._boundShader.shader),this._boundShader.shader.copyUniformValues(this._boundShader.orig),this.needsTexturePush){for(let t=0;t<this._textures.length;t+=1){const a=this._textures[t][0],e=this._textures[t][1],r=this._textures[t][2];if(this._getUniform(a)){const n=this.getPrefixedName(a),i=this._boundShader.shader.getUniform(n);i&&this._boundShader.shader.pushTexture(i,e,r)}}this.needsTexturePush=!1,this._textures.length=0}this._modulesChanged=!1}unbind(){this._boundShader&&this._cgl.popShader(),this._boundShader=null}_addModulesToShader(t){let n;this._mods.length>1&&(n=this._mods[0]);for(let e=0;e<this._mods.length;e++)t.addModule(this._mods[e],n)}_removeModulesFromShader(t){for(const e in this._origShaders)this._origShaders[e].shader.removeModule(t)}addModule(e){this._mods.push(e),this._modulesChanged=!0}removeModule(t){const n=[];for(let e=0;e<this._mods.length;e++)this._mods[e].title==t&&(this._removeModulesFromShader(this._mods[e]),n.push(e));for(let e=n.length-1;e>=0;e-=1)this._mods.splice(n[e],1);this._modulesChanged=!0}_updateUniformsShader(r){for(let e=0;e<this._uniforms.length;e++){const t=this._uniforms[e],n=this.getPrefixedName(t.name);if(!r.hasUniform(n)&&!t.structName){let e=null;"both"===t.shaderType?(e=r.addUniformBoth(t.type,n,t.v1,t.v2,t.v3,t.v4),e.comment="mod: "+this._name):"frag"===t.shaderType?(e=r.addUniformFrag(t.type,n,t.v1,t.v2,t.v3,t.v4),e.comment="mod: "+this._name):"vert"===t.shaderType&&(e=r.addUniformVert(t.type,n,t.v1,t.v2,t.v3,t.v4),e.comment="mod: "+this._name)}}for(let a=0;a<this._structUniforms.length;a+=1){const e=this._structUniforms[a];let t=e.uniformName,n=e.structName;const i=e.members;t=this.getPrefixedName(e.uniformName),n=this.getPrefixedName(e.structName),"frag"===e.shaderType&&r.addUniformStructFrag(n,t,i),"vert"===e.shaderType&&r.addUniformStructVert(n,t,i),"both"===e.shaderType&&r.addUniformStructBoth(n,t,i)}}_updateUniforms(){for(const e in this._origShaders)this._updateUniformsShader(this._origShaders[e].shader);this._changedUniforms=!1}_setUniformValue(e,t,n){const a=e.getUniform(t);a&&a.setValue(n)}setUniformValue(e,t){if(!this._getUniform(e))return;const n=this.getPrefixedName(e);for(const e in this._origShaders)this._setUniformValue(this._origShaders[e].shader,n,t)}hasUniform(e){return this._getUniform(e)}_getUniform(t){for(let e=0;e<this._uniforms.length;e++){if(this._uniforms[e].name==t)return this._uniforms[e];if(this._uniforms[e].structName&&this._uniforms[e].propertyName==t)return this._uniforms[e]}return!1}_getStructUniform(t){for(let e=0;e<this._structUniforms.length;e+=1)if(this._structUniforms[e].uniformName===t)return this._structUniforms[e];return null}_isStructUniform(t){for(let e=0;e<this._uniforms.length;e++){if(this._uniforms[e].name==t)return!1;if(this._uniforms[e].structName&&this._uniforms[e].propertyName==t)return!0}return!1}addUniform(t,n,a,r,i,o,s,l,u,m){if(!this._getUniform(n)){let e="both";m&&(e=m),this._uniforms.push({type:t,name:n,v1:a,v2:r,v3:i,v4:o,structUniformName:s,structName:l,propertyName:u,shaderType:e}),this._changedUniforms=!0}}addUniformFrag(e,t,n,a,r,i){this.addUniform(e,t,n,a,r,i,null,null,null,"frag"),this._changedUniforms=!0}addUniformVert(e,t,n,a,r,i){this.addUniform(e,t,n,a,r,i,null,null,null,"vert"),this._changedUniforms=!0}addUniformBoth(e,t,n,a,r,i){this.addUniform(e,t,n,a,r,i,null,null,null,"both"),this._changedUniforms=!0}addUniformStruct(t,n,a,r){for(let e=0;e<a.length;e+=1){const i=a[e];"2i"!==i.type&&"i"!==i.type&&"3i"!==i.type||"both"!==r||console.error("Adding an integer struct member to both shaders can potentially error. Please use different structs for each shader. Error occured in struct:",t," with member:",i.name," of type:",i.type,"."),this._getUniform(n+"."+i.name)||this.addUniform(i.type,n+"."+i.name,i.v1,i.v2,i.v3,i.v4,n,t,i.name,r)}this._getStructUniform(n)||this._structUniforms.push({structName:t,uniformName:n,members:a,shaderType:r})}addUniformStructVert(e,t,n){this.addUniformStruct(e,t,n,"vert")}addUniformStructFrag(e,t,n){this.addUniformStruct(e,t,n,"frag")}addUniformStructBoth(e,t,n){this.addUniformStruct(e,t,n,"both")}pushTexture(e,t,n){if(!t)throw new Error("no texture given to texturestack");this._textures.push([e,t,n]),this.needsTexturePush=!0}_removeUniformFromShader(e,t){t.hasUniform(e)&&t.removeUniform(e)}removeUniform(n){if(this._getUniform(n)){for(let t=this._uniforms.length-1;t>=0;t-=1){const e=n;if(this._uniforms[t].name==n&&!this._uniforms[t].structName){for(const n in this._origShaders)this._removeUniformFromShader(this.getPrefixedName(e),this._origShaders[n].shader);this._uniforms.splice(t,1)}}this._changedUniforms=!0}}removeUniformStruct(n){if(this._getStructUniform(n)){for(let e=this._structUniforms.length-1;e>=0;e-=1){const t=this._structUniforms[e];if(t.uniformName===n){for(const n in this._origShaders)for(let e=0;e<t.members.length;e+=1){const a=t.members[e];this._removeUniformFromShader(this.getPrefixedName(a.name),this._origShaders[n].shader)}this._structUniforms.splice(e,1)}}this._changedUniforms=!0}}getPrefixedName(e){const t=this._mods[0].group;if(void 0!==t)return 0==e.indexOf("MOD_")&&(e="mod"+t+"_"+(e=e.substr("MOD_".length))),e}_updateDefinesShader(n){for(const t in this._defines){const e=this.getPrefixedName(t);null!==this._defines[t]&&void 0!==this._defines[t]?n.define(e,this._defines[t]):n.removeDefine(e)}for(const t in this._definesToggled){const e=this.getPrefixedName(t);n.toggleDefine(e,this._definesToggled[t])}}_updateDefines(){for(const e in this._origShaders)this._updateDefinesShader(this._origShaders[e].shader);this._changedDefines=!1}define(e,t){this._defines[e]=t,this._changedDefines=!0}removeDefine(e){this._defines[e]=null,this._changedDefines=!0}hasDefine(e){return null!==this._defines[e]&&void 0!==this._defines[e]}toggleDefine(e,t){this._changedDefines=!0,this._definesToggled[e]=t}currentShader(){return this._boundShader.shader}dispose(){}}}]).Shadermodifier;this.CABLES=this.CABLES||{},this.CABLES.COREMODULES=this.CABLES.COREMODULES||{},this.CABLES.COREMODULES.Vargetset=function(n){var a={};function r(e){if(a[e])return a[e].exports;var t=a[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,r),t.l=!0,t.exports}return r.m=n,r.c=a,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)r.d(n,a,function(e){return t[e]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t){CABLES.VarSetOpWrapper=class{constructor(t,e,n,a,r,i){this._valuePort=n,this._varNamePort=a,this._op=t,this._type=e,this._triggerPort=r,this._nextPort=i,this._btnCreate=t.inTriggerButton("Create new variable"),this._btnCreate.setUiAttribs({hidePort:!0}),this._btnCreate.onTriggered=this._createVar.bind(this),this._helper=t.inUiTriggerButtons("",["Rename"]),this._helper.setUiAttribs({hidePort:!0}),this._helper.onTriggered=e=>{"Rename"==e&&CABLES.CMD.PATCH.renameVariable(t.varName.get())},this._op.setPortGroup("Variable",[this._helper,this._varNamePort,this._btnCreate]),this._op.on("uiParamPanel",this._updateVarNamesDropdown.bind(this)),this._op.patch.addEventListener("variablesChanged",this._updateName.bind(this)),this._op.patch.addEventListener("variableRename",this._renameVar.bind(this)),this._varNamePort.onChange=this._updateName.bind(this),this._valuePort.changeAlways=!0,this._triggerPort?this._triggerPort.onTriggered=()=>{this._setVarValue(!0)}:this._valuePort.onChange=this._setVarValue.bind(this),this._op.init=()=>{this._updateName(),this._triggerPort||this._setVarValue(),this._updateErrorUi()}}_updateErrorUi(){CABLES.UI&&(this._varNamePort.get()?this._op.setUiError("novarname",null):this._op.setUiError("novarname","no variable selected"))}_updateName(){const e=this._varNamePort.get();this._op.setTitle("var set "),this._op.setUiAttrib({extendTitle:"#"+e}),this._updateErrorUi();const t=this._op.patch.getVar(e);t&&!t.type&&(t.type=this._type),this._op.patch.hasVar(e)||0==e||this._triggerPort||this._setVarValue(),!this._op.patch.hasVar(e)&&0!=e&&this._triggerPort&&("string"==this._type||"number"==this._type?this._op.patch.setVarValue(e,""):this._op.patch.setVarValue(e,null)),this._op.isCurrentUiOp()&&(this._updateVarNamesDropdown(),this._op.refreshParams()),this._updateDisplay(),this._op.patch.emitEvent("opVariableNameChanged",this._op,this._varNamePort.get())}_createVar(){CABLES.CMD.PATCH.createVariable(this._op,this._type,()=>{this._updateName()})}_updateDisplay(){this._valuePort.setUiAttribs({greyout:!this._varNamePort.get()})}_updateVarNamesDropdown(){if(CABLES.UI){const e=[],t=this._op.patch.getVars();for(const n in t)t[n].type==this._type&&"0"!=n&&e.push(n);this._varNamePort.uiAttribs.values=e}}_renameVar(e,t){e==this._varNamePort.get()&&(this._varNamePort.set(t),this._updateName())}_setVarValue(e){const t=this._varNamePort.get();if(!t)return;const n=this._valuePort.get();"array"==this._type?(this._arr=[],CABLES.copyArray(n,this._arr),this._op.patch.setVarValue(t,null),this._op.patch.setVarValue(t,this._arr)):("object"==this._type&&(this._op.patch.setVarValue(t,null),n&&n.tex&&n._cgl&&"texture"!=this._valuePort.uiAttribs.objType?this._op.setUiError("texobj","Dont use object variables for textures, use varSetTexture"):this._op.setUiError("texobj",null)),this._op.patch.setVarValue(t,n)),e&&this._nextPort&&this._nextPort.trigger()}},CABLES.VarGetOpWrapper=class{constructor(e,t,n,a){this._op=e,this._type=t,this._varnamePort=n,this._variable=null,this._valueOutPort=a,this._op.on("uiParamPanel",this._updateVarNamesDropdown.bind(this)),this._op.patch.on("variableRename",this._renameVar.bind(this)),this._op.patch.on("variableDeleted",e=>{this._op.isCurrentUiOp()&&this._op.refreshParams()}),this._varnamePort.onChange=this._init.bind(this),this._op.patch.addEventListener("variablesChanged",this._init.bind(this)),this._op.onDelete=function(){this._variable&&this._variable.removeListener(this._setValueOut.bind(this))},this._op.init=()=>{this._init()}}_renameVar(e,t){e==this._varnamePort.get()&&(this._varnamePort.set(t),this._updateVarNamesDropdown())}_updateVarNamesDropdown(){if(CABLES.UI){const e=[],t=this._op.patch.getVars();for(const n in t)t[n].type==this._type&&"0"!=n&&e.push(n);this._op.varName.uiAttribs.values=e}}_setValueOut(e){this._updateVarNamesDropdown(),this._valueOutPort.set(e)}_init(){this._updateVarNamesDropdown(),this._variable&&this._variable.removeListener(this._setValueOut.bind(this)),this._variable=this._op.patch.getVar(this._op.varName.get()),this._variable?(this._variable.addListener(this._setValueOut.bind(this)),this._op.setUiError("unknownvar",null),this._op.setTitle("var get "),this._op.setUiAttrib({extendTitle:"#"+this._varnamePort.get()}),this._valueOutPort.set(this._variable.getValue())):(this._op.setUiError("unknownvar","unknown variable! - there is no setVariable with this name ("+this._varnamePort.get()+")"),this._op.setUiAttrib({extendTitle:"#invalid"}),this._valueOutPort.set(0)),this._op.patch.emitEvent("opVariableNameChanged",this._op,this._varnamePort.get())}}}]).Cables;this.CGL=this.CGL||{},this.CGL.COREMODULES=this.CGL.COREMODULES||{},this.CGL.COREMODULES.Cubemapframebuffer=function(n){var a={};function r(e){if(a[e])return a[e].exports;var t=a[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,r),t.l=!0,t.exports}return r.m=n,r.c=a,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)r.d(n,a,function(e){return t[e]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,n){"use strict";n.r(t);const a={float32Concat:function(e,t){e instanceof Float32Array||(e=new Float32Array(e)),t instanceof Float32Array||(t=new Float32Array(t));const n=new Float32Array(e.length+t.length);return n.set(e),n.set(t,e.length),n}},r=function(){let n=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=(n+16*Math.random())%16|0;return n=Math.floor(n/16),("x"==e?t:3&t|8).toString(16)})},i=r;Math.randomSeed=1,Math.seededRandom=function(e,t){0===Math.randomSeed&&(Math.randomSeed=999*Math.random()),e=e||1,t=t||0,Math.randomSeed=(9301*Math.randomSeed+49297)%233280;return t+Math.randomSeed/233280*(e-t)},a.arrayWriteToEnd=function(t,e){for(let e=1;e<t.length;e++)t[e-1]=t[e];t[t.length-1]=e},a.isNumeric=function(e){return!isNaN(parseFloat(e))&&isFinite(e)},a.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},String.prototype.endl=function(){return this+"\n"},String.prototype.startsWith=function(e){return 0===this.indexOf(e)},String.prototype.endsWith=function(e){return this.match(e+"$")==e};window.performance=window.performance||{offset:Date.now(),now:function(){return Date.now()-this.offset}};class o{constructor(e){this._logs=[],this.initiator=e}stack(e){console.error("["+this.initiator+"] ",e),console.log((new Error).stack),window.gui&&window.gui.emitEvent("coreLogEvent",this.initiator,"error",e)}groupCollapsed(e){console.groupCollapsed("["+this.initiator+"] "+e)}table(e){console.table(e)}groupEnd(){console.groupEnd()}error(e){console.error("["+this.initiator+"]",...arguments),window.gui&&window.gui.emitEvent("coreLogEvent",this.initiator,"error",arguments)}info(e){console.error("["+this.initiator+"]",...arguments),window.gui&&window.gui.emitEvent("coreLogEvent",this.initiator,"info",arguments)}warn(e){console.warn("["+this.initiator+"]",...arguments),window.gui&&window.gui.emitEvent("coreLogEvent",this.initiator,"warn",arguments)}verbose(){(CABLES.UI&&CABLES.UI.logFilter.shouldPrint(this.initiator,...arguments)||!CABLES.logSilent)&&console.log("["+this.initiator+"]",...arguments),window.gui&&window.gui.emitEvent("coreLogEvent",this.initiator,"verbose",arguments)}log(e){(CABLES.UI&&CABLES.UI.logFilter.shouldPrint(this.initiator,...arguments)||!CABLES.logSilent)&&console.log("["+this.initiator+"]",...arguments),window.gui&&window.gui.emitEvent("coreLogEvent",this.initiator,"log",arguments)}userInteraction(e){}}const s=function(e,t){if(!e)throw new Error("no cgl");this._log=new o("cgl_texture"),this._cgl=e,this.tex=this._cgl.gl.createTexture(),this.id=i(),this.width=0,this.height=0,this.loading=!1,this.flip=!0,this.flipped=!1,this.shadowMap=!1,this.deleted=!1,this.image=null,this.anisotropic=0,this.filter=s.FILTER_NEAREST,this.wrap=s.WRAP_CLAMP_TO_EDGE,this.texTarget=this._cgl.gl.TEXTURE_2D,t&&t.type&&(this.texTarget=t.type),this.textureType=s.TYPE_DEFAULT,this.unpackAlpha=!0,this._fromData=!0,this.name="unknown",t?(this.name=t.name||this.name,t.isDepthTexture&&(this.textureType=s.TYPE_DEPTH),t.isFloatingPointTexture&&(this.textureType=s.TYPE_FLOAT),"textureType"in t&&(this.textureType=t.textureType),"filter"in t&&(this.filter=t.filter),"wrap"in t&&(this.wrap=t.wrap),"unpackAlpha"in t&&(this.unpackAlpha=t.unpackAlpha),"flip"in t&&(this.flip=t.flip),"shadowMap"in t&&(this.shadowMap=t.shadowMap),"anisotropic"in t&&(this.anisotropic=t.anisotropic)):t={},t.width||(t.width=8),t.height||(t.height=8),this._cgl.profileData.profileTextureNew++,this._cgl.profileData.addHeavyEvent("texture created",this.name,t.width+"x"+t.height),this.setSize(t.width,t.height),this.getInfoOneLine()};s.prototype.isFloatingPoint=function(){return this.textureType==s.TYPE_FLOAT},s.prototype.compareSettings=function(e){return!!e&&(e.width==this.width&&e.height==this.height&&e.filter==this.filter&&e.wrap==this.wrap&&e.textureType==this.textureType&&e.unpackAlpha==this.unpackAlpha&&e.anisotropic==this.anisotropic&&e.shadowMap==this.shadowMap&&e.texTarget==this.texTarget&&e.flip==this.flip)},s.prototype.clone=function(){const e=new s(this._cgl,{name:this.name,filter:this.filter,wrap:this.wrap,textureType:this.textureType,unpackAlpha:this.unpackAlpha,flip:this.flip,width:this.width,height:this.height});return this._cgl.profileData.addHeavyEvent("texture created",this.name,this.width+"x"+this.height),this.compareSettings(e)||(this._log.error("Cloned texture settings do not compare!"),this._log.error(this),this._log.error(e)),e},s.prototype.setSize=function(t,n){if((t!=t||t<=0||!t)&&(t=8),(n!=n||n<=0||!n)&&(n=8),(t>this._cgl.maxTexSize||n>this._cgl.maxTexSize)&&this._log.error("texture size too big! "+t+"x"+n+" / max: "+this._cgl.maxTexSize),t=Math.min(t,this._cgl.maxTexSize),n=Math.min(n,this._cgl.maxTexSize),t=Math.floor(t),n=Math.floor(n),this.width==t&&this.height==n)return;this.width=t,this.height=n,this.deleted=!1,this.shortInfoString=this.getInfoOneLine(),this._cgl.gl.bindTexture(this.texTarget,this.tex),this._cgl.profileData.profileTextureResize++;if(this._cgl.patch.config.canvas.forceTextureNearest&&(this.filter=s.FILTER_NEAREST),1!=this._cgl.glVersion||this.textureType!=s.TYPE_FLOAT||this.filter!=s.FILTER_LINEAR||this._cgl.gl.getExtension("OES_texture_float_linear")||(console.warn("this graphics card does not support floating point texture linear interpolation! using NEAREST"),this.filter=s.FILTER_NEAREST),this.textureType==s.TYPE_FLOAT)if(1==this._cgl.glVersion)if(this._cgl.glUseHalfFloatTex){const e=this._cgl.gl.getExtension("OES_texture_half_float");this._cgl.gl.getExtension("EXT_color_buffer_half_float");if(!e)throw new Error("no half float texture extension");this._cgl.gl.texImage2D(this.texTarget,0,this._cgl.gl.RGBA,t,n,0,this._cgl.gl.RGBA,e.HALF_FLOAT_OES,null)}else this._cgl.gl.getExtension("OES_texture_float"),this._cgl.gl.texImage2D(this.texTarget,0,this._cgl.gl.RGBA,t,n,0,this._cgl.gl.RGBA,this._cgl.gl.FLOAT,null);else if(this._cgl.glUseHalfFloatTex){if(!this._cgl.gl.getExtension("EXT_color_buffer_half_float"))throw new Error("no half float texture extension");console.log("half float",this._cgl.gl.RGBA16F,this._cgl.gl.HALF_FLOAT),console.log("half float",this._cgl.gl.HALF_FLOAT),console.log("half float",this._cgl.gl.RGBA16F),this._cgl.gl.texImage2D(this.texTarget,0,this._cgl.gl.RGBA,t,n,0,this._cgl.gl.RGBA,this._cgl.gl.HALF_FLOAT,null)}else this._cgl.gl.getExtension("EXT_color_buffer_float"),this._cgl.gl.getExtension("EXT_color_buffer_float_linear"),this._cgl.gl.getExtension("OES_texture_float_linear"),this._cgl.gl.texImage2D(this.texTarget,0,this._cgl.gl.RGBA32F,t,n,0,this._cgl.gl.RGBA,this._cgl.gl.FLOAT,null);else if(this.textureType==s.TYPE_DEPTH)if(1==this._cgl.glVersion){const e=this._cgl.gl.DEPTH_COMPONENT;this._cgl.gl.texImage2D(this.texTarget,0,e,t,n,0,this._cgl.gl.DEPTH_COMPONENT,this._cgl.gl.UNSIGNED_SHORT,null)}else{const e=this._cgl.gl.DEPTH_COMPONENT32F;this._cgl.gl.texImage2D(this.texTarget,0,e,t,n,0,this._cgl.gl.DEPTH_COMPONENT,this._cgl.gl.FLOAT,null)}else this._cgl.gl.texImage2D(this.texTarget,0,this._cgl.gl.RGBA,t,n,0,this._cgl.gl.RGBA,this._cgl.gl.UNSIGNED_BYTE,null);this._setFilter(),this.updateMipMap(),this._cgl.gl.bindTexture(this.texTarget,null)},s.prototype.initFromData=function(e,t,n,a,r){if(this.filter=a,this.wrap=r,null==a&&(this.filter=s.FILTER_LINEAR),null==r&&(this.wrap=s.WRAP_CLAMP_TO_EDGE),this.width=t,this.height=n,this._fromData=!0,this.deleted=!1,this.height>this._cgl.maxTexSize||this.width>this._cgl.maxTexSize){const e=CGL.Texture.getTempTexture(this._cgl);return this.width=e.width,this.height=e.height,this.tex=e.tex,void this._log.error("[cgl_texture] texture size to big!!!",this.width,this.height,this._cgl.maxTexSize)}this.flip&&this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_FLIP_Y_WEBGL,this.flip),this._cgl.gl.bindTexture(this.texTarget,this.tex),this.textureType==s.TYPE_FLOAT?this._cgl.gl.texImage2D(this.texTarget,0,this._cgl.gl.RGBA32F,t,n,0,this._cgl.gl.RGBA,this._cgl.gl.FLOAT,e):this._cgl.gl.texImage2D(this.texTarget,0,this._cgl.gl.RGBA,t,n,0,this._cgl.gl.RGBA,this._cgl.gl.UNSIGNED_BYTE,e),this._setFilter(),this.updateMipMap(),this.flip&&this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_FLIP_Y_WEBGL,!1),this._cgl.gl.bindTexture(this.texTarget,null)},s.prototype.updateMipMap=function(){2!=this._cgl.glVersion&&!this.isPowerOfTwo()||this.filter!=s.FILTER_MIPMAP||(this._cgl.gl.generateMipmap(this.texTarget),this._cgl.profileData.profileGenMipMap++)},s.prototype.initTexture=function(e,t){if(this._cgl.printError("before initTexture"),this._cgl.checkFrameStarted("texture inittexture"),this._fromData=!1,this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.unpackAlpha),e.width&&(this.width=e.width),e.height&&(this.height=e.height),t&&(this.filter=t),e.height>this._cgl.maxTexSize||e.width>this._cgl.maxTexSize){const t=CGL.Texture.getTempTexture(this._cgl);return this.width=t.width,this.height=t.height,this.tex=t.tex,void this._log.error("[cgl_texture] texture size to big!!!",e.width,e.height,this._cgl.maxTexSize)}this._cgl.gl.bindTexture(this.texTarget,this.tex),this.deleted=!1,this.flipped=!this.flip,this.flipped&&this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_FLIP_Y_WEBGL,this.flipped),this._cgl.gl.texImage2D(this.texTarget,0,this._cgl.gl.RGBA,this._cgl.gl.RGBA,this._cgl.gl.UNSIGNED_BYTE,e),this._setFilter(),this.updateMipMap(),this._cgl.gl.bindTexture(this.texTarget,null),this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),this.flipped&&this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_FLIP_Y_WEBGL,!1),this.getInfoOneLine(),this._cgl.printError("initTexture")},s.prototype.delete=function(){this.loading||(this.deleted=!0,this.width=0,this.height=0,this._cgl.profileData.profileTextureDelete++,this._cgl.gl.deleteTexture(this.tex),this.image=null,this.tex=null)},s.prototype.isPowerOfTwo=function(){return s.isPowerOfTwo(this.width)&&s.isPowerOfTwo(this.height)},s.prototype.printInfo=function(){console.log(this.getInfo())},s.prototype.getInfoReadable=function(){const t=this.getInfo();let n="";t.name=t.name.substr(0,t.name.indexOf("?rnd="));for(const e in t)n+="* "+e+":  **"+t[e]+"**\n";return n},s.prototype.getInfoOneLine=function(){let e=this.width+" x "+this.height;return this.textureType===CGL.Texture.TYPE_FLOAT?e+=" 32bit":e+=" 8bit",this.filter===CGL.Texture.FILTER_NEAREST&&(e+=" nearest"),this.filter===CGL.Texture.FILTER_LINEAR&&(e+=" linear"),this.filter===CGL.Texture.FILTER_MIPMAP&&(e+=" mipmap"),this.wrap===CGL.Texture.WRAP_CLAMP_TO_EDGE&&(e+=" clamp"),this.wrap===CGL.Texture.WRAP_REPEAT&&(e+=" repeat"),this.wrap===CGL.Texture.WRAP_MIRRORED_REPEAT&&(e+=" repeatmir"),this.shortInfoString=e,e},s.prototype.getInfo=function(){const e={};e.name=this.name,e["power of two"]=this.isPowerOfTwo(),e.size=this.width+" x "+this.height;let t=this.texTarget;return this.texTarget==this._cgl.gl.TEXTURE_2D&&(t="TEXTURE_2D"),e.target=t,e.unpackAlpha=this.unpackAlpha,this.textureType==s.TYPE_FLOAT?e.textureType="TYPE_FLOAT":this.textureType==s.TYPE_DEPTH?e.textureType="TYPE_DEPTH":this.textureType==s.TYPE_DEFAULT?e.textureType="TYPE_DEFAULT":e.textureType="UNKNOWN",this.wrap==s.WRAP_CLAMP_TO_EDGE?e.wrap="CLAMP_TO_EDGE":this.wrap==s.WRAP_REPEAT?e.wrap="WRAP_REPEAT":this.wrap==s.WRAP_MIRRORED_REPEAT?e.wrap="WRAP_MIRRORED_REPEAT":e.wrap="UNKNOWN",this.filter==s.FILTER_NEAREST?e.filter="FILTER_NEAREST":this.filter==s.FILTER_LINEAR?e.filter="FILTER_LINEAR":this.filter==s.FILTER_MIPMAP?e.filter="FILTER_MIPMAP":e.filter="UNKNOWN",e},s.prototype._setFilter=function(){if(this._cgl.printError("before _setFilter"),this._fromData||this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.unpackAlpha),this.shadowMap&&(this._cgl.gl.texParameteri(this._cgl.gl.TEXTURE_2D,this._cgl.gl.TEXTURE_COMPARE_MODE,this._cgl.gl.COMPARE_REF_TO_TEXTURE),this._cgl.gl.texParameteri(this._cgl.gl.TEXTURE_2D,this._cgl.gl.TEXTURE_COMPARE_FUNC,this._cgl.gl.LEQUAL)),this.textureType==s.TYPE_FLOAT&&this.filter==s.FILTER_MIPMAP&&(this.filter=s.FILTER_LINEAR,this._log.stack("texture: HDR and mipmap filtering at the same time is not possible")),1!=this._cgl.glVersion||this.isPowerOfTwo()){if(this.wrap==s.WRAP_CLAMP_TO_EDGE?(this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_S,this._cgl.gl.CLAMP_TO_EDGE),this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_T,this._cgl.gl.CLAMP_TO_EDGE)):this.wrap==s.WRAP_REPEAT?(this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_S,this._cgl.gl.REPEAT),this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_T,this._cgl.gl.REPEAT)):this.wrap==s.WRAP_MIRRORED_REPEAT&&(this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_S,this._cgl.gl.MIRRORED_REPEAT),this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_T,this._cgl.gl.MIRRORED_REPEAT)),this.filter==s.FILTER_NEAREST)this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MAG_FILTER,this._cgl.gl.NEAREST),this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MIN_FILTER,this._cgl.gl.NEAREST);else if(this.filter==s.FILTER_LINEAR)this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MIN_FILTER,this._cgl.gl.LINEAR),this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MAG_FILTER,this._cgl.gl.LINEAR);else{if(this.filter!=s.FILTER_MIPMAP)throw this._log.log("unknown texture filter!",this.filter),new Error("unknown texture filter!"+this.filter);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MAG_FILTER,this._cgl.gl.LINEAR),this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MIN_FILTER,this._cgl.gl.LINEAR_MIPMAP_LINEAR)}if(this.anisotropic){const t=this._cgl.gl.getExtension("EXT_texture_filter_anisotropic");if(t){const e=this._cgl.gl.getParameter(t.MAX_TEXTURE_MAX_ANISOTROPY_EXT);this._cgl.gl.texParameterf(this._cgl.gl.TEXTURE_2D,t.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(e,this.anisotropic))}}}else this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MAG_FILTER,this._cgl.gl.NEAREST),this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MIN_FILTER,this._cgl.gl.NEAREST),this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_S,this._cgl.gl.CLAMP_TO_EDGE),this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_T,this._cgl.gl.CLAMP_TO_EDGE),this.filter=s.FILTER_NEAREST,this.wrap=s.WRAP_CLAMP_TO_EDGE;this.getInfoOneLine(),this._cgl.printError("_setFilter")},s.load=function(t,n,a,e){if(!n)return a({error:!0});let r=null;t.patch.loading.existByName(n)||(r=t.patch.loading.start("texture",n));const i=new s(t);return i.name=n,t.patch.isEditorMode()&&gui.jobs().start({id:"loadtexture"+r,title:"loading texture "+CABLES.basename(n)}),i.image=new Image,i.image.crossOrigin="anonymous",i.loading=!0,e&&e.hasOwnProperty("filter")&&(i.filter=e.filter),e&&e.hasOwnProperty("flip")&&(i.flip=e.flip),e&&e.hasOwnProperty("wrap")&&(i.wrap=e.wrap),e&&e.hasOwnProperty("anisotropic")&&(i.anisotropic=e.anisotropic),e&&e.hasOwnProperty("unpackAlpha")&&(i.unpackAlpha=e.unpackAlpha),i.image.onabort=i.image.onerror=e=>{console.warn("[cgl.texture.load] error loading texture",n,e),i.loading=!1,r&&t.patch.loading.finished(r);a&&a({error:!0},i),t.patch.isEditorMode()&&gui.jobs().finish("loadtexture"+r)},i.image.onload=function(e){t.addNextFrameOnceCallback(()=>{i.initTexture(i.image),r&&t.patch.loading.finished(r),i.loading=!1,t.patch.isEditorMode()&&gui.jobs().finish("loadtexture"+r),a&&a(null,i)})},i.image.src=n,i},s.getTempTexture=function(e){return e||console.error("[getTempTexture] no cgl!"),e.tempTexture||(e.tempTexture=s.getTemporaryTexture(e,256,s.FILTER_LINEAR,s.REPEAT)),e.tempTexture},s.getEmptyTexture=function(e,t){if(t)return s.getEmptyTextureFloat(e);if(e||console.error("[getEmptyTexture] no cgl!"),e.tempTextureEmpty)return e.tempTextureEmpty;e.tempTextureEmpty=new s(e,{name:"emptyTexture"});const n=new Uint8Array(256).fill(0);for(let e=0;e<256;e+=4)n[e+3]=0;return e.tempTextureEmpty.initFromData(n,8,8,s.FILTER_NEAREST,s.WRAP_REPEAT),e.tempTextureEmpty},s.getEmptyTextureFloat=function(e){if(e||console.error("[getEmptyTextureFloat] no cgl!"),e.tempTextureEmptyFloat)return e.tempTextureEmptyFloat;e.tempTextureEmptyFloat=new s(e,{name:"emptyTexture",isFloatingPointTexture:!0});const t=new Float32Array(256).fill(1);for(let e=0;e<256;e+=4)t[e+3]=0;return e.tempTextureEmptyFloat.initFromData(t,8,8,s.FILTER_NEAREST,s.WRAP_REPEAT),e.tempTextureEmptyFloat},s.getRandomTexture=function(e){if(e||console.error("[getRandomTexture] no cgl!"),e.randomTexture)return e.randomTexture;const t=new Uint8Array(262144);for(let e=0;e<65536;e++)t[4*e+0]=255*Math.random(),t[4*e+1]=255*Math.random(),t[4*e+2]=255*Math.random(),t[4*e+3]=255;return e.randomTexture=new s(e),e.randomTexture.initFromData(t,256,256,s.FILTER_NEAREST,s.WRAP_REPEAT),e.randomTexture},s.getBlackTexture=function(e){if(e||this._log.error("[getBlackTexture] no cgl!"),e.blackTexture)return e.blackTexture;const t=new Uint8Array(256);for(let e=0;e<64;e++)t[4*e+0]=t[4*e+1]=t[4*e+2]=0,t[4*e+3]=255;return e.blackTexture=new s(e),e.blackTexture.initFromData(t,8,8,s.FILTER_NEAREST,s.WRAP_REPEAT),e.blackTexture},s.getEmptyCubemapTexture=function(t){const n=[t.gl.TEXTURE_CUBE_MAP_POSITIVE_X,t.gl.TEXTURE_CUBE_MAP_NEGATIVE_X,t.gl.TEXTURE_CUBE_MAP_POSITIVE_Y,t.gl.TEXTURE_CUBE_MAP_NEGATIVE_Y,t.gl.TEXTURE_CUBE_MAP_POSITIVE_Z,t.gl.TEXTURE_CUBE_MAP_NEGATIVE_Z],e=t.gl.createTexture(),a=t.gl.TEXTURE_CUBE_MAP,r=s.FILTER_NEAREST,i=s.WRAP_CLAMP_TO_EDGE;t.profileData.profileTextureNew++,t.gl.bindTexture(a,e),t.profileData.profileTextureResize++;for(let e=0;e<6;e+=1){const r=new Uint8Array(256);t.gl.texImage2D(n[e],0,t.gl.RGBA,8,8,0,t.gl.RGBA,t.gl.UNSIGNED_BYTE,r),t.gl.texParameteri(a,t.gl.TEXTURE_MAG_FILTER,t.gl.NEAREST),t.gl.texParameteri(a,t.gl.TEXTURE_MIN_FILTER,t.gl.NEAREST),t.gl.texParameteri(a,t.gl.TEXTURE_WRAP_S,t.gl.CLAMP_TO_EDGE),t.gl.texParameteri(a,t.gl.TEXTURE_WRAP_T,t.gl.CLAMP_TO_EDGE)}return t.gl.bindTexture(a,null),{id:CABLES.uuid(),tex:e,cubemap:e,width:8,height:8,filter:r,wrap:i,unpackAlpha:!0,flip:!0,_fromData:!0,name:"emptyCubemapTexture",anisotropic:0}},s.getTempGradientTexture=function(e){if(e||console.error("[getTempGradientTexture] no cgl!"),e.tempTextureGradient)return e.tempTextureGradient;const t=new s(e),n=new Uint8Array(262144);for(let t=0;t<256;t++)for(let e=0;e<256;e++)n[4*(e+256*t)+0]=n[4*(e+256*t)+1]=n[4*(e+256*t)+2]=255-t,n[4*(e+256*t)+3]=255;return t.initFromData(n,256,256,s.FILTER_NEAREST,s.WRAP_REPEAT),e.tempTextureGradient=t,t},s.getTemporaryTexture=function(e,n,t,a){const r=new s(e),i=[];for(let t=0;t<n;t++)for(let e=0;e<n;e++)(e+t)%64<32?(i.push(200+t/n*25+e/n*25),i.push(200+t/n*25+e/n*25),i.push(200+t/n*25+e/n*25)):(i.push(40+t/n*25+e/n*25),i.push(40+t/n*25+e/n*25),i.push(40+t/n*25+e/n*25)),i.push(255);const o=new Uint8Array(i);return r.initFromData(o,n,n,t,a),r},s.createFromImage=function(e,t,n){const a=new s(e,n=n||{});return a.flip=!1,a.image=t,a.width=t.width,a.height=t.height,a.initTexture(t,n.filter),a},s.fromImage=function(e,t,n,a){console.error("deprecated texture from image...");const r=new s(e);return r.flip=!1,n&&(r.filter=n),a&&(r.wrap=a),r.image=t,r.initTexture(t),r},s.isPowerOfTwo=function(e){return 1==e||2==e||4==e||8==e||16==e||32==e||64==e||128==e||256==e||512==e||1024==e||2048==e||4096==e||8192==e||16384==e},s.FILTER_NEAREST=0,s.FILTER_LINEAR=1,s.FILTER_MIPMAP=2,s.WRAP_REPEAT=0,s.WRAP_MIRRORED_REPEAT=1,s.WRAP_CLAMP_TO_EDGE=2,s.TYPE_DEFAULT=0,s.TYPE_DEPTH=1,s.TYPE_FLOAT=2,s.PFORMATSTR_RGBA32F="RGBA 32bit float",s.PFORMATSTR_RGBA8UB="RGBA 8bit ubyte",s.PIXELFORMATS=[s.PFORMATSTR_RGBA8UB,s.PFORMATSTR_RGBA32F];class l{constructor(e,t){this.id=CABLES.uuid(),this.name=t.name||"unknown cubemap texture",this._cgl=e,this._cubemapFaces=[this._cgl.gl.TEXTURE_CUBE_MAP_POSITIVE_X,this._cgl.gl.TEXTURE_CUBE_MAP_NEGATIVE_X,this._cgl.gl.TEXTURE_CUBE_MAP_POSITIVE_Y,this._cgl.gl.TEXTURE_CUBE_MAP_NEGATIVE_Y,this._cgl.gl.TEXTURE_CUBE_MAP_POSITIVE_Z,this._cgl.gl.TEXTURE_CUBE_MAP_NEGATIVE_Z],this.tex=this._cgl.gl.createTexture(),this.cubemap=this.tex,this.texTarget=this._cgl.gl.TEXTURE_CUBE_MAP,this.width=t.width||8,this.width=t.width||8,this.filter=t.filter||CGL.Texture.FILTER_NEAREST,this.wrap=t.wrap||CGL.Texture.WRAP_CLAMP_TO_EDGE,this.unpackAlpha=t.unpackAlpha||!0,this.flip=t.flip||!0,this._cgl.profileData.profileTextureNew++,this.setSize(t.width,t.height)}setSize(e,t){if((e!=e||e<=0||!e)&&(e=8),(t!=t||t<=0||!t)&&(t=8),(e>this._cgl.maxTexSize||t>this._cgl.maxTexSize)&&console.error("texture size too big! "+e+"x"+t+" / max: "+this._cgl.maxTexSize),e=Math.min(e,this._cgl.maxTexSize),t=Math.min(t,this._cgl.maxTexSize),e=Math.floor(e),t=Math.floor(t),this.width!=e||this.height!=t){this.width=e,this.height=t,this._cgl.gl.bindTexture(this.texTarget,this.tex),this._cgl.profileData.profileTextureResize++,this._setFilter();for(let e=0;e<6;e++)this._cgl.glVersion,this._cgl.gl.texImage2D(this._cubemapFaces[e],0,this._cgl.gl.RGBA,this.width,this.height,0,this._cgl.gl.RGBA,this._cgl.gl.UNSIGNED_BYTE,null);this.updateMipMap(),this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_CUBE_MAP,null)}}_setFilter(){if(this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.unpackAlpha),this.textureType==CGL.Texture.TYPE_FLOAT&&this.filter==CGL.Texture.FILTER_MIPMAP&&(console.log("texture: HDR and mipmap filtering at the same time is not possible"),this.filter=CGL.Texture.FILTER_LINEAR),1!=this._cgl.glVersion||s.isPowerOfTwo()){if(this.wrap==CGL.Texture.WRAP_CLAMP_TO_EDGE)this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_S,this._cgl.gl.CLAMP_TO_EDGE),this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_T,this._cgl.gl.CLAMP_TO_EDGE);else if(this.wrap==CGL.Texture.WRAP_REPEAT)this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_S,this._cgl.gl.REPEAT),this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_T,this._cgl.gl.REPEAT);else{if(this.wrap!=CGL.Texture.WRAP_MIRRORED_REPEAT)throw new Error("[CubemapTexture] unknown texture filter!"+this.filter);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_S,this._cgl.gl.MIRRORED_REPEAT),this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_T,this._cgl.gl.MIRRORED_REPEAT)}if(this.filter==CGL.Texture.FILTER_NEAREST)this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MAG_FILTER,this._cgl.gl.NEAREST),this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MIN_FILTER,this._cgl.gl.NEAREST);else if(this.filter==CGL.Texture.FILTER_LINEAR)this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MIN_FILTER,this._cgl.gl.LINEAR),this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MAG_FILTER,this._cgl.gl.LINEAR);else{if(this.filter!=CGL.Texture.FILTER_MIPMAP)throw new Error("[CubemapTexture] unknown texture filter!"+this.filter);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MAG_FILTER,this._cgl.gl.LINEAR),this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MIN_FILTER,this._cgl.gl.LINEAR_MIPMAP_LINEAR)}}else this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MAG_FILTER,this._cgl.gl.NEAREST),this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MIN_FILTER,this._cgl.gl.NEAREST),this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_S,this._cgl.gl.CLAMP_TO_EDGE),this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_T,this._cgl.gl.CLAMP_TO_EDGE),this.filter=CGL.Texture.FILTER_NEAREST,this.wrap=CGL.Texture.WRAP_CLAMP_TO_EDGE}updateMipMap(){2!=this._cgl.glVersion&&!s.isPowerOfTwo()||this.filter!=CGL.Texture.FILTER_MIPMAP||(this._cgl.gl.generateMipmap(this.texTarget),this._cgl.profileData.profileGenMipMap++)}}CGL.CubemapFramebuffer=class{constructor(e,t,n,a){this._cgl=e,this.width=t||8,this.height=n||8,this._cubemapProperties=[{face:this._cgl.gl.TEXTURE_CUBE_MAP_POSITIVE_X,lookAt:vec3.fromValues(1,0,0),up:vec3.fromValues(0,-1,0)},{face:this._cgl.gl.TEXTURE_CUBE_MAP_NEGATIVE_X,lookAt:vec3.fromValues(-1,0,0),up:vec3.fromValues(0,-1,0)},{face:this._cgl.gl.TEXTURE_CUBE_MAP_POSITIVE_Y,lookAt:vec3.fromValues(0,1,0),up:vec3.fromValues(0,0,1)},{face:this._cgl.gl.TEXTURE_CUBE_MAP_NEGATIVE_Y,lookAt:vec3.fromValues(0,-1,0),up:vec3.fromValues(0,0,-1)},{face:this._cgl.gl.TEXTURE_CUBE_MAP_POSITIVE_Z,lookAt:vec3.fromValues(0,0,1),up:vec3.fromValues(0,-1,0)},{face:this._cgl.gl.TEXTURE_CUBE_MAP_NEGATIVE_Z,lookAt:vec3.fromValues(0,0,-1),up:vec3.fromValues(0,-1,0)}],this._lookAtTemp=vec3.fromValues(0,0,0),this.camPos=vec3.fromValues(0,0,0),this._modelMatrix=mat4.create(),this._viewMatrix=mat4.create(),this._projectionMatrix=mat4.perspective(mat4.create(),90*CGL.DEG2RAD,1,.1,1e3),this._depthRenderbuffer=null,this._framebuffer=null,this._depthbuffer=null,this._textureFrameBuffer=null,this._textureDepth=null,this._options=a||{},this.name=this._options.name||"unknown cubemapframebuffer",this._options.hasOwnProperty("numRenderBuffers")||(this._options.numRenderBuffers=1),this._options.hasOwnProperty("depth")||(this._options.depth=!0),this._options.hasOwnProperty("clear")||(this._options.clear=!0),this._options.hasOwnProperty("multisampling")||(this._options.multisampling=!1,this._options.multisamplingSamples=0),this._options.multisamplingSamples&&(this._cgl.glSlowRenderer&&(this._options.multisamplingSamples=0),this._cgl.gl.MAX_SAMPLES?this._options.multisamplingSamples=Math.min(this._cgl.gl.getParameter(this._cgl.gl.MAX_SAMPLES),this._options.multisamplingSamples):this._options.multisamplingSamples=0),this._options.hasOwnProperty("filter")||(this._options.filter=CGL.Texture.FILTER_LINEAR),this._options.hasOwnProperty("wrap")||(this._options.wrap=CGL.Texture.WRAP_CLAMP_TO_EDGE),this.texture=new l(this._cgl,{width:this.width,height:this.height,filter:this._options.filter,wrap:this._options.wrap,name:this.name+" cubemaptexture"}),this.initializeRenderbuffers(),this.setSize(this.width,this.height)}initializeRenderbuffers(){this._framebuffer=this._cgl.gl.createFramebuffer(),this._depthbuffer=this._cgl.gl.createRenderbuffer(),this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._framebuffer),this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,this._depthbuffer),this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER,this._cgl.gl.DEPTH_COMPONENT16,this.width,this.height),this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.RENDERBUFFER,this._depthbuffer),this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,null),this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,null)}getWidth(){return this.width}getHeight(){return this.height}getGlFrameBuffer(){return this._framebuffer}getDepthRenderBuffer(){return this._depthRenderbuffer}getTextureColor(){return this.texture}getTextureDepth(){return this._textureDepth}dispose(){this.texture=null,this._cgl.gl.deleteRenderbuffer(this._depthRenderbuffer),this._cgl.gl.deleteFramebuffer(this._framebuffer),this._cgl.gl.deleteFramebuffer(this._textureFrameBuffer)}delete(){this.dispose()}setSize(e,t){this._cgl.printError("before cubemap setsize"),this.width=Math.floor(e),this.height=Math.floor(t),this.width=Math.min(this.width,this._cgl.maxTexSize),this.height=Math.min(this.height,this._cgl.maxTexSize),this._cgl.profileData.profileFrameBuffercreate++,this._framebuffer=this._cgl.gl.createFramebuffer(),this._depthbuffer=this._cgl.gl.createRenderbuffer(),this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._framebuffer),this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,this._depthbuffer),this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER,this._cgl.gl.DEPTH_COMPONENT16,this.width,this.height),this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.RENDERBUFFER,this._depthbuffer),this.texture.setSize(this.width,this.height),this._cgl.gl.isFramebuffer(this._framebuffer)||console.warn("invalid framebuffer...");const n=this._cgl.gl.checkFramebufferStatus(this._cgl.gl.FRAMEBUFFER);this.checkErrorsByStatus(n),this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_CUBE_MAP,null),this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,null),this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,null),this._cgl.printError("cubemap setsize")}checkErrorsByStatus(e){switch(e){case this._cgl.gl.FRAMEBUFFER_COMPLETE:break;case this._cgl.gl.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:throw console.error("FRAMEBUFFER_INCOMPLETE_ATTACHMENT...",this.width,this.height,this.texture.tex,this._depthBuffer),new Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");case this._cgl.gl.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:throw console.error("FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT"),new Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");case this._cgl.gl.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:throw console.error("FRAMEBUFFER_INCOMPLETE_DIMENSIONS"),new Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");case this._cgl.gl.FRAMEBUFFER_UNSUPPORTED:throw console.error("FRAMEBUFFER_UNSUPPORTED"),new Error("Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED");case 36059:console.error("Incomplete: FRAMEBUFFER_INCOMPLETE_DRAW_BUFFER from ext. Or Safari/iOS undefined behaviour.");break;default:throw console.error("incomplete framebuffer",e),console.log(this),new Error("Incomplete framebuffer: "+e)}}setFilter(e){this.texture.filter=e,this.texture.setSize(this.width,this.height)}setCamPos(e){this.camPos=e||this.camPos}setMatrices(e,t,n){this._modelMatrix=e||this._modelMatrix,this._viewMatrix=t||this._viewMatrix,this._projectionMatrix=n||this._projectionMatrix}renderStart(){this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_CUBE_MAP,this.texture.tex),this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._framebuffer),this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,this._depthbuffer),this._cgl.gl.viewport(0,0,this.width,this.height),this._cgl.pushGlFrameBuffer(this._framebuffer),this._cgl.pushFrameBuffer(this)}renderStartCubemapFace(e){this._cgl.pushModelMatrix(),this._cgl.pushViewMatrix(),this._cgl.pushPMatrix(),this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0,this._cubemapProperties[e].face,this.texture.tex,0),this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.RENDERBUFFER,this._depthbuffer),this._options.clear&&(this._cgl.gl.clearColor(1,1,1,1),this._cgl.gl.clear(this._cgl.gl.COLOR_BUFFER_BIT|this._cgl.gl.DEPTH_BUFFER_BIT)),this.setMatricesCubemapFace(e)}setMatricesCubemapFace(e){mat4.copy(this._cgl.mMatrix,this._modelMatrix),vec3.add(this._lookAtTemp,this.camPos,this._cubemapProperties[e].lookAt),mat4.lookAt(this._cgl.vMatrix,this.camPos,this._lookAtTemp,this._cubemapProperties[e].up),mat4.copy(this._cgl.pMatrix,this._projectionMatrix)}renderEndCubemapFace(){this._cgl.popPMatrix(),this._cgl.popModelMatrix(),this._cgl.popViewMatrix()}renderEnd(){this._cgl.profileData.profileFramebuffer++,1!==this._cgl.glVersion&&(this._cgl.gl.bindFramebuffer(this._cgl.gl.READ_FRAMEBUFFER,this._framebuffer),this._cgl.gl.bindFramebuffer(this._cgl.gl.DRAW_FRAMEBUFFER,this._textureFrameBuffer)),this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.popGlFrameBuffer()),this._cgl.popFrameBuffer(),this._cgl.resetViewPort(),this.updateMipMap()}updateMipMap(){this.texture&&(this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_CUBE_MAP,this.texture.tex),this.texture.updateMipMap(),this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_CUBE_MAP,null))}}}]).Cubemapframebuffer;